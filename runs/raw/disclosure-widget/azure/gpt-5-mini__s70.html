<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b6efd;
      --bg:#f7f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:8px;
      --shadow: 0 6px 18px rgba(11,110,253,0.08);
    }
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,var(--bg),#eef4ff 60%);
      color:#0f1724;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
      box-sizing:border-box;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }
    p.lead{
      margin:0 0 24px 0;
      color:var(--muted);
      font-size:14px;
    }

    .container{
      max-width:820px;
      margin:0 auto;
    }

    /* Example wrapper */
    .example{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      margin:18px 0;
    }

    /* Header area with button */
    .summary{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .toggle-btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(15,23,36,0.06);
      background:transparent;
      cursor:pointer;
      font-weight:600;
      color:var(--accent);
      font-size:14px;
      transition:background .12s, transform .12s;
    }
    .toggle-btn:focus{
      outline:3px solid rgba(11,110,253,0.15);
      outline-offset:3px;
    }
    .toggle-btn:active{ transform:translateY(1px); }

    .toggle-icon{
      width:16px;
      height:16px;
      display:inline-block;
      transition:transform .25s ease;
      transform-origin:center;
    }
    .toggle-btn[aria-expanded="true"] .toggle-icon{
      transform:rotate(180deg);
    }

    /* Controlled content */
    .details{
      overflow:hidden;
      max-height:0;
      transition:max-height .28s ease;
      margin-top:12px;
    }
    .details-inner{
      padding:10px 2px 6px 2px;
      color:#111827;
      border-left:3px solid rgba(11,110,253,0.06);
    }

    .meta{
      color:var(--muted);
      font-size:13px;
      margin-top:8px;
    }

    /* Small visual tweak for accordion sections */
    .accordion-section + .accordion-section{
      margin-top:8px;
      padding-top:8px;
      border-top:1px dashed rgba(15,23,36,0.04);
    }

    /* Responsive */
    @media (max-width:520px){
      .toggle-btn{ width:100%; justify-content:center; }
      .summary{flex-direction:column; align-items:stretch;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget Examples</h1>
    <p class="lead">Each widget is wrapped with a div.example. The controlled content uses a container with the class details. Buttons use aria-expanded and aria-controls for accessibility.</p>

    <!-- Example 1: Simple expand/collapse -->
    <div class="example" id="example-1">
      <div class="summary">
        <button class="toggle-btn" aria-expanded="false" aria-controls="details-1" id="btn-1">
          <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Show more
        </button>
        <div style="flex:1">
          <div style="font-weight:600">Simple details</div>
          <div class="meta">Click the button to reveal additional content.</div>
        </div>
      </div>

      <div class="details" id="details-1" role="region" aria-labelledby="btn-1" aria-hidden="true">
        <div class="details-inner">
          <p style="margin:0 0 8px 0">
            This is an example of a simple expand/collapse widget. The button controls the visibility of this content.
            The script animates the opening and closing for a smooth transition and preserves accessibility attributes.
          </p>
          <p class="meta" style="margin:0">Accessible attributes: aria-expanded and aria-controls on the button; aria-hidden on the details region.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: Longer content with images and paragraphs -->
    <div class="example" id="example-2">
      <div class="summary">
        <button class="toggle-btn" aria-expanded="false" aria-controls="details-2" id="btn-2">
          <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Read details
        </button>
        <div style="flex:1">
          <div style="font-weight:600">More elaborate content</div>
          <div class="meta">Content includes text and a decorative image.</div>
        </div>
      </div>

      <div class="details" id="details-2" role="region" aria-labelledby="btn-2" aria-hidden="true">
        <div class="details-inner">
          <p style="margin:0 0 10px 0">
            Here's a longer description with a small decorative illustration. In real usage this area could contain
            forms, lists, or any interactive content you need to reveal on demand.
          </p>
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='120'%3E%3Crect width='100%25' height='100%25' fill='%23e8f0ff'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='18' fill='%230b6efd'%3D%3EDecorative%20illustration%3C/text%3E%3C/svg%3E" alt="" style="width:100%; max-width:460px; height:auto; display:block; margin:8px 0;">
          <p class="meta" style="margin:0">Images used here are decorative; they include empty alt text. Interactive elements placed inside should be focusable and reachable by keyboard.</p>
        </div>
      </div>
    </div>

    <!-- Example 3: Accordion - only one open at a time -->
    <div class="example" id="example-3">
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
        <div style="font-weight:600">Accordion (single-open)</div>
        <div class="meta">Only one section stays open at a time.</div>
      </div>

      <div class="accordion" data-accordion="single">
        <div class="accordion-section">
          <div class="summary">
            <button class="toggle-btn" aria-expanded="false" aria-controls="acc-1" id="acc-btn-1">
              <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Section 1
            </button>
          </div>
          <div class="details" id="acc-1" role="region" aria-labelledby="acc-btn-1" aria-hidden="true">
            <div class="details-inner">
              <p style="margin:0">Content for section one. Open a different section to automatically close this one.</p>
            </div>
          </div>
        </div>

        <div class="accordion-section">
          <div class="summary">
            <button class="toggle-btn" aria-expanded="false" aria-controls="acc-2" id="acc-btn-2">
              <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Section 2
            </button>
          </div>
          <div class="details" id="acc-2" role="region" aria-labelledby="acc-btn-2" aria-hidden="true">
            <div class="details-inner">
              <p style="margin:0">Content for section two, which is a bit longer so you can see the animation effect.</p>
            </div>
          </div>
        </div>

        <div class="accordion-section">
          <div class="summary">
            <button class="toggle-btn" aria-expanded="false" aria-controls="acc-3" id="acc-btn-3">
              <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Section 3
            </button>
          </div>
          <div class="details" id="acc-3" role="region" aria-labelledby="acc-btn-3" aria-hidden="true">
            <div class="details-inner">
              <p style="margin:0">Final section content. The accordion behavior is implemented in the script below.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    (function(){
      // Utility to expand/collapse an element with smooth height transition
      function openDetails(detailsEl){
        // prepare
        detailsEl.setAttribute('aria-hidden','false');
        // measure
        const start = detailsEl.clientHeight;
        // temporarily disable transition to get accurate scrollHeight if necessary
        detailsEl.style.transition = 'none';
        // Force the browser to compute styles
        detailsEl.style.maxHeight = 'none';
        const full = detailsEl.scrollHeight;
        // reset to start
        detailsEl.style.maxHeight = start + 'px';
        // re-enable transition
        requestAnimationFrame(() => {
          detailsEl.style.transition = '';
          detailsEl.style.maxHeight = full + 'px';
        });

        // when transition ends, remove inline maxHeight to allow natural resizing
        const cleanup = function onEnd(e){
          if (e && e.target !== detailsEl) return;
          detailsEl.style.maxHeight = 'none';
          detailsEl.removeEventListener('transitionend', cleanup);
        };
        detailsEl.addEventListener('transitionend', cleanup);
        detailsEl.classList.add('open');
      }

      function closeDetails(detailsEl){
        // fix height to current height, then animate to 0
        const cur = detailsEl.getBoundingClientRect().height;
        detailsEl.style.maxHeight = cur + 'px';
        // force reflow
        detailsEl.getBoundingClientRect();
        requestAnimationFrame(() => {
          detailsEl.style.maxHeight = '0px';
        });

        const cleanup = function onEnd(e){
          if (e && e.target !== detailsEl) return;
          detailsEl.setAttribute('aria-hidden','true');
          detailsEl.classList.remove('open');
          // clear inline maxHeight so future openings compute fresh heights
          detailsEl.style.maxHeight = '';
          detailsEl.removeEventListener('transitionend', cleanup);
        };
        detailsEl.addEventListener('transitionend', cleanup);
      }

      // Initialize all toggle buttons
      document.querySelectorAll('.toggle-btn').forEach(btn => {
        const id = btn.getAttribute('aria-controls');
        if(!id) return;
        const details = document.getElementById(id);
        if(!details) return;

        // Ensure initial attributes
        if (btn.getAttribute('aria-expanded') === 'true'){
          details.setAttribute('aria-hidden','false');
          details.style.maxHeight = 'none';
        } else {
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          // If inside single-open accordion, close siblings
          const accordion = btn.closest('[data-accordion="single"]');
          if(!expanded){
            // open
            btn.setAttribute('aria-expanded','true');
            // If accordion single, close other open sections first
            if(accordion){
              const others = accordion.querySelectorAll('.toggle-btn[aria-expanded="true"]');
              others.forEach(otherBtn => {
                if(otherBtn === btn) return;
                const otherId = otherBtn.getAttribute('aria-controls');
                const otherDetails = document.getElementById(otherId);
                otherBtn.setAttribute('aria-expanded','false');
                if(otherDetails) closeDetails(otherDetails);
              });
            }
            openDetails(details);
          } else {
            btn.setAttribute('aria-expanded','false');
            closeDetails(details);
          }
        });
      });

      // Allow toggling with Enter/Space is already supported for <button>
      // Close everything if user presses Escape while focused inside a details region
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape'){
          const openDetailsEls = document.querySelectorAll('.details.open');
          openDetailsEls.forEach(el => {
            // find the controlling button and update its aria-expanded
            const id = el.id;
            if(!id) return;
            const controller = document.querySelector('[aria-controls="'+id+'"]');
            if(controller){
              controller.setAttribute('aria-expanded','false');
            }
            closeDetails(el);
          });
        }
      });

      // Improve reduced-motion preference: disable transition if user prefers reduced motion
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if(mq.matches){
        document.querySelectorAll('.details').forEach(el => {
          el.style.transition = 'none';
        });
      }
    })();
  </script>
</body>
</html>