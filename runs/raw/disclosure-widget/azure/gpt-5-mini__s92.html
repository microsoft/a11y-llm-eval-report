<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0f62fe;
      --radius:8px;
      --shadow: 0 6px 18px rgba(15, 98, 254, 0.08);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: linear-gradient(180deg,var(--bg),#ffffff 200px);
      color: #101828;
      line-height: 1.45;
    }

    h1 {
      margin: 0 0 18px 0;
      font-size: 20px;
    }
    p.lead {
      margin: 0 0 24px 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* Wrapper for examples */
    .example {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      margin: 16px 0;
      box-shadow: var(--shadow);
      max-width: 780px;
      border: 1px solid rgba(16,24,40,0.04);
    }

    /* Toggle button */
    .toggle {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: transparent;
      border: none;
      padding: 12px 14px;
      text-align: left;
      cursor: pointer;
      font-size: 16px;
      border-radius: 8px;
    }
    .toggle:hover {
      background: rgba(15,98,254,0.04);
    }
    .toggle:focus {
      outline: 3px solid rgba(15,98,254,0.16);
      outline-offset: 2px;
    }
    .title {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      flex: 1 1 auto;
    }
    .title .heading {
      font-weight: 600;
      color: #0f1724;
    }
    .title .sub {
      font-size: 13px;
      color: var(--muted);
    }

    /* Chevron icon */
    .chev {
      width: 28px;
      height: 28px;
      display: inline-grid;
      place-items: center;
      flex: 0 0 28px;
      transition: transform 220ms ease;
      color: var(--accent);
    }
    .chev svg {
      display: block;
      width: 16px;
      height: 16px;
      transform-origin: 50% 50%;
    }
    .toggle[aria-expanded="true"] .chev {
      transform: rotate(180deg);
    }

    /* Controlled content area */
    .details {
      overflow: hidden;
      transition: max-height 260ms cubic-bezier(.2,.9,.2,1), opacity 220ms ease;
      max-height: 0;
      opacity: 0;
      margin-top: 12px;
      will-change: max-height, opacity;
    }
    .details.open {
      opacity: 1;
    }
    .details .content {
      padding: 12px 14px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border-radius: 8px;
      border: 1px solid rgba(16,24,40,0.03);
      box-shadow: 0 4px 14px rgba(2,6,23,0.04);
    }
    .details p {
      margin: 0;
      color: #23304a;
      font-size: 14px;
    }

    /* Small helper text and controls inside details */
    .meta {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width:560px){
      body { margin: 16px; }
      .example { padding: 12px; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">These examples demonstrate an accessible expand/collapse widget. The content area uses the class "details" and each widget is wrapped in a div with class "example".</p>

  <!-- Example 1: collapsed by default -->
  <div class="example" data-widget="1">
    <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1">
      <span class="title">
        <span class="heading">Shipping information</span>
        <span class="sub">Estimated delivery, tracking, and returns</span>
      </span>
      <span class="chev" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" focusable="false" aria-hidden="true">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </span>
    </button>

    <div id="details-1" class="details" aria-hidden="true">
      <div class="content">
        <p>
          Orders typically ship within 1–2 business days. Once shipped, you will receive a tracking number by email.
          Standard delivery takes 3–7 business days depending on your location. International shipping times vary.
        </p>
        <div class="meta">Pro tip: Use the tracking number to get live updates from the carrier.</div>
      </div>
    </div>
  </div>

  <!-- Example 2: expanded by default -->
  <div class="example" data-widget="2">
    <button class="toggle" aria-expanded="true" aria-controls="details-2" id="toggle-2">
      <span class="title">
        <span class="heading">Account security</span>
        <span class="sub">Manage two-factor authentication and connected devices</span>
      </span>
      <span class="chev" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" focusable="false" aria-hidden="true">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </span>
    </button>

    <div id="details-2" class="details open" aria-hidden="false">
      <div class="content">
        <p>
          Two-factor authentication adds an extra layer of protection by requiring a second form of verification when signing in.
          Enable it via your account settings and register your phone or an authenticator app.
        </p>
        <div class="meta">You can review and revoke connected devices from this panel at any time.</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Utility to initialize each widget
      function initExample(root) {
        var button = root.querySelector('.toggle');
        var details = root.querySelector('.details');

        if (!button || !details) return;

        // Ensure details has an id for aria-controls; if not, create one.
        if (!details.id) {
          details.id = 'details-' + Math.random().toString(36).slice(2,9);
          button.setAttribute('aria-controls', details.id);
        }

        // Read initial expanded state from button attribute (default false)
        var expanded = button.getAttribute('aria-expanded') === 'true';

        // Sync aria-hidden on details
        details.setAttribute('aria-hidden', (!expanded).toString());

        // Prepare height for transition
        function setMaxHeightForState(isOpen, immediate) {
          var contentHeight = details.scrollHeight;
          if (isOpen) {
            // from 0 -> contentHeight, then clear inline max-height after transition
            details.style.maxHeight = contentHeight + 'px';
            details.classList.add('open');
          } else {
            // set max-height to current height first (to enable transition), then to 0
            details.style.maxHeight = details.scrollHeight + 'px';
            // Force a reflow so the height is applied before collapsing
            details.getBoundingClientRect();
            details.style.maxHeight = '0px';
            details.classList.remove('open');
          }
          if (immediate) {
            // remove transition and set directly
            details.style.transition = 'none';
            if (isOpen) details.style.maxHeight = 'none';
            else details.style.maxHeight = '0px';
            // force reflow and restore transition
            void details.offsetHeight;
            details.style.transition = '';
          }
        }

        // Initialize styles based on expanded state
        if (expanded) {
          // set max-height to content height so transition on page load doesn't animate unexpectedly
          details.style.maxHeight = details.scrollHeight + 'px';
          details.classList.add('open');
        } else {
          details.style.maxHeight = '0px';
          details.classList.remove('open');
        }

        // After transition ends, if open, clear max-height so content can resize naturally
        details.addEventListener('transitionend', function (e) {
          if (e.propertyName !== 'max-height') return;
          if (button.getAttribute('aria-expanded') === 'true') {
            details.style.maxHeight = 'none';
          }
        });

        // Toggle handler
        function toggle() {
          var isOpen = button.getAttribute('aria-expanded') === 'true';
          var next = !isOpen;
          button.setAttribute('aria-expanded', String(next));
          details.setAttribute('aria-hidden', String(!next));
          // When opening, temporarily set max-height from 0 to scrollHeight
          if (next) {
            // make sure max-height is 0 before opening (if previously none)
            if (details.style.maxHeight === 'none' || !details.style.maxHeight) {
              details.style.maxHeight = '0px';
            }
            // Force reflow then set to content height
            void details.offsetHeight;
            setMaxHeightForState(true);
          } else {
            // closing: if maxHeight is none, set it to current scrollHeight first
            if (details.style.maxHeight === 'none' || !details.style.maxHeight) {
              details.style.maxHeight = details.scrollHeight + 'px';
            }
            // Force reflow then set to 0
            void details.offsetHeight;
            setMaxHeightForState(false);
          }
        }

        // Click toggles
        button.addEventListener('click', function (e) {
          toggle();
        });

        // Support keyboard activation for non-button elements (button already handles Enter/Space)
        // Add optional Esc behavior: close when Esc pressed while focus is inside details
        details.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' || e.key === 'Esc') {
            if (button.getAttribute('aria-expanded') === 'true') {
              button.focus();
              toggle();
            }
          }
        });

        // Ensure window resize recalculates max-heights when open
        var resizeObserver = new ResizeObserver(function(){
          if (button.getAttribute('aria-expanded') === 'true') {
            // If currently open and max-height was cleared (none), keep it none.
            if (details.style.maxHeight === 'none' || !details.style.maxHeight) return;
            // Otherwise update the max-height to the new scrollHeight
            details.style.maxHeight = details.scrollHeight + 'px';
          }
        });
        resizeObserver.observe(details);
      }

      // Initialize all examples on DOM ready
      document.addEventListener('DOMContentLoaded', function(){
        var examples = document.querySelectorAll('.example');
        examples.forEach(initExample);
      });
    })();
  </script>
</body>
</html>