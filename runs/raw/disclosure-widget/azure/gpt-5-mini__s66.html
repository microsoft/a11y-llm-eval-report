<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b74de;
      --bg:#f7f9fb;
      --muted:#6b7280;
      --radius:8px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg, #ffffff 0%, #f2f6fb 100%);
      color:#0f1724;
      line-height:1.45;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }

    p.lead{
      margin:0 0 20px 0;
      color:var(--muted);
    }

    /* Example wrapper */
    .example{
      background: #fff;
      border: 1px solid rgba(15,23,36,0.06);
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: 0 1px 2px rgba(15,23,36,0.03);
      margin-bottom: 16px;
    }

    /* Toggle button */
    .toggle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
      background:transparent;
      border:1px solid rgba(15,23,36,0.06);
      padding:10px 12px;
      border-radius:6px;
      font-size:15px;
      cursor:pointer;
      color: #071133;
      transition:box-shadow .12s, border-color .12s;
    }

    .toggle:focus{
      outline:none;
      box-shadow:0 0 0 4px rgba(11,116,222,0.12);
      border-color:var(--accent);
    }

    .toggle .label{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .toggle .title{
      font-weight:600;
    }

    .toggle .meta{
      color:var(--muted);
      font-size:13px;
    }

    /* Caret icon using pseudo-element */
    .toggle::after{
      content:"";
      display:inline-block;
      width:12px;
      height:12px;
      border-right:2px solid var(--muted);
      border-bottom:2px solid var(--muted);
      transform:rotate(-45deg);
      transition: transform .22s ease, border-color .22s ease;
      margin-left:12px;
    }

    .toggle.is-open{
      border-color: rgba(11,116,222,0.16);
    }

    .toggle.is-open::after{
      transform:rotate(45deg);
      border-color:var(--accent);
    }

    /* Controlled content container */
    .details{
      overflow:hidden;
      height:0;
      transition:height 240ms cubic-bezier(.2,.9,.2,1);
      margin-top:12px;
      border-radius:6px;
      background:var(--bg);
      border:1px solid rgba(15,23,36,0.03);
      padding:0 12px;
    }

    .details .inner{
      padding:12px 6px 16px 6px;
    }

    .details p{
      margin:0 0 8px 0;
      color:#101828;
    }

    .details small{
      color:var(--muted);
      display:block;
    }

    /* When JS is disabled, show content (progressive enhancement) */
    .no-js .details{
      height:auto;
    }

    /* Smaller variant */
    .toggle.small{
      padding:8px 10px;
      font-size:14px;
    }

    /* Demo nested details styling tweaks */
    .details .example{
      margin:6px 0 0 0;
      padding:8px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Each widget is wrapped with a div.example. The controlled content container uses the class details. The controls are accessible (aria-expanded, aria-controls, role=region).</p>

  <!-- Example 1: simple -->
  <div class="example" id="example-1">
    <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1" type="button">
      <span class="label">
        <span class="title">Basic details</span>
        <span class="meta">Click to expand</span>
      </span>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
      <div class="inner">
        <p>This is the controlled content for the "Basic details" example. It's initially collapsed and expands smoothly when you activate the control.</p>
        <p><small>Tip: Buttons respond to Enter and Space, and the icon rotates to indicate state.</small></p>
      </div>
    </div>
  </div>

  <!-- Example 2: initially open -->
  <div class="example" id="example-2">
    <button class="toggle is-open" id="toggle-2" aria-expanded="true" aria-controls="details-2" type="button">
      <span class="label">
        <span class="title">Initially open</span>
        <span class="meta">Starts expanded</span>
      </span>
    </button>

    <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="false">
      <div class="inner">
        <p>This panel is shown by default. The script will compute and reveal it on load to match the aria-expanded state provided in the button.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: nested widget -->
  <div class="example" id="example-3">
    <button class="toggle" id="toggle-3" aria-expanded="false" aria-controls="details-3" type="button">
      <span class="label">
        <span class="title">Nested details</span>
        <span class="meta">Contains another collapsible area</span>
      </span>
    </button>

    <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
      <div class="inner">
        <p>Outer content. Below is a nested expand/collapse widget demonstrating nested regions.</p>

        <div class="example">
          <button class="toggle small" id="toggle-3-1" aria-expanded="false" aria-controls="details-3-1" type="button">
            <span class="label">
              <span class="title">Nested item</span>
            </span>
          </button>

          <div id="details-3-1" class="details" role="region" aria-labelledby="toggle-3-1" aria-hidden="true">
            <div class="inner">
              <p>Nested content inside the outer details. Animations and aria states are handled independently to allow nested expansions.</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // If JS runs, remove the no-js class (used by CSS progressive enhancement).
    document.documentElement.classList.remove('no-js');

    (function(){
      // Utility to animate open/close by manipulating height
      function openDetails(el){
        el.style.display = 'block'; // ensure measurable
        var startHeight = el.getBoundingClientRect().height;
        // get the target height
        var targetHeight;
        // Temporarily set height to 'auto' to measure full height
        el.style.height = 'auto';
        targetHeight = el.scrollHeight;
        // Start from current computed height (could be 0)
        el.style.height = startHeight + 'px';
        // Force a reflow so the height change is picked up
        el.getBoundingClientRect();
        // Then animate to the target height
        requestAnimationFrame(function(){
          el.style.height = targetHeight + 'px';
        });
        // After transition ends, clear inline height to allow content to size naturally
        var cleanup = function onTransitionEnd(e){
          if (e && e.target !== el) return;
          el.style.height = 'auto';
          el.removeEventListener('transitionend', cleanup);
        };
        el.addEventListener('transitionend', cleanup);
      }

      function closeDetails(el){
        // Set height to current pixel height, then transition to 0
        var curHeight = el.getBoundingClientRect().height;
        el.style.height = curHeight + 'px';
        // Force reflow
        el.getBoundingClientRect();
        requestAnimationFrame(function(){
          el.style.height = '0px';
        });
        var cleanup = function onTransitionEnd(e){
          if (e && e.target !== el) return;
          // keep it hidden but ensure it's not taking up space
          el.style.display = '';
          el.removeEventListener('transitionend', cleanup);
        };
        el.addEventListener('transitionend', cleanup);
      }

      // Find all toggle buttons that control a details container
      var toggles = Array.prototype.slice.call(document.querySelectorAll('.toggle[aria-controls]'));

      toggles.forEach(function(btn){
        var detailsId = btn.getAttribute('aria-controls');
        var details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure ARIA attributes exist on the content
        if (!details.hasAttribute('role')) details.setAttribute('role','region');
        var labelled = btn.id || ('btn-' + Math.random().toString(36).slice(2,9));
        if (!btn.id) btn.id = labelled;
        details.setAttribute('aria-labelledby', btn.id);

        // Initialize state based on aria-expanded
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        // Set initial visual state for content
        if (expanded){
          // make visible and set height:auto after measuring to avoid jump
          details.style.display = 'block';
          // allow a tiny delay to permit layout, then set height to auto
          details.style.height = 'auto';
          details.setAttribute('aria-hidden','false');
          btn.classList.add('is-open');
        } else {
          // ensure collapsed
          details.style.height = '0px';
          details.setAttribute('aria-hidden','true');
          btn.classList.remove('is-open');
        }

        // Click handler
        btn.addEventListener('click', function(){
          var isOpen = btn.getAttribute('aria-expanded') === 'true';
          if (isOpen){
            // close
            btn.setAttribute('aria-expanded','false');
            details.setAttribute('aria-hidden','true');
            btn.classList.remove('is-open');
            closeDetails(details);
          } else {
            // open
            btn.setAttribute('aria-expanded','true');
            details.setAttribute('aria-hidden','false');
            btn.classList.add('is-open');
            openDetails(details);
          }
        });

        // If the details starts open, ensure its height is set to auto after a tiny delay
        // to allow CSS transition to settle correctly
        if (btn.getAttribute('aria-expanded') === 'true'){
          // Force a short timeout to ensure measured heights are correct before next interactions
          setTimeout(function(){
            // Ensure style height is auto (so content can grow/shrink within)
            details.style.height = 'auto';
          }, 50);
        }
      });

      // Handle window resize: adjust any open panels that may have height set to auto -> leave auto,
      // but those that were left with a fixed px height (during opening) should be reconciled.
      var resizeTimer = null;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
          toggles.forEach(function(btn){
            var details = document.getElementById(btn.getAttribute('aria-controls'));
            if (!details) return;
            if (btn.getAttribute('aria-expanded') === 'true'){
              // make sure height is auto to accommodate changes
              details.style.height = 'auto';
            }
          });
        }, 120);
      });

      // Accessibility: allow Enter/Space handled by button element naturally.
      // No further keyboard handling required here.
    })();

    // If JS did not run, add a class to the html element to allow CSS to show details (progressive enhancement)
    // We'll add a .no-js class at parse time above; ensure it's present if script doesn't run.
  </script>

  <noscript>
    <style>
      /* If JS is disabled, show all details containers */
      .details { height:auto !important; display:block !important; }
      .toggle::after{ display:none; }
    </style>
    <div style="margin-top:12px;padding:12px;background:#fff3cd;border:1px solid #ffeeba;border-radius:6px;">
      JavaScript is disabled in your browser. All sections are expanded so the content remains accessible.
    </div>
  </noscript>
</body>
</html>