<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b6efd;
      --bg:#fff;
      --muted:#6b7280;
      --focus: 3px rgba(11,110,253,0.25);
      --radius:8px;
      --transition:250ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.5;
      background:#f6f7fb;
      color:#0f172a;
      padding:36px;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
      font-weight:600;
    }

    .grid{
      display:grid;
      gap:18px;
      max-width:880px;
    }

    .example{
      background:var(--bg);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 1px 2px rgba(15,23,42,0.04), 0 8px 24px rgba(15,23,42,0.04);
      border:1px solid rgba(15,23,42,0.04);
    }

    .summary{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }

    button.toggle{
      appearance:none;
      border:1px solid rgba(15,23,42,0.06);
      background:linear-gradient(180deg, #fff, #fbfdff);
      padding:10px 12px;
      border-radius:8px;
      width:100%;
      text-align:left;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      font-size:15px;
      color:inherit;
      transition:box-shadow var(--transition), border-color var(--transition), transform var(--transition);
    }

    button.toggle:focus{
      outline:none;
      box-shadow:var(--focus);
      border-color:var(--accent);
    }

    .toggle .meta{
      display:flex;
      flex-direction:column;
      gap:2px;
      flex:1;
    }

    .toggle .title{
      font-weight:600;
      font-size:15px;
      color:#0f172a;
    }

    .toggle .subtitle{
      font-size:13px;
      color:var(--muted);
    }

    .toggle .icon{
      width:28px;
      height:28px;
      display:inline-grid;
      place-items:center;
      flex-shrink:0;
      color:var(--muted);
      transition:transform var(--transition);
      border-radius:6px;
    }

    button.toggle[aria-expanded="true"] .icon{
      transform:rotate(180deg);
      color:var(--accent);
    }

    /* Controlled content container */
    .details{
      overflow:hidden;
      transition:max-height var(--transition), padding var(--transition);
      margin-top:12px;
      border-radius:6px;
      padding:12px;
      background:linear-gradient(180deg, #fbfdff, #fff);
      border:1px solid rgba(11,110,253,0.04);
    }

    .details.closed{
      padding-top:0;
      padding-bottom:0;
      border-color:transparent;
    }

    .details p{
      margin:0 0 8px 0;
      color:#16324f;
      font-size:14px;
    }

    .meta-list{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
    }

    .badge{
      background:#eef6ff;
      color:var(--accent);
      padding:6px 8px;
      border-radius:999px;
      font-size:12px;
    }

    /* Small helper for code block */
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      background:#0f172a;
      color:#fff;
      padding:8px;
      border-radius:6px;
      display:block;
      overflow:auto;
    }

    /* Responsive */
    @media (max-width:640px){
      .toggle .meta{ gap:4px; }
      body{ padding:18px; }
    }
  </style>
</head>
<body>
  <main class="grid" role="main">
    <h1>Expand / Collapse Widget Examples</h1>

    <div class="example">
      <div class="summary">
        <button class="toggle" id="toggle-1" data-toggle="details" aria-expanded="false" aria-controls="details-1" type="button">
          <div class="meta">
            <span class="title">Basic details</span>
            <span class="subtitle">Click to expand or collapse this content</span>
          </div>
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-1" class="details closed" role="region" aria-labelledby="toggle-1" aria-hidden="true" style="max-height:0;">
        <p>
          This is a simple expand/collapse example. It uses an accessible button with aria-expanded and aria-controls.
        </p>
        <p class="meta-list">
          <span class="badge">Accessible</span>
          <span class="badge">Animated</span>
        </p>
      </div>
    </div>

    <div class="example">
      <div class="summary">
        <button class="toggle" id="toggle-2" data-toggle="details" aria-expanded="true" aria-controls="details-2" type="button">
          <div class="meta">
            <span class="title">Expanded by default</span>
            <span class="subtitle">Starts open to show how the widget behaves when visible</span>
          </div>
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="false" style="max-height:none;">
        <p>
          This panel is expanded by default. When opened it clears the explicit max-height so content can grow naturally.
        </p>
        <p class="meta-list">
          <span class="badge">Default open</span>
          <span class="badge">Responsive</span>
        </p>
      </div>
    </div>

    <div class="example">
      <div class="summary">
        <button class="toggle" id="toggle-3" data-toggle="details" aria-expanded="false" aria-controls="details-3" type="button">
          <div class="meta">
            <span class="title">Long content example</span>
            <span class="subtitle">Handles dynamic height changes and animates smoothly</span>
          </div>
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-3" class="details closed" role="region" aria-labelledby="toggle-3" aria-hidden="true" style="max-height:0;">
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam.
        </p>
        <p>
          Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper porta.
        </p>
        <p>
          Mauris ipsum. Nulla metus metus, ullamcorper vel, tincidunt sed, euismod in, nibh. Quisque volutpat condimentum velit.
        </p>
      </div>
    </div>

    <div class="example" aria-hidden="true">
      <div class="summary">
        <button class="toggle" id="toggle-4" data-toggle="details" aria-expanded="false" aria-controls="details-4" type="button">
          <div class="meta">
            <span class="title">Programmatic control</span>
            <span class="subtitle">You can toggle this via the controls below</span>
          </div>
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-4" class="details closed" role="region" aria-labelledby="toggle-4" aria-hidden="true" style="max-height:0;">
        <p>
          This panel demonstrates programmatic control. Use the buttons to open, close or toggle.
        </p>
        <div style="display:flex;gap:8px;margin-top:10px;">
          <button id="open-4" style="padding:8px 10px;border-radius:6px;border:1px solid #e6eefc;background:#f8fbff;cursor:pointer;">Open</button>
          <button id="close-4" style="padding:8px 10px;border-radius:6px;border:1px solid #ffece6;background:#fff8f6;cursor:pointer;">Close</button>
          <button id="toggle-btn-4" style="padding:8px 10px;border-radius:6px;border:1px solid #e6f7ed;background:#f7fffb;cursor:pointer;">Toggle</button>
        </div>
      </div>
    </div>

  </main>

  <script>
    (function(){
      // Utility to animate open/close using max-height
      function openDetails(content, button){
        // If already open, do nothing
        if (button.getAttribute('aria-expanded') === 'true') return;

        content.classList.remove('closed');
        // Measure height
        content.style.maxHeight = '0px';
        content.style.display = 'block';
        // Allow the browser to apply the maxHeight=0 before measuring
        requestAnimationFrame(function(){
          var fullHeight = content.scrollHeight;
          content.style.maxHeight = fullHeight + 'px';
          content.setAttribute('aria-hidden', 'false');
          button.setAttribute('aria-expanded', 'true');
        });

        // After transition, clear maxHeight so content can flex
        var once = function(){
          content.style.maxHeight = 'none';
          content.removeEventListener('transitionend', once);
        };
        content.addEventListener('transitionend', once);
      }

      function closeDetails(content, button){
        if (button.getAttribute('aria-expanded') === 'false') return;

        // Fix the height so we can animate to 0
        content.style.maxHeight = content.scrollHeight + 'px';
        // Force reflow then set maxHeight to 0
        requestAnimationFrame(function(){
          content.style.maxHeight = '0px';
          content.setAttribute('aria-hidden', 'true');
          button.setAttribute('aria-expanded', 'false');
          content.classList.add('closed');
        });

        // After transition, keep maxHeight=0 (and closed)
        var once = function(){
          // ensure the element remains collapsed
          content.style.display = '';
          content.removeEventListener('transitionend', once);
        };
        content.addEventListener('transitionend', once);
      }

      function toggleDetails(content, button){
        if (button.getAttribute('aria-expanded') === 'true'){
          closeDetails(content, button);
        } else {
          openDetails(content, button);
        }
      }

      // Initialize all toggles
      document.querySelectorAll('button[data-toggle="details"]').forEach(function(btn){
        var cid = btn.getAttribute('aria-controls');
        var content = document.getElementById(cid);
        if (!content) return;

        // Ensure aria-hidden aligns with aria-expanded on initial load
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        content.setAttribute('aria-hidden', expanded ? 'false' : 'true');
        if (!expanded){
          // collapsed
          content.classList.add('closed');
          content.style.maxHeight = '0';
        } else {
          content.style.maxHeight = 'none';
        }

        btn.addEventListener('click', function(){
          toggleDetails(content, btn);
        });

        // Allow Enter/Space handled by button automatically; no extra keyboard handling required.
      });

      // Programmatic controls for example 4
      var btnOpen4 = document.getElementById('open-4');
      var btnClose4 = document.getElementById('close-4');
      var btnToggle4 = document.getElementById('toggle-btn-4');
      var content4 = document.getElementById('details-4');
      var toggleBtn4 = document.getElementById('toggle-4');

      if (btnOpen4 && btnClose4 && btnToggle4 && content4 && toggleBtn4){
        btnOpen4.addEventListener('click', function(){ openDetails(content4, toggleBtn4); });
        btnClose4.addEventListener('click', function(){ closeDetails(content4, toggleBtn4); });
        btnToggle4.addEventListener('click', function(){ toggleDetails(content4, toggleBtn4); });
      }

      // Handle window resize: if a panel is open and has max-height none, we don't need adjustments
      // But if a panel is open with explicit maxHeight (mid-animation) and window resizes, recalc
      window.addEventListener('resize', function(){
        document.querySelectorAll('.details').forEach(function(content){
          var labelled = document.querySelector('[aria-controls="' + content.id + '"]');
          if (!labelled) return;
          if (labelled.getAttribute('aria-expanded') === 'true'){
            // If maxHeight is 'none', nothing to do. If it's set to px, update to current scrollHeight to avoid clipping.
            if (content.style.maxHeight && content.style.maxHeight !== 'none'){
              content.style.maxHeight = content.scrollHeight + 'px';
            }
          }
        });
      });
    })();
  </script>
</body>
</html>