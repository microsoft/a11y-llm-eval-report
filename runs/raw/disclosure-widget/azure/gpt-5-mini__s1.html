<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0366d6;
      --bg:#f8fafc;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:8px;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#eef2ff 0%, #ffffff 100%);
      color:#0f172a;
      padding:32px;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    h1{
      margin:0 0 20px 0;
      font-size:20px;
      color:var(--accent);
    }

    .example{
      background:var(--card);
      border:1px solid rgba(15,23,42,0.06);
      box-shadow: 0 1px 2px rgba(15,23,42,0.04);
      padding:16px;
      border-radius:var(--radius);
      margin-bottom:20px;
      max-width:800px;
    }

    .widget-header{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .toggle{
      appearance:none;
      border:1px solid rgba(15,23,42,0.08);
      background:linear-gradient(180deg,#fff,#fbfdff);
      color:var(--accent);
      padding:8px 12px;
      font-size:14px;
      border-radius:6px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    .toggle:focus{
      outline:3px solid rgba(3,102,214,0.12);
      outline-offset:2px;
    }

    .chev{
      display:inline-block;
      width:14px;
      height:14px;
      transform-origin:center;
      transition:transform 220ms ease;
    }

    .toggle[aria-expanded="true"] .chev{
      transform:rotate(90deg);
    }

    .summary{
      margin:0;
      font-weight:600;
      font-size:15px;
      color:#0f172a;
    }

    /* The controlled content */
    .details{
      overflow:hidden;
      transition: max-height 300ms ease, opacity 220ms ease;
      max-height:0;
      opacity:0;
      margin-top:12px;
      border-top:1px dashed rgba(15,23,42,0.04);
      padding-top:12px;
    }

    .details.open{
      opacity:1;
    }

    .panel-content{
      font-size:14px;
      color:#111827;
      line-height:1.5;
    }

    .muted{
      color:var(--muted);
      font-size:13px;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .details{ transition:none; }
      .chev{ transition:none; }
    }

    /* small visual demo tweaks */
    .meta{
      font-size:13px;
      color:var(--muted);
      margin-left:auto;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse widget examples</h1>

  <!-- Example 1: Basic accessible toggle -->
  <div class="example">
    <div class="widget-header">
      <button id="btn-1" class="toggle" aria-expanded="false" aria-controls="details-1">
        <span class="chev" aria-hidden="true">▶</span>
        <span>Show details</span>
      </button>
      <p class="meta muted">Basic</p>
    </div>

    <div id="details-1" class="details" role="region" aria-labelledby="btn-1" aria-hidden="true">
      <div class="panel-content">
        <p>This is a simple expand/collapse panel. The toggle button updates aria-expanded and the content container uses the class "details". The content is hidden from assistive technologies when collapsed via aria-hidden.</p>
        <p class="muted">Tip: You can activate the control with Enter or Space when focused.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Animated, larger content and Escape to close -->
  <div class="example">
    <div class="widget-header">
      <button id="btn-2" class="toggle" aria-expanded="false" aria-controls="details-2">
        <span class="chev" aria-hidden="true">▶</span>
        <span>More information</span>
      </button>
      <p class="meta muted">Animated, close with Esc</p>
    </div>

    <div id="details-2" class="details" role="region" aria-labelledby="btn-2" aria-hidden="true">
      <div class="panel-content">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vitae risus et arcu vehicula gravida. Praesent ac augue in nunc feugiat porta. Suspendisse potenti. Curabitur quis sem at nunc aliquet dictum.</p>
        <ul>
          <li>Point one with some extra explanatory text.</li>
          <li>Point two to show list rendering.</li>
          <li>Point three demonstrating multiple lines of content in the details container.</li>
        </ul>
        <p class="muted">Press Escape while focus is inside the panel to close it.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Utility to initialize all toggle buttons that reference a .details container
      function initToggle(button){
        var detailsId = button.getAttribute('aria-controls');
        if(!detailsId) return;
        var details = document.getElementById(detailsId);
        if(!details || !details.classList.contains('details')) return;

        // Ensure initial state is consistent
        var expanded = button.getAttribute('aria-expanded') === 'true';
        details.setAttribute('aria-hidden', String(!expanded));
        if(expanded){
          openDetails(details, false);
        }else{
          closeDetails(details, false);
        }

        // Click toggles
        button.addEventListener('click', function(){
          toggle();
        });

        // Allow Escape to close the panel when focus is inside
        details.addEventListener('keydown', function(e){
          if(e.key === 'Escape' || e.key === 'Esc'){
            button.focus();
            if(button.getAttribute('aria-expanded') === 'true'){
              toggle();
            }
          }
        });

        // For accessibility, if focus leaves the panel and moves to the document
        // we won't auto-close — following typical disclosure widget behavior.

        function toggle(){
          var isOpen = button.getAttribute('aria-expanded') === 'true';
          if(isOpen){
            button.setAttribute('aria-expanded','false');
            details.setAttribute('aria-hidden','true');
            closeDetails(details, true);
          }else{
            button.setAttribute('aria-expanded','true');
            details.setAttribute('aria-hidden','false');
            openDetails(details, true);
            // move focus into panel for keyboard users? We keep focus on button but you can tab into content.
          }
        }
      }

      // Animation helpers: use max-height transitions for smooth open/close.
      function openDetails(details, animate){
        details.classList.add('open');
        if(!animate){
          details.style.transition = 'none';
          details.style.maxHeight = 'none';
          // force reflow then restore transition
          void details.offsetHeight;
          details.style.transition = '';
          return;
        }
        // Set to scrollHeight to animate open
        var contentHeight = details.scrollHeight;
        details.style.maxHeight = contentHeight + 'px';

        // After transition, remove max-height to allow dynamic height
        var once = function(){
          details.style.maxHeight = 'none';
          details.removeEventListener('transitionend', once);
        };
        details.addEventListener('transitionend', once);
      }

      function closeDetails(details, animate){
        details.classList.remove('open');
        if(!animate){
          details.style.transition = 'none';
          details.style.maxHeight = '0px';
          void details.offsetHeight;
          details.style.transition = '';
          return;
        }
        // From current height to 0
        // If maxHeight was 'none', set it to the current pixel height
        var currentMax = getComputedStyle(details).maxHeight;
        if(currentMax === 'none'){
          // Freeze to pixel height before collapsing
          details.style.maxHeight = details.scrollHeight + 'px';
          // Force reflow so the browser registers the change
          void details.offsetHeight;
        }
        // Then animate to 0
        details.style.maxHeight = '0px';
      }

      // Initialize all buttons on the page that control .details containers
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(initToggle);
    })();
  </script>
</body>
</html>