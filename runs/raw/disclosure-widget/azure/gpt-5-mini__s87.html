<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0ea5a4;
      --radius:8px;
      --duration:280ms;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg), #eef2f7 120%);
      margin: 2rem;
      color:#0f172a;
      line-height:1.4;
    }

    h1{font-size:1.25rem;margin:0 0 1rem 0}
    p.lead{margin:0 0 1.25rem 0;color:var(--muted)}

    .container{
      max-width:900px;
      margin:0 auto;
    }

    .example{
      background:var(--card);
      border:1px solid rgba(15,23,42,0.06);
      padding:1rem;
      border-radius:var(--radius);
      box-shadow:0 6px 18px rgba(12,18,27,0.04);
      margin-bottom:1rem;
    }

    .widget{
      display:flex;
      gap:0.75rem;
      align-items:flex-start;
    }

    .toggle{
      appearance:none;
      border:1px solid rgba(15,23,42,0.08);
      background:white;
      color:var(--accent);
      padding:0.5rem 0.75rem;
      border-radius:6px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
      transition:box-shadow var(--duration) ease, transform var(--duration) ease;
    }
    .toggle:focus{
      outline:3px solid rgba(14,165,164,0.12);
      box-shadow:0 6px 18px rgba(14,165,164,0.06);
    }
    .toggle[aria-expanded="true"]{
      background:linear-gradient(180deg,#eefdfa,#e6fdfb);
      border-color:rgba(14,165,164,0.15);
      transform:translateY(-1px);
    }

    /* Controlled content container */
    .details{
      overflow:hidden;
      transition:max-height var(--duration) cubic-bezier(.2,.9,.3,1), opacity var(--duration) ease;
      max-height:0;
      opacity:0;
      margin-top:0.75rem;
      border-left:2px solid rgba(14,165,164,0.06);
      padding:0 0 0 0.75rem;
    }
    .details.open{
      opacity:1;
      /* max-height will be set inline for precise animation */
    }

    .details .content{
      padding:0.5rem 0 0.5rem 0;
      color:#0b1225;
      font-size:0.95rem;
    }

    .meta{
      font-size:0.85rem;color:var(--muted);margin-top:0.5rem;
    }

    /* Nested styling */
    .nested{
      margin-top:0.5rem;
      padding:0.5rem;
      background:linear-gradient(180deg,#fff,#fcfeff);
      border-radius:6px;
      border:1px dashed rgba(15,23,42,0.04);
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .details{ transition:none }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">Accessible examples of an expand/collapse widget. Each widget is wrapped in a div.example; the controlled content container uses the class "details".</p>

    <!-- Example 1: Simple collapsed by default -->
    <div class="example">
      <div class="widget" aria-roledescription="expandable">
        <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1">
          More information
          <span aria-hidden="true">▾</span>
        </button>
        <div style="flex:1">
          <div class="details" id="details-1" role="region" aria-labelledby="toggle-1" aria-hidden="true">
            <div class="content">
              This is the additional information that is hidden by default. It becomes visible when the toggle is activated. Use the button to open and close the content.
              <div class="meta">Tip: The button uses aria-expanded and aria-controls for screen readers.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 2: Open by default -->
    <div class="example">
      <div class="widget" aria-roledescription="expandable">
        <button class="toggle" id="toggle-2" aria-expanded="true" aria-controls="details-2">
          Details (open)
          <span aria-hidden="true">▴</span>
        </button>
        <div style="flex:1">
          <div class="details open" id="details-2" role="region" aria-labelledby="toggle-2" aria-hidden="false">
            <div class="content">
              This widget starts open. The script initializes state based on aria-expanded so this content is visible on load.
              <div class="meta">Example of an initially-open widget.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 3: Nested expanders -->
    <div class="example">
      <div class="widget" aria-roledescription="expandable">
        <button class="toggle" id="toggle-3" aria-expanded="false" aria-controls="details-3">
          Show nested options
          <span aria-hidden="true">▾</span>
        </button>
        <div style="flex:1">
          <div class="details" id="details-3" role="region" aria-labelledby="toggle-3" aria-hidden="true">
            <div class="content">
              Inside this panel there's another small expand/collapse control.
              <div class="nested">
                <button class="toggle" id="toggle-3b" aria-expanded="false" aria-controls="details-3b">
                  More nested info
                  <span aria-hidden="true">▾</span>
                </button>
                <div class="details" id="details-3b" role="region" aria-labelledby="toggle-3b" aria-hidden="true">
                  <div class="content">
                    Nested content can also be expanded independently.
                    <div class="meta">Nested widgets follow the same structure and use the "details" class for the controlled containers.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>  
    </div>

  </div>

  <script>
    (function(){
      // Utility to animate opening/closing with max-height based on scrollHeight.
      function openDetails(el){
        el.classList.add('open');
        el.setAttribute('aria-hidden','false');

        // Remove any previous inline max-height so scrollHeight is correct
        el.style.maxHeight = '0px';
        // Allow the DOM to apply the zero height before measuring
        requestAnimationFrame(function(){
          var full = el.scrollHeight;
          el.style.maxHeight = full + 'px';
        });

        // Clean up after transition so content can grow naturally
        var onEnd = function(e){
          if (e.propertyName === 'max-height'){
            el.style.maxHeight = '';
            el.removeEventListener('transitionend', onEnd);
          }
        };
        el.addEventListener('transitionend', onEnd);
      }

      function closeDetails(el){
        // To animate from current height we set maxHeight to scrollHeight then 0
        var full = el.scrollHeight;
        el.style.maxHeight = full + 'px';
        // Force layout
        el.getBoundingClientRect();
        requestAnimationFrame(function(){
          el.style.maxHeight = '0px';
        });

        var onEnd = function(e){
          if (e.propertyName === 'max-height'){
            el.classList.remove('open');
            el.setAttribute('aria-hidden','true');
            el.removeEventListener('transitionend', onEnd);
          }
        };
        el.addEventListener('transitionend', onEnd);
      }

      // Initialize toggles on page load
      document.querySelectorAll('.toggle[aria-controls]').forEach(function(btn){
        var id = btn.getAttribute('aria-controls');
        var details = document.getElementById(id);
        if (!details) return;

        // Ensure the details element has the required class
        if (!details.classList.contains('details')){
          details.classList.add('details');
        }

        // Initialize state on load based on aria-expanded
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded){
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          // Remove inline max-height so content is not clipped
          details.style.maxHeight = '';
        } else {
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        btn.addEventListener('click', function(){
          var isExpanded = btn.getAttribute('aria-expanded') === 'true';
          if (isExpanded){
            btn.setAttribute('aria-expanded','false');
            closeDetails(details);
          } else {
            btn.setAttribute('aria-expanded','true');
            openDetails(details);
          }
        });

        // Support keyboard toggling is provided by <button> inherently (Space/Enter).
      });
    })();
  </script>
</body>
</html>