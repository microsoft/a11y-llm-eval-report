<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --transition-duration: 280ms;
      --accent: #2b6cb0;
      --bg: #f7fafc;
      --card-bg: #ffffff;
      --border: #e2e8f0;
      --text: #1a202c;
    }

    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin: 32px;
      color: var(--text);
      background: linear-gradient(180deg,var(--bg),#ffffff 40%);
      line-height: 1.4;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
      color: #0f172a;
    }

    p.lead{
      margin: 0 0 24px 0;
      color: #475569;
    }

    .example{
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 18px;
      box-shadow: 0 1px 2px rgba(16,24,40,0.03);
      max-width: 760px;
    }

    .controls{
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .toggle{
      appearance: none;
      border: 1px solid var(--border);
      background: transparent;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      color: var(--text);
      transition: border-color var(--transition-duration), box-shadow var(--transition-duration), background var(--transition-duration);
    }

    .toggle:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(59,130,246,0.12);
      border-color: var(--accent);
    }

    .toggle[aria-expanded="true"]{
      border-color: var(--accent);
      background: linear-gradient(90deg, rgba(59,130,246,0.06), rgba(59,130,246,0.02));
    }

    .toggle .chev{
      display:inline-block;
      transition: transform var(--transition-duration) ease;
      width: 14px;
      height: 14px;
    }

    .toggle[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    .details{
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition-duration) ease, opacity var(--transition-duration) ease;
      opacity: 0;
      margin-top: 12px;
      border-top: 1px dashed var(--border);
      padding-top: 12px;
    }

    .details.open{
      opacity: 1;
      /* max-height is controlled via inline CSS var --details-max */
      max-height: var(--details-max, 800px);
    }

    .details .content{
      padding: 4px 2px;
    }

    .note{
      font-size: 13px;
      color: #475569;
      margin-top: 8px;
    }

    /* small demo content styles */
    .card{
      border-radius: 6px;
      border: 1px solid var(--border);
      padding: 12px;
      background: #fff;
    }

    .meta{
      font-size: 13px;
      color: #475569;
      margin-top: 8px;
    }

    /* Responsive */
    @media (max-width:520px){
      body{ margin: 16px; }
      .example{ padding: 12px; }
      .toggle{ padding: 8px 10px; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Accessible expand/collapse widget using a button and a controlled container (class "details"). Each widget is wrapped in a div.example.</p>

  <div class="example" id="example-1">
    <div class="controls">
      <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1" type="button">
        <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true" focusable="false">
          <path d="M6 4l8 6-8 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Show more details
      </button>
      <span class="note">Press Space or Enter to toggle</span>
    </div>

    <div class="details" id="details-1" role="region" aria-labelledby="toggle-1" hidden aria-hidden="true">
      <div class="content">
        <div class="card">
          <strong>Details</strong>
          <p class="meta">This section is controlled via the button above. It starts collapsed and becomes visible when expanded. The container has class="details".</p>
          <ul>
            <li>Uses aria-expanded on the button</li>
            <li>aria-controls points to the details container</li>
            <li>The details container has class "details" and is wrapped in a div.example</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="example" id="example-2">
    <div class="controls">
      <button class="toggle" aria-expanded="false" aria-controls="details-2" id="toggle-2" type="button">
        <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true" focusable="false">
          <path d="M6 4l8 6-8 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        More options
      </button>
      <span class="note">This example demonstrates dynamic height animation</span>
    </div>

    <div class="details" id="details-2" role="region" aria-labelledby="toggle-2" hidden aria-hidden="true">
      <div class="content">
        <div class="card">
          <strong>Advanced options</strong>
          <p class="meta">This block contains longer content to show the animation of expanding and collapsing with a measured height.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer at orci vitae lectus dictum faucibus. Praesent non venenatis lectus. Quisque quis volutpat lacus. Sed ac dui ut purus pharetra efficitur. Aenean id tristique orci. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Duis pretium, mi vel mattis vehicula, magna arcu volutpat nibh, id lacinia neque justo vitae nunc.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Initialize all toggle buttons that have aria-controls
      const toggles = Array.from(document.querySelectorAll('.toggle[aria-controls]'));

      toggles.forEach(btn => {
        const targetId = btn.getAttribute('aria-controls');
        const target = document.getElementById(targetId);
        if (!target) return;

        // Ensure the details element has the required class (per requirement)
        if (!target.classList.contains('details')) {
          target.classList.add('details');
        }

        // Helper to open
        const open = () => {
          btn.setAttribute('aria-expanded', 'true');
          target.classList.add('open');
          // remove hidden before measuring to allow scrollHeight
          target.hidden = false;
          target.setAttribute('aria-hidden', 'false');

          // measure and set --details-max so transition matches content height
          const height = target.scrollHeight;
          target.style.setProperty('--details-max', height + 'px');
          // In some browsers we need a small delay to ensure transition occurs
          requestAnimationFrame(() => {
            target.classList.add('open');
          });
        };

        // Helper to close
        const close = () => {
          btn.setAttribute('aria-expanded', 'false');

          // Set the max to current height so transition has a start point
          const height = target.scrollHeight;
          target.style.setProperty('--details-max', height + 'px');

          // Force reflow to ensure transition sees the starting max-height
          // eslint-disable-next-line no-unused-expressions
          target.offsetHeight;

          target.classList.remove('open');
          target.setAttribute('aria-hidden', 'true');

          // After transition ends, hide the content to remove it from tab order
        };

        // Toggle function
        const toggle = () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            close();
          } else {
            open();
          }
        };

        // Transitionend handler: when collapsed, set hidden to true to prevent tabbing
        target.addEventListener('transitionend', (e) => {
          if (e.propertyName === 'max-height' || e.propertyName === 'opacity') {
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            if (!expanded) {
              target.hidden = true;
              // clear inline max so content can resize naturally when opened later
              target.style.removeProperty('--details-max');
            } else {
              // once expanded, set max to large enough for future resizes (optional)
              target.style.removeProperty('--details-max');
            }
          }
        });

        // Initialize: ensure hidden and aria-hidden true if collapsed
        if (btn.getAttribute('aria-expanded') !== 'true') {
          target.hidden = true;
          target.setAttribute('aria-hidden', 'true');
        } else {
          target.hidden = false;
          target.setAttribute('aria-hidden', 'false');
          target.classList.add('open');
        }

        // Click handler
        btn.addEventListener('click', toggle);

        // Optional: support keyboard on Enter/Space is handled by button by default.
      });
    })();
  </script>
</body>
</html>