<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2b7cff;
      --bg:#f7f9fc;
      --muted:#667085;
      --radius:8px;
      --transition:300ms cubic-bezier(.2,.8,.2,1);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#fbfdff 0%, #f2f6fb 100%);
      color: #0f1720;
      padding: 32px;
      line-height:1.5;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }

    .container{
      max-width:900px;
      margin:0 auto;
    }

    /* Example wrapper */
    .example{
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(17,24,39,0.06);
      padding: 16px;
      margin: 18px 0;
      border: 1px solid rgba(15,23,36,0.04);
    }

    .example h2{
      margin: 0 0 12px 0;
      font-size:16px;
      color: #071133;
    }

    /* Toggle button */
    .toggle {
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(43,124,255,0.04), rgba(43,124,255,0.02));
      border: 1px solid rgba(43,124,255,0.12);
      color: #06306a;
      border-radius: 8px;
      cursor: pointer;
      font-weight:600;
      text-align:left;
      outline: none;
      transition: box-shadow var(--transition), transform 120ms ease;
    }

    .toggle:focus{
      box-shadow: 0 0 0 4px rgba(43,124,255,0.12);
    }

    .toggle[aria-expanded="true"]{
      background: linear-gradient(180deg, rgba(43,124,255,0.09), rgba(43,124,255,0.03));
    }

    .toggle .title{
      flex:1;
      font-size:15px;
    }

    .toggle .meta{
      font-size:13px;
      color:var(--muted);
      margin-left:auto;
    }

    /* Caret */
    .caret{
      width:18px;
      height:18px;
      flex: 0 0 18px;
      display:inline-block;
      transform-origin: center;
      transition: transform var(--transition);
      color: var(--accent);
    }

    .toggle[aria-expanded="true"] .caret{
      transform: rotate(180deg);
    }

    /* Controlled content area */
    .details{
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 0;
      margin-top: 12px;
      border-radius: 8px;
    }

    .details.open{
      opacity: 1;
    }

    .details .inner{
      padding: 12px 14px;
      background: #ffffff;
      border: 1px solid rgba(15,23,36,0.04);
      border-radius: 8px;
    }

    .small{
      font-size:13px;
      color:var(--muted);
    }

    /* Subtle nested example styling */
    .nested .toggle{
      padding-left: 8px;
      font-weight:600;
      background: linear-gradient(180deg, rgba(17,24,39,0.02), rgba(17,24,39,0.01));
      border-color: rgba(15,23,36,0.06);
    }

    /* Accessibility helpers for screen-reader only text */
    .sr-only{
      position: absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    /* Simple responsive */
    @media (max-width:640px){
      .toggle{ font-size:14px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget â€” Examples</h1>

    <!-- Example 1: Simple toggle -->
    <div class="example" id="example-simple">
      <h2>Simple Expand/Collapse</h2>
      <button
        class="toggle"
        aria-expanded="false"
        data-controls="details-simple"
        id="toggle-simple"
        type="button"
      >
        <span class="title">More information about this feature</span>
        <span class="meta small">Click to expand</span>
        <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
          <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
      </button>

      <div
        id="details-simple"
        class="details"
        role="region"
        aria-labelledby="toggle-simple"
        aria-hidden="true"
      >
        <div class="inner">
          <p>
            This is a simple expand/collapse region. It demonstrates the basics:
            a button that controls a content area. The button uses
            aria-expanded and aria-controls; the content uses aria-hidden and role="region".
          </p>
          <p class="small">The area transitions open and closed and supports keyboard interaction.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: Accordion group with multiple widgets -->
    <div class="example" id="example-accordion" data-accordion="true" aria-label="Example accordion group">
      <h2>Accordion Group (Only one open at a time)</h2>

      <div class="example" style="margin:0 0 12px 0;">
        <button class="toggle"
                aria-expanded="false"
                data-controls="details-acc-1"
                id="toggle-acc-1"
                type="button">
          <span class="title">Section 1: Overview</span>
          <span class="meta small">High level</span>
          <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
            <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>
        <div id="details-acc-1" class="details" role="region" aria-labelledby="toggle-acc-1" aria-hidden="true">
          <div class="inner">
            <p>This section provides an overview. When used in an accordion group, opening one panel will close the others in the same group.</p>
          </div>
        </div>
      </div>

      <div class="example" style="margin:0 0 12px 0;">
        <button class="toggle"
                aria-expanded="false"
                data-controls="details-acc-2"
                id="toggle-acc-2"
                type="button">
          <span class="title">Section 2: Details</span>
          <span class="meta small">Technical</span>
          <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
            <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>
        <div id="details-acc-2" class="details" role="region" aria-labelledby="toggle-acc-2" aria-hidden="true">
          <div class="inner">
            <p>Detailed information goes here. You can navigate between the accordion headers using the Up and Down arrow keys when focus is on a header.</p>
          </div>
        </div>
      </div>

      <div class="example" style="margin:0;">
        <button class="toggle"
                aria-expanded="false"
                data-controls="details-acc-3"
                id="toggle-acc-3"
                type="button">
          <span class="title">Section 3: Notes</span>
          <span class="meta small">Misc</span>
          <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
            <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>
        <div id="details-acc-3" class="details" role="region" aria-labelledby="toggle-acc-3" aria-hidden="true">
          <div class="inner">
            <p>These are some miscellaneous notes. Try opening one section and then another; the first will close automatically as this group is configured as an accordion.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 3: Nested expandables -->
    <div class="example" id="example-nested">
      <h2>Nested Expandables</h2>
      <div class="example nested" style="margin:0;">
        <button class="toggle"
                aria-expanded="false"
                data-controls="details-parent"
                id="toggle-parent"
                type="button">
          <span class="title">Parent section</span>
          <span class="meta small">Contains nested content</span>
          <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
            <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>

        <div id="details-parent" class="details" role="region" aria-labelledby="toggle-parent" aria-hidden="true">
          <div class="inner">
            <p>Inside the parent section there is another expand/collapse widget:</p>

            <div class="example" style="margin-top:12px;">
              <button class="toggle"
                      aria-expanded="false"
                      data-controls="details-child"
                      id="toggle-child"
                      type="button">
                <span class="title">Child section</span>
                <span class="meta small">Nested</span>
                <svg class="caret" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                  <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
              </button>

              <div id="details-child" class="details" role="region" aria-labelledby="toggle-child" aria-hidden="true">
                <div class="inner">
                  <p>This child panel is nested. Each widget manages its own state independently, even when nested.</p>
                </div>
              </div>
            </div>
            <!-- end inner example -->
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    (function(){
      // Utility: find all toggles (buttons) with data-controls
      const toggles = Array.from(document.querySelectorAll('.toggle[data-controls]'));

      function closeOtherInAccordion(toggleBtn) {
        // Find nearest ancestor that marks an accordion group:
        // either an ancestor with [data-accordion="true"] or the direct #example-accordion wrapper.
        let accordionAncestor = toggleBtn.closest('[data-accordion="true"]');
        if (!accordionAncestor) return;
        // Close other toggles inside that ancestor (but not the clicked one)
        const groupToggles = Array.from(accordionAncestor.querySelectorAll('.toggle[data-controls]'));
        groupToggles.forEach(btn => {
          if (btn === toggleBtn) return;
          if (btn.getAttribute('aria-expanded') === 'true') {
            toggle(btn, false);
          }
        });
      }

      // Toggle function: set aria attributes and animate details element
      function toggle(button, wantOpen = null) {
        const controlsId = button.getAttribute('data-controls');
        const content = document.getElementById(controlsId);
        if (!content) return;
        const isOpen = button.getAttribute('aria-expanded') === 'true';
        const willOpen = typeof wantOpen === 'boolean' ? wantOpen : !isOpen;

        // If part of accordion and opening, close others
        if (willOpen) closeOtherInAccordion(button);

        button.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
        content.setAttribute('aria-hidden', willOpen ? 'false' : 'true');

        // Smooth height animation using max-height. We set explicit pixel height then animate to 0 or to the scrollHeight.
        if (willOpen) {
          // Make sure content is visible for measurement
          content.classList.add('open');
          const startHeight = content.scrollHeight;
          // Set to 0 first in case it was 'none' after previous open
          content.style.maxHeight = '0px';
          // Force reflow
          content.getBoundingClientRect();
          // Animate to measured height
          content.style.transition = 'max-height 300ms cubic-bezier(.2,.8,.2,1), opacity 300ms';
          content.style.maxHeight = startHeight + 'px';

          // After transition, remove max-height to allow auto sizing
          const handler = function() {
            // Only remove max-height if currently open
            if (button.getAttribute('aria-expanded') === 'true') {
              content.style.maxHeight = 'none';
            }
            content.removeEventListener('transitionend', handler);
          };
          content.addEventListener('transitionend', handler);
        } else {
          // Closing: set maxHeight to current height, then animate to 0
          const currentHeight = content.scrollHeight;
          content.style.transition = 'max-height 300ms cubic-bezier(.2,.8,.2,1), opacity 300ms';
          content.style.maxHeight = currentHeight + 'px';
          // Force reflow
          content.getBoundingClientRect();
          // animate to 0
          content.style.maxHeight = '0px';
          // Remove 'open' class after transition to hide opacity
          const handler = function() {
            content.classList.remove('open');
            content.removeEventListener('transitionend', handler);
            // keep max-height at 0 so next open starts from 0
          };
          content.addEventListener('transitionend', handler);
        }
      }

      // Attach click handlers
      toggles.forEach(btn => {
        btn.addEventListener('click', function(e){
          toggle(btn);
        });

        // Keyboard interaction: Space/Enter toggle, and for accordion Up/Down move focus
        btn.addEventListener('keydown', function(e){
          const key = e.key;
          if (key === ' ' || key === 'Spacebar' || key === 'Enter') {
            e.preventDefault();
            toggle(btn);
          }

          // Arrow navigation for accordion groups
          if (key === 'ArrowDown' || key === 'ArrowUp') {
            const accordionAncestor = btn.closest('[data-accordion="true"]');
            if (!accordionAncestor) return;
            e.preventDefault();
            const group = Array.from(accordionAncestor.querySelectorAll('.toggle[data-controls]'));
            const idx = group.indexOf(btn);
            if (idx === -1) return;
            let nextIdx;
            if (key === 'ArrowDown') nextIdx = (idx + 1) % group.length;
            else nextIdx = (idx - 1 + group.length) % group.length;
            group[nextIdx].focus();
          }
        });
      });

      // On load: ensure details elements start closed (but allow server-rendered open if aria-expanded true on button)
      toggles.forEach(btn => {
        const controlsId = btn.getAttribute('data-controls');
        const content = document.getElementById(controlsId);
        if (!content) return;
        const isOpen = btn.getAttribute('aria-expanded') === 'true';
        content.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        if (isOpen) {
          content.classList.add('open');
          content.style.maxHeight = 'none';
          content.style.opacity = '1';
        } else {
          content.classList.remove('open');
          content.style.maxHeight = '0px';
          content.style.opacity = '0';
        }
      });

      // Optional: allow clicking outside to close any open accordion panels (uncomment if desired)
      // document.addEventListener('click', (e) => {
      //   if (!e.target.closest('.example')) {
      //     toggles.forEach(btn => { if (btn.getAttribute('aria-expanded') === 'true') toggle(btn,false); });
      //   }
      // });

    })();
  </script>
</body>
</html>