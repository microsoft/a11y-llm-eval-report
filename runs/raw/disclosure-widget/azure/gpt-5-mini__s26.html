<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent: #0b84ff;
      --bg: #ffffff;
      --muted: #6b7280;
      --radius: 8px;
      --transition: 260ms cubic-bezier(.2,.9,.3,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f7f8fa;
      color: #0f172a;
      padding: 28px;
      line-height: 1.4;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
    }

    .grid{
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    /* Each widget wrapper must have class "example" */
    .example{
      background: var(--bg);
      border-radius: var(--radius);
      border: 1px solid rgba(15,23,42,0.06);
      padding: 12px;
      box-shadow: 0 1px 0 rgba(15,23,42,0.02);
    }

    .toggle{
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      background: transparent;
      border: none;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      font-size: 15px;
      color: inherit;
      border-radius: 6px;
    }

    .toggle:focus{
      outline: none;
      box-shadow: 0 0 0 3px rgba(11,132,255,0.12);
    }

    .toggle__title{
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .toggle__label{
      font-weight: 600;
    }
    .toggle__subtitle{
      font-size: 13px;
      color: var(--muted);
      margin-top: 2px;
    }

    .chev{
      width: 20px;
      height: 20px;
      display: inline-block;
      transition: transform var(--transition);
      transform-origin: 50% 50%;
      color: var(--accent);
      flex-shrink: 0;
    }

    .toggle[aria-expanded="true"] .chev{
      transform: rotate(180deg);
    }

    /*
      The controlled content container must have class "details"
    */
    .details{
      overflow: hidden;
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 1;
      max-height: 0; /* collapsed by default unless explicit inline style set */
      margin-top: 8px;
      border-top: 1px dashed rgba(15,23,42,0.05);
      padding-top: 12px;
    }

    .details[aria-hidden="true"]{
      opacity: 0;
    }

    .details__inner{
      font-size: 14px;
      color: #111827;
      line-height: 1.5;
    }

    /* small helper */
    .meta{
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }

    @media (prefers-reduced-motion: reduce){
      .details{ transition: none; }
      .chev{ transition: none; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Demonstration</h1>
  <p class="meta">Each widget is wrapped in a div.example and the controlled content container uses the class "details". Buttons use aria-expanded and aria-controls for accessibility.</p>

  <div class="grid">
    <!-- Example 1: collapsed by default -->
    <div class="example" id="example-1">
      <button class="toggle"
              id="toggle-1"
              aria-expanded="false"
              aria-controls="details-1"
              type="button">
        <span class="toggle__title">
          <span class="toggle__label">More information</span>
          <span class="toggle__subtitle">Click to reveal additional details</span>
        </span>
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 15.6 5.6 9.2l1.4-1.4L12 12.8l5-5 1.4 1.4z"/>
        </svg>
      </button>

      <div id="details-1" class="details"
           role="region"
           aria-labelledby="toggle-1"
           aria-hidden="true">
        <div class="details__inner">
          <p>This area contains extra information that is hidden by default. It is controlled by the button above using aria attributes. Keyboard users can toggle it with Enter or Space while focused on the button.</p>
          <p>Implementations should keep aria-expanded on the button and aria-hidden on this region in sync for assistive technologies.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: open by default -->
    <div class="example" id="example-2">
      <button class="toggle"
              id="toggle-2"
              aria-expanded="true"
              aria-controls="details-2"
              type="button">
        <span class="toggle__title">
          <span class="toggle__label">Release notes</span>
          <span class="toggle__subtitle">Version 3.4.1 â€” what's changed</span>
        </span>
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 15.6 5.6 9.2l1.4-1.4L12 12.8l5-5 1.4 1.4z"/>
        </svg>
      </button>

      <div id="details-2" class="details"
           role="region"
           aria-labelledby="toggle-2"
           aria-hidden="false"
           style="max-height: none;">
        <div class="details__inner">
          <ul>
            <li>Fixed an issue causing slow load times on large projects.</li>
            <li>Improved accessibility of modal dialogs and toggle controls.</li>
            <li>Minor bug fixes and performance improvements.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Example 3: nested content -->
    <div class="example" id="example-3">
      <button class="toggle"
              id="toggle-3"
              aria-expanded="false"
              aria-controls="details-3"
              type="button">
        <span class="toggle__title">
          <span class="toggle__label">FAQ</span>
          <span class="toggle__subtitle">Common questions and answers</span>
        </span>
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 15.6 5.6 9.2l1.4-1.4L12 12.8l5-5 1.4 1.4z"/>
        </svg>
      </button>

      <div id="details-3" class="details"
           role="region"
           aria-labelledby="toggle-3"
           aria-hidden="true">
        <div class="details__inner">
          <h3 style="margin:0 0 8px 0;">Q: How do I use this widget?</h3>
          <p style="margin:0 0 12px 0;">A: Click the button to expand or collapse the content. The widget supports keyboard input and exposes state to assistive technologies.</p>
          <h3 style="margin:0 0 8px 0;">Q: Can I include interactive elements inside?</h3>
          <p style="margin:0;">A: Yes. You can place links, forms, or other controls inside the .details container. They remain focusable when visible.</p>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Accessible expand/collapse logic.
    (function(){
      var examples = document.querySelectorAll('.example');

      function setHiddenState(content, hidden) {
        content.setAttribute('aria-hidden', hidden ? 'true' : 'false');
      }

      function openDetail(button, content) {
        if (content.dataset.animating === "true") return;
        button.setAttribute('aria-expanded', 'true');
        setHiddenState(content, false);

        // Prepare animation
        var startHeight = content.scrollHeight;
        // If current max-height is 'none', set it to actual height first to allow transition.
        content.style.maxHeight = '0px';
        // Force reflow
        content.getBoundingClientRect();
        content.dataset.animating = "true";

        // Expand to full height
        content.style.maxHeight = startHeight + 'px';

        // After transition, remove max-height to allow natural height (and dynamic content changes)
        var onEnd = function(e){
          if (e && e.target !== content) return;
          content.removeEventListener('transitionend', onEnd);
          content.style.maxHeight = 'none';
          delete content.dataset.animating;
        };
        content.addEventListener('transitionend', onEnd);
      }

      function closeDetail(button, content) {
        if (content.dataset.animating === "true") return;
        button.setAttribute('aria-expanded', 'false');

        // If max-height is 'none', set it to scrollHeight so we can animate to 0
        var curHeight = content.scrollHeight;
        content.style.maxHeight = curHeight + 'px';
        // Force reflow
        content.getBoundingClientRect();
        content.dataset.animating = "true";

        // Collapse to zero
        content.style.maxHeight = '0px';

        var onEnd = function(e){
          if (e && e.target !== content) return;
          content.removeEventListener('transitionend', onEnd);
          setHiddenState(content, true);
          delete content.dataset.animating;
        };
        content.addEventListener('transitionend', onEnd);
      }

      examples.forEach(function(example){
        var btn = example.querySelector('.toggle');
        if (!btn) return;

        var controlsId = btn.getAttribute('aria-controls');
        var details = controlsId ? document.getElementById(controlsId) : null;
        if (!details) return;

        // Initialize: ensure aria-hidden matches aria-expanded
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        setHiddenState(details, !expanded);

        // If expanded and no inline max-height was set, remove max-height to avoid being clipped.
        if (expanded) {
          // Allow content to be fully visible by default
          details.style.maxHeight = 'none';
        } else {
          // Ensure collapsed visually
          details.style.maxHeight = details.style.maxHeight || '0px';
        }

        btn.addEventListener('click', function(){
          var isOpen = btn.getAttribute('aria-expanded') === 'true';
          if (isOpen) {
            closeDetail(btn, details);
          } else {
            openDetail(btn, details);
          }
        });

        // Optional: Allow Escape to close when focus is inside the details region
        details.addEventListener('keydown', function(e){
          if (e.key === 'Escape' || e.key === 'Esc') {
            // move focus back to the button and close
            btn.focus();
            closeDetail(btn, details);
          }
        });

        // Prevent accidental form submits or button presses bubbling causing weird toggles
        btn.addEventListener('keydown', function(e){
          // Button already supports Enter/Space by default; no need to intercept.
          // But we can allow Ctrl+M to toggle (example of extra keyboard)
          if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'm') {
            e.preventDefault();
            btn.click();
          }
        });
      });
    })();
  </script>
</body>
</html>