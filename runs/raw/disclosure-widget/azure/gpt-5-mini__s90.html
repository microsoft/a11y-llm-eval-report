<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b6ef6;
      --bg:#f8f9fb;
      --panel:#ffffff;
      --border:#e3e7ef;
      --text:#0f1724;
      --muted:#6b7280;
      --radius:8px;
      --duration:260ms;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg,#f7f9fc, #ffffff);
      color:var(--text);
      line-height:1.4;
    }

    h1{
      margin: 0 0 16px 0;
      font-size: 20px;
    }

    p.lead{
      margin: 0 0 20px 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* Example wrapper */
    .example{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 1px 2px rgba(15,23,36,0.04);
      max-width: 760px;
    }

    .widget{
      display:flex;
      flex-direction: column;
      gap: 12px;
    }

    .toggle{
      display: inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      font-weight:600;
      background: linear-gradient(180deg, #fff, #fbfdff);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      transition: box-shadow var(--duration), transform var(--duration);
      user-select:none;
    }

    .toggle:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(11,110,246,0.12);
    }

    .toggle:hover{
      transform: translateY(-1px);
    }

    .toggle .chev{
      display:inline-block;
      width:16px;
      height:16px;
      transition: transform var(--duration) cubic-bezier(.2,.9,.3,1);
      color:var(--accent);
    }

    /* rotate when expanded (use attr on button) */
    .toggle[aria-expanded="true"] .chev{
      transform: rotate(180deg);
    }

    /* details panel (the controlled content) */
    .details{
      overflow: hidden;
      transition: max-height var(--duration) ease, opacity var(--duration) ease;
      max-height: 0;
      opacity: 0;
      will-change: max-height, opacity;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
    }

    .details-inner{
      padding: 12px;
    }

    /* When aria-hidden is false we'll make it visible.
       We still control exact height in JS for smooth animation. */
    .details[aria-hidden="false"]{
      opacity: 1;
    }

    /* small demo content styling */
    .summary{
      color:var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
    }

    .rich{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .rich img{
      width:120px;
      height:80px;
      object-fit:cover;
      border-radius:6px;
      border:1px solid var(--border);
      flex-shrink:0;
    }

    .rich p{
      margin:0;
      color:var(--text);
      font-size:14px;
    }

    /* small footer for hints */
    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
    }

    @media (prefers-reduced-motion: reduce){
      .details, .toggle .chev{
        transition: none;
      }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Two accessible expand/collapse widgets. Click the buttons to reveal or hide the associated content. Each controlled container uses the class="details".</p>

  <div class="example">
    <div class="widget" aria-labelledby="toggle-1">
      <button id="toggle-1"
              class="toggle"
              aria-expanded="false"
              aria-controls="details-1"
              data-collapsed="Show details"
              data-expanded="Hide details">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="label">Show details</span>
      </button>

      <div id="details-1" class="details" role="region" aria-hidden="true" aria-labelledby="toggle-1">
        <div class="details-inner">
          <div class="summary">Quick summary</div>
          <p>This panel contains a short explanation of the widget behavior. It demonstrates how to toggle visibility while keeping the content accessible to assistive technologies. Use the button above or press Enter/Space when it has focus.</p>
          <div class="hint">Tip: the button uses aria-expanded and aria-controls, the panel uses aria-hidden and the class "details".</div>
        </div>
      </div>
    </div>
  </div>

  <div class="example">
    <div class="widget" aria-labelledby="toggle-2">
      <button id="toggle-2"
              class="toggle"
              aria-expanded="false"
              aria-controls="details-2"
              data-collapsed="Read more"
              data-expanded="Show less">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="label">Read more</span>
      </button>

      <div id="details-2" class="details" role="region" aria-hidden="true" aria-labelledby="toggle-2">
        <div class="details-inner">
          <div class="summary">Rich content example</div>
          <div class="rich">
            <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=2c8e5b6a8d8d2a7a9ad5f9c6b2d9ea5e" alt="Ocean waves">
            <p>Here is a richer content area with an image and paragraph. The container with class "details" is used to show/hide this content. The transition is animated by changing max-height from 0 to the measured content height for a smooth expand/collapse.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const toggles = Array.from(document.querySelectorAll('.toggle'));

      function open(details, button){
        // Make content visible to assistive tech immediately
        details.setAttribute('aria-hidden','false');
        button.setAttribute('aria-expanded','true');

        // Measure to animate
        const startMax = details.style.maxHeight;
        // temporarily set maxHeight to 'none' to measure full scrollHeight if previously cleared
        const prev = details.style.maxHeight;
        details.style.maxHeight = 'none';
        const full = details.scrollHeight;
        // revert to start for animation kickoff
        details.style.maxHeight = prev && prev !== 'none' ? prev : '0px';

        // Force reflow before changing to target value
        // (reading offsetHeight is a common reflow trigger)
        void details.offsetHeight;

        details.style.maxHeight = full + 'px';

        // After transition, clear the explicit maxHeight so content can resize naturally
        function onTransitionEnd(e){
          if (e.propertyName === 'max-height'){
            details.style.maxHeight = 'none';
            details.removeEventListener('transitionend', onTransitionEnd);
          }
        }
        details.addEventListener('transitionend', onTransitionEnd);
      }

      function close(details, button){
        // To animate from current height to 0, ensure maxHeight is set to current pixel height (not 'none')
        const current = details.scrollHeight;
        details.style.maxHeight = current + 'px';

        // Force reflow
        void details.offsetHeight;

        // then set to 0 to animate
        details.style.maxHeight = '0px';

        // After animation, mark hidden for assistive tech
        function onTransitionEnd(e){
          if (e.propertyName === 'max-height'){
            details.setAttribute('aria-hidden','true');
            button.setAttribute('aria-expanded','false');
            details.removeEventListener('transitionend', onTransitionEnd);
          }
        }
        details.addEventListener('transitionend', onTransitionEnd);
      }

      function toggle(e){
        const button = e.currentTarget;
        const detailsId = button.getAttribute('aria-controls');
        const details = document.getElementById(detailsId);
        if (!details) return;

        const expanded = button.getAttribute('aria-expanded') === 'true';

        // update visible label from data attributes
        const label = button.querySelector('.label');
        const collapsedText = button.getAttribute('data-collapsed') || 'Show';
        const expandedText = button.getAttribute('data-expanded') || 'Hide';

        if (expanded){
          // close
          close(details, button);
          if (label) label.textContent = collapsedText;
        } else {
          open(details, button);
          if (label) label.textContent = expandedText;
        }
      }

      // Attach handlers
      toggles.forEach(btn => {
        btn.addEventListener('click', toggle);
        // Initialize labels from data attributes
        const label = btn.querySelector('.label');
        if (label){
          label.textContent = btn.getAttribute('data-collapsed') || label.textContent;
        }
      });

      // Allow starting state to be expanded if someone sets aria-expanded="true" in markup
      document.querySelectorAll('.toggle[aria-expanded="true"]').forEach(btn => {
        const details = document.getElementById(btn.getAttribute('aria-controls'));
        if (!details) return;
        details.setAttribute('aria-hidden','false');
        details.style.maxHeight = 'none';
      });

      // Optional: close panels when pressing Escape while focus is inside the details region
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape' || e.key === 'Esc'){
          const active = document.activeElement;
          // if focus within a details region, close its controller if it's open
          const detailsRegion = active && active.closest('.details');
          if (detailsRegion && detailsRegion.getAttribute('aria-hidden') === 'false'){
            // find the button that controls this region
            const id = detailsRegion.id;
            const controller = document.querySelector(`[aria-controls="${id}"]`);
            if (controller){
              controller.click();
              controller.focus();
            }
          }
        }
      });

    })();
  </script>
</body>
</html>