<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2563eb;
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --radius:10px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#eef2ff 0%, #f8fafc 100%);
      color:var(--text);
      margin:0;
      padding:32px;
      line-height:1.45;
    }

    h1{ margin:0 0 20px 0; font-size:20px; color:var(--accent); }
    p.lead{ margin:0 0 18px 0; color:var(--muted); }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.07);
      margin:14px 0;
      max-width:760px;
    }

    .summary {
      display:flex;
      align-items:center;
      width:100%;
      gap:12px;
      border:0;
      background:transparent;
      padding:8px;
      text-align:left;
      cursor:pointer;
      font-size:16px;
      color:var(--text);
      border-radius:8px;
    }
    .summary:focus {
      outline:3px solid rgba(37,99,235,0.18);
      outline-offset:2px;
    }

    .chev {
      width:28px;
      height:28px;
      display:inline-grid;
      place-items:center;
      border-radius:6px;
      background:linear-gradient(180deg,rgba(37,99,235,0.06),rgba(2,6,23,0.02));
      transition: transform 240ms ease;
      flex:0 0 28px;
    }
    .chev svg { display:block; width:14px; height:14px; fill:var(--accent); }

    /* rotate the chevron when expanded (controlled by aria-expanded on the button) */
    .summary[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    .summary .title {
      font-weight:600;
      font-size:15px;
    }
    .summary .meta {
      margin-left:auto;
      color:var(--muted);
      font-size:13px;
    }

    /* Controlled content container (class "details") */
    .details {
      overflow: hidden;
      max-height: 0;
      transition: max-height 300ms cubic-bezier(.2,.9,.3,1), opacity 220ms ease;
      opacity:0;
      margin-top:8px;
      border-top:1px dashed rgba(15,23,42,0.06);
      padding-top:12px;
    }
    .details.open {
      opacity:1;
    }

    .details .inner {
      padding-right:6px;
    }

    .details p { margin:0 0 10px 0; color:var(--muted); }
    .details a { color:var(--accent); text-decoration:none; }
    .kbd {
      display:inline-block;
      padding:2px 6px;
      border-radius:6px;
      background:#0f172a;
      color:white;
      font-size:12px;
      margin-left:8px;
    }

    /* small helper for demo layout */
    main{ max-width:900px; margin:0 auto; }
    footer{ margin-top:20px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>
  <main>
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">Click the headings to expand or collapse the content. Each widget is wrapped with a div.example and the controlled content uses the class "details".</p>

    <div class="example">
      <button class="summary" id="summary-1" aria-expanded="false" aria-controls="details-1">
        <span class="chev" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true"><path d="M8.59 16.34L13.17 11.76 8.59 7.17 10 5.76 16 11.76 10 17.76z"/></svg>
        </span>
        <span class="title">Overview</span>
        <span class="meta">Quick summary</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="summary-1" aria-hidden="true">
        <div class="inner">
          <p>This section contains a brief overview of the expand/collapse widget. It demonstrates an accessible pattern using aria-expanded on the trigger and aria-hidden on the controlled content.</p>
          <p>Keyboard: the trigger is a native button, so Enter and Space activate it. Focus remains on the button when content is collapsed.</p>
          <p><a href="#" onclick="alert('Example link clicked');return false;">Example action</a></p>
        </div>
      </div>
    </div>

    <div class="example">
      <button class="summary" id="summary-2" aria-expanded="false" aria-controls="details-2">
        <span class="chev" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true"><path d="M8.59 16.34L13.17 11.76 8.59 7.17 10 5.76 16 11.76 10 17.76z"/></svg>
        </span>
        <span class="title">More information</span>
        <span class="meta">Details and examples</span>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="summary-2" aria-hidden="true">
        <div class="inner">
          <p>Here is a longer block of content to show how the open/close animation adapts to height. The script measures the content height to animate between 0 and the content's full height.</p>
          <ul>
            <li>Fully accessible attributes (aria-expanded, aria-hidden, aria-controls, aria-labelledby)</li>
            <li>Smooth height animation</li>
            <li>Multiple independent instances supported</li>
          </ul>
          <p>Tip: Use <span class="kbd">Enter</span> or <span class="kbd">Space</span> to toggle the panels via keyboard.</p>
        </div>
      </div>
    </div>

    <footer>End of demo.</footer>
  </main>

  <script>
    (function(){
      // Initialize all summary buttons that control a details container
      const triggers = Array.from(document.querySelectorAll('.summary[aria-controls]'));

      function openDetails(button, details) {
        // make content visible for assistive tech
        button.setAttribute('aria-expanded', 'true');
        details.setAttribute('aria-hidden', 'false');

        // Prepare for animation: ensure current computed height is taken into account
        details.classList.add('open');

        // Remove any inline maxHeight so we can measure natural scrollHeight
        details.style.maxHeight = '';

        // Use scrollHeight to animate to the full height
        const fullHeight = details.scrollHeight;

        // Start from 0 (in case it was just closed)
        details.style.maxHeight = '0px';
        // Force a repaint so the transition happens
        window.requestAnimationFrame(() => {
          details.style.maxHeight = fullHeight + 'px';
        });

        // After transition, clear maxHeight so the panel can grow/shrink naturally
        const onEnd = (e) => {
          if (e.target !== details) return;
          details.style.maxHeight = '';
          details.removeEventListener('transitionend', onEnd);
        };
        details.addEventListener('transitionend', onEnd);
      }

      function closeDetails(button, details) {
        button.setAttribute('aria-expanded', 'false');
        details.setAttribute('aria-hidden', 'true');

        // To animate from current height, set maxHeight to current scrollHeight first
        const height = details.scrollHeight;
        details.style.maxHeight = height + 'px';

        // Force repaint then set maxHeight to 0 to trigger transition
        window.requestAnimationFrame(() => {
          details.style.maxHeight = '0px';
        });

        const onEnd = (e) => {
          if (e.target !== details) return;
          // remove open class once collapsed so CSS opacity rules apply
          details.classList.remove('open');
          // clear inline maxHeight to keep DOM clean
          details.style.maxHeight = '';
          details.removeEventListener('transitionend', onEnd);
        };
        details.addEventListener('transitionend', onEnd);
      }

      triggers.forEach(btn => {
        const id = btn.getAttribute('aria-controls');
        const details = document.getElementById(id);
        if (!details) return;

        // Ensure initial states are consistent
        if (btn.getAttribute('aria-expanded') === 'true') {
          details.classList.add('open');
          details.setAttribute('aria-hidden', 'false');
          details.style.maxHeight = '';
        } else {
          details.classList.remove('open');
          details.setAttribute('aria-hidden', 'true');
          details.style.maxHeight = '';
        }

        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            closeDetails(btn, details);
          } else {
            openDetails(btn, details);
          }
        });

        // Optional: allow Ctrl+Click to open many, not implemented; default button keyboard handling suffices.
      });

      // For demonstration: close all if ESC pressed when focus is inside a details
      document.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') {
          // find any open details that contain the focused element
          const active = document.activeElement;
          const openDetails = document.querySelectorAll('.details.open');
          openDetails.forEach(d => {
            if (d.contains(active) || document.body.contains(active)) {
              const id = d.id;
              const trigger = document.querySelector('.summary[aria-controls="' + id + '"]');
              if (trigger) closeDetails(trigger, d);
            }
          });
        }
      });
    })();
  </script>
</body>
</html>