<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#fff;
      --accent:#0366d6;
      --muted:#6b7280;
      --radius:10px;
      --shadow: 0 6px 18px rgba(15,23,42,0.08);
      --gap:16px;
    }
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin:24px;
      background:linear-gradient(180deg,var(--bg),#fff 40%);
      color:#0f1724;
      line-height:1.4;
    }

    h1{font-size:1.25rem;margin:0 0 12px}
    p{margin:0 0 18px;color:var(--muted)}
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap:var(--gap);
      align-items:start;
    }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow);
      border:1px solid rgba(15,23,42,0.03);
    }

    .summary-button{
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
      background:transparent;
      border:0;
      padding:10px 12px;
      text-align:left;
      cursor:pointer;
      border-radius:8px;
      font-weight:600;
      color:var(--accent);
      font-size:0.98rem;
    }
    .summary-button:focus{
      outline:3px solid rgba(3,102,214,0.18);
      outline-offset:2px;
    }
    .summary-button .label{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .chev{
      width:18px;height:18px;display:inline-block;transform-origin:center;
      transition:transform .26s cubic-bezier(.2,.9,.3,1);
      color:var(--accent);
    }

    .details{
      overflow:hidden;
      margin-top:10px;
      border-radius:8px;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border:1px solid rgba(3,102,214,0.06);
      transition:box-shadow .18s;
      box-shadow:none;
    }
    .details.open{ box-shadow: 0 10px 30px rgba(3,102,214,0.06); }

    .details-inner{
      padding:12px;
      color:#0f1724;
      font-size:0.95rem;
    }

    /* collapsed state: hide content visually via max-height & aria-hidden */
    .details[data-state="closed"]{ max-height:0; padding-top:0; padding-bottom:0; border-width:0 0 0 0; }
    .details[data-state="open"]{ max-height:800px; } /* large enough to hold content */

    .muted{
      color:var(--muted); font-size:0.9rem;
    }

    /* rotate chevron when open */
    .summary-button[aria-expanded="true"] .chev{ transform:rotate(180deg); }

    /* reduce motion */
    @media (prefers-reduced-motion: reduce){
      .chev, .details{ transition:none !important; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p>Each widget is wrapped in a container with class "example". The controlled content containers use the class "details".</p>

  <div class="grid">
    <!-- Example 1 -->
    <div class="example" data-example="1">
      <button class="summary-button toggle-button" aria-expanded="false" aria-controls="details-1" type="button">
        <span class="label">
          <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
          </svg>
          Basic details
        </span>
        <span class="muted">Show more</span>
      </button>

      <div id="details-1" class="details" data-state="closed" aria-hidden="true">
        <div class="details-inner">
          <p><strong>What this is:</strong> A simple expand/collapse region controlled by a button. The button uses aria-expanded to reflect the state and aria-controls to identify the content area.</p>
          <p class="muted">Tip: Press the button (or Enter/Space when focused) to toggle. Press Escape while focus is inside to close.</p>
        </div>
      </div>
    </div>

    <!-- Example 2 -->
    <div class="example" data-example="2">
      <button class="summary-button toggle-button" aria-expanded="false" aria-controls="details-2" type="button">
        <span class="label">
          <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
          </svg>
          Additional information
        </span>
        <span class="muted">Read details</span>
      </button>

      <div id="details-2" class="details" data-state="closed" aria-hidden="true">
        <div class="details-inner">
          <h2 style="margin:0 0 8px; font-size:1rem;">More context</h2>
          <p style="margin:0 0 10px">This example shows a slightly richer content area. The script performs a smooth slide animation using max-height and the content's scrollHeight to animate open/close transitions.</p>
          <ul style="margin:0 0 10px 20px; color:var(--muted)">
            <li>Accessible: aria-expanded, aria-controls, aria-hidden</li>
            <li>Animated: smooth height transition</li>
            <li>Keyboard: Escape closes while focus is inside</li>
          </ul>
          <button type="button" style="padding:8px 10px;border-radius:6px;border:1px solid rgba(15,23,42,0.06);background:#fff;cursor:pointer;">Action inside</button>
        </div>
      </div>
    </div>

    <!-- Example 3: starts open -->
    <div class="example" data-example="3">
      <button class="summary-button toggle-button" aria-expanded="true" aria-controls="details-3" type="button">
        <span class="label">
          <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
          </svg>
          Initially open panel
        </span>
        <span class="muted">Collapse</span>
      </button>

      <div id="details-3" class="details open" data-state="open" aria-hidden="false">
        <div class="details-inner">
          <p><em>This panel is open by default. Widgets can be initialized to an open or closed state.</em></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const examples = document.querySelectorAll('.example');

      examples.forEach((example, index) => {
        const btn = example.querySelector('.toggle-button');
        let details = example.querySelector('.details');

        if (!btn || !details) return;

        // Ensure details has an id that matches aria-controls, or update aria-controls
        if (!details.id) {
          details.id = 'details-auto-' + (index + 1) + '-' + Math.floor(Math.random()*10000);
        }
        if (!btn.getAttribute('aria-controls')) {
          btn.setAttribute('aria-controls', details.id);
        } else {
          // if aria-controls points elsewhere, sync reference
          const ctrl = btn.getAttribute('aria-controls');
          if (ctrl !== details.id) {
            btn.setAttribute('aria-controls', details.id);
          }
        }

        // Initialize state based on attributes/classes
        const initiallyOpen = btn.getAttribute('aria-expanded') === 'true' || details.classList.contains('open');
        setState(initiallyOpen, {animate:false});

        // Click toggles
        btn.addEventListener('click', () => {
          const open = btn.getAttribute('aria-expanded') === 'true';
          setState(!open, {animate:true});
        });

        // Close on Escape when focus is inside the details
        details.addEventListener('keydown', (ev) => {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            setState(false, {animate:true});
            btn.focus();
          }
        });

        // Allow focus inside details to be tabbable; when closed, we set aria-hidden
        // We also animate using max-height tuning
        function setState(open, options){
          const animate = options && options.animate;
          btn.setAttribute('aria-expanded', String(!!open));
          details.setAttribute('data-state', open ? 'open' : 'closed');
          details.classList.toggle('open', !!open);
          details.setAttribute('aria-hidden', String(!open));

          // Update the visible text in the button (small affordance)
          const label = btn.querySelector('.muted');
          if(label){
            label.textContent = open ? 'Collapse' : (btn.closest('.example').dataset.example === "1" ? 'Show more' : 'Read details');
          }

          // Animation: toggle max-height between 0 and scrollHeight
          if (animate){
            const inner = details.querySelector('.details-inner');
            if (!inner) return;
            // Temporarily set max-height to current for a smooth transition start
            const startHeight = details.scrollHeight;
            if (open){
              // from 0 to content height
              details.style.maxHeight = '0px';
              // force reflow
              void details.offsetHeight;
              details.style.maxHeight = inner.scrollHeight + 'px';
            } else {
              // from current to 0
              details.style.maxHeight = details.scrollHeight + 'px';
              // force reflow
              void details.offsetHeight;
              details.style.maxHeight = '0px';
            }
            // when transition ends, clear inline max-height for open state so it can grow naturally
            const onTransitionEnd = (e) => {
              if (e.target !== details || e.propertyName !== 'max-height') return;
              details.removeEventListener('transitionend', onTransitionEnd);
              if (open){
                details.style.maxHeight = '800px'; // keep a generous max to allow some extra content; keeps class-driven open behavior
              } else {
                details.style.maxHeight = '0px';
              }
            };
            details.addEventListener('transitionend', onTransitionEnd);
          } else {
            // immediate, set max-height based on state
            details.style.transition = 'none';
            details.style.maxHeight = open ? '800px' : '0px';
            // restore transition shortly after
            requestAnimationFrame(()=> {
              details.style.transition = '';
            });
          }
        }
      });
    })();
  </script>
</body>
</html>