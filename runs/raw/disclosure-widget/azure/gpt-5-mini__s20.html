<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2563eb;
      --muted:#6b7280;
      --bg:#f8fafc;
      --card:#fff;
      --radius:8px;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg,#f8fafc 0%, #eef2ff 100%);
      color:#0f172a;
    }
    h1{ margin: 0 0 18px 0; font-size: 20px;}
    .examples { display: grid; gap: 16px; max-width: 900px; margin-top: 12px; }
    .example{
      background: var(--card);
      border: 1px solid rgba(15,23,42,0.06);
      box-shadow: 0 1px 2px rgba(15,23,42,0.04);
      padding: 14px;
      border-radius: var(--radius);
    }
    .example h2{
      font-size: 15px;
      margin: 0 0 8px 0;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .note { font-size: 13px; color: var(--muted); margin: 6px 0 12px 0; }

    /* Button style used for custom widgets */
    .expander{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background: linear-gradient(180deg,#fff,#f7fbff);
      border:1px solid rgba(15,23,42,0.08);
      padding:8px 12px;
      border-radius: 8px;
      cursor:pointer;
      font-size:14px;
      color:#0f172a;
    }
    .expander:focus{ outline:3px solid rgba(37,99,235,0.15); outline-offset:2px; }

    /* triangle icon (CSS) */
    .expander::after{
      content: "";
      width: 0;
      height: 0;
      border-left:6px solid transparent;
      border-right:6px solid transparent;
      border-top:8px solid var(--muted);
      transition: transform 180ms ease;
      margin-left:4px;
    }
    .expander[aria-expanded="true"]::after{
      transform: rotate(180deg);
      border-top-color: var(--accent);
    }

    /* Controlled content containers */
    .details{
      margin-top:10px;
      padding:12px;
      border-radius:8px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border:1px solid rgba(15,23,42,0.04);
      color:#0b1220;
      line-height:1.45;
    }

    /* Small visual for native <details> summary */
    details summary{
      list-style: none;
      cursor: pointer;
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(15,23,42,0.04);
      display:inline-block;
      margin-bottom:8px;
      background: #fff;
    }
    details summary::-webkit-details-marker { display:none; }
    details[open] summary{ box-shadow: 0 1px 0 rgba(15,23,42,0.02); }

    /* Animated variant */
    .details.animated{
      overflow: hidden;
      transition: max-height 280ms cubic-bezier(.2,.8,.2,1), opacity 180ms ease;
      opacity: 1;
    }
    .details.animated.collapsed{
      opacity: 0;
      /* max-height will be set inline by JS */
    }

    /* small helper */
    pre.sample { background:#0b1220; color:#e6eef8; padding:10px; border-radius:6px; overflow:auto; font-size:13px; }

    @media (prefers-reduced-motion: reduce){
      .expander::after, .details.animated { transition: none !important; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="note">Each widget is wrapped with a container having class="example". The controlled content container uses class="details".</p>

  <div class="examples">

    <!-- Example 1: Native details element -->
    <div class="example" id="ex-native">
      <h2>Native &lt;details&gt; element</h2>
      <p class="note">This uses the built-in browser widget. The content container below has class="details".</p>

      <details>
        <summary id="native-summary-1">Show basic details</summary>
        <div class="details" id="native-details-1" role="region" aria-labelledby="native-summary-1">
          <p>
            The native &lt;details&gt; element provides expand/collapse functionality without custom scripting.
            Use it when you want a simple, accessible disclosure. Styling is limited by the browser, but it's robust.
          </p>
          <ul>
            <li>Automatic keyboard support (Enter / Space).</li>
            <li>State reflected via the "open" attribute on the details element.</li>
          </ul>
        </div>
      </details>
    </div>

    <!-- Example 2: Simple custom toggle -->
    <div class="example" id="ex-custom">
      <h2>Custom button-controlled panel</h2>
      <p class="note">A simple accessible widget controlled by a button. The content container uses class="details".</p>

      <button class="expander" id="btn-panel-1" aria-expanded="false" aria-controls="panel-1">
        Show more information
      </button>

      <div class="details" id="panel-1" role="region" aria-labelledby="btn-panel-1" hidden aria-hidden="true">
        <p>
          This panel is toggled by a button. When collapsed, it uses the "hidden" attribute and aria-hidden="true".
          When open, "hidden" is removed and aria-hidden="false" is set. The button reflects the state via aria-expanded.
        </p>
        <p>Because the toggle uses a real button element, keyboard and focus behaviors are built-in.</p>
      </div>
    </div>

    <!-- Example 3: Smooth animated expand/collapse -->
    <div class="example" id="ex-animated">
      <h2>Smooth animated expand/collapse</h2>
      <p class="note">A slightly more advanced widget that animates the height for a smooth transition. The container has class="details".</p>

      <button class="expander" id="btn-panel-2" aria-expanded="false" aria-controls="panel-2">
        Toggle advanced details
      </button>

      <div class="details animated collapsed" id="panel-2" role="region" aria-labelledby="btn-panel-2" aria-hidden="true" style="max-height:0;">
        <p>
          Animated panels need script to adjust max-height based on content size for smooth transitions.
          This implementation measures the content height and sets max-height accordingly when opening.
        </p>
        <p>
          The example also toggles aria-hidden and the button's aria-expanded attribute for accessibility.
        </p>
        <p>
          Tip: For large or dynamic content, you may want to recalculate the target height (e.g. on window resize).
        </p>
      </div>
    </div>

  </div>

  <script>
    // Generic toggle handler for simple button-controlled panels (non-animated)
    (function(){
      const simpleButton = document.getElementById('btn-panel-1');
      const simplePanel = document.getElementById('panel-1');

      simpleButton.addEventListener('click', function(){
        const expanded = simpleButton.getAttribute('aria-expanded') === 'true';
        simpleButton.setAttribute('aria-expanded', String(!expanded));
        if (expanded) {
          simplePanel.setAttribute('hidden', '');
          simplePanel.setAttribute('aria-hidden', 'true');
        } else {
          simplePanel.removeAttribute('hidden');
          simplePanel.setAttribute('aria-hidden', 'false');
        }
      });

      // Keep attributes in sync if markup is manipulated elsewhere
      // (e.g. server-rendered open state).
      // Initialize based on current attributes:
      (function initSimple(){
        const isHidden = simplePanel.hasAttribute('hidden');
        simpleButton.setAttribute('aria-expanded', String(!isHidden));
        simplePanel.setAttribute('aria-hidden', String(isHidden ? 'true' : 'false'));
      })();
    })();

    // Animated expander implementation
    (function(){
      const btn = document.getElementById('btn-panel-2');
      const panel = document.getElementById('panel-2');

      // Utility to open panel with animation
      function openPanel(){
        panel.classList.remove('collapsed');
        // make sure it's visible for measurement
        panel.style.display = 'block';
        // remove inline max-height so scrollHeight is accurate
        panel.style.maxHeight = 'none';
        // measure
        const target = panel.scrollHeight + 'px';
        // set to 0 then to target to trigger transition
        panel.style.maxHeight = '0px';
        // force reflow
        // eslint-disable-next-line no-unused-expressions
        panel.offsetHeight;
        panel.style.maxHeight = target;
        panel.setAttribute('aria-hidden', 'false');
        btn.setAttribute('aria-expanded', 'true');
      }

      function closePanel(){
        // set explicit max-height to current height then force it to 0
        const current = panel.scrollHeight + 'px';
        panel.style.maxHeight = current; // current measured height
        // force reflow
        // eslint-disable-next-line no-unused-expressions
        panel.offsetHeight;
        panel.style.maxHeight = '0px';
        panel.classList.add('collapsed');
        panel.setAttribute('aria-hidden', 'true');
        btn.setAttribute('aria-expanded', 'false');
      }

      // After transition ends, if opened, remove max-height limit to allow dynamic content.
      panel.addEventListener('transitionend', function (e) {
        if (e.propertyName !== 'max-height') return;
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          panel.style.maxHeight = 'none';
        } else {
          // keep it at 0 and use collapsed class for opacity
          panel.style.display = '';
        }
      });

      btn.addEventListener('click', function(){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          closePanel();
        } else {
          openPanel();
        }
      });

      // Initialize state (collapsed by default)
      (function init(){
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          panel.classList.remove('collapsed');
          panel.setAttribute('aria-hidden','false');
          panel.style.maxHeight = 'none';
        } else {
          panel.classList.add('collapsed');
          panel.setAttribute('aria-hidden','true');
          panel.style.maxHeight = '0';
        }
      })();

      // Recompute open height on window resize if currently open
      let resizeTimer;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
          if (btn.getAttribute('aria-expanded') === 'true') {
            // if open, temporarily remove max-height then set it to scrollHeight
            panel.style.maxHeight = 'none';
            const h = panel.scrollHeight + 'px';
            panel.style.maxHeight = h;
          }
        }, 120);
      });
    })();

    // Small enhancement: when native <details> toggles, set aria-expanded on summary for parity
    (function syncNativeDetails(){
      const detailsEl = document.querySelector('#ex-native details');
      const summary = document.getElementById('native-summary-1');
      if (!detailsEl || !summary) return;
      function update(){
        const open = detailsEl.hasAttribute('open');
        summary.setAttribute('aria-expanded', String(open));
      }
      detailsEl.addEventListener('toggle', update);
      // initialize
      update();
    })();
  </script>
</body>
</html>