<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Expand / Collapse Widget Examples</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#2563eb;
      --bg:#ffffff;
      --muted:#6b7280;
      --radius:8px;
      --shadow: 0 6px 18px rgba(16,24,40,0.06);
      --transition: 240ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f8fafc, #f1f5f9);
      margin: 32px;
      color: #0f172a;
      line-height: 1.45;
    }

    h1{
      font-size: 20px;
      margin: 0 0 18px 0;
    }

    .examples {
      display: grid;
      gap: 18px;
      max-width: 820px;
    }

    /* Wrapper required by the prompt */
    .example{
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      border: 1px solid rgba(2,6,23,0.04);
    }

    .example p { margin: 0 0 12px 0; color: var(--muted); font-size: 13px; }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border-radius: 8px;
      border: 1px solid rgba(2,6,23,0.06);
      cursor: pointer;
      font-weight: 600;
      color: #08203a;
      box-shadow: 0 1px 0 rgba(14,20,24,0.02);
      transition: box-shadow 160ms ease, transform 120ms ease;
      user-select: none;
    }

    .toggle:active { transform: translateY(1px); }
    .toggle:focus { outline: 3px solid rgba(37,99,235,0.12); outline-offset: 3px; }

    .toggle .chev {
      width: 16px;
      height: 16px;
      display: inline-block;
      transform-origin: 50% 50%;
      transition: transform var(--transition);
      color: var(--accent);
    }

    .toggle[aria-expanded="true"] .chev { transform: rotate(180deg); }

    /* The container that holds the controlled content (required class name 'details') */
    .details {
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 0;
      margin-top: 12px;
      border-radius: 8px;
      pointer-events: none;
      background: linear-gradient(180deg,#fbfdff,#ffffff);
      border: 1px solid rgba(2,6,23,0.04);
      padding: 0 12px;
    }

    .details.open {
      opacity: 1;
      pointer-events: auto;
    }

    .details .inner {
      padding: 14px 6px;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    /* small visual examples inside details */
    .card {
      background: #fff;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid rgba(2,6,23,0.04);
      box-shadow: 0 2px 6px rgba(2,6,23,0.04);
      margin-bottom: 8px;
    }

    /* nested example styling */
    .nested-note { font-size: 13px; color: #334155; margin-bottom: 8px; }

    /* Make links slightly styled */
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <main class="examples" aria-labelledby="demoHeading">
    <h1 id="demoHeading">Expand / Collapse Widget Examples</h1>

    <!-- Example 1: Basic -->
    <div class="example">
      <p class="muted">Basic expand/collapse pattern using a button and a controlled container with class="details".</p>
      <button id="toggle1" class="toggle" aria-controls="content1" aria-expanded="false">
        <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M5 7.5l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Show more
      </button>

      <div id="content1" class="details" role="region" aria-labelledby="toggle1" aria-hidden="true">
        <div class="inner">
          <div class="card">
            <strong>Details</strong>
            <p class="muted">This is the basic content that is shown or hidden when the button is toggled. The container has the required class "details".</p>
            <a href="#">Learn more</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 2: Animated, keeps height fluid -->
    <div class="example">
      <p class="muted">Animated open/close. The script computes the height for a smooth transition and restores auto height when open.</p>

      <button id="toggle2" class="toggle" aria-controls="content2" aria-expanded="false">
        <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M5 7.5l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        View details
      </button>

      <div id="content2" class="details" role="region" aria-labelledby="toggle2" aria-hidden="true">
        <div class="inner">
          <div class="card">
            <strong>Animated content</strong>
            <p class="muted">This content demonstrates a smooth height animation using JavaScript to measure and animate max-height. Works well for variable-height content.</p>
            <ul>
              <li>Point one</li>
              <li>Point two</li>
              <li>Point three</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 3: Nested widgets -->
    <div class="example">
      <p class="muted">Nested expand/collapse widget. Both widgets are wrapped in their own .example and their content containers use class="details".</p>

      <button id="toggle3" class="toggle" aria-controls="content3" aria-expanded="false">
        <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M5 7.5l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Show nested example
      </button>

      <div id="content3" class="details" role="region" aria-labelledby="toggle3" aria-hidden="true">
        <div class="inner">
          <div class="card">
            <div class="nested-note">Parent content. Inside is another widget.</div>

            <!-- Inner widget wrapped with its own .example as required -->
            <div class="example" style="margin:0; padding:12px;">
              <button id="toggle3-1" class="toggle" aria-controls="content3-1" aria-expanded="false">
                <svg class="chev" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                  <path d="M5 7.5l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Inner details
              </button>

              <div id="content3-1" class="details" role="region" aria-labelledby="toggle3-1" aria-hidden="true">
                <div class="inner">
                  <p class="muted">This is an inner details region. Nesting works because each button controls its own container with class="details".</p>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </main>

  <script>
    (function () {
      // Find all toggle buttons that control a details container
      const toggles = Array.from(document.querySelectorAll('button[aria-controls]'));

      function setOpenState(button, details, isOpen) {
        button.setAttribute('aria-expanded', String(isOpen));
        details.setAttribute('aria-hidden', String(!isOpen));
        if (isOpen) details.classList.add('open');
        else details.classList.remove('open');
      }

      function open(details) {
        // measure and animate
        details.style.display = 'block'; // ensure measurement works
        const height = details.scrollHeight;
        details.style.maxHeight = '0px';
        // Force a reflow before setting to measured height
        // so the transition occurs
        void details.offsetWidth;
        details.style.maxHeight = height + 'px';
        // after transition, clear inline max-height so content can resize naturally
        const cleanup = function (e) {
          if (e && e.target !== details) return;
          details.style.maxHeight = 'none';
          details.removeEventListener('transitionend', cleanup);
        };
        details.addEventListener('transitionend', cleanup);
      }

      function close(details) {
        // animate from current height to 0
        // ensure we have a numeric maxHeight to animate from
        details.style.maxHeight = details.scrollHeight + 'px';
        // force reflow
        void details.offsetWidth;
        details.style.maxHeight = '0px';
      }

      toggles.forEach(button => {
        const controlsId = button.getAttribute('aria-controls');
        const details = document.getElementById(controlsId);
        if (!details) return;

        // Ensure ARIA roles/labels exist
        details.setAttribute('role', details.getAttribute('role') || 'region');
        details.setAttribute('aria-labelledby', details.getAttribute('aria-labelledby') || button.id);

        // initialize states from aria-expanded if set on load
        const initial = button.getAttribute('aria-expanded') === 'true';
        setOpenState(button, details, initial);
        if (initial) {
          // make sure it's visible without transition on load
          details.classList.add('open');
          details.style.maxHeight = 'none';
          details.style.opacity = '1';
          details.style.pointerEvents = 'auto';
        } else {
          details.style.maxHeight = '0px';
          details.style.opacity = '';
        }

        button.addEventListener('click', (e) => {
          const isOpen = button.getAttribute('aria-expanded') === 'true';
          if (isOpen) {
            // close
            setOpenState(button, details, false);
            // animate close
            close(details);
          } else {
            // open
            setOpenState(button, details, true);
            open(details);
          }
        });

        // Close with Escape when focus inside the details or on the button
        [button, details].forEach(node => {
          node.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape' || ev.key === 'Esc') {
              const isOpen = button.getAttribute('aria-expanded') === 'true';
              if (isOpen) {
                setOpenState(button, details, false);
                close(details);
                button.focus();
              }
            }
          });
        });

        // When transition ends on close, ensure the element is hidden for screen readers/pointer events
        details.addEventListener('transitionend', (e) => {
          if (e.propertyName !== 'max-height') return;
          const openNow = button.getAttribute('aria-expanded') === 'true';
          if (!openNow) {
            // fully closed
            details.style.display = 'none';
            details.style.maxHeight = '0px';
            details.style.opacity = '';
            details.style.pointerEvents = '';
          } else {
            // fully open: remove maxHeight inline (open() already schedules this as well)
            details.style.display = '';
          }
        });

        // make sure details becomes display:block when opening (for browsers that had display:none)
        // and ensure aria-hidden sync
        details.addEventListener('transitionstart', () => {
          const openNow = button.getAttribute('aria-expanded') === 'true';
          if (openNow) {
            details.style.display = 'block';
          }
        });
      });

      // Progressive enhancement: allow toggling with links that might be injected later
      document.addEventListener('click', function (e) {
        const t = e.target.closest('a[data-toggle-details]');
        if (!t) return;
        e.preventDefault();
        const id = t.getAttribute('data-toggle-details');
        const button = document.querySelector('button[aria-controls="' + id + '"]');
        if (button) button.click();
      });

    })();
  </script>
</body>
</html>