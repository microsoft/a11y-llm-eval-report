<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b74de;
      --muted:#666;
      --surface:#fff;
      --shadow: 0 2px 8px rgba(12,20,30,0.08);
      --radius:8px;
      --transition: 300ms cubic-bezier(.2,.9,.3,1);
    }

    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(180deg,#f6f9fc,#eef4fb);
      color:#102026;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    main{
      max-width:900px;
      margin:48px auto;
      padding:24px;
    }

    h1{
      margin:0 0 16px 0;
      font-size:20px;
      font-weight:600;
    }

    p.lead{
      margin:0 0 24px 0;
      color:var(--muted);
      font-size:14px;
    }

    /* Each widget wrapper */
    .example{
      background:var(--surface);
      border-radius:var(--radius);
      padding:12px;
      box-shadow:var(--shadow);
      margin-bottom:18px;
    }

    /* Toggle button */
    .toggle {
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      padding:12px;
      background:transparent;
      border:1px solid rgba(16,32,38,0.06);
      border-radius:8px;
      cursor:pointer;
      text-align:left;
      font-size:15px;
      color:inherit;
      transition:box-shadow var(--transition), background var(--transition), transform 120ms ease;
    }
    .toggle:focus{
      outline:3px solid rgba(11,116,222,0.15);
      outline-offset:2px;
    }
    .toggle:hover{
      transform:translateY(-1px);
    }
    .toggle .label{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .toggle .title{
      font-weight:600;
      line-height:1;
    }
    .toggle .subtitle{
      font-size:13px;
      color:var(--muted);
    }

    /* Icon caret */
    .toggle .caret{
      width:28px;
      height:28px;
      border-radius:6px;
      background:rgba(11,116,222,0.06);
      display:inline-grid;
      place-items:center;
      transition:transform var(--transition);
      flex-shrink:0;
    }
    .toggle[aria-expanded="true"] .caret{
      transform:rotate(180deg);
      background:rgba(11,116,222,0.12);
    }
    .caret svg{
      display:block;
      width:14px;
      height:14px;
      color:var(--accent);
      fill:none;
      stroke:currentColor;
      stroke-width:2;
    }

    /* Controlled content container (must have class "details") */
    .details{
      overflow:hidden;               /* required for transition */
      max-height:0;                  /* collapsed by default */
      transition:max-height var(--transition), opacity var(--transition);
      opacity:0;
      margin-top:10px;
      border-left:3px solid rgba(11,116,222,0.06);
      padding:0 12px;
      border-radius:6px;
    }
    .details.is-open{
      opacity:1;
      /* max-height will be set inline to measured height on open for smooth animation */
    }

    /* Inner content styling */
    .details .inner{
      padding:12px 4px 16px 8px;
      font-size:14px;
      color:#153238;
      background:linear-gradient(180deg, rgba(11,116,222,0.02), transparent);
      border-radius:6px;
    }

    /* Small example variations */
    .example.small .toggle{ padding:8px; font-size:14px; }
    .example.small .caret{ width:24px; height:24px; border-radius:6px; }
    .example.ghost{
      background:transparent;
      box-shadow:none;
      border:1px dashed rgba(16,32,38,0.04);
    }

    /* Accessibility hint text */
    .hint{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }

    /* Decorative footer */
    footer{
      margin-top:36px;
      font-size:13px;
      color:var(--muted);
    }

    /* Make sure content is readable if JS disabled: show details by default when .no-js on <html> */
    .no-js .details{
      max-height:none;
      opacity:1;
    }

  </style>
</head>
<body>
  <main>
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">Two examples of an accessible expand/collapse widget. Each widget is wrapped in a container with the <code>example</code> class. The controlled content container uses the <code>details</code> class.</p>

    <!-- Example 1: Basic -->
    <div class="example" id="ex1">
      <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1" data-toggle="expand">
        <div class="label">
          <span class="title">Show additional information</span>
          <span class="subtitle">A simple accessible expand/collapse control</span>
        </div>
        <span class="caret" aria-hidden="true">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <polyline points="6 9 12 15 18 9" stroke-linecap="round" stroke-linejoin="round"></polyline>
          </svg>
        </span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="inner">
          <p>This content is controlled by the button above. It demonstrates how to implement an expand/collapse widget with proper ARIA attributes: the button uses <code>aria-expanded</code> and <code>aria-controls</code>, and the content region uses <code>role="region"</code> and <code>aria-hidden</code>.</p>
          <ul>
            <li>Keyboard-accessible: Space / Enter trigger the toggle (native button behavior).</li>
            <li>Smooth open/close animation powered by JavaScript measuring content height.</li>
            <li>Visually indicates open state by rotating the caret.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Example 2: Initially open, smaller -->
    <div class="example small ghost" id="ex2">
      <button class="toggle" aria-expanded="true" aria-controls="details-2" id="toggle-2" data-toggle="expand">
        <div class="label">
          <span class="title">Release notes â€” version 2.1.0</span>
          <span class="subtitle">Click to hide</span>
        </div>
        <span class="caret" aria-hidden="true">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <polyline points="6 9 12 15 18 9" stroke-linecap="round" stroke-linejoin="round"></polyline>
          </svg>
        </span>
      </button>

      <div id="details-2" class="details is-open" role="region" aria-labelledby="toggle-2" aria-hidden="false" style="max-height:1000px;">
        <div class="inner">
          <strong>Highlights:</strong>
          <ul>
            <li>Faster rendering of lists.</li>
            <li>Improved keyboard navigation.</li>
            <li>Bug fixes and performance improvements.</li>
          </ul>
          <p class="hint">This example starts open to show how the widget handles an initially expanded state.</p>
        </div>
      </div>
    </div>

    <footer>
      Tip: Buttons are real <code>&lt;button&gt;</code> elements so they work with keyboards and assistive technology out of the box.
    </footer>
  </main>

  <script>
    (function(){
      // Mark <html> with .no-js if JS is disabled; remove now that JS runs
      document.documentElement.classList.remove('no-js');

      // Polyfill helper: measure height of element's content
      function measureHeight(el){
        // Temporarily remove max-height/overflow to measure natural height
        var currentMax = el.style.maxHeight;
        var currentOverflow = el.style.overflow;
        el.style.maxHeight = 'none';
        el.style.overflow = 'visible';
        var h = el.scrollHeight;
        el.style.maxHeight = currentMax;
        el.style.overflow = currentOverflow;
        return h;
      }

      // Initialize all toggles
      var toggles = document.querySelectorAll('[data-toggle="expand"]');
      toggles.forEach(function(btn, idx){
        var controlsId = btn.getAttribute('aria-controls');
        if(!controlsId) return;
        var details = document.getElementById(controlsId);
        if(!details) return;

        // Ensure unique ids (if missing) - already provided in markup
        // Set initial ARIA states based on markup OR fallback to closed
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        var hidden = !(expanded);

        // Initialize styles for details
        if(expanded){
          // Measure and set an initial max-height large enough so the transition can animate if toggled
          // Some examples may provide style inline (like ex2); we'll ensure consistency:
          var h = measureHeight(details);
          details.style.maxHeight = h + 'px';
          details.classList.add('is-open');
          details.setAttribute('aria-hidden','false');
        } else {
          details.style.maxHeight = '0';
          details.classList.remove('is-open');
          details.setAttribute('aria-hidden','true');
        }

        // Click handler toggles state
        btn.addEventListener('click', function(e){
          var isOpen = btn.getAttribute('aria-expanded') === 'true';
          if(isOpen){
            // Close
            // To animate from current height to 0, set max-height to measured height first (in case it was 'none')
            var currentHeight = measureHeight(details);
            details.style.maxHeight = currentHeight + 'px';
            // Force a browser reflow so the change is registered before setting to 0
            details.getBoundingClientRect();
            // Now collapse
            details.style.maxHeight = '0';
            details.classList.remove('is-open');
            details.setAttribute('aria-hidden','true');
            btn.setAttribute('aria-expanded','false');
          } else {
            // Open
            details.classList.add('is-open');
            // Measure target height then set max-height so the transition animates to that value
            var targetH = measureHeight(details);
            details.style.maxHeight = targetH + 'px';
            details.setAttribute('aria-hidden','false');
            btn.setAttribute('aria-expanded','true');
            // When transition ends, clear max-height so content can resize naturally
            var onEnd = function(e){
              if(e.target !== details) return;
              details.style.maxHeight = 'none';
              details.removeEventListener('transitionend', onEnd);
            };
            details.addEventListener('transitionend', onEnd);
          }
        });

        // Also allow toggling via Enter/Space on the button is handled natively, but keep keyboard support consistent
        btn.addEventListener('keydown', function(e){
          if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){
            // open
            if(btn.getAttribute('aria-expanded') === 'false'){
              e.preventDefault();
              btn.click();
            }
          }
          if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){
            // close
            if(btn.getAttribute('aria-expanded') === 'true'){
              e.preventDefault();
              btn.click();
            }
          }
        });

        // If the details container is resized while open (images, fonts), clear inline max-height after a short delay
        // so it stays flexible. We already clear max-height on transitionend when opening.
        // Add a ResizeObserver if available to keep things tidy.
        if(window.ResizeObserver){
          var ro = new ResizeObserver(function(){
            if(btn.getAttribute('aria-expanded') === 'true'){
              // ensure max-height stays 'none' so it grows naturally
              details.style.maxHeight = 'none';
            }
          });
          ro.observe(details);
        }
      });

      // For users without JS, ensure their content is visible:
      document.documentElement.classList.add('js-enabled');
    })();
  </script>

  <script>
    // If JS is completely disabled, the .no-js class should exist on <html>
    // Ensure it's present by default when page loads without JavaScript:
    (function(){
      // This script intentionally left blank for progressive enhancement.
    })();
  </script>
</body>
</html>