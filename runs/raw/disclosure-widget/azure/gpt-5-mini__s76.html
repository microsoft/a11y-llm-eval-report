<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Expand / Collapse Widget Examples</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#0366d6;
      --bg:#f8f9fb;
      --surface:#ffffff;
      --text:#0f1720;
      --muted:#6b7280;
      --radius:8px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      color:var(--text);
      background: linear-gradient(180deg,#f2f6fb 0%, #ffffff 100%);
    }

    h1{
      margin:0 0 18px;
      font-size:20px;
    }

    .example{
      background:var(--surface);
      border:1px solid rgba(16,24,40,0.06);
      box-shadow: 0 1px 2px rgba(16,24,40,0.04);
      border-radius:var(--radius);
      padding:16px;
      margin: 12px 0;
    }

    .example h2{
      font-size:16px;
      margin:0 0 12px;
    }

    /* Shared panel styling */
    .details{
      overflow:hidden;
      max-height:0;
      opacity:0;
      transition: max-height 320ms cubic-bezier(.2,.9,.2,1), opacity 200ms linear;
      padding:0 0;
      margin-top:12px;
      border-radius:6px;
      background: linear-gradient(180deg, rgba(3,102,214,0.03), rgba(3,102,214,0.01));
      border:1px solid rgba(3,102,214,0.06);
    }
    .details > .panel-inner{
      padding:12px 14px;
      font-size:14px;
      color:var(--muted);
      line-height:1.45;
    }
    /* Expanded state â€” native details[open] and .details.open for custom */
    details[open] .details,
    .details.open{
      max-height:800px; /* large enough for most content; allows transition */
      opacity:1;
    }

    /* Native details summary styles */
    details summary{
      list-style:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 8px;
      user-select:none;
      outline: none;
      border-radius:6px;
    }
    details summary::-webkit-details-marker{ display:none; }

    .summary-title{
      flex:1;
      font-weight:600;
      color:var(--text);
    }
    .summary-sub{
      font-size:13px;
      color:var(--muted);
    }

    /* Custom toggle button */
    .toggle-btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      background:transparent;
      border:1px solid rgba(16,24,40,0.06);
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      color:var(--text);
    }
    .toggle-btn:focus{
      outline:3px solid rgba(3,102,214,0.15);
      outline-offset:2px;
    }
    .caret{
      width:12px;
      height:12px;
      display:inline-block;
      transform-origin:center;
      transition: transform 200ms ease;
      border-right:2px solid var(--muted);
      border-bottom:2px solid var(--muted);
      transform:rotate(-45deg);
      margin-left:auto;
    }
    .toggle-btn[aria-expanded="true"] .caret,
    .accordion-btn[aria-expanded="true"] .caret{
      transform:rotate(45deg);
    }

    /* Accordion */
    .accordion .section{
      margin:8px 0;
    }
    .accordion h3{
      margin:0;
      font-size:14px;
    }
    .accordion-btn{
      width:100%;
      text-align:left;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:transparent;
      border:1px solid rgba(16,24,40,0.06);
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      color:var(--text);
    }
    .accordion-btn:focus{
      outline:3px solid rgba(3,102,214,0.12);
      outline-offset:2px;
    }

    /* Small helper text */
    .muted{
      color:var(--muted);
      font-size:13px;
      margin-top:8px;
    }

    /* Make the demo look nicer on small screens */
    @media (max-width:420px){
      body{ margin:12px; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <!-- Example 1: Native details element -->
  <div class="example" aria-label="Native details example">
    <h2>Native details element</h2>
    <p class="muted">Uses the browser's native details/summary with a dedicated content container that has class="details".</p>

    <details>
      <summary>
        <span class="summary-title">Native: Learn more about the widget</span>
        <span class="summary-sub">Click to open</span>
      </summary>

      <div class="details" id="native-panel-1" role="region" aria-labelledby="native-summary-1">
        <div class="panel-inner">
          The HTML details element provides a native expand/collapse experience that is keyboard accessible and works without JavaScript.
          This demo wraps the controlled content inside a container with class="details" so it can be styled and animated in CSS.
        </div>
      </div>
    </details>
  </div>

  <!-- Example 2: Custom single-button toggle -->
  <div class="example" aria-label="Custom toggle example">
    <h2>Custom toggle (button + controlled content)</h2>
    <p class="muted">A fully script-driven widget: button uses aria-expanded and aria-controls to control the container with class="details". Supports Escape to close.</p>

    <button class="toggle-btn" id="toggle-btn-1" aria-expanded="false" aria-controls="panel-1" type="button">
      Toggle details
      <span class="caret" aria-hidden="true"></span>
    </button>

    <div id="panel-1" class="details" role="region" aria-labelledby="toggle-btn-1">
      <div class="panel-inner">
        This content is controlled by the button above. The button updates aria-expanded and the panel toggles the class "open" to animate expansion and collapse.
      </div>
    </div>
  </div>

  <!-- Example 3: Accordion with multiple sections -->
  <div class="example" aria-label="Accordion example">
    <h2>Accordion (multiple sections)</h2>
    <p class="muted">Keyboard: Up/Down to move, Home/End to jump. Only one section opens at a time.</p>

    <div class="accordion" role="presentation" id="accordion-1">
      <div class="section">
        <h3>
          <button class="accordion-btn" id="acc-btn-1" aria-expanded="false" aria-controls="acc-panel-1" type="button">
            Section A: Overview
            <span class="caret" aria-hidden="true"></span>
          </button>
        </h3>
        <div id="acc-panel-1" class="details" role="region" aria-labelledby="acc-btn-1">
          <div class="panel-inner">
            Section A content. Accordions help group related content in collapsible panels. This panel is controlled by a button with aria-expanded.
          </div>
        </div>
      </div>

      <div class="section">
        <h3>
          <button class="accordion-btn" id="acc-btn-2" aria-expanded="false" aria-controls="acc-panel-2" type="button">
            Section B: Details
            <span class="caret" aria-hidden="true"></span>
          </button>
        </h3>
        <div id="acc-panel-2" class="details" role="region" aria-labelledby="acc-btn-2">
          <div class="panel-inner">
            Section B content. When one section opens, the others close. Use Up/Down, Home/End to navigate the section headers.
          </div>
        </div>
      </div>

      <div class="section">
        <h3>
          <button class="accordion-btn" id="acc-btn-3" aria-expanded="false" aria-controls="acc-panel-3" type="button">
            Section C: Notes
            <span class="caret" aria-hidden="true"></span>
          </button>
        </h3>
        <div id="acc-panel-3" class="details" role="region" aria-labelledby="acc-btn-3">
          <div class="panel-inner">
            Section C content. This example demonstrates a common accessible accordion pattern and keyboard support.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Helper to toggle a panel (adds/removes .open and updates aria-expanded)
      function togglePanel(button, panel, expanded) {
        const willOpen = expanded !== undefined ? expanded : !(button.getAttribute('aria-expanded') === 'true');
        button.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
        if (willOpen) {
          panel.classList.add('open');
        } else {
          panel.classList.remove('open');
        }
      }

      // Example 2: single custom toggle
      const toggleBtn = document.getElementById('toggle-btn-1');
      const panel1 = document.getElementById('panel-1');
      if (toggleBtn && panel1){
        // Initialize closed state
        toggleBtn.setAttribute('aria-expanded', 'false');
        panel1.classList.remove('open');

        toggleBtn.addEventListener('click', function(){
          const isOpen = toggleBtn.getAttribute('aria-expanded') === 'true';
          togglePanel(toggleBtn, panel1, !isOpen);
          // Move focus into panel if opening (optional):
          if (!isOpen) {
            // Do nothing to keep focus on the toggle button
          }
        });

        // Allow Escape to close when the button is focused
        toggleBtn.addEventListener('keydown', function(e){
          if (e.key === 'Escape') {
            togglePanel(toggleBtn, panel1, false);
            toggleBtn.focus();
          }
        });
      }

      // Example 3: accordion
      const accordion = document.getElementById('accordion-1');
      if (accordion){
        const buttons = Array.from(accordion.querySelectorAll('.accordion-btn'));
        const panels = buttons.map(btn => document.getElementById(btn.getAttribute('aria-controls')));

        // Initialize closed
        buttons.forEach((btn, i) => {
          btn.setAttribute('aria-expanded', 'false');
          panels[i].classList.remove('open');
        });

        // Click behavior: open clicked and close others
        buttons.forEach((btn, idx) => {
          btn.addEventListener('click', () => {
            const isOpen = btn.getAttribute('aria-expanded') === 'true';
            if (isOpen) {
              togglePanel(btn, panels[idx], false);
            } else {
              // Close all
              buttons.forEach((b,j) => togglePanel(b, panels[j], false));
              // Open target
              togglePanel(btn, panels[idx], true);
            }
          });

          // Keyboard navigation for accordion headers
          btn.addEventListener('keydown', (e) => {
            const key = e.key;
            let newIndex;
            if (key === 'ArrowDown' || key === 'Down') {
              e.preventDefault();
              newIndex = (idx + 1) % buttons.length;
              buttons[newIndex].focus();
            } else if (key === 'ArrowUp' || key === 'Up') {
              e.preventDefault();
              newIndex = (idx - 1 + buttons.length) % buttons.length;
              buttons[newIndex].focus();
            } else if (key === 'Home') {
              e.preventDefault();
              buttons[0].focus();
            } else if (key === 'End') {
              e.preventDefault();
              buttons[buttons.length - 1].focus();
            } else if (key === 'Escape') {
              // Close this section
              togglePanel(btn, panels[idx], false);
              btn.focus();
            } else if (key === 'Enter' || key === ' ') {
              // Space/Enter toggle happens by default for button (no need to intercept),
              // but we prevent default on Space because some browsers scroll the page.
              // We still let the click handler run after.
              if (key === ' ') {
                e.preventDefault();
                btn.click();
              }
            }
          });
        });
      }

      // Optional: smooth ARIA sync for native details when user toggles the native element
      document.querySelectorAll('details').forEach(function(detailsEl){
        // find the inner panel with class details
        const inner = detailsEl.querySelector('.details');
        const summary = detailsEl.querySelector('summary');
        if (!inner || !summary) return;

        // Ensure the inner panel has proper attributes (role/aria-labelledby)
        if (!inner.hasAttribute('role')) inner.setAttribute('role', 'region');
        if (!inner.hasAttribute('aria-labelledby')) {
          // give the summary a generated id if missing
          if (!summary.id) summary.id = 'summary-' + Math.random().toString(36).slice(2,9);
          inner.setAttribute('aria-labelledby', summary.id);
        }

        // Add a mutation observer to sync CSS class when open attribute changes
        const mo = new MutationObserver(function(muts){
          muts.forEach(m => {
            if (m.attributeName === 'open') {
              if (detailsEl.hasAttribute('open')) {
                inner.classList.add('open');
              } else {
                inner.classList.remove('open');
              }
            }
          });
        });
        mo.observe(detailsEl, { attributes: true });

        // Initialize
        if (detailsEl.hasAttribute('open')) inner.classList.add('open');
        else inner.classList.remove('open');
      });
    })();
  </script>
</body>
</html>