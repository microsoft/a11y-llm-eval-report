<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Modal Dialog Component Example</title>
<style>
:root {
  --backdrop-bg: rgba(0,0,0,.6);
  --dialog-bg: #fff;
  --dialog-color: #222;
  --radius: 12px;
  --shadow: 0 10px 40px rgba(0,0,0,.2);
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  color: #222;
  background: #f6f7fb;
}
.container { max-width: 800px; margin: 0 auto; padding: 2rem; }
button { font: inherit; }
.trigger {
  padding: .6rem 1rem;
  border-radius: 8px;
  border: 1px solid #1d72f2;
  color: #fff;
  background: #1d72f2;
  cursor: pointer;
}
.trigger:focus { outline: 3px solid #99c3ff; outline-offset: 2px; }
.modal-backdrop {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: var(--backdrop-bg);
  z-index: 1000;
}
.modal-backdrop.active { display: flex; }
.dialog {
  width: min(560px, calc(100% - 2rem));
  max-height: calc(100% - 2rem);
  overflow: auto;
  background: var(--dialog-bg);
  color: var(--dialog-color);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  outline: none;
}
.dialog-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1rem;
  border-bottom: 1px solid #e6e8ef;
}
.dialog-title { font-size: 1.25rem; margin: 0; }
.close {
  border: none;
  background: transparent;
  padding: .5rem;
  border-radius: 6px;
  cursor: pointer;
}
.close:focus { outline: 3px solid #99c3ff; outline-offset: 2px; }
.dialog-body { padding: 1rem; }
.dialog-actions {
  display: flex;
  gap: .5rem;
  padding: 1rem;
  border-top: 1px solid #e6e8ef;
}
.dialog-actions .primary {
  background: #1d72f2;
  border: 1px solid #1d72f2;
  color: #fff;
  border-radius: 8px;
  padding: .6rem 1rem;
}
.dialog-actions .secondary {
  background: #fff;
  border: 1px solid #ccd3e3;
  color: #333;
  border-radius: 8px;
  padding: .6rem 1rem;
}
@media (prefers-reduced-motion: no-preference) {
  .dialog { transform: translateY(8px); opacity: 0; transition: transform .2s ease, opacity .2s ease; }
  .modal-backdrop.active .dialog { transform: translateY(0); opacity: 1; }
}
.visually-hidden {
  position: absolute !important;
  height: 1px; width: 1px;
  overflow: hidden;
  clip: rect(1px,1px,1px,1px);
  white-space: nowrap;
  clip-path: inset(50%);
}
</style>
</head>
<body>
<main id="page" class="container" tabindex="-1">
  <h1>Modal Dialog Example</h1>
  <p>This page demonstrates an accessible modal dialog. The dialog is closed by default. Use the button below to open it.</p>
  <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="demo-modal">Open Modal</button>

  <p>Other page content goes here. Clicking outside the dialog or pressing Escape will close it.</p>
</main>

<div id="demo-modal-backdrop" class="modal-backdrop" aria-hidden="true">
  <div id="demo-modal" class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialog-title" aria-describedby="dialog-desc" tabindex="-1">
    <div class="dialog-header">
      <h2 id="dialog-title" class="dialog-title">Subscribe to updates</h2>
      <button class="close" type="button" aria-label="Close dialog">
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="dialog-body">
      <p id="dialog-desc">Sign up to receive product news and occasional tips. You can unsubscribe at any time.</p>
      <form onsubmit="event.preventDefault();">
        <label for="email">Email address</label>
        <input id="email" name="email" type="email" required placeholder="you@example.com" style="display:block;width:100%;margin:.5rem 0 1rem;padding:.6rem;border:1px solid #ccd3e3;border-radius:8px;">
        <label for="frequency">How often?</label>
        <select id="frequency" name="frequency" style="display:block;width:100%;margin:.5rem 0 1rem;padding:.6rem;border:1px solid #ccd3e3;border-radius:8px;">
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
          <option value="quarterly">Quarterly</option>
        </select>
      </form>
    </div>
    <div class="dialog-actions">
      <button class="primary" type="button">Subscribe</button>
      <button class="secondary close" type="button">Cancel</button>
    </div>
  </div>
</div>

<script>
(function() {
  const page = document.getElementById('page');
  const modalBackdrop = document.getElementById('demo-modal-backdrop');
  const modal = document.getElementById('demo-modal');
  const triggers = Array.from(document.querySelectorAll('.trigger'));
  const closeButtons = Array.from(modal.querySelectorAll('.close'));
  let lastFocusedElement = null;

  const focusableSelectors = [
    'a[href]',
    'area[href]',
    'input:not([disabled])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    'button:not([disabled])',
    'iframe',
    '[tabindex]:not([tabindex="-1"])',
    '[contenteditable="true"]'
  ].join(',');

  function getFocusableElements(container) {
    return Array.from(container.querySelectorAll(focusableSelectors))
      .filter(el => el.offsetParent !== null || (el.getBoundingClientRect && el.getBoundingClientRect().width));
  }

  function openModal(trigger) {
    lastFocusedElement = trigger || document.activeElement;
    modalBackdrop.classList.add('active');
    modalBackdrop.setAttribute('aria-hidden', 'false');
    page.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = 'hidden';

    const focusables = getFocusableElements(modal);
    const initialFocus = focusables.find(el => el.tagName.toLowerCase() !== 'svg') || modal;
    initialFocus.focus({ preventScroll: true });

    document.addEventListener('keydown', onKeyDown);
    modalBackdrop.addEventListener('click', onBackdropClick);
  }

  function closeModal() {
    modalBackdrop.classList.remove('active');
    modalBackdrop.setAttribute('aria-hidden', 'true');
    page.removeAttribute('aria-hidden');
    document.body.style.overflow = '';
    document.removeEventListener('keydown', onKeyDown);
    modalBackdrop.removeEventListener('click', onBackdropClick);
    if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
      lastFocusedElement.focus({ preventScroll: true });
    }
  }

  function onBackdropClick(e) {
    if (e.target === modalBackdrop) {
      closeModal();
    }
  }

  function onKeyDown(e) {
    if (e.key === 'Escape') {
      e.preventDefault();
      closeModal();
      return;
    }
    if (e.key === 'Tab') {
      const focusables = getFocusableElements(modal);
      if (focusables.length === 0) {
        e.preventDefault();
        modal.focus();
        return;
      }
      const first = focusables[0];
      const last = focusables[focusables.length - 1];
      const active = document.activeElement;

      if (e.shiftKey) {
        if (active === first || !modal.contains(active)) {
          e.preventDefault();
          last.focus();
        }
      } else {
        if (active === last || !modal.contains(active)) {
          e.preventDefault();
          first.focus();
        }
      }
    }
  }

  triggers.forEach(btn => {
    btn.addEventListener('click', () => openModal(btn));
  });

  closeButtons.forEach(btn => {
    btn.addEventListener('click', closeModal);
  });
})();
</script>
</body>
</html>