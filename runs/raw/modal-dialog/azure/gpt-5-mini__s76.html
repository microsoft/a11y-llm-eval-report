<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --backdrop: rgba(0,0,0,0.5);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 600px;
      --gap: 1rem;
      --shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      line-height: 1.4;
      padding: 2rem;
      color: #111;
      background: #f6f7fb;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .trigger {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    /* Modal base (hidden by default) */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.is-open {
      display: flex;
    }

    /* Backdrop */
    .modal__backdrop {
      position: absolute;
      inset: 0;
      background: var(--backdrop);
      backdrop-filter: blur(2px);
    }

    /* Dialog panel */
    .modal__panel {
      position: relative;
      background: var(--modal-bg);
      border-radius: var(--radius);
      max-width: var(--max-width);
      width: calc(100% - 2rem);
      margin: 1rem;
      padding: 1.25rem 1.25rem;
      box-shadow: var(--shadow);
      z-index: 1;
      transform: translateY(8px);
      transition: transform 180ms ease, opacity 180ms ease;
      opacity: 1;
    }

    .modal.is-open .modal__panel {
      transform: translateY(0);
    }

    .modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--gap);
      margin-bottom: 0.5rem;
    }

    .modal__title {
      font-size: 1.125rem;
      font-weight: 700;
      margin: 0;
    }

    .modal__close {
      background: transparent;
      border: 0;
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
      border-radius: 6px;
      color: #333;
    }

    .modal__close:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }

    .modal__body {
      margin-top: 0.5rem;
      font-size: 0.98rem;
    }

    .modal__footer {
      margin-top: 1rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 0.8rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .btn.secondary {
      background: #eef2ff;
      color: #3730a3;
    }

    .btn.primary {
      background: #2563eb;
      color: white;
    }

    /* For demonstration purposes: focus outlines on interactive elements */
    button:focus, a:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container" id="page-main">
    <h1>Modal Dialog Component (Closed by default)</h1>
    <p>
      This page contains an example modal dialog component. It is initially closed.
      Use the button below to open it.
    </p>

    <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">
      Open dialog
    </button>

    <p>
      This content represents the page behind the modal. When the modal opens, this region will be hidden from assistive technologies.
    </p>

    <p>
      Try navigating with Tab when the modal is open—the focus will be trapped inside the dialog. Press Escape or click outside the dialog to close it.
    </p>
  </div>

  <!-- Modal (closed by default) -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal__backdrop" data-modal-backdrop></div>

    <div class="modal__panel" role="document" tabindex="-1">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Example Modal</h2>
        <button class="modal__close" type="button" aria-label="Close dialog" data-modal-close>
          ×
        </button>
      </div>

      <div class="modal__body">
        <p>
          This is a simple accessible modal dialog. It traps focus, restores focus to the triggering element when closed,
          and can be dismissed by the close button, pressing Escape, or clicking outside the dialog panel.
        </p>

        <form>
          <label>
            Name
            <input type="text" name="name" placeholder="Your name" />
          </label>
          <br /><br />
          <label>
            Email
            <input type="email" name="email" placeholder="you@example.com" />
          </label>
        </form>
      </div>

      <div class="modal__footer">
        <button class="btn secondary" type="button" data-modal-close>Cancel</button>
        <button class="btn primary" type="button">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const modal = document.getElementById('example-modal');
      const modalPanel = modal.querySelector('.modal__panel');
      const backdrop = modal.querySelector('[data-modal-backdrop]');
      const closeButtons = Array.from(modal.querySelectorAll('[data-modal-close]'));
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const pageMain = document.getElementById('page-main');

      let lastFocused = null;

      function getFocusableElements(container) {
        const selectors = [
          'a[href]:not([tabindex="-1"])',
          'area[href]',
          'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
          'select:not([disabled]):not([tabindex="-1"])',
          'textarea:not([disabled]):not([tabindex="-1"])',
          'button:not([disabled]):not([tabindex="-1"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(','))).filter(el => el.offsetWidth || el.offsetHeight || el === document.activeElement);
      }

      function openModal(triggerEl) {
        lastFocused = triggerEl || document.activeElement;
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
        pageMain.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = 'hidden';

        // Focus first focusable inside or the panel itself
        const focusable = getFocusableElements(modalPanel);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          modalPanel.focus();
        }

        document.addEventListener('keydown', handleKeyDown, true);
      }

      function closeModal() {
        modal.classList.remove('is-open');
        modal.setAttribute('aria-hidden', 'true');
        pageMain.removeAttribute('aria-hidden');
        document.body.style.overflow = '';

        // restore focus
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }

        document.removeEventListener('keydown', handleKeyDown, true);
      }

      function handleKeyDown(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          // Focus trap
          const focusable = getFocusableElements(modalPanel);
          if (focusable.length === 0) {
            // nothing focusable; keep focus on panel
            e.preventDefault();
            modalPanel.focus();
            return;
          }

          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          const active = document.activeElement;

          if (e.shiftKey) {
            if (active === first || active === modalPanel) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (active === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Open handlers
      triggers.forEach(btn => {
        btn.addEventListener('click', function(e) {
          openModal(btn);
        });
      });

      // Close via backdrop click
      backdrop.addEventListener('click', function() {
        closeModal();
      });

      // Prevent clicks inside the panel from closing
      modalPanel.addEventListener('click', function(e) {
        e.stopPropagation();
      });

      // Close buttons inside modal
      closeButtons.forEach(cb => {
        cb.addEventListener('click', function() {
          closeModal();
        });
      });

      // Close if focusing outside modal while open (for assistive tech / keyboard-savvy users)
      // Keep as a safety net: if focus moves outside and modal is open, bring it back.
      document.addEventListener('focusin', function(e) {
        if (modal.classList.contains('is-open') && !modal.contains(e.target)) {
          // Bring focus back to panel or first focusable
          const focusable = getFocusableElements(modalPanel);
          if (focusable.length) {
            focusable[0].focus();
          } else {
            modalPanel.focus();
          }
        }
      });

      // Ensure modal is closed on load
      modal.setAttribute('aria-hidden', 'true');
    })();
  </script>
</body>
</html>