<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.55);
      --modal-bg: #fff;
      --radius: 12px;
      --max-width: 640px;
      --transition: 220ms cubic-bezier(.2,.9,.3,1);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    html,body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f7f9fc,#eef3f8);
      color: #0b1220;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    main {
      padding: 48px;
      max-width: 900px;
      margin: 0 auto;
    }

    .trigger {
      display: inline-block;
      padding: 10px 16px;
      border-radius: 8px;
      background: #0066ff;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(3,102,255,.16);
    }

    .trigger:focus {
      outline: 3px solid rgba(0,102,255,.18);
      outline-offset: 3px;
    }

    /* Modal overlay (hidden by default) */
    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: transparent;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition);
      z-index: 1000;
    }

    .modal.open {
      pointer-events: auto;
      opacity: 1;
      background: var(--overlay-bg);
    }

    /* Dialog panel */
    .modal .dialog {
      background: var(--modal-bg);
      width: calc(100% - 48px);
      max-width: var(--max-width);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transform: translateY(12px) scale(.99);
      opacity: 0;
      transition: transform var(--transition), opacity var(--transition);
      margin: 0 24px;
    }

    .modal.open .dialog {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .dialog header {
      padding: 20px 20px 0 20px;
    }

    .dialog h2 {
      margin: 0;
      font-size: 1.125rem;
      line-height: 1.2;
    }

    .dialog .content {
      padding: 16px 20px 20px 20px;
      color: #334155;
      font-size: 0.98rem;
    }

    .dialog footer {
      padding: 12px 20px 20px 20px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid transparent;
      background: #f1f5f9;
      color: #0b1220;
      cursor: pointer;
    }

    .btn.primary {
      background: #0066ff;
      color: #fff;
    }

    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      color: #94a3b8;
      font-size: 20px;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
    }

    .close-btn:focus {
      outline: 3px solid rgba(0,0,0,.08);
    }

    /* Make dialog position relative to place close button */
    .dialog-wrapper {
      position: relative;
    }

    /* Reduce motion preference respect */
    @media (prefers-reduced-motion: reduce) {
      .modal, .modal .dialog {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <main id="main">
    <h1>Modal dialog example</h1>
    <p>This page demonstrates an accessible modal dialog. The modal is closed by default. Click the button below to open it.</p>

    <button class="trigger" data-target="#modal">Open dialog</button>

    <p style="margin-top:24px">You can still interact with the rest of the page while the modal is closed. When open, focus is trapped inside the dialog and background content is hidden from assistive technology.</p>
  </main>

  <!-- Modal (closed by default) -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="dialog" role="document">
      <div class="dialog-wrapper">
        <button class="close-btn" aria-label="Close dialog" data-close>&times;</button>
        <header>
          <h2 id="modal-title">Example modal dialog</h2>
        </header>
        <div class="content" id="modal-desc">
          <p>This is a sample modal. It demonstrates a focus trap, keyboard access (Esc to close, Tab/Shift+Tab to cycle focus), clicking outside to close, and restoration of focus once the dialog closes.</p>
          <p>Try tabbing through the interactive elements:</p>
          <ul>
            <li><a href="#">A focusable link</a></li>
            <li><button class="btn">Secondary action</button></li>
            <li><button class="btn primary">Primary action</button></li>
          </ul>
        </div>
        <footer>
          <button class="btn" data-close>Cancel</button>
          <button class="btn primary" data-close>Done</button>
        </footer>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Utility to collect focusable elements
      var FOCUSABLE_SELECTORS = [
        'a[href]:not([tabindex^="-"]):not([aria-hidden])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',
        'select:not([disabled]):not([aria-hidden])',
        'textarea:not([disabled]):not([aria-hidden])',
        'button:not([disabled]):not([aria-hidden])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      var main = document.getElementById('main');
      var triggers = Array.prototype.slice.call(document.querySelectorAll('.trigger'));

      triggers.forEach(function (trigger) {
        trigger.addEventListener('click', function (e) {
          var targetSelector = trigger.getAttribute('data-target') || '#modal';
          var modal = document.querySelector(targetSelector);
          if (!modal) return;
          openModal(modal);
        });
      });

      function openModal(modal) {
        if (modal._isOpen) return;
        modal._isOpen = true;

        // Save previously focused element to restore later
        modal._previouslyFocused = document.activeElement;

        // Make main aria-hidden for screen readers while modal is open
        if (main) main.setAttribute('aria-hidden', 'true');

        modal.classList.add('open');
        modal.setAttribute('aria-hidden', 'false');

        // Prevent background scrolling
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';

        // Find focusable elements inside modal
        var focusable = Array.prototype.slice.call(modal.querySelectorAll(FOCUSABLE_SELECTORS));
        // Prefer focusing an element with [autofocus] or the first interactive element
        var toFocus = modal.querySelector('[autofocus]') || focusable[0] || modal.querySelector('.dialog');
        if (toFocus && typeof toFocus.focus === 'function') {
          // Wait a tick for transition to complete visually before focusing
          setTimeout(function () {
            toFocus.focus();
          }, 60);
        }

        // Click outside to close - listening on overlay
        modal._overlayClickHandler = function (ev) {
          if (ev.target === modal) {
            closeModal(modal);
          }
        };
        modal.addEventListener('mousedown', modal._overlayClickHandler);

        // Close buttons inside modal (data-close)
        modal._closeClickHandler = function (ev) {
          var btn = ev.target.closest && ev.target.closest('[data-close]');
          if (btn) {
            closeModal(modal);
          }
        };
        modal.addEventListener('click', modal._closeClickHandler);

        // Keyboard handling: Esc + Focus trap
        modal._keydownHandler = function (ev) {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            ev.preventDefault();
            closeModal(modal);
            return;
          }
          if (ev.key === 'Tab') {
            // Recompute focusable each Tab in case DOM changed
            var all = Array.prototype.slice.call(modal.querySelectorAll(FOCUSABLE_SELECTORS)).filter(function (el) {
              return el.offsetParent !== null || el === document.activeElement;
            });
            if (all.length === 0) {
              ev.preventDefault();
              return;
            }
            var first = all[0];
            var last = all[all.length - 1];
            if (ev.shiftKey) {
              if (document.activeElement === first || document.activeElement === modal) {
                ev.preventDefault();
                last.focus();
              }
            } else {
              if (document.activeElement === last) {
                ev.preventDefault();
                first.focus();
              }
            }
          }
        };
        document.addEventListener('keydown', modal._keydownHandler);
      }

      function closeModal(modal) {
        if (!modal._isOpen) return;
        modal._isOpen = false;

        modal.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');

        // Restore aria-hidden on main
        if (main) main.removeAttribute('aria-hidden');

        // Restore scroll
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';

        // Remove listeners
        if (modal._overlayClickHandler) {
          modal.removeEventListener('mousedown', modal._overlayClickHandler);
          modal._overlayClickHandler = null;
        }
        if (modal._closeClickHandler) {
          modal.removeEventListener('click', modal._closeClickHandler);
          modal._closeClickHandler = null;
        }
        if (modal._keydownHandler) {
          document.removeEventListener('keydown', modal._keydownHandler);
          modal._keydownHandler = null;
        }

        // Restore focus to previously focused element
        var prev = modal._previouslyFocused;
        if (prev && typeof prev.focus === 'function') {
          setTimeout(function () {
            prev.focus();
          }, 50);
        }
        modal._previouslyFocused = null;
      }

      // Accessibility: if an open modal exists and the user clicks a link or button outside, keep it inert visually.
      // The focus trapping and aria-hidden on main handle most assistive tech scenarios.

      // Optional: close modal on page unload to avoid persistent state (cleanup)
      window.addEventListener('beforeunload', function () {
        var openModals = document.querySelectorAll('.modal.open');
        openModals.forEach(function (m) {
          m.classList.remove('open');
          m.setAttribute('aria-hidden', 'true');
        });
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
        if (main) main.removeAttribute('aria-hidden');
      });
    })();
  </script>
</body>
</html>