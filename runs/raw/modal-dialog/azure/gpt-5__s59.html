<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Modal Dialog Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --backdrop: rgba(0,0,0,0.5);
      --bg: #fff;
      --fg: #111;
      --muted: #666;
      --primary: #2563eb;
      --border: #e5e7eb;
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1f2937;
        --fg: #f9fafb;
        --muted: #cbd5e1;
        --border: #374151;
      }
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.5;
      color: var(--fg);
      background: canvas;
    }
    [hidden] { display: none !important; }

    .container {
      max-width: 72rem;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    .trigger {
      appearance: none;
      border: none;
      background: var(--primary);
      color: #fff;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(0,0,0,0.15);
    }
    .trigger:focus-visible {
      outline: 3px solid color-mix(in oklab, var(--primary), white 30%);
      outline-offset: 2px;
    }
    .trigger:hover { filter: brightness(1.05); }

    body.modal-open { overflow: hidden; }

    .modal-root {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: var(--backdrop);
      opacity: 0;
      pointer-events: none;
      transition: opacity 200ms ease;
      z-index: 1000;
    }
    .modal-root[data-open] {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      background: var(--bg);
      color: var(--fg);
      width: min(640px, 90vw);
      border-radius: 0.75rem;
      box-shadow: 0 30px 80px rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      transform: translateY(12px) scale(0.98);
      opacity: 0;
      transition: transform 220ms ease, opacity 220ms ease;
      outline: none;
    }
    .modal-root[data-open] .modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1rem 0.75rem;
      border-bottom: 1px solid var(--border);
    }
    .modal-title {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 700;
    }
    .close {
      appearance: none;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 1.25rem;
      line-height: 1;
      border-radius: 0.375rem;
      padding: 0.25rem;
      cursor: pointer;
    }
    .close:focus-visible {
      outline: 3px solid color-mix(in oklab, var(--primary), white 30%);
      outline-offset: 2px;
    }
    .close:hover { color: var(--fg); }

    .modal-body { padding: 1rem; }
    .modal-footer {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      padding: 0.75rem 1rem 1rem;
      border-top: 1px solid var(--border);
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border);
      background: #f5f7fb;
      color: var(--fg);
      padding: 0.6rem 0.9rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    @media (prefers-color-scheme: dark) {
      .btn { background: #111827; }
    }
    .btn.primary {
      border-color: color-mix(in oklab, var(--primary), black 20%);
      background: var(--primary);
      color: #fff;
    }
    .btn:focus-visible {
      outline: 3px solid color-mix(in oklab, var(--primary), white 30%);
      outline-offset: 2px;
    }

    .field {
      display: grid;
      gap: 0.375rem;
      margin-block: 0.75rem;
    }
    .field label {
      font-weight: 600;
    }
    .field input, .field textarea {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: canvas;
      color: var(--fg);
    }
    .field input:focus-visible, .field textarea:focus-visible {
      outline: 3px solid color-mix(in oklab, var(--primary), white 40%);
      outline-offset: 2px;
    }

    @media (prefers-reduced-motion: reduce) {
      .modal-root, .modal {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="page-content">
    <h1>Modal Dialog Component</h1>
    <p>This example shows an accessible modal dialog that is closed by default.</p>
    <button class="trigger" type="button">Open Dialog</button>
    <p>More page content goes here to demonstrate background scrolling being locked while the modal is open.</p>
  </div>

  <div id="modal-root" class="modal-root" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="-1">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Feedback</h2>
        <button class="close" type="button" aria-label="Close dialog">âœ•</button>
      </div>
      <div class="modal-body">
        <p id="modal-desc">We value your feedback. Share your thoughts below.</p>

        <div class="field">
          <label for="name">Name</label>
          <input id="name" name="name" autocomplete="name" placeholder="Your name">
        </div>
        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="4" placeholder="Type your message"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn close" type="button">Cancel</button>
        <button class="btn primary" type="button" id="submit-btn">Submit</button>
      </div>
    </div>
  </div>

  <script>
    const modalRoot = document.getElementById('modal-root');
    const modal = modalRoot.querySelector('[role="dialog"]');
    const closeBtns = modal.querySelectorAll('.close');
    const triggers = document.querySelectorAll('.trigger');
    const body = document.body;
    let lastFocused = null;

    const focusableSelector = [
      'a[href]',
      'area[href]',
      'input:not([disabled]):not([type="hidden"])',
      'select:not([disabled])',
      'textarea:not([disabled])',
      'button:not([disabled])',
      'iframe',
      'object',
      'embed',
      '[contenteditable]',
      '[tabindex]:not([tabindex="-1"])'
    ].join(',');

    function getFocusable() {
      return Array.from(modal.querySelectorAll(focusableSelector))
        .filter(el => el.offsetParent !== null || el === modal);
    }

    function openModal() {
      if (!modalRoot.hidden) return;
      lastFocused = document.activeElement instanceof HTMLElement ? document.activeElement : null;
      modalRoot.hidden = false;
      body.classList.add('modal-open');
      requestAnimationFrame(() => {
        modalRoot.setAttribute('data-open', '');
        const focusables = getFocusable();
        const target = focusables[0] || modal;
        target.focus({ preventScroll: true });
        document.addEventListener('keydown', onKeyDown, true);
      });
    }

    function closeModal() {
      if (modalRoot.hidden) return;
      modalRoot.removeAttribute('data-open');
      body.classList.remove('modal-open');

      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) {
        modalRoot.hidden = true;
        restoreFocus();
        document.removeEventListener('keydown', onKeyDown, true);
        return;
      }

      const onEnd = (e) => {
        if (e.target !== modalRoot || e.propertyName !== 'opacity') return;
        modalRoot.hidden = true;
        modalRoot.removeEventListener('transitionend', onEnd);
        restoreFocus();
        document.removeEventListener('keydown', onKeyDown, true);
      };
      modalRoot.addEventListener('transitionend', onEnd);
      setTimeout(() => {
        if (!modalRoot.hasAttribute('data-open')) {
          modalRoot.hidden = true;
          modalRoot.removeEventListener('transitionend', onEnd);
          restoreFocus();
          document.removeEventListener('keydown', onKeyDown, true);
        }
      }, 300);
    }

    function restoreFocus() {
      if (lastFocused && document.contains(lastFocused)) {
        lastFocused.focus({ preventScroll: true });
      }
    }

    function onKeyDown(e) {
      if (e.key === 'Escape') {
        e.stopPropagation();
        e.preventDefault();
        closeModal();
        return;
      }
      if (e.key === 'Tab') {
        const focusables = getFocusable();
        if (focusables.length === 0) {
          e.preventDefault();
          modal.focus();
          return;
        }
        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        if (e.shiftKey) {
          if (document.activeElement === first || document.activeElement === modal) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }
    }

    modalRoot.addEventListener('click', (e) => {
      if (e.target === modalRoot) closeModal();
    });

    triggers.forEach(btn => {
      btn.addEventListener('click', openModal);
    });

    closeBtns.forEach(btn => {
      btn.addEventListener('click', closeModal);
    });

    const submitBtn = document.getElementById('submit-btn');
    if (submitBtn) {
      submitBtn.addEventListener('click', () => {
        closeModal();
      });
    }
  </script>
</body>
</html>