<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel-bg: #ffffff;
      --overlay: rgba(2,6,23,0.6);
      --accent: #2563eb;
      --radius: 8px;
      --shadow: 0 10px 30px rgba(2,6,23,0.35);
      --ease: cubic-bezier(.22,.9,.38,1);
    }

    html,body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f7fbff,#eef6ff);
      color: #0b1220;
    }

    .container {
      max-width: 720px;
      margin: 6vh auto;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(18,38,63,0.08);
    }

    .trigger {
      appearance: none;
      border: 0;
      background: linear-gradient(180deg, var(--accent), #174bbd);
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(37,99,235,0.18);
    }

    .trigger:focus {
      outline: 3px solid rgba(37,99,235,0.18);
      outline-offset: 3px;
    }

    /* Modal wrapper */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 1200;
      display: block; /* we control visibility with aria-hidden */
      pointer-events: none;
    }

    .modal[aria-hidden="true"] {
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
    }

    .modal[aria-hidden="false"] {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }

    /* overlay */
    .modal .overlay {
      position: absolute;
      inset: 0;
      background: var(--overlay);
      backdrop-filter: blur(4px);
      opacity: 0;
      transition: opacity 260ms var(--ease);
      pointer-events: auto;
    }
    .modal[aria-hidden="false"] .overlay {
      opacity: 1;
    }

    /* panel */
    .modal .panel {
      position: relative;
      width: min(680px, calc(100% - 48px));
      margin: 8vh auto;
      background: var(--panel-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transform: translateY(10px) scale(.995);
      opacity: 0;
      transition: transform 260ms var(--ease), opacity 260ms var(--ease);
      z-index: 2;
      pointer-events: auto;
      overflow: hidden;
    }
    .modal[aria-hidden="false"] .panel {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .panel header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 18px 20px;
      border-bottom: 1px solid rgba(10,20,40,0.06);
    }
    .panel h2 {
      margin: 0;
      font-size: 18px;
      line-height: 1;
    }
    .panel .close {
      appearance: none;
      border: 0;
      background: transparent;
      font-size: 20px;
      line-height: 1;
      padding: 6px;
      cursor: pointer;
      color: #475569;
    }
    .panel .close:focus {
      outline: 3px solid rgba(99,102,241,0.15);
      border-radius: 6px;
    }
    .panel .body {
      padding: 18px 20px;
      font-size: 15px;
      color: #0f172a;
      line-height: 1.5;
    }
    .panel footer {
      display: flex;
      gap: 8px;
      padding: 14px 20px;
      border-top: 1px solid rgba(10,20,40,0.06);
      justify-content: flex-end;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    }
    .btn {
      border: 0;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn.ghost {
      background: rgba(15,23,42,0.04);
      color: #0f172a;
    }
    .btn.primary {
      background: var(--accent);
      color: white;
    }

    /* Prevent background scroll while modal open */
    body.modal-open {
      overflow: hidden;
    }

    /* small screens */
    @media (max-width:480px) {
      .panel {
        margin: 6vh 14px;
      }
    }
  </style>
</head>
<body>
  <main id="page" class="container" tabindex="-1">
    <h1>Example page</h1>
    <p>This page demonstrates a simple accessible modal dialog. The button below opens the modal. The button to open it has the class "trigger".</p>

    <button class="trigger" id="openBtn">Open Modal</button>

    <section style="margin-top:20px;">
      <h2>More content</h2>
      <p>Focus is returned to the trigger when the modal closes. While open, focus is trapped inside the modal and pressing Escape closes it.</p>
    </section>
  </main>

  <!-- Modal (closed by default, aria-hidden="true") -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="overlay" data-overlay tabindex="-1"></div>

    <div class="panel" role="document" aria-describedby="modalDesc">
      <header>
        <h2 id="modalTitle">Confirm action</h2>
        <button class="close" id="closeBtn" aria-label="Close modal">&times;</button>
      </header>

      <div class="body" id="modalDesc">
        <p>Are you sure you want to perform this action? This modal demonstrates focus management, closing with the Escape key, clicking the overlay, and cycling focus with Tab/Shift+Tab.</p>
        <p>Try tabbing through the elements and then pressing Escape to close.</p>
      </div>

      <footer>
        <button id="cancelBtn" class="btn ghost">Cancel</button>
        <button id="confirmBtn" class="btn primary">Confirm</button>
      </footer>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('modal');
      const panel = modal.querySelector('.panel');
      const overlay = modal.querySelector('[data-overlay]');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const closeBtn = document.getElementById('closeBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const confirmBtn = document.getElementById('confirmBtn');
      const page = document.getElementById('page');

      let previouslyFocused = null;

      // Utility: find focusable elements inside an element
      const FOCUSABLE_SELECTORS = [
        'a[href]:not([tabindex="-1"])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
        'select:not([disabled]):not([tabindex="-1"])',
        'textarea:not([disabled]):not([tabindex="-1"])',
        'button:not([disabled]):not([tabindex="-1"])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      function getFocusable(container = modal) {
        return Array.from(container.querySelectorAll(FOCUSABLE_SELECTORS));
      }

      function openModal() {
        if (modal.getAttribute('aria-hidden') === 'false') return;
        previouslyFocused = document.activeElement;

        modal.setAttribute('aria-hidden', 'false');
        page.setAttribute('aria-hidden', 'true');
        document.body.classList.add('modal-open');

        // After rendered, move focus to the first focusable inside modal
        requestAnimationFrame(() => {
          const focusables = getFocusable(modal);
          if (focusables.length) {
            focusables[0].focus();
          } else {
            // ensure panel is focusable and focus it
            panel.setAttribute('tabindex', '-1');
            panel.focus();
          }
        });
      }

      function closeModal() {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        modal.setAttribute('aria-hidden', 'true');
        page.removeAttribute('aria-hidden');
        document.body.classList.remove('modal-open');

        // remove temporary tabindex from panel if we added it
        if (panel.hasAttribute('tabindex')) panel.removeAttribute('tabindex');

        // restore focus
        requestAnimationFrame(() => {
          if (previouslyFocused && typeof previouslyFocused.focus === 'function') {
            previouslyFocused.focus();
          } else {
            // fallback
            triggers[0]?.focus();
          }
        });
      }

      // Trap focus inside modal when open
      function handleKeyDown(e) {
        if (modal.getAttribute('aria-hidden') === 'true') return;

        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          const focusables = getFocusable(modal);
          if (focusables.length === 0) {
            // nothing to focus; keep focus on panel
            e.preventDefault();
            panel.focus();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          } else if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          }
        }
      }

      // Open triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', openModal);
        btn.addEventListener('keydown', (e) => {
          // support Enter/Space default behavior already triggers click; no extra needed
        });
      });

      // Close controls
      closeBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', (e) => {
        // clicking the overlay should close
        closeModal();
      });

      // Example confirm action
      confirmBtn.addEventListener('click', () => {
        // perform action here
        alert('Action confirmed!');
        closeModal();
      });

      // Global listeners
      document.addEventListener('keydown', handleKeyDown, true);

      // Prevent clicks inside panel from closing (overlay is separate so this is optional)
      panel.addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // Ensure focus remains inside modal if clicking inside panel (some browsers may not focus it)
      panel.addEventListener('focusin', () => {}, true);

      // Accessibility: If user programmatically navigates while modal open, keep aria-hidden in sync
      // (no further action required here, but left as a placeholder for extensions)
    })();
  </script>
</body>
</html>