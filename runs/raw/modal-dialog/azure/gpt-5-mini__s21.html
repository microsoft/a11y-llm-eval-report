<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --modal-radius: 8px;
      --modal-width: 520px;
      --accent: #0366d6;
      --shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    body.no-scroll {
      overflow: hidden;
    }

    /* Page layout */
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 0;
      padding: 24px;
      background: #f7f9fc;
      color: #0b1220;
    }

    header {
      margin-bottom: 18px;
    }

    .controls {
      margin-bottom: 18px;
    }

    button.trigger {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(3,102,214,0.2);
    }

    button.trigger:focus {
      outline: 3px solid rgba(3,102,214,0.25);
      outline-offset: 2px;
    }

    /* Overlay & modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease;
      z-index: 1000;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    /* When hidden attribute present, remove from flow (so screen readers don't see it) */
    .modal-overlay[hidden] {
      display: none;
    }

    .modal {
      background: var(--modal-bg);
      width: calc(100% - 48px);
      max-width: var(--modal-width);
      border-radius: var(--modal-radius);
      box-shadow: var(--shadow);
      padding: 20px;
      transform: translateY(-6px);
      transition: transform 220ms ease;
    }

    .modal:focus {
      outline: none;
    }

    .modal-overlay.open .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 12px;
    }

    .modal h2 {
      margin: 0;
      font-size: 1.125rem;
    }

    .modal p {
      margin: 12px 0 0 0;
      color: #334155;
    }

    .modal-body {
      margin-top: 14px;
    }

    .modal-footer {
      margin-top: 18px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 20px;
      line-height: 1;
      padding: 6px;
      cursor: pointer;
      color: #556575;
      border-radius: 6px;
    }

    .modal-close:hover {
      background: rgba(0,0,0,0.04);
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-muted {
      background: #eef2f6;
      color: #0b1220;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Small demo layout */
    .card {
      background: white;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(9,30,66,0.04);
      max-width: 720px;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #d1d9e6;
      box-sizing: border-box;
      font-size: 14px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
    }

    footer {
      margin-top: 28px;
      font-size: 13px;
      color: #6b7280;
    }

    a {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <header>
    <h1>Modal Dialog â€” Example</h1>
    <p>Click the button to open the modal. The open button uses the class "trigger".</p>
  </header>

  <main id="page-main">
    <section class="card">
      <div class="controls">
        <button type="button" class="trigger">Open Modal</button>
        <button type="button" class="trigger" style="margin-left:8px;">Another Trigger</button>
      </div>

      <p>This is the page content behind the modal. When the modal opens, focus is trapped inside it, pressing Escape closes it, and clicking outside the modal content closes it as well.</p>

      <form style="margin-top:16px" aria-label="Sample form">
        <label for="name">Your name</label>
        <input id="name" type="text" placeholder="Jane Doe" />
        <div style="margin-top:10px;">
          <label for="about">About</label>
          <textarea id="about" rows="3" placeholder="Write something..."></textarea>
        </div>
        <div style="margin-top:12px;">
          <button type="submit" class="btn-primary">Save</button>
          <button type="button" class="btn-muted">Cancel</button>
        </div>
      </form>
    </section>

    <footer>
      <p>Modal example created for accessibility and usability demonstration. Return focus to the trigger on close.</p>
    </footer>
  </main>

  <!-- Modal -->
  <div id="modal-overlay" class="modal-overlay" hidden>
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" aria-hidden="true" tabindex="-1">
      <div class="modal-header">
        <div>
          <h2 id="modal-title">Contact details</h2>
          <p id="modal-desc">Edit your information and press Save. Press Esc or click outside to close.</p>
        </div>
        <div>
          <button class="modal-close" aria-label="Close modal">&times;</button>
        </div>
      </div>

      <div class="modal-body">
        <form id="modal-form">
          <div style="margin-top:12px;">
            <label for="modal-name">Full name</label>
            <input id="modal-name" type="text" value="Jane Doe" />
          </div>

          <div style="margin-top:12px;">
            <label for="modal-email">Email</label>
            <input id="modal-email" type="text" value="jane@example.com" />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-muted modal-cancel">Cancel</button>
        <button type="button" class="btn-primary modal-save">Save changes</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const overlay = document.getElementById('modal-overlay');
      const modal = document.getElementById('modal');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const closeButtons = Array.from(modal.querySelectorAll('.modal-close, .modal-cancel'));
      const saveButton = modal.querySelector('.modal-save');
      const main = document.getElementById('page-main');
      let lastFocused = null;

      function supportsInert() {
        return 'inert' in HTMLElement.prototype;
      }

      function setInert(state) {
        if (supportsInert()) {
          main.inert = state;
        } else {
          // Fallback: mark main as aria-hidden when inert
          if (state) {
            main.setAttribute('aria-hidden', 'true');
          } else {
            main.removeAttribute('aria-hidden');
          }
        }
      }

      function getFocusableElements(container) {
        const selectors = [
          'a[href]:not([tabindex="-1"])',
          'area[href]',
          'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
          'select:not([disabled]):not([tabindex="-1"])',
          'textarea:not([disabled]):not([tabindex="-1"])',
          'button:not([disabled]):not([tabindex="-1"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(','))).filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal(opener) {
        lastFocused = opener || document.activeElement;
        overlay.hidden = false;
        // Force a reflow so the transition can run when we add the open class.
        void overlay.offsetWidth;
        overlay.classList.add('open');
        document.body.classList.add('no-scroll');
        setInert(true);
        modal.setAttribute('aria-hidden', 'false');

        // Focus first focusable element inside modal
        const focusable = getFocusableElements(modal);
        const toFocus = focusable.length ? focusable[0] : modal;
        toFocus.focus();

        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal() {
        overlay.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('no-scroll');
        setInert(false);

        // After transition ends, hide overlay so it's removed from AT tree
        const onTransitionEnd = function() {
          overlay.hidden = true;
          overlay.removeEventListener('transitionend', onTransitionEnd);
        };
        overlay.addEventListener('transitionend', onTransitionEnd);

        document.removeEventListener('keydown', onKeyDown);

        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          handleTab(e);
        }
      }

      function handleTab(e) {
        const focusable = getFocusableElements(modal);
        if (focusable.length === 0) {
          e.preventDefault();
          return;
        }
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (!modal.contains(active)) {
          first.focus();
          e.preventDefault();
        } else if (!e.shiftKey && active === last) {
          first.focus();
          e.preventDefault();
        } else if (e.shiftKey && active === first) {
          last.focus();
          e.preventDefault();
        }
      }

      // Open via triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openModal(e.currentTarget);
        });
      });

      // Close via overlay click (only when clicking the overlay itself)
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeModal();
        }
      });

      // Prevent clicks inside modal from closing
      modal.addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // Close buttons
      closeButtons.forEach(btn => btn.addEventListener('click', (e) => {
        closeModal();
      }));

      // Save button demo behavior
      saveButton.addEventListener('click', () => {
        // For demo purposes, just close and restore focus
        closeModal();
      });

      // Make sure focus is trapped if focus leaves the modal unexpectedly
      // (minimal reinforcement)
      document.addEventListener('focusin', (e) => {
        if (!overlay.hidden && !modal.contains(e.target)) {
          const focusable = getFocusableElements(modal);
          (focusable[0] || modal).focus();
        }
      });

      // Initialize: ensure overlay is hidden and aria states are set
      overlay.hidden = true;
      modal.setAttribute('aria-hidden', 'true');
    })();
  </script>
</body>
</html>