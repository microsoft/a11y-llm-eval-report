<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --bg: #fff;
      --overlay: rgba(18, 24, 30, 0.6);
      --accent: #2563eb;
      --max-width: 520px;
      --radius: 10px;
      --shadow: 0 10px 30px rgba(2,6,23,0.2);
      --gap: 1rem;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 0;
      padding: 2rem;
      background: linear-gradient(180deg,#f7fbff,#eef6ff);
      color: #07214a;
    }

    header {
      margin-bottom: 1.5rem;
    }

    .controls {
      margin-bottom: 2rem;
    }

    .trigger {
      appearance: none;
      border: 0;
      background: linear-gradient(180deg,#3b82f6,#2563eb);
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(37,99,235,0.18);
      cursor: pointer;
    }
    .trigger:focus {
      outline: 3px solid rgba(37,99,235,0.18);
      outline-offset: 3px;
    }

    /* dialog styles */
    dialog.modal {
      width: min(calc(100% - 2rem), var(--max-width));
      border: none;
      padding: 0;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    dialog.modal::backdrop {
      background: var(--overlay);
      backdrop-filter: blur(3px);
    }

    .modal-panel {
      background: var(--bg);
      padding: 1.25rem;
      border-radius: var(--radius);
      display: grid;
      gap: 0.75rem;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--gap);
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.125rem;
    }

    .close {
      background: transparent;
      border: none;
      font-size: 1rem;
      color: #334155;
      padding: 0.35rem;
      border-radius: 6px;
      cursor: pointer;
    }
    .close:focus {
      outline: 3px solid rgba(99,102,241,0.16);
      outline-offset: 3px;
    }

    .modal-body {
      color: #13315f;
      font-size: 0.96rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.25rem;
    }

    .btn-secondary {
      background: #eef2ff;
      border: 1px solid #e0e7ff;
      color: #3730a3;
      padding: 0.45rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn-primary {
      background: var(--accent);
      border: none;
      color: white;
      padding: 0.45rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
    }

    /* visually hide content when modal open for screen readers and pointer events handling */
    [aria-hidden="true"] {
      pointer-events: none;
      user-select: none;
      touch-action: none;
      -webkit-user-select: none;
    }

    /* small screens adjustments */
    @media (max-width: 420px) {
      .modal-panel { padding: 0.9rem; }
      .modal-actions { flex-direction: column-reverse; align-items: stretch; }
      .btn-primary, .btn-secondary { width: 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Modal Dialog Component Example</h1>
    <p>Click the button to open the modal. The opener uses the class "trigger".</p>
  </header>

  <main id="main">
    <section class="controls">
      <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">Open Modal</button>
    </section>

    <section>
      <p>This is background content. When the modal opens it will receive focus and underlying content is hidden to assistive technologies.</p>
      <p>Try tabbing, pressing Escape, or clicking outside the dialog to close it.</p>
    </section>
  </main>

  <dialog id="example-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="modal-panel">
      <div class="modal-header">
        <h2 id="modal-title">Subscribe to updates</h2>
        <button class="close" type="button" aria-label="Close modal" data-close>&times;</button>
      </div>

      <div class="modal-body" id="modal-desc">
        <p>Enter your email to subscribe to product updates and news. We’ll only send things you’ll actually want to read.</p>
        <form id="subscribe-form">
          <label for="email" style="display:block;font-weight:600;margin-bottom:0.25rem;">Email address</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #d1d5db;margin-top:0.25rem;">
        </form>
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" type="button" data-close>Cancel</button>
        <button class="btn-primary" type="submit" form="subscribe-form">Subscribe</button>
      </div>
    </div>
  </dialog>

  <script>
    (function () {
      const dialog = document.getElementById('example-modal');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const main = document.getElementById('main');
      let lastFocused = null;

      // utility: focusable elements selector
      const focusableSelector = [
        'a[href]:not([tabindex^="-"])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      function getFocusable(el) {
        return Array.from(el.querySelectorAll(focusableSelector))
          .filter(node => node.offsetWidth || node.offsetHeight || node.getClientRects().length);
      }

      function openDialog(trigger) {
        if (typeof dialog.showModal === 'function') {
          lastFocused = trigger || document.activeElement;
          dialog.showModal();
          // hide main content from assistive tech
          main.setAttribute('aria-hidden', 'true');
          // focus management
          const focusables = getFocusable(dialog);
          if (focusables.length) {
            focusables[0].focus();
          } else {
            dialog.focus();
          }
        } else {
          // fallback for browsers without <dialog>
          // very simple fallback: set attribute open and role; manage visibility via aria-hidden
          dialog.setAttribute('open', '');
          lastFocused = trigger || document.activeElement;
          main.setAttribute('aria-hidden', 'true');
          const focusables = getFocusable(dialog);
          if (focusables.length) focusables[0].focus();
        }
      }

      function closeDialog() {
        if (typeof dialog.close === 'function' && dialog.open) {
          dialog.close();
        } else {
          dialog.removeAttribute('open');
        }
        main.removeAttribute('aria-hidden');
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      // attach triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openDialog(btn);
        });
      });

      // close buttons inside dialog (data-close)
      dialog.addEventListener('click', (e) => {
        const closeBtn = e.target.closest('[data-close]');
        if (closeBtn) {
          e.preventDefault();
          closeDialog();
        }
      });

      // close when clicking backdrop (for native <dialog>, clicking the backdrop yields target === dialog)
      dialog.addEventListener('click', (e) => {
        if (e.target === dialog) {
          // clicked on backdrop
          closeDialog();
        }
      });

      // handle escape & focus trap
      dialog.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeDialog();
        } else if (e.key === 'Tab') {
          // focus trap
          const focusables = getFocusable(dialog);
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      });

      // ensure that when the dialog is closed (native close or via .close()) we restore state
      if (typeof dialog.addEventListener === 'function') {
        dialog.addEventListener('close', () => {
          // native dialog fires 'close' event
          main.removeAttribute('aria-hidden');
          if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
        });
      }

      // prevent accidental form submission from reloading the page in example
      const form = document.getElementById('subscribe-form');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Thanks! Subscribed: ' + (form.email.value || '[no email]'));
        closeDialog();
      });

      // allow opening via keyboard Enter/Space on trigger elements if they aren't buttons (graceful)
      triggers.forEach(el => {
        if (el.getAttribute('role') && el.getAttribute('role') !== 'button') return;
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openDialog(el);
          }
        });
      });

      // if the dialog is closed by other means, ensure main is visible
      window.addEventListener('focus', () => {
        // safety: if dialog not open ensure main not hidden
        if (!(dialog.open || dialog.hasAttribute('open'))) {
          main.removeAttribute('aria-hidden');
        }
      });
    })();
  </script>
</body>
</html>