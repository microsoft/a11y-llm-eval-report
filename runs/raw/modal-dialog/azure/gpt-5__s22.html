<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modal Dialog Example</title>
  <style>
    :root { --backdrop: rgba(0,0,0,0.5); --modal-bg: #fff; --radius: 12px; --shadow: 0 10px 30px rgba(0,0,0,0.2); --max-width: 520px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height: 1.5; margin: 0; min-height: 100vh; display: grid; place-items: center; background: #f6f7fb; }
    .trigger { padding: 0.75rem 1rem; border-radius: 8px; border: none; background: #2f6fed; color: white; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(47,111,237,0.3); }
    .trigger:focus-visible { outline: 3px solid #99b7ff; outline-offset: 2px; }
    .modal-backdrop { position: fixed; inset: 0; background: var(--backdrop); opacity: 0; transition: opacity 150ms ease; pointer-events: none; }
    .modal-backdrop.open { opacity: 1; pointer-events: auto; }
    .modal { position: fixed; inset: 0; display: grid; place-items: center; pointer-events: none; }
    .modal .dialog { background: var(--modal-bg); border-radius: var(--radius); box-shadow: var(--shadow); width: min(90vw, var(--max-width)); max-height: 90vh; display: grid; grid-template-rows: auto 1fr auto; overflow: hidden; transform: translateY(20px) scale(0.98); opacity: 0; transition: transform 180ms ease, opacity 180ms ease; pointer-events: auto; }
    .modal.open .dialog { transform: translateY(0) scale(1); opacity: 1; }
    .dialog header { padding: 1rem 1.25rem; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
    .dialog header h2 { font-size: 1.25rem; margin: 0; }
    .dialog .close-btn { border: none; background: transparent; font-size: 1rem; padding: 0.5rem; cursor: pointer; border-radius: 6px; }
    .dialog .close-btn:focus-visible { outline: 3px solid #99b7ff; outline-offset: 2px; }
    .dialog main { padding: 1rem 1.25rem; overflow: auto; }
    .dialog footer { padding: 0.75rem 1.25rem; border-top: 1px solid #eee; display: flex; gap: 0.5rem; justify-content: flex-end; }
    .btn { padding: 0.5rem 0.9rem; border-radius: 8px; border: 1px solid #d0d7ff; background: #eff3ff; color: #1f3dd9; font-weight: 600; cursor: pointer; }
    .btn.primary { background: #2f6fed; color: white; border-color: #2f6fed; }
    [hidden] { display: none !important; }
    body.modal-open { overflow: hidden; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <button class="trigger" aria-haspopup="dialog" aria-controls="example-modal">Open Modal</button>

  <div class="modal-backdrop" id="backdrop" hidden></div>

  <div class="modal" id="example-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" hidden>
    <div class="dialog">
      <header>
        <h2 id="modal-title">Confirm Action</h2>
        <button class="close-btn" type="button" aria-label="Close dialog" data-close>&times;</button>
      </header>
      <main>
        <p id="modal-desc">Are you sure you want to proceed? This action cannot be undone.</p>
        <p>Modal content can include forms, text, and interactive elements. Focus is trapped within the dialog while it is open.</p>
      </main>
      <footer>
        <button class="btn" type="button" data-close>Cancel</button>
        <button class="btn primary" type="button">Confirm</button>
      </footer>
    </div>
  </div>

  <script>
    (function() {
      const trigger = document.querySelector('.trigger');
      const modal = document.getElementById('example-modal');
      const backdrop = document.getElementById('backdrop');
      const closeButtons = modal.querySelectorAll('[data-close]');
      let lastFocusedElement = null;

      const focusableSelectors = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex="-1"])'
      ];
      const getFocusable = () => Array.from(modal.querySelectorAll(focusableSelectors.join(','))).filter(el => el.offsetParent !== null);

      function openModal() {
        if (!modal.hasAttribute('hidden')) return;
        lastFocusedElement = document.activeElement;
        modal.removeAttribute('hidden');
        backdrop.removeAttribute('hidden');
        modal.classList.add('open');
        backdrop.classList.add('open');
        document.body.classList.add('modal-open');
        trigger.setAttribute('aria-expanded', 'true');

        const focusables = getFocusable();
        const target = focusables[0] || modal.querySelector('.dialog') || modal;
        target.focus({ preventScroll: true });

        setSiblingsAriaHidden(true);
        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('focusin', trapFocus, true);
      }

      function closeModal() {
        if (modal.hasAttribute('hidden')) return;
        modal.setAttribute('hidden', '');
        backdrop.setAttribute('hidden', '');
        modal.classList.remove('open');
        backdrop.classList.remove('open');
        document.body.classList.remove('modal-open');
        trigger.setAttribute('aria-expanded', 'false');

        setSiblingsAriaHidden(false);
        document.removeEventListener('keydown', onKeyDown);
        document.removeEventListener('focusin', trapFocus, true);

        if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          lastFocusedElement.focus({ preventScroll: true });
        } else {
          trigger.focus({ preventScroll: true });
        }
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.stopPropagation();
          closeModal();
        } else if (e.key === 'Tab') {
          const focusables = getFocusable();
          if (focusables.length === 0) {
            e.preventDefault();
            modal.querySelector('.dialog').focus();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          const isShift = e.shiftKey;

          if (isShift && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!isShift && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }

      function trapFocus(e) {
        if (modal.hasAttribute('hidden')) return;
        if (!modal.contains(e.target)) {
          const focusables = getFocusable();
          (focusables[0] || modal.querySelector('.dialog')).focus();
          e.stopPropagation();
        }
      }

      function onBackdropClick(e) {
        if (e.target === backdrop) {
          closeModal();
        }
      }

      function onDialogClick(e) {
        if (e.target === modal) {
          closeModal();
        }
      }

      function setSiblingsAriaHidden(hidden) {
        const children = Array.from(document.body.children);
        children.forEach(node => {
          if (node === modal || node === backdrop) return;
          if (hidden) node.setAttribute('aria-hidden', 'true');
          else node.removeAttribute('aria-hidden');
        });
      }

      trigger.addEventListener('click', openModal);
      backdrop.addEventListener('click', onBackdropClick);
      modal.addEventListener('click', onDialogClick);
      closeButtons.forEach(btn => btn.addEventListener('click', closeModal));

      modal.querySelector('.dialog').setAttribute('tabindex', '-1');

      const confirmBtn = modal.querySelector('.btn.primary');
      confirmBtn.addEventListener('click', () => {
        closeModal();
      });
    })();
  </script>
</body>
</html>