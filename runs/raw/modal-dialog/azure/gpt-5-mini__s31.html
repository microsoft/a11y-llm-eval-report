<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(11, 22, 39, 0.6);
      --modal-bg: #fff;
      --accent: #0b74de;
      --max-width: 640px;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      padding: 2rem;
      line-height: 1.4;
      color: #07203a;
      background: linear-gradient(180deg, #f8fbff 0%, #eef6ff 100%);
      min-height: 100vh;
    }

    /* Prevent background scroll when modal open */
    .no-scroll {
      overflow: hidden;
    }

    .trigger {
      appearance: none;
      border: none;
      background: linear-gradient(180deg, var(--accent), #0567c9);
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(6, 30, 60, 0.12);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .trigger:active { transform: translateY(1px); }
    .trigger:focus { outline: 3px solid rgba(11, 116, 222, 0.18); }

    /* Overlay and modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      z-index: 1000;
      -webkit-tap-highlight-color: transparent;
    }

    .modal-overlay.is-open {
      display: flex;
    }

    .overlay-backdrop {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      backdrop-filter: blur(4px);
      opacity: 0;
      transition: opacity 200ms ease;
    }
    .modal-overlay.is-open .overlay-backdrop {
      opacity: 1;
    }

    .modal {
      position: relative;
      z-index: 1;
      width: calc(100% - 2rem);
      max-width: var(--max-width);
      background: var(--modal-bg);
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(6, 30, 60, 0.2);
      transform: translateY(10px) scale(0.98);
      opacity: 0;
      transition: opacity 220ms ease, transform 220ms ease;
      max-height: calc(100vh - 4rem);
      overflow: auto;
    }
    .modal-overlay.is-open .modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal-header {
      padding: 1.25rem 1.25rem 0.75rem 1.25rem;
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 1rem;
    }
    .modal-title {
      margin: 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: #03263d;
    }
    .close {
      appearance: none;
      border: none;
      background: transparent;
      padding: 0.25rem;
      border-radius: 6px;
      cursor: pointer;
      color: #506a7a;
    }
    .close:focus { outline: 3px solid rgba(11, 116, 222, 0.18); }

    .modal-body {
      padding: 0.75rem 1.25rem 1.25rem 1.25rem;
      color: #234157;
      font-size: 0.98rem;
    }

    .modal-actions {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem 1.25rem 1.25rem;
      justify-content: flex-end;
      border-top: 1px solid #eef5fb;
      background: linear-gradient(180deg, rgba(255,255,255,0), rgba(250,250,252,1));
      border-radius: 0 0 12px 12px;
    }

    .btn-secondary {
      background: #f1f5f9;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      color: #0b4868;
    }

    .btn-primary {
      background: linear-gradient(180deg, #0b74de, #0567c9);
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Small responsive tweaks */
    @media (max-width: 480px) {
      .modal {
        border-radius: 10px;
        width: calc(100% - 1rem);
        margin: 0 0.5rem;
      }
    }
  </style>
</head>
<body>
  <h1>Modal Dialog Example</h1>
  <p>This page demonstrates an accessible modal dialog. The modal is closed by default. Click the button below to open it.</p>

  <button type="button" class="trigger" id="openModal">Open modal</button>

  <!-- Modal structure -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="overlay-backdrop" data-overlay></div>

    <div
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
      aria-describedby="modalDesc"
      tabindex="-1"
      id="modal"
    >
      <header class="modal-header">
        <h2 id="modalTitle" class="modal-title">Subscribe to updates</h2>
        <button type="button" class="close" id="closeModal" aria-label="Close dialog">
          <!-- simple X icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </header>

      <div class="modal-body" id="modalDesc">
        <p>Enter your email below to receive occasional updates about our product and releases. You can close this dialog with the Escape key, by clicking outside, or by using the Close button.</p>

        <form id="subscribeForm">
          <label for="email" style="display:block; margin-top:0.5rem; margin-bottom:0.25rem; font-weight:600; color:#0b4868;">Email address</label>
          <input id="email" name="email" type="email" required placeholder="you@example.com" style="width:100%; padding:0.5rem; border-radius:6px; border:1px solid #dceaf7;">
          <div style="margin-top:0.75rem;">
            <label style="display:inline-flex; gap:0.5rem; align-items:center; color:#275166;">
              <input type="checkbox" name="agree" required>
              <span>Yes, I'll accept occasional emails</span>
            </label>
          </div>
        </form>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
        <button type="submit" form="subscribeForm" class="btn-primary" id="submitBtn">Subscribe</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const overlay = document.getElementById('modalOverlay');
      const modal = document.getElementById('modal');
      const closeButton = document.getElementById('closeModal');
      const cancelBtn = document.getElementById('cancelBtn');
      const overlayBackdrop = document.querySelector('[data-overlay]');
      let lastFocused = null;

      function isOpen() {
        return overlay.classList.contains('is-open');
      }

      function openModal(triggerEl) {
        if (isOpen()) return;
        lastFocused = triggerEl || document.activeElement;
        overlay.classList.add('is-open');
        overlay.setAttribute('aria-hidden', 'false');
        document.body.classList.add('no-scroll');

        // Focus first focusable element inside modal or modal itself
        const focusable = getFocusableElements(modal);
        (focusable.length ? focusable[0] : modal).focus();

        document.addEventListener('keydown', onKeyDown, true);
      }

      function closeModal() {
        if (!isOpen()) return;
        overlay.classList.remove('is-open');
        overlay.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('no-scroll');

        // restore focus
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }

        document.removeEventListener('keydown', onKeyDown, true);
      }

      function onKeyDown(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          trapTabKey(e);
        }
      }

      function getFocusableElements(container) {
        const selectors = [
          'a[href]:not([tabindex^="-"]):not([disabled])',
          'area[href]:not([tabindex^="-"]):not([disabled])',
          'input:not([type="hidden"]):not([disabled]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex^="-"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(','))).filter(el => {
          // check for visible
          return el.offsetWidth > 0 || el.offsetHeight > 0 || el.getClientRects().length;
        });
      }

      function trapTabKey(e) {
        const focusable = getFocusableElements(modal);
        if (focusable.length === 0) {
          e.preventDefault();
          modal.focus();
          return;
        }
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (e.shiftKey) {
          if (active === first || active === modal) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (active === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }

      // Attach event listeners
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          openModal(ev.currentTarget);
        });
      });

      closeButton.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);

      // click on backdrop closes modal (but clicks inside modal do not)
      overlayBackdrop.addEventListener('click', closeModal);

      // click on overlay but outside modal should close (in case backdrop doesn't capture)
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeModal();
        }
      });

      // optional: handle form submission for demo
      const form = document.getElementById('subscribeForm');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        // simulate submit
        alert('Thank you! (demo only)');
        closeModal();
      });

      // Ensure that if the user opens the modal via keyboard (Enter/Space) the trigger is the lastFocused.
      // Also support focusing modal by clicking inside.
    })();
  </script>
</body>
</html>