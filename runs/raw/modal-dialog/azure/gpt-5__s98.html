<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Modal Dialog Example</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --overlay-bg: rgba(0, 0, 0, 0.6);
      --dialog-bg: #fff;
      --dialog-radius: 12px;
      --dialog-shadow: 0 20px 50px rgba(0,0,0,0.3);
      --accent: #3b82f6;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: #111;
      background: #f6f7fb;
      line-height: 1.5;
    }
    main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 3rem 1rem 5rem;
    }
    h1 {
      font-size: clamp(1.5rem, 3vw, 2rem);
      margin: 0 0 1rem;
    }
    p { margin: 0 0 1rem; }
    .trigger {
      appearance: none;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.1rem;
      font-weight: 600;
      background: var(--accent);
      color: #fff;
      box-shadow: 0 8px 20px rgba(59,130,246,0.25);
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
    }
    .trigger:hover { filter: brightness(1.05); }
    .trigger:active { transform: translateY(1px); box-shadow: 0 6px 16px rgba(59,130,246,0.25); }
    .trigger:focus-visible { outline: 3px solid rgba(59,130,246,0.5); outline-offset: 2px; }

    /* Modal root (overlay container) */
    .modal-root[hidden] { display: none !important; }
    .modal-root {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 2rem;
      background: var(--overlay-bg);
      z-index: 1000;
      backdrop-filter: saturate(140%) blur(2px);
    }

    /* Dialog */
    .modal-dialog {
      position: relative;
      width: min(640px, 100%);
      max-height: calc(100vh - 4rem);
      overflow: auto;
      background: var(--dialog-bg);
      border-radius: var(--dialog-radius);
      box-shadow: var(--dialog-shadow);
      transform: translateY(10px) scale(0.98);
      opacity: 0;
      animation: modal-in 170ms ease-out forwards;
    }
    @keyframes modal-in {
      from { transform: translateY(10px) scale(0.98); opacity: 0; }
      to   { transform: translateY(0) scale(1); opacity: 1; }
    }
    .modal-header {
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 1rem;
      padding: 1rem 1rem 0.75rem;
      border-bottom: 1px solid #eee;
    }
    .modal-title {
      margin: 0;
      font-size: 1.25rem;
    }
    .modal-close {
      appearance: none;
      border: none;
      background: transparent;
      color: #444;
      border-radius: 6px;
      padding: 0.35rem;
      cursor: pointer;
    }
    .modal-close:hover { background: #f2f3f7; }
    .modal-close:focus-visible { outline: 3px solid rgba(59,130,246,0.4); outline-offset: 2px; }
    .modal-body {
      padding: 1rem;
    }
    .modal-footer {
      display: flex;
      justify-content: end;
      gap: 0.5rem;
      padding: 0.75rem 1rem 1rem;
      border-top: 1px solid #eee;
    }
    .btn {
      appearance: none;
      border-radius: 8px;
      border: 1px solid transparent;
      padding: 0.6rem 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: filter 120ms ease, transform 120ms ease, box-shadow 120ms ease;
    }
    .btn:hover { filter: brightness(1.03); }
    .btn:active { transform: translateY(1px); }
    .btn:focus-visible { outline: 3px solid rgba(59,130,246,0.4); outline-offset: 2px; }
    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 10px 20px rgba(59,130,246,0.25);
    }
    .btn-secondary {
      background: #f5f5f7;
      border-color: #e5e7eb;
      color: #111;
    }

    /* Optional: prevent overscroll beneath */
    body.modal-open {
      overflow: hidden;
      touch-action: none;
    }
  </style>
</head>
<body>
  <main id="content">
    <h1>Modal Dialog Component</h1>
    <p>This example demonstrates an accessible modal dialog that is closed by default. Use the button below to open it.</p>
    <button class="trigger" aria-haspopup="dialog" aria-controls="example-modal-root" aria-expanded="false">
      Open Modal
    </button>

    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris facilisis, ante ac gravida dapibus, neque nibh efficitur tortor, sit amet mattis erat nibh quis ante. Integer in iaculis odio. Donec elementum volutpat arcu, a iaculis libero pulvinar ac.</p>
    <p>More content here to demonstrate page scroll and focus behavior when the modal is open.</p>
  </main>

  <!-- Modal -->
  <div class="modal-root" id="example-modal-root" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="example-modal-title" aria-describedby="example-modal-desc" tabindex="-1">
      <div class="modal-header">
        <h2 class="modal-title" id="example-modal-title">Example Modal</h2>
        <button class="modal-close" type="button" data-close aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" id="example-modal-desc">
        <p>This is a modal dialog. It traps focus while open, supports closing with Escape, clicking the backdrop, or pressing the close button.</p>
        <p>Try tabbing around to see focus management. Press Escape to dismiss.</p>
        <label for="name-input">Your name</label>
        <input id="name-input" name="name" type="text" placeholder="Jane Doe" style="display:block;width:100%;margin-top:0.35rem;margin-bottom:0.85rem;padding:0.6rem;border:1px solid #ddd;border-radius:8px;">
        <label for="feedback-input">Feedback</label>
        <textarea id="feedback-input" name="feedback" rows="4" placeholder="Write something..." style="display:block;width:100%;margin-top:0.35rem;margin-bottom:0.85rem;padding:0.6rem;border:1px solid #ddd;border-radius:8px;"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-close>Cancel</button>
        <button class="btn btn-primary" type="button">Submit</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const focusableSelector = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      let activeModal = null;
      let lastFocused = null;
      let keydownHandler = null;
      let clickHandler = null;

      function getFocusable(container) {
        const nodes = Array.from(container.querySelectorAll(focusableSelector))
          .filter(el => el.offsetParent !== null || el === container);
        return nodes;
      }

      function openModal(modalRoot, trigger) {
        if (!modalRoot || activeModal) return;
        const dialog = modalRoot.querySelector('.modal-dialog');
        if (!dialog) return;

        lastFocused = trigger || document.activeElement;
        activeModal = modalRoot;
        modalRoot.hidden = false;
        document.body.classList.add('modal-open');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');

        // Focus management
        const focusables = getFocusable(dialog);
        if (focusables.length > 0) {
          // Prefer first focusable inside body (skip close button)
          const firstContentFocusable = focusables.find(el => !el.matches('.modal-close'));
          (firstContentFocusable || focusables[0]).focus();
        } else {
          dialog.focus();
        }

        // Trap focus and close interactions
        keydownHandler = function (e) {
          if (!activeModal) return;
          if (e.key === 'Escape') {
            e.preventDefault();
            closeModal();
            return;
          }
          if (e.key === 'Tab') {
            const f = getFocusable(dialog);
            if (f.length === 0) {
              e.preventDefault();
              dialog.focus();
              return;
            }
            const first = f[0];
            const last = f[f.length - 1];
            if (e.shiftKey && document.activeElement === first) {
              e.preventDefault();
              last.focus();
            } else if (!e.shiftKey && document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        };
        document.addEventListener('keydown', keydownHandler);

        clickHandler = function (e) {
          if (!activeModal) return;
          const path = e.composedPath ? e.composedPath() : null;
          const clickedInsideDialog = path ? path.includes(dialog) : dialog.contains(e.target);
          if (!clickedInsideDialog) {
            // Clicked on backdrop
            closeModal();
          }
        };
        modalRoot.addEventListener('mousedown', clickHandler);

        modalRoot.querySelectorAll('[data-close]').forEach(btn => {
          btn.addEventListener('click', closeModal);
        });
      }

      function closeModal() {
        if (!activeModal) return;
        const modalRoot = activeModal;
        const dialog = modalRoot.querySelector('.modal-dialog');
        const triggerId = Array.from(document.querySelectorAll('.trigger'))
          .find(btn => (btn.getAttribute('aria-controls') || '') === modalRoot.id);
        const trigger = triggerId || lastFocused;

        // Clean up listeners
        document.removeEventListener('keydown', keydownHandler);
        modalRoot.removeEventListener('mousedown', clickHandler);
        modalRoot.querySelectorAll('[data-close]').forEach(btn => {
          btn.removeEventListener('click', closeModal);
        });

        modalRoot.hidden = true;
        document.body.classList.remove('modal-open');

        if (trigger && typeof trigger.focus === 'function') {
          try { trigger.focus(); } catch {}
        }
        if (trigger && trigger.classList && trigger.classList.contains('trigger')) {
          trigger.setAttribute('aria-expanded', 'false');
        }

        activeModal = null;
        keydownHandler = null;
        clickHandler = null;
      }

      // Wire triggers
      const triggers = document.querySelectorAll('.trigger');
      triggers.forEach(btn => {
        const targetId = btn.getAttribute('aria-controls') || btn.dataset.target || 'example-modal-root';
        const modalRoot = document.getElementById(targetId);
        btn.addEventListener('click', () => openModal(modalRoot, btn));
      });

      // Optional: close on hash change or navigation
      window.addEventListener('popstate', closeModal);
      window.addEventListener('blur', () => {
        // Do not auto-close; just an example hook if desired
      });
    })();
  </script>
</body>
</html>