<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --modal-width: 520px;
      --radius: 8px;
      --transition: 200ms ease;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    main{
      padding:48px;
      max-width:900px;
      margin:0 auto;
    }
    button{
      font:inherit;
      padding:10px 14px;
      border-radius:6px;
      border:1px solid #2b6cb0;
      background:#3182ce;
      color:white;
      cursor:pointer;
    }
    /* Modal overlay and panel */
    .modal-overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:transparent;
      pointer-events:none;
      opacity:0;
      transition:opacity var(--transition);
      z-index:1000;
    }
    .modal-overlay[data-open="true"]{
      background:var(--overlay-bg);
      opacity:1;
      pointer-events:auto;
    }
    .modal{
      width:clamp(300px, 90%, var(--modal-width));
      max-height:90vh;
      background:var(--modal-bg);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(2,6,23,0.35);
      transform:translateY(10px) scale(.98);
      transition:transform var(--transition), opacity var(--transition);
      opacity:0;
      overflow:auto;
      pointer-events:auto;
    }
    .modal-overlay[data-open="true"] .modal{
      transform:translateY(0) scale(1);
      opacity:1;
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:16px 18px;
      border-bottom:1px solid #eef2f7;
    }
    .modal h2{
      margin:0;
      font-size:1.125rem;
    }
    .modal-body{
      padding:18px;
      color:#0f172a;
      font-size:0.98rem;
      line-height:1.45;
    }
    .modal-footer{
      padding:12px 18px 18px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
      border-top:1px solid #f1f5f9;
    }
    .close-btn{
      background:transparent;
      border:0;
      color:#475569;
      font-size:16px;
      padding:6px;
      border-radius:6px;
      cursor:pointer;
    }
    .close-btn:hover{ background:#f1f5f9; }
    .no-scroll{
      overflow:hidden;
    }
    /* Lightweight focus ring for accessibility */
    :focus{
      outline:3px solid #bde4ff;
      outline-offset:2px;
    }
    /* Hide visually but keep for screen readers */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0 0 0 0);
      white-space:nowrap;
      border:0;
    }
  </style>
</head>
<body>
  <main id="page-main">
    <h1>Example Page</h1>
    <p>This page demonstrates a modal dialog component. The modal is closed by default. Click the button below to open it.</p>

    <!-- Trigger button (must have class "trigger") -->
    <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">Open modal</button>

    <p>More page content to show the background behavior while the modal is open. You can tab around here when the modal is closed.</p>
  </main>

  <!-- Modal overlay and dialog (closed by default) -->
  <div class="modal-overlay" id="modal-overlay" aria-hidden="true" role="presentation">
    <div
      class="modal"
      id="example-modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modal-title"
      aria-describedby="modal-desc"
      tabindex="-1"
    >
      <div class="modal-header">
        <h2 id="modal-title">Example Modal</h2>
        <button class="close-btn" type="button" aria-label="Close modal" data-action="close">&times;</button>
      </div>
      <div class="modal-body">
        <p id="modal-desc">This is an example modal dialog. It traps focus while open, closes with the ESC key,
          clicking the close button, or clicking the overlay outside the panel.</p>
        <form>
          <label for="name">Name</label><br />
          <input id="name" name="name" type="text" placeholder="Your name" /><br /><br />
          <label for="email">Email</label><br />
          <input id="email" name="email" type="email" placeholder="you@example.com" />
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="cancel-btn" data-action="close">Cancel</button>
        <button type="button" id="save-btn">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const overlay = document.getElementById('modal-overlay');
      const modal = document.getElementById('example-modal');
      const pageMain = document.getElementById('page-main');
      const closeElements = Array.from(modal.querySelectorAll('[data-action="close"]'));
      const focusableSelectors = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');
      let previouslyFocused = null;

      function getFocusableElements(container) {
        return Array.from(container.querySelectorAll(focusableSelectors)).filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal() {
        previouslyFocused = document.activeElement;
        // Mark overlay and modal as open
        overlay.setAttribute('data-open', 'true');
        overlay.setAttribute('aria-hidden', 'false');
        document.body.classList.add('no-scroll');

        // Hide main content from assistive tech while modal is open
        pageMain.setAttribute('aria-hidden', 'true');

        // Focus the first focusable element inside the modal
        const focusables = getFocusableElements(modal);
        const first = focusables.length ? focusables[0] : modal;
        first.focus();

        // Add event listeners
        document.addEventListener('keydown', onKeyDown, true);
        document.addEventListener('focus', enforceFocus, true);
      }

      function closeModal() {
        overlay.removeAttribute('data-open');
        overlay.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('no-scroll');
        pageMain.removeAttribute('aria-hidden');

        // restore focus
        if (previouslyFocused && typeof previouslyFocused.focus === 'function') {
          previouslyFocused.focus();
        }

        // Remove listeners
        document.removeEventListener('keydown', onKeyDown, true);
        document.removeEventListener('focus', enforceFocus, true);
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trap
          const focusables = getFocusableElements(modal);
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === modal) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      function enforceFocus(e) {
        if (!modal.contains(e.target) && overlay.getAttribute('data-open') === 'true') {
          e.stopPropagation();
          const focusables = getFocusableElements(modal);
          (focusables.length ? focusables[0] : modal).focus();
        }
      }

      // Open triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          openModal();
        });
      });

      // Close buttons
      closeElements.forEach(el => {
        el.addEventListener('click', (ev) => {
          ev.preventDefault();
          closeModal();
        });
      });

      // Clicking the overlay outside the panel closes modal
      overlay.addEventListener('click', (ev) => {
        if (ev.target === overlay) {
          closeModal();
        }
      });

      // Ensure modal is closed by default (no data-open)
      overlay.removeAttribute('data-open');
      overlay.setAttribute('aria-hidden', 'true');
      // Ensure modal cannot be tabbed to when closed
      modal.setAttribute('tabindex', '-1');

      // Optional: handle Save button to demonstrate actions
      document.getElementById('save-btn').addEventListener('click', function () {
        // Do something (demo), then close
        closeModal();
        // For demonstration, briefly alert user
        setTimeout(() => alert('Saved (demo)'), 10);
      });
    })();
  </script>
</body>
</html>