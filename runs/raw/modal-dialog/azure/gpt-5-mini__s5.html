<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --bg: #fff;
      --overlay: rgba(0,0,0,0.5);
      --modal-bg: #fff;
      --accent: #0066cc;
      --radius: 8px;
      --max-width: 640px;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f5f7fb,#eef4ff 60%);
      color:#111;
    }

    .page{
      padding:48px 20px;
      max-width:1000px;
      margin:0 auto;
    }

    header h1{
      margin:0 0 12px 0;
      font-size:1.6rem;
    }

    p.lead{ color:#334; margin-top:8px; }

    .trigger{
      display:inline-block;
      padding:10px 16px;
      background:var(--accent);
      color:white;
      border-radius:6px;
      border:0;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(3,102,214,0.15);
    }

    /* Modal base */
    .modal{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none; /* when hidden */
      z-index:1000;
    }

    .modal[data-open="true"]{
      pointer-events:auto;
    }

    .modal__overlay{
      position:absolute;
      inset:0;
      background:var(--overlay);
      backdrop-filter: blur(4px);
      opacity:0;
      transition:opacity .22s ease;
    }

    .modal[data-open="true"] .modal__overlay{
      opacity:1;
    }

    .modal__dialog{
      position:relative;
      width:calc(100% - 40px);
      max-width:var(--max-width);
      background:var(--modal-bg);
      border-radius:var(--radius);
      box-shadow:0 14px 40px rgba(18,28,45,0.18);
      transform:translateY(16px) scale(.99);
      opacity:0;
      transition:transform .26s cubic-bezier(.2,.9,.2,1),opacity .26s ease;
      z-index:2;
      pointer-events:auto;
      padding:20px;
    }

    .modal[data-open="true"] .modal__dialog{
      transform:translateY(0) scale(1);
      opacity:1;
    }

    .modal__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:8px;
    }

    .modal__title{
      margin:0;
      font-size:1.125rem;
    }

    .modal__close{
      background:transparent;
      border:0;
      font-size:1rem;
      padding:8px;
      cursor:pointer;
      color:#333;
      border-radius:6px;
    }

    .modal__close:focus{
      outline:2px solid rgba(0,102,204,0.18);
      box-shadow:0 0 0 4px rgba(0,102,204,0.06);
    }

    .modal__body{
      font-size:0.95rem;
      color:#222;
      line-height:1.4;
      margin-top:6px;
    }

    .modal__actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      margin-top:18px;
    }

    .btn{
      padding:10px 14px;
      border-radius:6px;
      border:0;
      cursor:pointer;
      font-weight:600;
    }

    .btn.secondary{
      background:#f1f5f9;
      color:#111;
    }

    .btn.primary{
      background:var(--accent);
      color:white;
    }

    /* Prevent body scroll while modal open */
    body.modal-open{
      overflow:hidden;
    }

    /* Small screens tweak */
    @media (max-width:480px){
      .modal__dialog{
        padding:16px;
        border-radius:10px;
      }
    }

    /* Utility focus styles for demo links/buttons */
    a, button {
      transition: box-shadow .12s ease;
    }

    a:focus, button:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(0,102,204,0.08);
      border-radius:6px;
    }

  </style>
</head>
<body>
  <div class="page" id="page">
    <header>
      <h1>Example Modal Dialog</h1>
      <p class="lead">This page includes a modal dialog component. The button below opens the modal. The open trigger has class "trigger".</p>
    </header>

    <main>
      <p>
        <button class="trigger" id="openModalBtn">Open modal</button>
      </p>

      <section aria-labelledby="contentHeading">
        <h2 id="contentHeading">Background content</h2>
        <p>
          This content remains accessible but is hidden from assistive technologies while the dialog is open.
          The modal traps focus and can be dismissed with the Escape key, the close button, or by clicking the overlay.
        </p>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modalTitle" data-open="false">
    <div class="modal__overlay" data-overlay></div>

    <div class="modal__dialog" role="document">
      <div class="modal__header">
        <h3 id="modalTitle" class="modal__title">Example modal</h3>
        <button class="modal__close" aria-label="Close dialog" data-close>&#10005;</button>
      </div>

      <div class="modal__body">
        <p>
          This is a demo modal. It demonstrates accessible behaviors: focus is moved into the dialog,
          focus is trapped, and the previously focused element is restored when the dialog closes.
        </p>

        <div class="modal__actions">
          <button class="btn secondary" data-close>Cancel</button>
          <button class="btn primary">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const page = document.getElementById('page');
      const modal = document.getElementById('modal');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const overlay = modal.querySelector('[data-overlay]');
      const closeButtons = Array.from(modal.querySelectorAll('[data-close]'));
      let lastFocused = null;
      let focusableElements = [];
      let firstFocusable = null;
      let lastFocusable = null;

      function updateFocusable(){
        const FOCUSABLE_SELECTORS = [
          'a[href]',
          'area[href]',
          'input:not([disabled]):not([type="hidden"])',
          'select:not([disabled])',
          'textarea:not([disabled])',
          'button:not([disabled])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex^="-"])'
        ].join(',');

        focusableElements = Array.from(modal.querySelectorAll(FOCUSABLE_SELECTORS)).filter(el => el.offsetParent !== null);
        firstFocusable = focusableElements[0] || null;
        lastFocusable = focusableElements[focusableElements.length - 1] || null;
      }

      function openModal(triggerEl){
        if (modal.getAttribute('data-open') === 'true') return;
        lastFocused = triggerEl || document.activeElement;
        modal.setAttribute('data-open','true');
        modal.setAttribute('aria-hidden','false');
        page.setAttribute('aria-hidden','true');
        document.body.classList.add('modal-open');

        updateFocusable();

        // focus the first focusable element inside the dialog, or the dialog itself
        (firstFocusable || modal.querySelector('.modal__dialog') || modal).focus?.();
        // add listeners
        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal(){
        if (modal.getAttribute('data-open') !== 'true') return;
        modal.setAttribute('data-open','false');
        modal.setAttribute('aria-hidden','true');
        page.removeAttribute('aria-hidden');
        document.body.classList.remove('modal-open');

        document.removeEventListener('keydown', onKeyDown);

        // restore focus
        try {
          (lastFocused && lastFocused.focus && lastFocused.focus());
        } catch(e){}
      }

      function onKeyDown(e){
        if (e.key === 'Escape' || e.key === 'Esc'){
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab'){
          updateFocusable();
          if (focusableElements.length === 0){
            // no focusable element: prevent leaving modal
            e.preventDefault();
            return;
          }
          // focus trap
          if (e.shiftKey){
            if (document.activeElement === firstFocusable || document.activeElement === modal){
              e.preventDefault();
              lastFocusable.focus();
            }
          } else {
            if (document.activeElement === lastFocusable){
              e.preventDefault();
              firstFocusable.focus();
            }
          }
        }
      }

      // Open triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openModal(e.currentTarget);
        });
      });

      // Close controls
      closeButtons.forEach(btn => {
        btn.addEventListener('click', closeModal);
      });

      // Overlay click closes (only if clicked outside dialog)
      overlay.addEventListener('click', (e) => {
        closeModal();
      });

      // Make modal container focusable for fallback
      modal.querySelector('.modal__dialog').setAttribute('tabindex','-1');

      // Close if focus somehow leaves and modal is open (extra safety)
      document.addEventListener('focusin', (e) => {
        if (modal.getAttribute('data-open') !== 'true') return;
        if (!modal.contains(e.target)){
          // focus moved outside; bring it back
          e.preventDefault();
          updateFocusable();
          (firstFocusable || modal.querySelector('.modal__dialog')).focus();
        }
      });

      // Allow opening the modal via Enter/Space when focused on trigger(s)
      triggers.forEach(btn => {
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            openModal(e.currentTarget);
          }
        });
      });

      // Expose for debug in dev tools (optional)
      window.__demoModal = { open: openModal, close: closeModal };
    })();
  </script>
</body>
</html>