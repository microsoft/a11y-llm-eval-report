<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Dialog Example - Components - Accessibility Demo</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #222;
            background-color: #f9f9f9;
            margin: 0;
            padding: 2rem;
            min-height: 100vh;
        }

        .sr-only:not(:focus):not(:active) {
            clip: rect(0 0 0 0);
            clip-path: inset(50%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        header {
            border-bottom: 1px solid #ccc;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        main {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            margin-top: 0;
            font-size: 2.5rem;
        }

        h2 {
            margin-top: 2rem;
        }

        p {
            max-width: 65ch;
        }

        .trigger {
            font: inherit;
            padding: 0.75rem 1.5rem;
            background-color: #0056cc;
            color: white;
            border: 2px solid transparent;
            border-radius: 0.375rem;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .trigger:hover {
            background-color: #0044a3;
        }

        .trigger:focus-visible {
            outline: 3px solid #0056cc;
            outline-offset: 2px;
            background-color: #0044a3;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-overlay[aria-hidden="false"] {
            display: flex;
        }

        .modal-dialog {
            background-color: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.75rem;
            line-height: 1.2;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            line-height: 1;
            padding: 0.25rem 0.5rem;
            margin: -0.5rem -0.5rem -0.5rem 0.5rem;
            cursor: pointer;
            color: #555;
            border-radius: 0.25rem;
            font-weight: 400;
        }

        .modal-close:hover {
            color: #222;
            background-color: #f0f0f0;
        }

        .modal-close:focus-visible {
            outline: 3px solid #0056cc;
            outline-offset: 2px;
            background-color: #f0f0f0;
            color: #222;
        }

        .modal-content {
            margin-bottom: 2rem;
        }

        .modal-content p:last-child {
            margin-bottom: 0;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .modal-footer .btn {
            font: inherit;
            padding: 0.6rem 1.5rem;
            border: 2px solid transparent;
            border-radius: 0.375rem;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .btn-primary {
            background-color: #0056cc;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0044a3;
        }

        .btn-primary:focus-visible {
            outline: 3px solid #0056cc;
            outline-offset: 2px;
            background-color: #0044a3;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #222;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-secondary:focus-visible {
            outline: 3px solid #0056cc;
            outline-offset: 2px;
            background-color: #e0e0e0;
        }

        /* Focus management for modal open */
        body.modal-open {
            overflow: hidden;
        }

        /* Forced Colors Mode Support */
        @media (forced-colors: active) {
            .trigger,
            .modal-close,
            .btn {
                border: 2px solid ButtonBorder;
            }

            .trigger:focus-visible,
            .modal-close:focus-visible,
            .btn:focus-visible {
                outline: 2px solid transparent;
                outline-offset: 2px;
                box-shadow: 0 0 0 3px ButtonText;
            }

            .modal-overlay {
                background-color: rgba(0, 0, 0, 0.7);
            }
            .modal-dialog {
                border: 2px solid CanvasText;
            }
        }

        /* Reflow (Responsive) */
        @media (max-width: 320px) {
            body {
                padding: 1rem;
            }
            .modal-dialog {
                padding: 1.5rem;
                max-height: 85vh;
            }
            .modal-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            .modal-header h2 {
                font-size: 1.5rem;
            }
            .modal-close {
                align-self: flex-end;
                margin: 0;
            }
            .modal-footer {
                flex-direction: column;
            }
            .modal-footer .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="#maincontent" class="sr-only">Skip to main content</a>
    <header>
        <h1>Accessible Modal Dialog Example</h1>
        <p>This page demonstrates a modal dialog that conforms to WCAG 2.2 Level AA guidelines.</p>
    </header>
    <nav aria-label="Primary">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Components</a></li>
            <li><a href="#" aria-current="page">Modal Dialog</a></li>
        </ul>
    </nav>
    <main id="maincontent" tabindex="-1">
        <h2>Demonstration</h2>
        <p>The button below will open a modal dialog. The dialog manages focus, traps focus within itself while open, and can be closed via the close button, the Escape key, or by pressing a button in the footer.</p>
        <button class="trigger" aria-haspopup="dialog" aria-controls="example-modal">
            Open Example Modal
        </button>

        <h2>Accessibility Features</h2>
        <ul>
            <li>Focus is trapped within the modal when open.</li>
            <li>Focus returns to the triggering button when closed.</li>
            <li>The modal has a descriptive title (h2).</li>
            <li>The close button in the top-right has an accessible label.</li>
            <li>All interactive elements have visible focus indicators with sufficient contrast.</li>
            <li>The modal is announced by screen readers when it opens.</li>
            <li>Supports Forced Colors Mode and reflows for narrow viewports (320px).</li>
        </ul>
    </main>
    <footer>
        <p>Example created for accessibility demonstration purposes.</p>
    </footer>

    <!-- Modal Dialog -->
    <div id="example-modal" class="modal-overlay" aria-hidden="true" aria-modal="true" role="dialog" aria-labelledby="modal-title">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2 id="modal-title">Confirm Your Action</h2>
                <button class="modal-close" aria-label="Close dialog">
                    &times;
                </button>
            </div>
            <div class="modal-content">
                <p>This is an example of an accessible modal dialog. When opened, focus is moved to the first focusable element inside the dialog (this close button).</p>
                <p>You can close this dialog by:</p>
                <ul>
                    <li>Pressing the <strong>Close dialog</strong> button (X) in the top-right corner.</li>
                    <li>Pressing the <strong>Escape</strong> key.</li>
                    <li>Pressing the <strong>Cancel</strong> or <strong>Confirm</strong> buttons below.</li>
                </ul>
                <p>Focus is trapped within the dialog while it is open. This ensures keyboard users do not accidentally interact with content behind the modal.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">
                    Cancel
                </button>
                <button class="btn btn-primary" id="modal-confirm">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            const body = document.body;
            const triggerButton = document.querySelector('.trigger');
            const modal = document.getElementById('example-modal');
            const closeButton = modal.querySelector('.modal-close');
            const cancelButton = document.getElementById('modal-cancel');
            const confirmButton = document.getElementById('modal-confirm');
            const modalTitle = document.getElementById('modal-title');

            // Elements that can receive focus within the modal
            const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            const firstFocusableElement = focusableElements[0];
            const lastFocusableElement = focusableElements[focusableElements.length - 1];

            // Track the element that had focus before the modal opened
            let previousActiveElement;

            // Open modal function
            function openModal() {
                previousActiveElement = document.activeElement;
                modal.setAttribute('aria-hidden', 'false');
                body.classList.add('modal-open');

                // Move focus to the first focusable element inside the modal
                firstFocusableElement.focus();

                // Prevent scrolling on the body
                document.body.style.overflow = 'hidden';
            }

            // Close modal function
            function closeModal() {
                modal.setAttribute('aria-hidden', 'true');
                body.classList.remove('modal-open');

                // Return focus to the element that had it before the modal opened
                if (previousActiveElement) {
                    previousActiveElement.focus();
                }

                // Restore body scrolling
                document.body.style.overflow = '';
            }

            // Handle keyboard navigation within the modal (focus trap)
            function handleTabKey(e) {
                if (e.key !== 'Tab') return;

                if (e.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusableElement) {
                        e.preventDefault();
                        lastFocusableElement.focus();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusableElement) {
                        e.preventDefault();
                        firstFocusableElement.focus();
                    }
                }
            }

            // Event Listeners
            triggerButton.addEventListener('click', openModal);

            closeButton.addEventListener('click', closeModal);
            cancelButton.addEventListener('click', closeModal);
            confirmButton.addEventListener('click', function() {
                alert('Action confirmed!');
                closeModal();
            });

            // Close modal on Escape key
            modal.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
                // Trap tab key within modal
                handleTabKey(e);
            });

            // Optional: Close modal when clicking on the overlay background
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        })();
    </script>
</body>
</html>