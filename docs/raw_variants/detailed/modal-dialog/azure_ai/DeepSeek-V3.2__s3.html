<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example Modal - Component Demo</title>
    <style>
        /* Screen reader only utility */
        .sr-only:not(:focus):not(:active) {
            clip: rect(0 0 0 0);
            clip-path: inset(50%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        /* Basic page styling */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.5;
            color: #222;
            background-color: #f9f9f9;
            margin: 0;
            padding: 1rem;
        }

        header, main, footer {
            max-width: 80ch;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            margin-top: 2rem;
        }

        /* Button styling */
        button {
            font: inherit;
            padding: 0.75rem 1.5rem;
            border: 2px solid #0056b3;
            border-radius: 0.375rem;
            background-color: #0056b3;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        button:hover {
            background-color: #004494;
            border-color: #004494;
        }

        button:focus {
            outline: 3px solid transparent;
            box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.5);
        }

        button:active {
            background-color: #003375;
        }

        /* Modal overlay - hidden by default */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-sizing: border-box;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay[aria-hidden="false"] {
            opacity: 1;
            visibility: visible;
        }

        /* Modal dialog */
        .modal {
            background-color: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal__header {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            line-height: 1.3;
        }

        .modal__close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            padding: 0.5rem;
            line-height: 1;
            color: #444;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
        }

        .modal__close-button:hover,
        .modal__close-button:focus {
            background-color: #eee;
            color: #222;
        }

        .modal__close-button:focus {
            outline: 3px solid transparent;
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.5);
        }

        .modal__content {
            margin-bottom: 2rem;
        }

        .modal__content p:last-child {
            margin-bottom: 0;
        }

        .modal__footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .modal__footer button {
            min-width: 6rem;
        }

        /* Forced Colors Mode support */
        @media (forced-colors: active) {
            .modal-overlay {
                background-color: rgba(0, 0, 0, 0.8);
            }

            .modal {
                border: 2px solid CanvasText;
                box-shadow: none;
            }

            button,
            .modal__close-button {
                border: 2px solid ButtonBorder;
            }

            button:focus,
            .modal__close-button:focus {
                outline: 2px solid Highlight;
                outline-offset: 2px;
                box-shadow: none;
            }
        }

        /* Reflow support */
        @media (max-width: 320px) {
            .modal {
                padding: 1.5rem;
            }

            .modal__footer {
                flex-direction: column;
            }

            .modal__footer button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="#maincontent" class="sr-only">Skip to main content</a>
    <header>
        <h1>Modal Dialog Example</h1>
    </header>
    <main id="maincontent" tabindex="-1">
        <p>This page demonstrates an accessible modal dialog component. The button below will open the modal.</p>
        <button class="trigger" aria-haspopup="dialog" aria-expanded="false" aria-controls="example-modal">
            Open Example Modal
        </button>
        <p>Additional page content to illustrate focus management when the modal is open.</p>
    </main>
    <footer>
        <p>Accessibility example. Manual testing with tools like Accessibility Insights is recommended.</p>
    </footer>

    <!-- Modal Dialog -->
    <div class="modal-overlay" id="example-modal-overlay" aria-hidden="true" aria-modal="true" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-description">
        <div class="modal">
            <button class="modal__close-button" aria-label="Close dialog">
                &times;
            </button>
            <h2 class="modal__header" id="modal-title">Example Modal Dialog</h2>
            <div class="modal__content" id="modal-description">
                <p>This is an example of an accessible modal dialog. When opened, focus moves inside the dialog. The dialog can be closed via the close button, the Escape key, or by activating the Cancel button.</p>
                <p>Focus is trapped within the dialog while it is open. Closing the dialog returns focus to the button that opened it.</p>
            </div>
            <div class="modal__footer">
                <button class="modal__cancel">Cancel</button>
                <button class="modal__confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            const triggerButton = document.querySelector('.trigger');
            const modalOverlay = document.getElementById('example-modal-overlay');
            const closeButton = modalOverlay.querySelector('.modal__close-button');
            const cancelButton = modalOverlay.querySelector('.modal__cancel');
            const confirmButton = modalOverlay.querySelector('.modal__confirm');
            const focusableElements = modalOverlay.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            const firstFocusableElement = focusableElements[0];
            const lastFocusableElement = focusableElements[focusableElements.length - 1];
            let previousActiveElement = null;

            function openModal() {
                previousActiveElement = document.activeElement;
                modalOverlay.setAttribute('aria-hidden', 'false');
                triggerButton.setAttribute('aria-expanded', 'true');
                firstFocusableElement.focus();
                document.addEventListener('keydown', handleKeyDown);
            }

            function closeModal() {
                modalOverlay.setAttribute('aria-hidden', 'true');
                triggerButton.setAttribute('aria-expanded', 'false');
                document.removeEventListener('keydown', handleKeyDown);
                if (previousActiveElement) {
                    previousActiveElement.focus();
                }
            }

            function handleKeyDown(event) {
                if (event.key === 'Escape') {
                    closeModal();
                    return;
                }

                if (event.key === 'Tab') {
                    if (!modalOverlay.contains(document.activeElement)) {
                        event.preventDefault();
                        firstFocusableElement.focus();
                        return;
                    }

                    if (event.shiftKey) {
                        if (document.activeElement === firstFocusableElement) {
                            event.preventDefault();
                            lastFocusableElement.focus();
                        }
                    } else {
                        if (document.activeElement === lastFocusableElement) {
                            event.preventDefault();
                            firstFocusableElement.focus();
                        }
                    }
                }
            }

            triggerButton.addEventListener('click', openModal);
            closeButton.addEventListener('click', closeModal);
            cancelButton.addEventListener('click', closeModal);
            confirmButton.addEventListener('click', function() {
                alert('Action confirmed!');
                closeModal();
            });

            // Close modal when clicking on the overlay (outside the modal content)
            modalOverlay.addEventListener('click', function(event) {
                if (event.target === modalOverlay) {
                    closeModal();
                }
            });
        })();
    </script>
</body>
</html>