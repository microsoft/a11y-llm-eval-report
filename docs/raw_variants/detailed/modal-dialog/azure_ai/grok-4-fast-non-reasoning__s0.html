<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Dialog Example - Accessibility Demo</title>
  <style>
    :root {
      --color-bg: #ffffff;
      --color-text: #1a1a1a;
      --color-muted-text: #6b7280;
      --color-border: #d1d5db;
      --color-overlay: rgba(0, 0, 0, 0.5);
      --color-focus: #3b82f6;
      --color-button-bg: #3b82f6;
      --color-button-text: #ffffff;
      --color-button-hover: #2563eb;
      --color-button-danger: #ef4444;
      --color-button-danger-hover: #dc2626;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.5;
      color: var(--color-text);
      background-color: var(--color-bg);
      margin: 0;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .sr-only:not(:focus):not(:active) {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }

    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--color-button-bg);
      color: var(--color-button-text);
      padding: 8px;
      text-decoration: none;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
    }

    .skip-link:focus {
      top: 6px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--color-text);
    }

    .button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      background: var(--color-bg);
      color: var(--color-text);
      text-decoration: none;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .button:focus {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    .button:hover {
      background-color: #f9fafb;
    }

    .button-primary {
      background: var(--color-button-bg);
      color: var(--color-button-text);
      border-color: var(--color-button-bg);
    }

    .button-primary:hover {
      background: var(--color-button-hover);
      border-color: var(--color-button-hover);
    }

    .button-danger {
      background: var(--color-button-danger);
      color: var(--color-button-text);
      border-color: var(--color-button-danger);
    }

    .button-danger:hover {
      background: var(--color-button-danger-hover);
      border-color: var(--color-button-danger-hover);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1000;
    }

    .modal[open] {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay {
      position: absolute;
      inset: 0;
      background: var(--color-overlay);
      cursor: pointer;
    }

    .modal-container {
      background: var(--color-bg);
      border-radius: 8px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      outline: none;
    }

    .modal-header {
      padding: 1.5rem 1.5rem 0 1.5rem;
      border-bottom: 1px solid var(--color-border);
      margin-bottom: 1rem;
    }

    .modal-title {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text);
    }

    .modal-body {
      padding: 0 1.5rem 1rem 1.5rem;
      color: var(--color-text);
    }

    .modal-description {
      color: var(--color-muted-text);
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .modal-actions {
      padding: 0 1.5rem 1.5rem 1.5rem;
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      border-top: 1px solid var(--color-border);
      margin-top: 1rem;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-muted-text);
      font-size: 18px;
      line-height: 1;
    }

    .modal-close:hover,
    .modal-close:focus {
      background: #f3f4f6;
      color: var(--color-text);
    }

    .modal-close:focus {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    /* Responsive */
    @media (max-width: 320px) {
      .modal-container {
        max-height: 100vh;
        border-radius: 0;
        margin: 0;
      }
      
      .modal-header,
      .modal-body,
      .modal-actions {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      .modal-close {
        top: 0.5rem;
        right: 0.5rem;
      }
    }

    /* High Contrast Mode */
    @media (forced-colors: active) {
      .modal-container {
        border: 1px solid CanvasText;
        box-shadow: none;
      }
      
      .modal-close {
        border: 1px solid ButtonBorder;
        background: ButtonFace;
        color: ButtonText;
      }
      
      .modal-close:hover,
      .modal-close:focus {
        background: ButtonFace;
        border-color: ButtonText;
        color: ButtonText;
      }
      
      .button {
        border: 1px solid ButtonBorder;
        background: ButtonFace;
        color: ButtonText;
      }
      
      .button:focus {
        outline-color: ButtonText;
      }
      
      .button-primary {
        background: ButtonFace;
        color: ButtonText;
        border-color: ButtonText;
      }
      
      .button-danger {
        background: Highlight;
        color: HighlightText;
        border-color: Highlight;
      }
    }

    /* Focus visible for all interactive elements */
    *:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: 2px;
    }

    /* Ensure text contrast */
    .modal-title,
    .button,
    .modal-description {
      font-size: 1rem; /* Ensures 4.5:1 contrast requirement */
    }
  </style>
</head>
<body>
  <a href="#maincontent" class="skip-link sr-only">Skip to main content</a>
  
  <header>
    <h1>Modal Dialog Accessibility Example</h1>
  </header>

  <main id="maincontent" tabindex="-1">
    <p>This page demonstrates an accessible modal dialog component. Click the button below to open the modal. The modal follows WCAG 2.2 AA guidelines including proper focus management, keyboard navigation, and screen reader support.</p>
    
    <p><strong>Features demonstrated:</strong></p>
    <ul>
      <li>Keyboard navigation (Tab, Escape, Enter)</li>
      <li>Focus trapping within the modal</li>
      <li>Proper ARIA attributes and roles</li>
      <li>Screen reader announcements</li>
      <li>High contrast mode support</li>
      <li>Mobile responsive design</li>
    </ul>

    <div style="margin: 2rem 0;">
      <button class="button button-primary trigger" aria-describedby="modal-description">
        Open Confirmation Modal
      </button>
    </div>

    <p>Try these keyboard interactions:</p>
    <ul>
      <li><kbd>Tab</kbd>: Navigate through interactive elements</li>
      <li><kbd>Escape</kbd>: Close the modal</li>
      <li><kbd>Enter</kbd> or <kbd>Space</kbd>: Activate buttons</li>
    </ul>
  </main>

  <dialog class="modal" id="confirmationModal" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description">
    <div class="modal-overlay" data-close></div>
    
    <div class="modal-container" role="document">
      <header class="modal-header">
        <button class="modal-close" aria-label="Close modal" data-close>Ã—</button>
        <h2 class="modal-title" id="modal-title">Confirm Action</h2>
      </header>
      
      <div class="modal-body">
        <p class="modal-description" id="modal-description">
          Are you sure you want to proceed with this action? This cannot be undone and will permanently affect your data.
        </p>
      </div>
      
      <footer class="modal-actions">
        <button class="button" data-close>Cancel</button>
        <button class="button button-danger" data-confirm>Confirm Action</button>
      </footer>
    </div>
  </dialog>

  <script>
    (function() {
      'use strict';

      const modal = document.getElementById('confirmationModal');
      const triggerButtons = document.querySelectorAll('.trigger');
      const closeButtons = modal.querySelectorAll('[data-close]');
      const confirmButton = modal.querySelector('[data-confirm]');
      const overlay = modal.querySelector('.modal-overlay');

      // Open modal
      function openModal() {
        modal.showModal();
        modal.querySelector('.modal-container').focus(); // Focus goes to container
        
        // Trap focus within modal
        const focusableElements = getFocusableElements(modal);
        if (focusableElements.length > 0) {
          focusableElements[0].focus();
        }
        
        // Handle Escape key
        document.addEventListener('keydown', handleKeydown);
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
        
        // Announce to screen readers
        const announcement = document.createElement('div');
        announcement.setAttribute('aria-live', 'polite');
        announcement.setAttribute('aria-atomic', 'true');
        announcement.className = 'sr-only';
        announcement.textContent = 'Dialog opened';
        modal.appendChild(announcement);
        // Remove announcement after a brief delay
        setTimeout(() => announcement.remove(), 100);
      }

      // Close modal
      function closeModal() {
        modal.close();
        document.removeEventListener('keydown', handleKeydown);
        document.body.style.overflow = '';
        
        // Return focus to trigger button
        const lastActiveElement = document.activeElement;
        const trigger = lastActiveElement.closest('.trigger') || document.querySelector('.trigger');
        if (trigger) {
          trigger.focus();
        }
        
        // Announce to screen readers
        const announcement = document.createElement('div');
        announcement.setAttribute('aria-live', 'polite');
        announcement.setAttribute('aria-atomic', 'true');
        announcement.className = 'sr-only';
        announcement.textContent = 'Dialog closed';
        document.body.appendChild(announcement);
        setTimeout(() => announcement.remove(), 100);
      }

      // Handle keydown events
      function handleKeydown(event) {
        if (event.key === 'Escape') {
          closeModal();
          return;
        }

        // Handle Tab key for focus trapping
        if (event.key === 'Tab') {
          const focusableElements = getFocusableElements(modal);
          if (focusableElements.length === 0) return;

          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];
          const currentElement = document.activeElement;

          if (event.shiftKey) {
            // Shift + Tab (backward)
            if (currentElement === firstElement) {
              event.preventDefault();
              lastElement.focus();
            }
          } else {
            // Tab (forward)
            if (currentElement === lastElement) {
              event.preventDefault();
              firstElement.focus();
            }
          }
        }
      }

      // Get all focusable elements within the modal
      function getFocusableElements(container) {
        const focusableSelectors = [
          'button:not([disabled])',
          '[href]',
          'input:not([disabled]):not([type="hidden"])',
          'select:not([disabled])',
          'textarea:not([disabled])',
          '[tabindex]:not([tabindex="-1"]):not([disabled])'
        ];
        return Array.from(container.querySelectorAll(focusableSelectors.join(', ')))
          .filter(el => {
            const style = window.getComputedStyle(el);
            return style.display !== 'none' && style.visibility !== 'hidden';
          });
      }

      // Event listeners
      triggerButtons.forEach(button => {
        button.addEventListener('click', openModal);
      });

      closeButtons.forEach(button => {
        button.addEventListener('click', closeModal);
      });

      overlay.addEventListener('click', closeModal);

      confirmButton.addEventListener('click', function(event) {
        event.preventDefault();
        // Simulate action confirmation
        alert('Action confirmed! (This is just a demo)');
        closeModal();
      });

      // Handle modal open/close events for additional accessibility
      modal.addEventListener('close', () => {
        document.body.style.overflow = '';
      });

      // Close modal when clicking outside (overlay only)
      modal.addEventListener('click', function(event) {
        if (event.target === modal || event.target.classList.contains('modal-overlay')) {
          closeModal();
        }
      });

      // Ensure modal is closed when page loses visibility
      document.addEventListener('visibilitychange', () => {
        if (document.hidden && modal.hasAttribute('open')) {
          closeModal();
        }
      });

    })();
  </script>
</body>
</html>