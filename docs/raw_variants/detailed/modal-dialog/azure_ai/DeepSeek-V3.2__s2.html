<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Dialog Example - Components - Site</title>
    <style>
        /* Base styles and tokens */
        :root {
            --color-bg: #ffffff;
            --color-text: #1a1a1a;
            --color-muted-text: #4a5568;
            --color-link: #0056b3;
            --color-border: #cbd5e0;
            --color-focus: #4d90fe;
            --color-danger: #dc2626;
            --color-success: #059669;
            --color-overlay: rgba(0, 0, 0, 0.5);
            --color-modal-bg: #ffffff;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --radius: 0.375rem;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --focus-outline: 3px solid var(--color-focus);
            --focus-outline-offset: 2px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-bg: #1a1a1a;
                --color-text: #f7fafc;
                --color-muted-text: #a0aec0;
                --color-border: #4a5568;
                --color-modal-bg: #2d3748;
                --color-overlay: rgba(0, 0, 0, 0.7);
            }
        }

        /* Forced Colors Mode Support */
        @media (forced-colors: active) {
            :root {
                --color-focus: Highlight;
                --color-border: ButtonBorder;
            }
            .modal {
                border: 1px solid ButtonBorder;
            }
            .btn-close {
                border: 1px solid ButtonBorder;
            }
        }

        /* Utility: Screen reader only */
        .sr-only:not(:focus):not(:active) {
            clip: rect(0 0 0 0);
            clip-path: inset(50%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        /* Base page styles */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
            margin: 0;
            padding: var(--spacing-md);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        main {
            flex: 1;
            padding: var(--spacing-lg) 0;
        }

        footer {
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--color-border);
            color: var(--color-muted-text);
            font-size: 0.875rem;
        }

        h1, h2 {
            margin-top: 0;
            line-height: 1.2;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-sm);
        }

        p {
            margin-top: 0;
            margin-bottom: var(--spacing-sm);
            max-width: 65ch;
        }

        /* Button base styles */
        button {
            font-family: inherit;
            font-size: 1rem;
            border: 1px solid transparent;
            border-radius: var(--radius);
            padding: var(--spacing-xs) var(--spacing-sm);
            cursor: pointer;
            background-color: var(--color-border);
            color: var(--color-text);
            transition: background-color 0.2s ease;
        }

        button:hover {
            background-color: color-mix(in srgb, var(--color-border) 80%, var(--color-text));
        }

        button:focus-visible {
            outline: var(--focus-outline);
            outline-offset: var(--focus-outline-offset);
        }

        button:active {
            transform: translateY(1px);
        }

        /* Specific button styles */
        .trigger {
            background-color: var(--color-link);
            color: white;
            font-weight: 600;
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .trigger:hover {
            background-color: color-mix(in srgb, var(--color-link) 80%, black);
        }

        .btn-close {
            background: none;
            border: 0;
            font-size: 1.5rem;
            line-height: 1;
            padding: var(--spacing-xs);
            color: var(--color-muted-text);
            align-self: flex-start;
            margin-left: auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            min-height: 44px;
        }

        .btn-close:hover,
        .btn-close:focus-visible {
            background-color: color-mix(in srgb, var(--color-border) 30%, transparent);
            color: var(--color-text);
        }

        .btn-primary {
            background-color: var(--color-link);
            color: white;
            font-weight: 600;
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .btn-primary:hover {
            background-color: color-mix(in srgb, var(--color-link) 80%, black);
        }

        /* Modal overlay and container */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-overlay);
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-overlay[aria-hidden="false"] {
            display: flex;
        }

        .modal {
            background-color: var(--color-modal-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 600px;
            max-height: calc(100vh - 2 * var(--spacing-sm));
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .modal:focus {
            outline: none;
        }

        .modal-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .modal-title {
            margin: 0;
            font-size: 1.5rem;
            line-height: 1.3;
        }

        .modal-body {
            padding: var(--spacing-md);
            flex: 1;
            overflow-y: auto;
        }

        .modal-body p:last-child {
            margin-bottom: 0;
        }

        .modal-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        /* Reflow: Ensure modal is usable at 320px */
        @media (max-width: 320px) {
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: var(--spacing-sm);
            }
            .modal-footer {
                flex-direction: column;
            }
            .modal-footer button {
                width: 100%;
            }
            .btn-close {
                min-width: 36px;
                min-height: 36px;
            }
        }

        /* Handle long strings */
        .modal-body {
            overflow-wrap: anywhere;
        }
    </style>
</head>
<body>
    <a href="#maincontent" class="sr-only">Skip to main content</a>
    <header>
        <h1>Accessible Modal Dialog Example</h1>
        <p>This page demonstrates a modal dialog that conforms to WCAG 2.2 Level AA.</p>
    </header>
    <nav aria-label="Main">
        <ul style="list-style: none; padding: 0; display: flex; gap: 1rem;">
            <li><a href="#" style="color: var(--color-link);">Home</a></li>
            <li><a href="#" style="color: var(--color-link);">Components</a></li>
            <li><a href="#" style="color: var(--color-link);">About</a></li>
        </ul>
    </nav>
    <main id="maincontent" tabindex="-1">
        <h2>Interactive Demo</h2>
        <p>Use the button below to open the modal dialog. It can be operated with a keyboard, screen reader, and respects user preferences.</p>
        <button class="trigger" id="openModal" aria-haspopup="dialog">Open Example Modal</button>

        <section aria-labelledby="features-heading" style="margin-top: var(--spacing-lg);">
            <h3 id="features-heading">Accessibility Features Included</h3>
            <ul>
                <li>Proper focus management: opens on trigger, traps focus inside, returns focus on close.</li>
                <li>Keyboard support: <kbd>Tab</kbd>, <kbd>Shift+Tab</kbd>, <kbd>Escape</kbd> to close.</li>
                <li>Semantic structure: uses <code>&lt;dialog&gt;</code> semantics via ARIA.</li>
                <li>Screen reader announcements: modal title is announced when opened.</li>
                <li>High contrast and forced colors mode support.</li>
                <li>Reflow: adapts down to 320px width without horizontal scrolling for text.</li>
                <li>Visible focus indicators with sufficient contrast.</li>
            </ul>
        </section>
    </main>
    <footer>
        <p>Example site for accessible components. Manual testing with tools like Accessibility Insights is recommended.</p>
    </footer>

    <!-- Modal Dialog -->
    <div class="modal-overlay" id="modalOverlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
        <div class="modal" tabindex="-1">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Example Modal Dialog</h2>
                <button class="btn-close" id="closeModal" aria-label="Close dialog">Ã—</button>
            </div>
            <div class="modal-body">
                <p id="modalDesc">This is an example of an accessible modal dialog. When opened, focus is moved into the dialog and trapped until it is closed.</p>
                <p>You can close this dialog by pressing the <kbd>Escape</kbd> key, clicking the close button, or clicking the "Confirm" button below.</p>
                <p>All interactive elements are keyboard accessible and have visible focus styles.</p>
                <p>This content should reflow properly at narrow viewports without requiring horizontal scrolling to read.</p>
                <form id="exampleForm" style="margin-top: var(--spacing-md);">
                    <label for="email">Email address (required)</label>
                    <input type="email" id="email" name="email" required aria-required="true" style="display: block; width: 100%; padding: var(--spacing-xs); margin-bottom: var(--spacing-sm); border: 1px solid var(--color-border); border-radius: var(--radius);">
                    <p style="font-size: 0.875rem; color: var(--color-muted-text); margin-top: 0;">We'll never share your email with anyone else.</p>
                    <div>
                        <input type="checkbox" id="subscribe" name="subscribe">
                        <label for="subscribe">Subscribe to newsletter</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-close" id="cancelModal">Cancel</button>
                <button class="btn-primary" id="confirmModal">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            const openButton = document.getElementById('openModal');
            const overlay = document.getElementById('modalOverlay');
            const modal = overlay.querySelector('.modal');
            const closeButton = document.getElementById('closeModal');
            const cancelButton = document.getElementById('cancelModal');
            const confirmButton = document.getElementById('confirmModal');
            const emailInput = document.getElementById('email');

            let previousActiveElement = null;

            function openModal() {
                previousActiveElement = document.activeElement;
                overlay.setAttribute('aria-hidden', 'false');
                modal.focus();
                document.body.style.overflow = 'hidden';
                trapFocus(modal);
            }

            function closeModal() {
                overlay.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                if (previousActiveElement) {
                    previousActiveElement.focus();
                }
                removeFocusTrap();
            }

            function handleKeydown(event) {
                if (event.key === 'Escape') {
                    closeModal();
                }
                if (event.key === 'Tab') {
                    trapTabKey(modal, event);
                }
            }

            function trapFocus(element) {
                document.addEventListener('keydown', handleKeydown);
            }

            function removeFocusTrap() {
                document.removeEventListener('keydown', handleKeydown);
            }

            function trapTabKey(container, event) {
                const focusableElements = container.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                const firstFocusable = focusableElements[0];
                const lastFocusable = focusableElements[focusableElements.length - 1];

                if (event.shiftKey) {
                    if (document.activeElement === firstFocusable) {
                        lastFocusable.focus();
                        event.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastFocusable) {
                        firstFocusable.focus();
                        event.preventDefault();
                    }
                }
            }

            openButton.addEventListener('click', openModal);
            closeButton.addEventListener('click', closeModal);
            cancelButton.addEventListener('click', closeModal);
            confirmButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (emailInput.value) {
                    alert('Form submitted (example).');
                    closeModal();
                } else {
                    emailInput.setAttribute('aria-invalid', 'true');
                    emailInput.focus();
                }
            });

            overlay.addEventListener('click', (event) => {
                if (event.target === overlay) {
                    closeModal();
                }
            });

            emailInput.addEventListener('input', () => {
                if (emailInput.hasAttribute('aria-invalid')) {
                    emailInput.removeAttribute('aria-invalid');
                }
            });
        })();
    </script>
</body>
</html>