<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Example modal dialog - Demo - Accessible UI</title>
  <style>
    /* Design tokens (use these only) */
    :root{
      --color-bg: #ffffff;
      --color-surface: #f7f9fb;
      --color-text: #0b0b0b;
      --color-muted-text: #444444;
      --color-primary: #005ea6; /* accessible on white */
      --color-primary-hover: #004b8c;
      --color-border: #d6dbe0;
      --color-focus: #ffb400; /* distinct, high-contrast */
      --color-danger: #b82323;
      --shadow: 0 6px 18px rgba(11,11,11,0.12);
      --radius: 8px;
      --max-modal-width: 640px;
      --z-modal: 1000;
    }

    /* Forced colors support */
    @media (forced-colors: active) {
      :root{
        --color-bg: Canvas;
        --color-text: CanvasText;
        --color-border: ButtonBorder;
        --color-focus: Highlight;
      }
      .modal__dialog {
        border: 2px solid ButtonBorder;
        box-shadow: none;
        background: Canvas;
        color: CanvasText;
      }
      .btn {
        border-color: ButtonBorder;
        background: ButtonFace;
        color: ButtonText;
      }
      .btn:focus {
        outline: 3px solid Highlight;
      }
    }

    /* Basic reset and layout */
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--color-surface);
      color:var(--color-text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
    }

    /* Utility: screen-reader only but visible on focus */
    .sr-only:not(:focus):not(:active) {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    .sr-only:focus, .sr-only:active {
      position: static;
      width: auto;
      height: auto;
      clip: none;
      clip-path: none;
      white-space: normal;
    }

    header, nav, main, footer {
      padding: 1rem;
    }

    header {
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
    }

    .site-brand {
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .logo {
      width:36px;
      height:36px;
      background:var(--color-primary);
      border-radius:6px;
      display:inline-block;
    }
    .site-title {
      font-weight:600;
      color:var(--color-text);
      margin:0;
    }

    nav ul {
      display:flex;
      gap:1rem;
      list-style:none;
      padding:0;
      margin:0.75rem 0 0 0;
    }
    nav a {
      color:var(--color-primary);
      text-decoration:none;
    }
    nav a:focus {
      outline:3px solid var(--color-focus);
      outline-offset:2px;
    }

    main {
      max-width:900px;
      margin:1.25rem auto;
      padding:0 1rem;
    }
    h1{
      font-size:1.5rem;
      margin:0 0 1rem 0;
    }
    p { color:var(--color-muted-text); margin:0 0 1rem 0; }

    /* Buttons */
    .btn {
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      background:var(--color-primary);
      color: white;
      border: 1px solid transparent;
      padding:.5rem .75rem;
      font-size:1rem;
      border-radius:6px;
      cursor:pointer;
    }
    .btn:hover { background:var(--color-primary-hover); }
    .btn:focus {
      outline:3px solid var(--color-focus);
      outline-offset:3px;
    }

    /* Make focus visible for all interactive elements */
    button, a, input, select, textarea {
      -moz-outline-style: none;
    }
    button:focus, a:focus, input:focus, select:focus, textarea:focus {
      outline:3px solid var(--color-focus);
      outline-offset:3px;
    }

    /* Modal overlay and dialog */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
    }
    .modal[hidden] { display:none; }
    .modal__overlay {
      position: absolute;
      inset: 0;
      background: rgba(11,11,11,0.5);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }
    .modal__dialog {
      position: relative;
      z-index: calc(var(--z-modal) + 1);
      background: var(--color-bg);
      color: var(--color-text);
      border-radius: var(--radius);
      padding: 1rem;
      box-shadow: var(--shadow);
      width: min(90%, var(--max-modal-width));
      max-height: 90vh;
      overflow:auto;
      border: 1px solid var(--color-border);
      margin: 1rem;
    }
    .modal__header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    .modal__title {
      margin:0;
      font-size:1.125rem;
    }
    .modal__body {
      margin-top:.75rem;
      color:var(--color-muted-text);
      font-size:0.98rem;
    }
    .modal__footer {
      margin-top:1rem;
      display:flex;
      justify-content:flex-end;
      gap:.5rem;
    }

    .close {
      background:transparent;
      color:var(--color-text);
      border:1px solid var(--color-border);
      padding:.35rem .6rem;
      border-radius:6px;
      cursor:pointer;
    }
    .close:hover { background: #f0f0f0; }
    .close:focus {
      outline:3px solid var(--color-focus);
      outline-offset:3px;
    }

    /* Responsive + reflow rules */
    @media (max-width:480px){
      h1 { font-size:1.25rem; }
      .modal__dialog { padding:.75rem; border-radius:10px; }
    }

    /* Ensure long strings wrap, prevent overflow */
    .wrap { overflow-wrap:anywhere; word-break:break-word; }

    /* Footer */
    footer {
      border-top:1px solid var(--color-border);
      background:var(--color-bg);
      margin-top:2rem;
    }
  </style>
</head>
<body>
  <header>
    <a href="#maincontent" class="sr-only">Skip to main content</a>
    <div class="site-brand" aria-hidden="false">
      <span class="logo" aria-hidden="true"></span>
      <div>
        <p class="site-title">Accessible UI Demo</p>
        <nav aria-label="Top navigation">
          <ul>
            <li><a href="#features">Features</a></li>
            <li><a href="#examples">Examples</a></li>
            <li><a href="#about">About</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main id="maincontent" tabindex="-1" aria-labelledby="page-heading">
    <h1 id="page-heading">Modal dialog example</h1>

    <p>
      This page demonstrates an accessible modal dialog pattern. The modal is closed by default.
      Open it with the button below (the opener has the class "trigger"). While the modal is open,
      background content is hidden from assistive technology and focus is constrained inside the dialog.
    </p>

    <p class="wrap">
      Example long text to verify reflow and wrapping at small widths: a-very-long-string-without-spaces-like-a-really-long-URL-or-token-should-wrap-correctly-and-not-cause-horizontal-scrolling-when-the-viewport-is-narrow.
    </p>

    <p>
      <button class="btn trigger" id="openDialogBtn" aria-haspopup="dialog" aria-controls="exampleModal">
        Open example dialog
      </button>
    </p>

    <section aria-labelledby="examples" id="examples">
      <h2 id="examples" style="font-size:1rem; margin-top:1.25rem">Examples</h2>
      <p class="wrap">The dialog contains a small form, a close button, and an action button. All interactive items have visible labels and are keyboard operable.</p>
    </section>

    <!-- Modal (closed by default using hidden attribute) -->
    <div class="modal" id="exampleModal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" hidden>
      <div class="modal__overlay" data-dismiss="overlay"></div>

      <div class="modal__dialog" role="document">
        <header class="modal__header">
          <h2 id="modal-title" class="modal__title">Subscribe to updates</h2>
          <button class="close" id="modalClose" type="button">Close</button>
        </header>

        <div id="modal-desc" class="modal__body">
          <p>Please enter your email address to receive occasional product updates. You can unsubscribe at any time.</p>

          <form id="modalForm" style="margin-top:0.75rem;">
            <label for="emailInput" style="display:block; font-weight:600; margin-bottom:0.25rem;">Email address <span aria-hidden="true" style="color:var(--color-danger)">*</span></label>
            <input id="emailInput" name="email" type="email" required aria-required="true" aria-describedby="emailHelp" style="width:100%; padding:.5rem; border:1px solid var(--color-border); border-radius:6px; font-size:1rem; color:var(--color-text);" />

            <div id="emailHelp" style="font-size:0.92rem; color:var(--color-muted-text); margin-top:0.25rem;">
              We'll only use your email to send the updates you subscribe to.
            </div>

            <div class="modal__footer">
              <button type="button" class="close" id="cancelBtn">Cancel</button>
              <button type="submit" class="btn" id="submitBtn">Subscribe</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <p style="margin:0; color:var(--color-muted-text);">Demo footer — accessible modal example.</p>
  </footer>

  <script>
    (function(){
      // Element references
      const trigger = document.querySelector('.trigger');
      const modal = document.getElementById('exampleModal');
      const overlay = modal.querySelector('.modal__overlay');
      const dialog = modal.querySelector('.modal__dialog');
      const closeBtn = document.getElementById('modalClose');
      const cancelBtn = document.getElementById('cancelBtn');
      const submitBtn = document.getElementById('submitBtn');
      const firstFocusableSelector = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])';
      let lastFocusedElement = null;

      // Utility: find focusable elements inside container
      function getFocusable(container){
        return Array.prototype.slice.call(container.querySelectorAll(firstFocusableSelector))
          .filter(el => el.offsetParent !== null); // visible
      }

      function openDialog() {
        // Save last focused element to restore focus on close
        lastFocusedElement = document.activeElement;

        // Show modal
        modal.removeAttribute('hidden');

        // Hide main content from AT while modal is open
        document.querySelector('main').setAttribute('aria-hidden', 'true');

        // Prevent background scroll (non-essential but helpful)
        document.body.style.overflow = 'hidden';

        // Focus first interactive element inside dialog (close button)
        const focusable = getFocusable(dialog);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          // Ensure dialog has a programmatic focus target
          dialog.setAttribute('tabindex', '-1');
          dialog.focus();
        }

        // Start trapping focus
        document.addEventListener('keydown', onKeyDown, true);
      }

      function closeDialog(returnFocus = true) {
        // Hide modal
        if (!modal.hasAttribute('hidden')) {
          modal.setAttribute('hidden', '');
        }

        // Restore main content visibility to AT
        document.querySelector('main').removeAttribute('aria-hidden');

        // Restore body scroll
        document.body.style.overflow = '';

        // Remove tabindex if it was added
        if (dialog.hasAttribute('tabindex')) dialog.removeAttribute('tabindex');

        // Stop focus trap
        document.removeEventListener('keydown', onKeyDown, true);

        // Return focus
        if (returnFocus && lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          lastFocusedElement.focus();
        }
      }

      // Focus trap and Escape handling
      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeDialog(true);
          return;
        }

        if (e.key === 'Tab') {
          // Implement tab trapping inside modal
          const focusable = getFocusable(dialog);
          if (focusable.length === 0) {
            // No focusable elements — keep focus on dialog
            e.preventDefault();
            dialog.focus();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          } else if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          }
        }
      }

      // Click outside (overlay) closes dialog
      overlay.addEventListener('click', function (e) {
        closeDialog(true);
      });

      // Click handlers for open/close
      trigger.addEventListener('click', function (e) {
        openDialog();
      });

      closeBtn.addEventListener('click', function () {
        closeDialog(true);
      });

      cancelBtn.addEventListener('click', function () {
        closeDialog(true);
      });

      // Form submit example: simple validation and accessible error focus
      const form = document.getElementById('modalForm');
      const emailInput = document.getElementById('emailInput');
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        // basic client-side validation
        if (!emailInput.value || !emailInput.checkValidity()) {
          emailInput.setAttribute('aria-invalid', 'true');
          // Provide an inline error message programmatically (for demo we use title attribute and focus)
          // In real apps, render visible error text associated via aria-describedby.
          if (!document.getElementById('emailError')) {
            const err = document.createElement('div');
            err.id = 'emailError';
            err.style.color = 'var(--color-danger)';
            err.style.marginTop = '.5rem';
            err.textContent = 'Please enter a valid email address.';
            emailInput.insertAdjacentElement('afterend', err);
            emailInput.setAttribute('aria-describedby', (emailInput.getAttribute('aria-describedby') || '') + ' emailError');
          }
          emailInput.focus();
          return;
        }

        // Simulate success
        emailInput.removeAttribute('aria-invalid');
        // Simple success feedback (rendered inside dialog)
        const success = document.createElement('div');
        success.style.marginTop = '0.75rem';
        success.style.padding = '0.75rem';
        success.style.borderRadius = '6px';
        success.style.background = '#e6fffb';
        success.style.color = '#065f46';
        success.textContent = 'Thanks — you are subscribed!';
        form.parentElement.appendChild(success);

        // After a short delay close the dialog and return focus
        setTimeout(() => closeDialog(true), 900);
      });

      // Ensure that while hidden the modal isn't focusable
      // already handled by hidden attribute and focus trap removal

      // Safety: close dialog on escape even if focus is not in dialog (global listener)
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && !modal.hasAttribute('hidden')) {
          closeDialog(true);
        }
      });

      // Accessibility: click on content should not close the modal
      dialog.addEventListener('click', function (e) { e.stopPropagation(); });

      // Ensure that interactive elements outside the dialog are not reachable by keyboard
      // Primary measure is hiding main with aria-hidden + removing container scroll, focus trap prevents tabbing out.
      // On some browsers/users, consider using inert when available:
      if ('inert' in HTMLElement.prototype) {
        // When modal opens/closes, manage inert attribute for better keyboard and AT support.
        const main = document.querySelector('main');
        const setInert = (value) => {
          if (value) main.inert = true;
          else main.inert = false;
        };
        // Enhance open/close functions to toggle inert
        const origOpen = openDialog;
        openDialog = function(){
          setInert(true);
          origOpen();
        };
        const origClose = closeDialog;
        closeDialog = function(returnFocus = true){
          setInert(false);
          origClose(returnFocus);
        };
      }

      // Ensure the trigger has the requested class
      // (It's required by the task and present in markup)
      // No further action required.
    })();
  </script>
</body>
</html>