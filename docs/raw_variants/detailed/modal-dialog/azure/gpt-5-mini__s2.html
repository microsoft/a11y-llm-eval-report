<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible modal dialog example - patterns - Demo</title>
  <style>
    /* Design tokens */
    :root{
      --color-bg: #ffffff;
      --color-surface: #ffffff;
      --color-text: #0b0b0b;
      --color-muted-text: #3b3b3b;
      --color-link: #005fcc;
      --color-border: #d0d7de;
      --color-focus: #005fcc;
      --color-danger: #b00020;
      --color-success: #0a7a3a;
      --shadow: 0 6px 18px rgba(11,11,11,0.12);
      --radius: 8px;
      --max-width: 640px;
    }

    /* Basic reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--color-bg);
      color:var(--color-text);
      line-height:1.4;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Accessibility: visible focus for keyboard users */
    :focus{outline: none}
    :focus-visible{
      outline: 3px solid var(--color-focus);
      outline-offset: 3px;
      border-radius: 4px;
    }

    /* Skip link (first focusable element) */
    .sr-only:not(:focus):not(:active) {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    .skip-link{
      position: absolute;
      left:1rem;
      top:1rem;
      z-index: 2000;
    }

    header, nav, main, footer { padding: 1rem; }

    header{
      border-bottom: 1px solid var(--color-border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    .brand{ font-weight:700; color:var(--color-text) }

    nav ul{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      gap:0.5rem;
    }
    nav a{
      text-decoration:none;
      color:var(--color-link);
      padding: 0.25rem 0.5rem;
      border-radius:4px;
    }
    nav a:focus-visible{ outline: 3px solid var(--color-focus); outline-offset: 2px; }

    main{
      max-width: 900px;
      margin: 1.25rem auto;
      padding: 0 1rem;
    }

    .controls{
      display:flex;
      gap: 0.5rem;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      background: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text);
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    .btn-primary{
      background: var(--color-link);
      color: #fff;
      border-color: var(--color-link);
    }
    .btn-danger{
      background: var(--color-danger);
      color: #fff;
      border-color: var(--color-danger);
    }
    .btn:focus-visible{ outline: 3px solid var(--color-focus); outline-offset: 2px; }

    /* Dialog styling */
    dialog[open]{
      padding: 0;
      border: none;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: min(calc(100% - 2rem), var(--max-width));
      max-width: 95%;
    }
    dialog::backdrop{
      background: rgba(11,11,11,0.45);
      backdrop-filter: blur(2px);
    }
    .dialog-panel{
      display:flex;
      flex-direction:column;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--color-surface);
    }
    .dialog-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:1rem;
    }
    .dialog-title{
      margin:0;
      font-size: 1.125rem;
      line-height:1.2;
    }
    .dialog-close{
      background:transparent;
      border: none;
      color:var(--color-text);
      font-size: 1rem;
      padding: 0.25rem 0.5rem;
      cursor:pointer;
      border-radius:6px;
    }
    .dialog-close:focus-visible{ outline: 3px solid var(--color-focus); outline-offset:2px; }

    .dialog-body{
      padding: 0.25rem 0.25rem 0.5rem 0.25rem;
      color: var(--color-muted-text);
      font-size: 0.98rem;
    }
    .dialog-actions{
      display:flex;
      gap:0.5rem;
      justify-content:flex-end;
      padding-top:0.25rem;
    }

    /* Make sure long words wrap and the layout reflows at narrow widths */
    .dialog-panel, .dialog-body, main { overflow-wrap:anywhere; min-width:0; }

    /* Ensure controls remain visible at small widths */
    @media (max-width:420px){
      .dialog-actions{ flex-direction: column-reverse; align-items:stretch; }
      .dialog-actions .btn{ width:100%; }
    }

    /* High contrast / forced colors support */
    @media (forced-colors: active){
      :root{
        --color-bg: Canvas;
        --color-text: CanvasText;
        --color-border: ButtonBorder;
        --color-focus: Highlight;
      }
      dialog::backdrop{ background: CanvasText; opacity: 0.15; }
      .btn{ border: 2px solid ButtonBorder; background: ButtonFace; color: ButtonText; }
      .btn-primary{ background: Highlight; color: HighlightText; border-color: ButtonBorder; }
      .dialog-panel{ background: Canvas; color: CanvasText; border: 2px solid ButtonBorder; }
      .dialog-close{ border: 2px solid ButtonBorder; }
      :focus-visible{ outline: 3px solid Highlight; outline-offset: 2px; }
    }
  </style>
</head>
<body>
  <header>
    <a href="#maincontent" class="sr-only skip-link">Skip to main content</a>
    <div class="brand" aria-hidden="false">Demo UI</div>
    <nav aria-label="Primary navigation">
      <ul>
        <li><a href="#features">Features</a></li>
        <li><a href="#examples">Examples</a></li>
        <li><a href="#about">About</a></li>
      </ul>
    </nav>
  </header>

  <main id="maincontent" tabindex="-1">
    <h1>Accessible modal dialog example</h1>

    <p>
      This page demonstrates an accessible modal dialog pattern. The dialog is closed by default.
      Use the "Open dialog" button to open it. The opener button has the CSS class "trigger".
    </p>

    <section aria-labelledby="example-heading">
      <h2 id="example-heading">Try it</h2>

      <div class="controls">
        <!-- This button opens the dialog. It must have class "trigger" per the requirement. -->
        <button type="button" class="btn btn-primary trigger" id="openDialog">
          Open dialog
        </button>

        <!-- A second trigger to show multiple triggers scenario -->
        <button type="button" class="btn trigger" id="openDialogAlt">
          Open dialog (alt trigger)
        </button>

        <a href="#" class="btn" id="someLink">Another focusable element</a>
      </div>
    </section>

    <hr />

    <section>
      <h2>Notes</h2>
      <p style="color:var(--color-muted-text)">
        - The dialog is implemented using the native &lt;dialog&gt; element with accessible attributes.
        <br/>- Focus is trapped while the dialog is open; Escape closes it. When closed, focus returns to the opener.
      </p>
    </section>
  </main>

  <footer>
    <small>Footer content — accessible landmarks are present.</small>
  </footer>

  <!-- Dialog: closed by default (no 'open' attribute) -->
  <dialog id="example-dialog" aria-labelledby="dialog-title" aria-describedby="dialog-desc" aria-modal="true">
    <div class="dialog-panel" role="document">
      <header class="dialog-header">
        <h2 id="dialog-title" class="dialog-title">Confirm action</h2>
        <button class="dialog-close" id="dialogClose" aria-label="Close dialog">
          <!-- Decorative X; visible label for sighted users is provided -->
          <span aria-hidden="true">✕</span>
        </button>
      </header>

      <div class="dialog-body" id="dialog-desc">
        <p>
          Are you sure you want to perform this action? This is an example modal dialog that demonstrates proper
          keyboard and screen reader behavior. It is fully operable by keyboard and includes focus management.
        </p>
      </div>

      <div class="dialog-actions">
        <button class="btn" id="cancelBtn">Cancel</button>
        <button class="btn btn-danger" id="confirmBtn">Confirm</button>
      </div>
    </div>
  </dialog>

  <script>
    (function () {
      // Elements
      const dialog = document.getElementById('example-dialog');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const closeButton = document.getElementById('dialogClose');
      const cancelBtn = document.getElementById('cancelBtn');
      const confirmBtn = document.getElementById('confirmBtn');

      // Landmarks to mark inert when dialog open
      const inertTargets = Array.from(document.querySelectorAll('header, nav, main, footer'))
        .filter(el => !el.contains(dialog));

      let lastFocused = null;

      // Utility: get focusable elements inside container
      function getFocusable(container) {
        return Array.from(container.querySelectorAll(
          'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), ' +
          'textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex], [contenteditable]'
        )).filter(el => {
          // element must be visible and not have tabindex="-1"
          if (el.hasAttribute('tabindex') && el.getAttribute('tabindex') === '-1') return false;
          const style = window.getComputedStyle(el);
          return style && style.display !== 'none' && style.visibility !== 'hidden';
        });
      }

      // Make page inert (ARIA + inert property where supported)
      function setInert(isInert) {
        inertTargets.forEach(el => {
          try {
            if ('inert' in el) {
              el.inert = isInert;
            }
          } catch (e) {
            // ignore
          }
          if (isInert) {
            el.setAttribute('aria-hidden', 'true');
          } else {
            el.removeAttribute('aria-hidden');
          }
        });
      }

      // Open dialog; save last focused element and trap focus
      function openDialog(trigger) {
        if (dialog.hasAttribute('open')) return;
        lastFocused = trigger || document.activeElement;
        // showModal if available for native modality (keeps screen readers informed)
        if (typeof dialog.showModal === 'function') {
          dialog.showModal();
        } else {
          // fallback: add attribute and ensure visually appears
          dialog.setAttribute('open', '');
        }
        setInert(true);

        // Move focus to first focusable element inside dialog
        const focusable = getFocusable(dialog);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          // fallback: focus the dialog itself
          dialog.focus();
        }

        // Add keydown listener for focus trap and Escape
        document.addEventListener('keydown', handleKeyDown, true);
      }

      // Close dialog and restore state
      function closeDialog(returnFocus = true) {
        if (!dialog.hasAttribute('open')) return;
        try {
          if (typeof dialog.close === 'function') dialog.close();
          else dialog.removeAttribute('open');
        } finally {
          setInert(false);
          document.removeEventListener('keydown', handleKeyDown, true);
          if (returnFocus && lastFocused && typeof lastFocused.focus === 'function') {
            lastFocused.focus();
          }
        }
      }

      // Handle Tab focus trapping and Escape key
      function handleKeyDown(e) {
        if (!dialog.hasAttribute('open')) return;
        if (e.key === 'Escape') {
          e.preventDefault();
          closeDialog(true);
          return;
        }
        if (e.key === 'Tab') {
          const focusable = getFocusable(dialog);
          if (focusable.length === 0) {
            // No focusable elements; prevent tabbing out
            e.preventDefault();
            return;
          }
          const currentIndex = focusable.indexOf(document.activeElement);
          let nextIndex = currentIndex;
          if (e.shiftKey) {
            // Move backward
            if (currentIndex === -1 || currentIndex === 0) {
              nextIndex = focusable.length - 1;
            } else {
              nextIndex = currentIndex - 1;
            }
          } else {
            // Move forward
            if (currentIndex === -1 || currentIndex === focusable.length - 1) {
              nextIndex = 0;
            } else {
              nextIndex = currentIndex + 1;
            }
          }
          e.preventDefault();
          focusable[nextIndex].focus();
        }
      }

      // Close when clicking on the backdrop (dialog element itself)
      dialog.addEventListener('click', (event) => {
        // Only close if the click is directly on the backdrop (in the dialog element)
        if (event.target === dialog) {
          closeDialog(true);
        }
      });

      // Button handlers
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openDialog(e.currentTarget);
        });
      });

      closeButton.addEventListener('click', () => closeDialog(true));
      cancelBtn.addEventListener('click', () => closeDialog(true));
      confirmBtn.addEventListener('click', () => {
        // Example action — provide accessible feedback via alert role
        // Do not rely on color alone to announce success; provide text.
        const live = document.createElement('div');
        live.setAttribute('role', 'status');
        live.setAttribute('aria-live', 'polite');
        live.style.position = 'absolute';
        live.style.left = '-9999px';
        live.textContent = 'Action confirmed.';
        document.body.appendChild(live);
        setTimeout(()=> document.body.removeChild(live), 2000);

        closeDialog(true);
      });

      // Ensure dialog cannot be focused when not open (for some UA quirks)
      // Provide keyboard access to the dialog itself if needed
      dialog.addEventListener('cancel', (e) => {
        // Prevent default closing behavior for the native dialog "cancel" and instead run our close handler
        e.preventDefault();
        closeDialog(true);
      });

      // For safety, ensure tab order follows DOM order on page load
      // and there are no keyboard traps when the dialog is closed.
      // (No-op here, but left as a reminder / checkpoint.)

      // Expose functions for debugging (optional)
      window.__accessibleModal = {
        open: openDialog,
        close: closeDialog,
        dialog: dialog
      };
    })();
  </script>
</body>
</html>