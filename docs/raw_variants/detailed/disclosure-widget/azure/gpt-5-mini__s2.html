<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible expand/collapse examples - Widgets - Demo</title>
  <style>
    /* Design tokens (use tokens for all UI colors) */
    :root{
      --color-bg: #ffffff;
      --color-text: #0b0b0b;
      --color-muted-text: #334155;
      --color-link: #0b5fff;
      --color-border: #d1d5db;
      --color-focus: #0b5fff;
      --color-danger: #b91c1c;
      --max-width: 900px;
      --radius: 8px;
      --gap: 16px;
      --control-padding: 12px 16px;
      --shadow: 0 1px 2px rgba(16,24,40,0.05);
    }

    /* Basic reset + layout */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      line-height:1.4;
      color:var(--Color-text, var(--color-text));
      background:var(--color-bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .page {
      width:100%;
      max-width:var(--max-width);
    }

    header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }

    /* Skip link pattern (visible only on focus) */
    .sr-only:not(:focus):not(:active) {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }

    header h1{
      font-size:1rem;
      margin:0;
      color:var(--color-muted-text);
    }

    main{outline:none}

    h1.page-title{
      font-size:1.4rem;
      margin:0 0 12px 0;
      color:var(--color-text);
    }

    p.lead{
      margin:0 0 18px 0;
      color:var(--color-muted-text);
      font-size:0.95rem;
    }

    /* Examples */
    .example{
      border:1px solid var(--color-border);
      border-radius:var(--radius);
      padding:12px;
      margin-bottom:16px;
      background: linear-gradient(180deg, rgba(255,255,255,1), rgba(250,250,251,1));
      box-shadow: var(--shadow);
      min-width:0; /* allow flex children to shrink properly */
    }

    .example h2{
      margin:0 0 8px 0;
      font-size:1rem;
      color:var(--color-text);
    }

    /* Expander button */
    .expander{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      text-align:left;
      background:none;
      border:1px solid var(--color-border);
      padding:var(--control-padding);
      border-radius:6px;
      font-size:1rem;
      color:var(--color-text);
      cursor:pointer;
      transition:box-shadow 120ms ease, border-color 120ms ease, transform 120ms ease;
    }

    .expander:hover{
      border-color: color-mix(in srgb, var(--color-border) 60%, var(--color-link) 40%);
    }

    .expander:active{
      transform:translateY(1px);
    }

    /* Focus styles: must be visible and meet contrast requirements */
    .expander:focus{
      outline:3px solid var(--color-focus);
      outline-offset:2px;
      box-shadow:0 0 0 3px rgba(11,95,255,0.12);
    }

    /* Icon (rotates) */
    .expander .icon{
      width:18px;
      height:18px;
      flex:0 0 18px;
      display:inline-block;
      transition: transform 180ms ease;
      color:var(--color-muted-text);
    }
    .expander[aria-expanded="true"] .icon{
      transform:rotate(180deg);
      color:var(--color-link);
    }

    /* Summary text and meta */
    .summary{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:4px;
      flex:1 1 auto;
      min-width:0; /* important for truncation/wrapping */
    }

    .summary .title{
      font-weight:600;
      color:var(--color-text);
      white-space:normal;
      overflow-wrap:anywhere;
    }

    .summary .meta{
      font-size:0.9rem;
      color:var(--color-muted-text);
    }

    /* Controlled content region (class "details" required by spec) */
    .details{
      margin-top:12px;
      padding:12px;
      border-radius:6px;
      border:1px dashed var(--color-border);
      background: #fff;
      color:var(--color-text);
      overflow-wrap:anywhere;
    }

    /* Ensure hidden content isn't focusable/visible */
    [hidden]{display:none !important}

    /* Demo specific: make form controls accessible and visible */
    .details input[type="text"], .details a, .details button{
      font-size:0.95rem;
    }

    .details a{
      color:var(--color-link);
    }

    .controls-row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .controls-row > * { min-width:0; }

    label{
      font-size:0.9rem;
      color:var(--color-muted-text);
      display:block;
      margin-bottom:6px;
    }

    input[type="text"]{
      padding:8px 10px;
      border:1px solid var(--color-border);
      border-radius:6px;
      background:transparent;
      color:var(--color-text);
      min-width:200px;
    }

    input[type="text"]:focus{
      outline:3px solid var(--color-focus);
      outline-offset:2px;
    }

    /* Small helper text */
    .visually-muted{
      font-size:0.875rem;
      color:var(--color-muted-text);
    }

    /* Responsive behavior: reflow at small sizes */
    @media (max-width:420px){
      body{padding:12px}
      .controls-row{flex-direction:column; align-items:stretch}
      .example{padding:10px}
      .expander{padding:10px}
    }

    /* Forced colors / high contrast adjustments */
    @media (forced-colors: active) {
      .expander:focus {
        outline: 3px solid Highlight;
      }
      .expander {
        border-color: ButtonBorder;
        background: Canvas;
        color: ButtonText;
      }
      .details {
        border-color: ButtonBorder;
        background: Canvas;
        color: CanvasText;
      }
    }

    /* Make links clearly identifiable (not only by color) */
    a{
      text-decoration:underline;
    }

    /* Utility: ensure long inline strings wrap */
    .break-anywhere { overflow-wrap:anywhere; }
  </style>
</head>
<body>
  <div class="page" role="document">
    <header>
      <a href="#maincontent" class="sr-only">Skip to main content</a>
      <h1 aria-hidden="true">Component demos</h1>
    </header>

    <nav aria-label="Demo navigation" style="margin-bottom:12px;">
      <ul style="margin:0;padding:0;list-style:none;display:flex;gap:8px;">
        <li><a href="#expander-basic" style="color:var(--color-link)">Basic expander</a></li>
        <li><a href="#expander-controls" style="color:var(--color-link)">Expander with controls</a></li>
      </ul>
    </nav>

    <main id="maincontent" tabindex="-1">
      <h1 class="page-title">Accessible expand / collapse widget examples</h1>
      <p class="lead">These examples show an accessible pattern for a button that expands or collapses a content region. Each widget is wrapped in a container with class "example" and the controlled content container uses the required class "details".</p>

      <!-- Example 1: Basic -->
      <div class="example" id="expander-basic">
        <h2>Basic expander</h2>

        <!-- The expander button controls the content region with aria-expanded and aria-controls -->
        <button
          id="expander-btn-1"
          class="expander"
          aria-expanded="false"
          aria-controls="expander-panel-1"
          type="button"
        >
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M7 10l5 5 5-5z" fill="currentColor"/>
          </svg>

          <div class="summary">
            <span class="title">About this item</span>
            <span class="meta">Click to reveal a short description</span>
          </div>
        </button>

        <!-- Controlled content container must have class "details" -->
        <div
          id="expander-panel-1"
          class="details"
          role="region"
          aria-labelledby="expander-btn-1"
          hidden
        >
          <p class="break-anywhere">This item is made from responsibly sourced materials and has been tested to meet industry safety standards. The short description wraps and reflows for small viewports; long words will also break to avoid horizontal scrolling.</p>
          <p class="visually-muted">Status: <strong>In stock</strong></p>
        </div>
      </div>

      <!-- Example 2: Expander with interactive content inside -->
      <div class="example" id="expander-controls">
        <h2>Expander with interactive controls</h2>

        <button
          id="expander-btn-2"
          class="expander"
          aria-expanded="false"
          aria-controls="expander-panel-2"
          type="button"
        >
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M7 10l5 5 5-5z" fill="currentColor"/>
          </svg>

          <div class="summary">
            <span class="title">Advanced options</span>
            <span class="meta">Contains focusable elements; when collapsed, those elements are not reachable by keyboard or assistive tech.</span>
          </div>
        </button>

        <div
          id="expander-panel-2"
          class="details"
          role="region"
          aria-labelledby="expander-btn-2"
          hidden
        >
          <form id="demo-form-1">
            <div style="margin-bottom:10px;">
              <label for="display-name">Display name</label>
              <input id="display-name" name="displayName" type="text" value="Alex" />
            </div>

            <div class="controls-row" style="margin-bottom:8px;">
              <a href="https://example.com/profile" target="_blank" rel="noopener noreferrer">View profile</a>
              <button type="button" id="save-btn">Save changes</button>
            </div>

            <p class="visually-muted">Tip: Press Escape while focus is inside this region to collapse it and return focus to the toggle button.</p>
          </form>
        </div>
      </div>

      <footer style="margin-top:18px;color:var(--color-muted-text);font-size:0.9rem;">
        <p style="margin:0">Notes: Controls are keyboard operable. The expander button uses aria-expanded and aria-controls; the content region uses role="region" and aria-labelledby. Decorative icons use currentColor and are hidden from assistive technology.</p>
      </footer>
    </main>
  </div>

  <script>
    (function(){
      // Utility: returns NodeList of all expander buttons
      const expanders = document.querySelectorAll('.expander[aria-controls]');

      function collapse(panel, button) {
        if (!panel || !button) return;
        panel.hidden = true;
        button.setAttribute('aria-expanded', 'false');
        // move focus back to button if focus is inside panel
        if (panel.contains(document.activeElement)) {
          button.focus();
        }
      }

      function expand(panel, button) {
        if (!panel || !button) return;
        panel.hidden = false;
        button.setAttribute('aria-expanded', 'true');
      }

      // Wire up click handlers
      expanders.forEach((btn) => {
        const panelId = btn.getAttribute('aria-controls');
        const panel = document.getElementById(panelId);

        // Ensure relationship for assistive tech
        if (panel) {
          panel.setAttribute('aria-hidden', panel.hidden ? 'true' : 'false');
        }

        btn.addEventListener('click', function(e){
          const isExpanded = btn.getAttribute('aria-expanded') === 'true';
          if (isExpanded) {
            collapse(panel, btn);
          } else {
            expand(panel, btn);
            // Move focus to first focusable element inside panel if desired?
            // Avoid forcing focus; keep user in control. We leave focus on the button per ARIA Authoring Practices.
          }
          if (panel) panel.setAttribute('aria-hidden', panel.hidden ? 'true' : 'false');
        });

        // Support Enter and Space are already supported by button element natively.
      });

      // Global Escape handling: if focus is inside an open panel, collapse it and return focus to its button
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape' || e.key === 'Esc') {
          // find any panel that is open and contains the active element (or focus is on the button)
          let handled = false;
          expanders.forEach((btn) => {
            const panelId = btn.getAttribute('aria-controls');
            const panel = document.getElementById(panelId);
            if (!panel) return;
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            if (expanded && panel.contains(document.activeElement)) {
              collapse(panel, btn);
              handled = true;
            }
          });
          if (handled) {
            e.preventDefault();
            e.stopPropagation();
          }
        }
      });

      // Ensure that if JavaScript is enabled, aria-hidden tracks the hidden attribute for all panels
      const panels = document.querySelectorAll('.details');
      const observer = new MutationObserver(function(mutations){
        for (const m of mutations){
          if (m.type === 'attributes' && m.attributeName === 'hidden') {
            const target = m.target;
            target.setAttribute('aria-hidden', target.hasAttribute('hidden') ? 'true' : 'false');
          }
        }
      });
      panels.forEach(p => observer.observe(p, { attributes: true }));

      // Final: ensure no interactive element remains tabbable when its containing panel is hidden.
      // Hidden attribute on the panel ensures descendants are not focusable and hidden from AT,
      // but some browsers may not enforce this strictly for inert script-driven focus; add a safeguard:
      function updateTabbableState(){
        panels.forEach(panel => {
          const focusables = panel.querySelectorAll('a, button, input, textarea, select, [tabindex]');
          const disabled = panel.hasAttribute('hidden');
          focusables.forEach(el => {
            // store original tabindex if not already stored
            if (!el.hasAttribute('data-orig-tabindex')) {
              const t = el.getAttribute('tabindex');
              el.setAttribute('data-orig-tabindex', t === null ? 'none' : t);
            }
            if (disabled) {
              // remove from tab order
              el.setAttribute('tabindex', '-1');
            } else {
              const orig = el.getAttribute('data-orig-tabindex');
              if (orig === 'none') {
                el.removeAttribute('tabindex');
              } else {
                el.setAttribute('tabindex', orig);
              }
            }
          });
        });
      }
      // run initially and whenever a panel's hidden attribute changes
      updateTabbableState();
      observer.disconnect();
      panels.forEach(p => {
        new MutationObserver(function(muts){
          muts.forEach(m => {
            if (m.type === 'attributes' && m.attributeName === 'hidden') {
              updateTabbableState();
            }
          });
        }).observe(p, { attributes: true });
      });
    })();
  </script>
</body>
</html>