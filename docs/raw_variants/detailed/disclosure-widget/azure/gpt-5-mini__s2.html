<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible expand/collapse examples - Patterns - Demo</title>
  <style>
    /*
      Design tokens (safe defaults)
      - Use only these tokens for color decisions.
    */
    :root{
      --color-bg: #ffffff;
      --color-surface: #f7f8fa;
      --color-text: #0b1220; /* very dark for contrast */
      --color-muted-text: #3b4754; /* meets contrast for body text */
      --color-border: #d1d9e0;
      --color-primary: #0047cc;
      --color-focus: #ffb703; /* high contrast focus ring against dark text surfaces */
      --color-danger: #b00020;
      --color-success: #0a7a3d;
      --radius: 8px;
      --container-max-width: 840px;
      --space: 16px;
      --shadow: 0 1px 2px rgba(11,18,32,0.06);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: light dark;
    }

    /* Basic layout and accessibility helpers */
    * { box-sizing: border-box; }
    html,body { height: 100%; margin: 0; background: var(--color-bg); color: var(--color-text); }
    a { color: var(--color-primary); text-decoration: underline; }
    header, nav, main, footer { display: block; }
    .container {
      max-width: var(--container-max-width);
      margin: 0 auto;
      padding: calc(var(--space) * 1.5);
    }

    /* Skip link - visible when focused */
    .sr-only {
      clip: rect(0 0 0 0);
      clip-path: inset(50%);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    .sr-only:focus,
    .sr-only:active {
      position: static;
      clip: auto;
      clip-path: none;
      width: auto;
      height: auto;
      margin: 0 0 var(--space) 0;
      padding: 0.5rem 1rem;
      background: var(--color-surface);
      border-radius: 4px;
      box-shadow: var(--shadow);
    }

    header {
      border-bottom: 1px solid var(--color-border);
      background: linear-gradient(180deg, rgba(0,0,0,0.02), transparent);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: var(--space);
    }
    .logo {
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--color-primary);
      color: white;
      border-radius: 8px;
      flex: 0 0 40px;
      font-weight: 700;
    }
    nav.primary {
      display: flex;
      gap: 12px;
      padding: 0 var(--space) var(--space) var(--space);
    }
    nav.primary a {
      padding: 6px 10px;
      border-radius: 6px;
      color: var(--color-primary);
      text-decoration: none;
    }
    nav.primary a:focus {
      outline: 3px solid var(--color-focus);
      outline-offset: 2px;
    }

    main {
      padding: calc(var(--space) * 1.5) 0;
      min-height: 60vh;
    }
    h1 { font-size: 1.5rem; margin: 0 0 var(--space) 0; }
    p.lead { color: var(--color-muted-text); margin-top: 0; }

    /* Examples */
    .examples { display: grid; gap: var(--space); }
    .example {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: var(--space);
      box-shadow: var(--shadow);
    }

    /* Expand/collapse widget */
    .expander {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .expander .toggle {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: transparent;
      border: 1px solid transparent;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 1rem;
      color: var(--color-text);
      cursor: pointer;
    }

    .expander .toggle:focus {
      outline: 3px solid var(--color-focus);
      outline-offset: 2px;
    }

    .expander .toggle .icon {
      width: 18px;
      height: 18px;
      display: inline-block;
      flex: 0 0 18px;
    }

    /* Visual indicator for expanded state */
    .toggle[aria-expanded="true"] {
      background: white;
      border-color: var(--color-border);
      box-shadow: var(--shadow);
    }

    /* Content region (controlled) */
    .details {
      margin-left: 40px;
      margin-top: 8px;
      padding: 12px;
      border-left: 3px solid var(--color-border);
      background: white;
      border-radius: 6px;
      max-width: 100%;
      overflow-wrap: anywhere; /* handle long tokens/URLs */
    }

    /* When content is hidden we set display: none via [hidden] attribute so it is removed from layout and inaccessible */
    .details[hidden] { display: none; }

    /* Sample inner elements */
    .details p { margin-top: 0; color: var(--color-muted-text); line-height: 1.4; }
    .details .controls { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
    .btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--color-border);
      background: white;
      color: var(--color-text);
      cursor: pointer;
      font-size: 0.95rem;
    }
    .btn:focus { outline: 3px solid var(--color-focus); outline-offset: 2px; }
    .btn.primary {
      background: var(--color-primary);
      color: white;
      border-color: transparent;
    }
    .note {
      font-size: 0.875rem;
      color: var(--color-muted-text);
    }

    /* Responsive: ensure single column at 320px */
    @media (max-width: 600px) {
      .expander { flex-direction: column; align-items: stretch; }
      .expander .toggle { width: 100%; justify-content: space-between; }
      .details { margin-left: 0; }
      .container { padding: 12px; }
    }

    /* Forced colors for High Contrast / Windows High Contrast mode */
    @media (forced-colors: active) {
      :root {
        /* do not override system colors */
      }
      .expander .toggle:focus,
      .btn:focus {
        outline: 2px solid ButtonText;
      }
      .details {
        border-left: 4px solid ButtonText;
        background: Canvas;
      }
      .expander .toggle {
        background: Canvas;
        color: ButtonText;
        border-color: ButtonText;
      }
      .btn {
        background: ButtonFace;
        color: ButtonText;
        border-color: ButtonText;
      }
      .btn.primary {
        background: Highlight;
        color: HighlightText;
      }
    }

    /* Focus visible polyfill for browsers without :focus-visible */
    .toggle:focus:not(.focus-visible), .btn:focus:not(.focus-visible) {
      /* intentionally left; modern browsers support :focus-visible */
    }
  </style>
</head>
<body>
  <header>
    <a href="#maincontent" class="sr-only">Skip to main content</a>
    <div class="container brand" aria-hidden="false">
      <div class="logo" aria-hidden="true">Ex</div>
      <div>
        <strong>Patterns</strong>
        <div class="note" style="margin-top:4px;">Accessible expand/collapse examples</div>
      </div>
    </div>
    <nav class="container primary" aria-label="Primary">
      <a href="#" role="link">Overview</a>
      <a href="#" role="link">Components</a>
      <a href="#" role="link">Guidelines</a>
    </nav>
  </header>

  <main id="maincontent" tabindex="-1" class="container" >
    <h1>Accessible expand/collapse widget examples</h1>
    <p class="lead">Each example demonstrates an expand/collapse control. Controls are keyboard operable, have visible labels, and do not rely on color alone to convey state.</p>

    <section class="examples" aria-labelledby="examples-heading">
      <h2 id="examples-heading" style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;">Examples</h2>

      <!-- Example 1: Simple content -->
      <div class="example" aria-label="Example: Simple expand collapse">
        <div class="expander" >
          <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="18" height="18">
              <path d="M12 15.5l-7-7 1.4-1.4L12 12.7l5.6-5.6L19 8.5z" fill="currentColor"/>
            </svg>
            <span>Show more details</span>
          </button>
        </div>

        <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" hidden>
          <p>
            This content is controlled by the "Show more details" button. When collapsed, this region is hidden from all users and removed from the tab order. When expanded, it is keyboard navigable and accessible to assistive technologies.
          </p>
          <div class="controls" aria-hidden="false">
            <button class="btn" type="button">Action</button>
            <button class="btn primary" type="button">Primary action</button>
          </div>
        </div>
      </div>

      <!-- Example 2: Longer content with nested focusable items -->
      <div class="example" aria-label="Example: Expand collapse with form controls">
        <div class="expander">
          <button class="toggle" id="toggle-2" aria-expanded="false" aria-controls="details-2">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="18" height="18">
              <path d="M12 8.5l7 7-1.4 1.4L12 11.3 6.4 16.9 5 15.5z" fill="currentColor"/>
            </svg>
            <span>Show account settings</span>
          </button>
        </div>

        <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" hidden>
          <p class="note">These settings are for demonstration. All form fields have labels and inline help.</p>

          <form id="settings-form" onsubmit="return false;">
            <div style="display:flex;flex-direction:column;gap:8px;max-width:420px;">
              <label for="display-name">Display name</label>
              <input id="display-name" name="display-name" type="text" style="padding:8px;border-radius:6px;border:1px solid var(--color-border);" aria-describedby="display-name-help" />

              <div id="display-name-help" class="note">This name is shown on your public profile.</div>

              <label for="email-notify">Email notifications</label>
              <select id="email-notify" name="email-notify" style="padding:8px;border-radius:6px;border:1px solid var(--color-border);">
                <option value="all">All activity</option>
                <option value="mentions">Only mentions</option>
                <option value="none">None</option>
              </select>

              <div style="display:flex;gap:8px;margin-top:6px;">
                <button class="btn primary" type="submit">Save</button>
                <button class="btn" type="button">Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </div>

    </section>
  </main>

  <footer class="container" role="contentinfo" aria-label="Footer">
    <p class="note" style="margin:0;">Demo footer â€¢ This page includes accessible expand/collapse examples. Manual accessibility testing is recommended.</p>
  </footer>

  <script>
    // Accessible expand/collapse behavior
    (function () {
      // Utility to toggle details by id
      function toggle(toggleButton, detailsEl, expand) {
        var isExpanded = expand === undefined ? (toggleButton.getAttribute('aria-expanded') === 'true') : expand;
        // newState = !isExpanded
        var newState = !isExpanded;

        toggleButton.setAttribute('aria-expanded', String(newState));
        if (newState) {
          // show
          detailsEl.removeAttribute('hidden');
          detailsEl.setAttribute('aria-hidden', 'false');
        } else {
          // hide
          detailsEl.setAttribute('hidden', '');
          detailsEl.setAttribute('aria-hidden', 'true');
        }
      }

      // Initialize all pairs
      var toggles = document.querySelectorAll('.toggle[aria-controls]');
      toggles.forEach(function (btn) {
        var targetId = btn.getAttribute('aria-controls');
        var details = document.getElementById(targetId);
        if (!details) return;

        // Ensure initial hidden state matches aria-expanded
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (!expanded) {
          details.setAttribute('hidden', '');
          details.setAttribute('aria-hidden', 'true');
        } else {
          details.removeAttribute('hidden');
          details.setAttribute('aria-hidden', 'false');
        }

        // Click toggles
        btn.addEventListener('click', function (ev) {
          toggle(btn, details);
        });

        // If the user presses Escape inside the details, close and move focus back to the toggle
        details.addEventListener('keydown', function (ev) {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            ev.preventDefault();
            // close if open
            if (btn.getAttribute('aria-expanded') === 'true') {
              toggle(btn, details, true); // forces toggle so we end up collapsed
              btn.focus();
            }
          }
        });

        // If the toggle receives keydown for ArrowDown while focused, move focus into the first focusable element inside the details (if expanded)
        btn.addEventListener('keydown', function (ev) {
          if (ev.key === 'ArrowDown') {
            // If it is currently collapsed, expand
            var wasExpanded = btn.getAttribute('aria-expanded') === 'true';
            if (!wasExpanded) {
              toggle(btn, details);
              // Wait a tick for DOM
              setTimeout(function () {
                focusFirstFocusable(details);
              }, 0);
              ev.preventDefault();
            } else {
              // already expanded, move into content
              focusFirstFocusable(details);
              ev.preventDefault();
            }
          }
        });

        // Utility: when details is hidden, ensure no descendants are focusable
        // We rely on [hidden] which removes from layout and should prevent focusing.
        // For extra safety (in case of browsers that don't fully enforce), remove tabindex from focusable descendants.
        var rovingObserver = new MutationObserver(function () {
          manageFocusableDescendants(details);
        });
        rovingObserver.observe(details, { attributes: true, subtree: false, attributeFilter: ['hidden', 'aria-hidden'] });

        // Initial manage
        manageFocusableDescendants(details);
      });

      function focusFirstFocusable(root) {
        if (!root) return false;
        var focusableSelectors = [
          'a[href]:not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'input:not([disabled]):not([type="hidden"]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          '[tabindex]:not([tabindex^="-"]):not([disabled])'
        ];
        var first = root.querySelector(focusableSelectors.join(','));
        if (first) {
          first.focus();
          return true;
        }
        return false;
      }

      function manageFocusableDescendants(details) {
        if (!details) return;
        var hidden = details.hasAttribute('hidden') || details.getAttribute('aria-hidden') === 'true';
        var focusable = details.querySelectorAll('a, button, input, select, textarea, [tabindex]');
        focusable.forEach(function (el) {
          // Skip elements that are part of the document tab flow but not in the region
          if (hidden) {
            // If element has a positive tabindex or no tabindex, set data-prev-tabindex and set tabindex to -1 to prevent focusing
            if (el.hasAttribute('tabindex')) {
              el.dataset.prevTabindex = el.getAttribute('tabindex');
            }
            el.setAttribute('tabindex', '-1');
            // For form controls, disable them so screen readers don't announce them when hidden
            if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA' || el.tagName === 'BUTTON') {
              if (!el.hasAttribute('data-prev-disabled')) {
                el.dataset.prevDisabled = el.disabled ? 'true' : 'false';
              }
              el.disabled = true;
            }
          } else {
            // Restore previous tabindex if present
            if (el.dataset.prevTabindex !== undefined) {
              el.setAttribute('tabindex', el.dataset.prevTabindex);
              delete el.dataset.prevTabindex;
            } else {
              // remove the tabindex attribute we may have set earlier to allow normal tab order
              if (el.getAttribute('tabindex') === '-1') {
                el.removeAttribute('tabindex');
              }
            }
            if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA' || el.tagName === 'BUTTON') {
              if (el.dataset.prevDisabled !== undefined) {
                el.disabled = (el.dataset.prevDisabled === 'true');
                delete el.dataset.prevDisabled;
              } else {
                // leave original disabled state as-is
              }
            }
          }
        });
      }

      // Accessibility: ensure first invalid field focus (demo placeholder)
      // For real forms, on submit with client-side validation, focus the first invalid field and set aria-invalid.
      // This demo does not implement full form validation.
    })();
  </script>
</body>
</html>