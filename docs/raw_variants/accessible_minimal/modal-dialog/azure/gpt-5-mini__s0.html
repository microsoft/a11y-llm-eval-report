<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,.6);
      --dialog-bg: #fff;
      --dialog-width: 520px;
      --radius: 8px;
      --color: #111;
      --accent: #0066cc;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    /* Basic page layout */
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      color: var(--color);
      margin: 0;
      padding: 2rem;
      background: linear-gradient(180deg,#f7fbff 0%, #fff 100%);
      min-height: 100vh;
    }
    header, main, footer{
      max-width: 820px;
      margin: 0 auto 1.5rem;
    }
    h1{
      margin: 0 0 .25rem;
      font-size: 1.4rem;
    }
    p.lead{
      margin: 0 0 1rem;
      color: #334155;
    }

    /* Trigger */
    .trigger{
      display: inline-block;
      padding: .6rem .9rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid rgba(3,102,214,.15);
      background: linear-gradient(#0080ff, #0066cc);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(3,102,214,.18);
    }
    .trigger:focus{
      outline: 3px solid rgba(3,102,214,.25);
      outline-offset: 2px;
    }

    /* Modal overlay & dialog */
    .modal-overlay{
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      padding: 1.25rem;
      z-index: 9999;
    }
    .modal-overlay[hidden]{
      display: none;
    }
    .modal-dialog{
      width: min(var(--dialog-width), calc(100% - 2rem));
      background: var(--dialog-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1rem 1rem 1rem 1rem;
      max-height: 90vh;
      overflow: auto;
      outline: none;
    }
    .modal-header{
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: .5rem;
    }
    .modal-title{
      font-size: 1.125rem;
      margin: 0;
    }
    .modal-body{
      margin-top: .75rem;
      color: #123;
    }
    .modal-actions{
      margin-top: 1rem;
      display: flex;
      gap: .5rem;
      justify-content: flex-end;
    }
    .btn{
      padding: .5rem .75rem;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,.08);
      background: #f3f4f6;
      cursor: pointer;
      font-size: .95rem;
    }
    .btn.primary{
      background: var(--accent);
      color: #fff;
      border-color: rgba(0,0,0,.06);
    }
    .close-btn{
      background: transparent;
      border: none;
      color: #334155;
      font-size: 1rem;
      padding: .25rem;
      cursor: pointer;
      border-radius: 6px;
    }
    .close-btn:focus{
      outline: 3px solid rgba(3,102,214,.22);
    }

    /* Focus styles for elements inside the modal */
    .modal-dialog a, .modal-dialog button, .modal-dialog input, .modal-dialog select, .modal-dialog textarea {
      font: inherit;
    }
    .modal-dialog :focus{
      outline: 3px solid rgba(3,102,214,.18);
      outline-offset: 2px;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: no-preference){
      .modal-overlay{
        animation: fade .16s ease-out;
      }
      .modal-dialog{
        transform-origin: center;
        animation: pop .16s cubic-bezier(.2,.9,.2,1);
      }
      @keyframes fade{
        from{opacity:0}
        to{opacity:1}
      }
      @keyframes pop{
        from{opacity:0; transform: translateY(6px) scale(.995)}
        to{opacity:1; transform: translateY(0) scale(1)}
      }
    }

    /* Visually hidden (for accessibility) */
    .sr-only{
      position: absolute !important;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0 0 0 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>Modal Dialog Component — Example</h1>
    <p class="lead">This example demonstrates an accessible modal dialog. The dialog is closed by default. Use the button below to open it.</p>
  </header>

  <main id="page-main">
    <p>
      Example content on the page. When the dialog is open, page content is hidden from assistive technology.
    </p>

    <button class="trigger" id="openDialog">Open dialog</button>
  </main>

  <!-- Modal overlay / dialog (closed by default using hidden attribute) -->
  <div class="modal-overlay" id="modalOverlay" role="presentation" hidden>
    <div
      class="modal-dialog"
      id="exampleModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
      aria-describedby="modalDesc"
      tabindex="-1"
    >
      <div class="modal-header">
        <h2 id="modalTitle" class="modal-title">Subscribe to updates</h2>
        <button class="close-btn" id="dialogClose" aria-label="Close dialog">&times;</button>
      </div>

      <div id="modalDesc" class="modal-body">
        <p>
          Sign up to receive occasional updates about product releases and events.
        </p>

        <form id="signupForm">
          <label for="nameInput">Full name</label><br/>
          <input id="nameInput" name="name" type="text" autocomplete="name" required style="width:100%;padding:.5rem;margin-top:.25rem;border-radius:6px;border:1px solid #d1d5db;">
          <div style="height:.5rem"></div>
          <label for="emailInput">Email address</label><br/>
          <input id="emailInput" name="email" type="email" autocomplete="email" required style="width:100%;padding:.5rem;margin-top:.25rem;border-radius:6px;border:1px solid #d1d5db;" data-autofocus>
          <div class="modal-actions">
            <button type="button" class="btn" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn primary" id="submitBtn">Subscribe</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <footer>
    <p style="font-size:.9rem;color:#475569;">Footer content — more page content to demonstrate background.</p>
  </footer>

  <script>
    (function () {
      // Elements
      var triggers = Array.prototype.slice.call(document.querySelectorAll('.trigger'));
      var overlay = document.getElementById('modalOverlay');
      var dialog = document.getElementById('exampleModal');
      var closeBtn = document.getElementById('dialogClose');
      var cancelBtn = document.getElementById('cancelBtn');
      var pageMain = document.getElementById('page-main');
      var activeElementBeforeOpen = null;

      // Utility: get all focusable elements inside an element
      function getFocusableElements(container) {
        var focusableSelectors = [
          'a[href]:not([tabindex^="-"])',
          'area[href]',
          'input:not([disabled]):not([type="hidden"]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex^="-"])'
        ];
        return Array.prototype.slice.call(container.querySelectorAll(focusableSelectors.join(',')))
          .filter(function(el){ return el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement; });
      }

      // Open modal: manage ARIA, focus, and keyboard trapping
      function openModal(triggerEl) {
        if (!overlay.hasAttribute('hidden')) return;
        activeElementBeforeOpen = triggerEl || document.activeElement;

        // Show overlay + dialog
        overlay.removeAttribute('hidden');
        dialog.focus();

        // Hide main content from AT
        pageMain.setAttribute('aria-hidden', 'true');

        // Prevent body scrolling
        document.documentElement.style.overflow = 'hidden';

        // Move focus to first focusable element in dialog (or the dialog itself)
        var focusable = getFocusableElements(dialog);
        var autofocusEl = dialog.querySelector('[data-autofocus]');
        if (autofocusEl) {
          autofocusEl.focus();
        } else if (focusable.length) {
          focusable[0].focus();
        } else {
          dialog.focus();
        }

        // Add keydown listener for Escape and Tab trapping
        document.addEventListener('keydown', onKeyDown);
      }

      // Close modal: restore ARIA, focus, and listeners
      function closeModal() {
        if (overlay.hasAttribute('hidden')) return;
        overlay.setAttribute('hidden', '');
        pageMain.removeAttribute('aria-hidden');
        document.documentElement.style.overflow = '';

        // Return focus to the element that opened the dialog (if available)
        try {
          if (activeElementBeforeOpen && typeof activeElementBeforeOpen.focus === 'function') {
            activeElementBeforeOpen.focus();
          }
        } catch (e) {}

        document.removeEventListener('keydown', onKeyDown);
      }

      // Key handling: Escape closes, Tab traps focus inside dialog
      function onKeyDown(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trap
          var focusable = getFocusableElements(dialog);
          if (focusable.length === 0) {
            // No focusable elements: keep focus on dialog
            e.preventDefault();
            dialog.focus();
            return;
          }
          var first = focusable[0];
          var last = focusable[focusable.length - 1];
          var active = document.activeElement;

          if (e.shiftKey) {
            if (active === first || active === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (active === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Close when clicking the overlay (but not when clicking inside the dialog)
      overlay.addEventListener('click', function (event) {
        if (event.target === overlay) {
          closeModal();
        }
      });

      // Attach handlers
      triggers.forEach(function (btn) {
        btn.addEventListener('click', function () {
          openModal(btn);
        });
      });

      closeBtn.addEventListener('click', function () {
        closeModal();
      });

      cancelBtn.addEventListener('click', function () {
        closeModal();
      });

      // Submit handler - closes the dialog for demo, but could do form processing
      var signupForm = document.getElementById('signupForm');
      signupForm.addEventListener('submit', function (e) {
        e.preventDefault();
        // For a real app, validate and send data here.
        // Provide a small confirmation, then close modal.
        var name = document.getElementById('nameInput').value || 'Guest';
        alert('Thanks, ' + name + '! You are subscribed.');
        closeModal();
      });

      // If focus somehow goes outside the dialog while it's open, bring it back
      document.addEventListener('focusin', function (e) {
        if (!overlay.hasAttribute('hidden')) {
          if (!dialog.contains(e.target)) {
            // Redirect focus back into the dialog
            var focusable = getFocusableElements(dialog);
            if (focusable.length) focusable[0].focus();
            else dialog.focus();
          }
        }
      });
    })();
  </script>
</body>
</html>