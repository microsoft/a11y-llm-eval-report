<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0, 0, 0, 0.6);
      --dialog-bg: #fff;
      --max-width: 640px;
      --radius: 8px;
      --gap: 1rem;
      --focus: 3px solid #0b76ef;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #111;
      background: #f7f7f8;
    }

    header {
      padding: 1rem;
      background: white;
      border-bottom: 1px solid #e6e6e8;
    }

    main {
      padding: 1.25rem;
      max-width: 900px;
      margin: 1rem auto;
    }

    .trigger {
      display: inline-block;
      padding: 0.5rem 0.75rem;
      background: #0b76ef;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    .trigger:focus {
      outline: none;
      box-shadow: var(--focus);
    }

    /* Modal overlay */
    .modal {
      position: fixed;
      inset: 0;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      z-index: 1000;
    }
    .modal[aria-hidden="false"] {
      display: flex;
    }

    /* Dialog container */
    .dialog {
      background: var(--dialog-bg);
      width: calc(100% - 2rem);
      max-width: var(--max-width);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transform: translateY(-6px);
      transition: transform 160ms ease, opacity 160ms ease;
    }

    .modal[aria-hidden="false"] .dialog {
      transform: translateY(0);
    }

    .dialog h2 {
      margin: 0 0 0.5rem 0;
      font-size: 1.125rem;
    }

    .dialog p {
      margin: 0 0 1rem 0;
      color: #333;
      line-height: 1.4;
    }

    .form-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .form-row label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      width: 100%;
    }

    input[type="text"], input[type="email"] {
      padding: 0.5rem;
      border: 1px solid #cfcfcf;
      border-radius: 6px;
      font-size: 1rem;
      margin-top: 0.35rem;
    }

    .actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .btn.primary {
      background: #0b76ef;
      color: white;
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid #d0d0d0;
    }

    .btn:focus {
      outline: none;
      box-shadow: var(--focus);
    }

    /* Visually hidden helper */
    .sr-only {
      position: absolute !important;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0 0 0 0);
      white-space: nowrap;
      border: 0;
    }

    /* Prevent background scrolling when modal open */
    body.no-scroll {
      overflow: hidden;
    }

    /* Responsive tweaks */
    @media (min-width: 640px) {
      .dialog {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="page-title">Example Page</h1>
  </header>

  <main id="main-content" tabindex="-1" aria-labelledby="page-title">
    <p>Welcome to the demo page. The modal is closed by default. Use the "Open Modal" button to open it.</p>
    <button class="trigger" id="openModalButton">Open Modal</button>

    <section aria-label="Additional content" style="margin-top:1rem;">
      <p>This content is part of the background and will be hidden from assistive technologies when the modal is open.</p>
      <a href="#">Some focusable link</a>
    </section>
  </main>

  <!-- Modal: closed by default (hidden, aria-hidden="true") -->
  <div class="modal"
       id="modal"
       role="presentation"
       aria-hidden="true"
       hidden>
    <!-- dialog role and aria-modal to indicate an active modal dialog -->
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialog-title" aria-describedby="dialog-desc" tabindex="-1">
      <h2 id="dialog-title">Contact us</h2>
      <p id="dialog-desc">Fill out this short form and press Submit, or press Close to dismiss.</p>

      <form id="contactForm" action="#" novalidate>
        <div class="form-row">
          <label>
            Your name
            <input type="text" name="name" id="name" autocomplete="name" />
          </label>
        </div>
        <div class="form-row">
          <label>
            Email
            <input type="email" name="email" id="email" autocomplete="email" />
          </label>
        </div>

        <div class="actions">
          <button type="button" class="btn ghost" id="closeModalButton" aria-label="Close dialog">Close</button>
          <button type="submit" class="btn primary">Submit</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('modal');
      const dialog = modal.querySelector('.dialog');
      const openTriggers = document.querySelectorAll('.trigger');
      const closeButton = document.getElementById('closeModalButton');
      const main = document.getElementById('main-content');
      let lastFocused = null;

      // Utility: get all focusable elements within an element
      const focusableSelectors = [
        'a[href]:not([tabindex="-1"])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
        'select:not([disabled]):not([tabindex="-1"])',
        'textarea:not([disabled]):not([tabindex="-1"])',
        'button:not([disabled]):not([tabindex="-1"])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      function getFocusable(el) {
        return Array.from(el.querySelectorAll(focusableSelectors))
          .filter((node) => node.offsetWidth > 0 || node.offsetHeight > 0 || node === document.activeElement);
      }

      function openModal(trigger) {
        lastFocused = trigger || document.activeElement;
        // show the modal visually and for assistive tech
        modal.removeAttribute('hidden');
        modal.setAttribute('aria-hidden', 'false');
        // hide the main content from assistive tech
        main.setAttribute('aria-hidden', 'true');

        // prevent background scroll
        document.body.classList.add('no-scroll');

        // For browsers that support inert, make main inert as well
        if ('inert' in HTMLElement.prototype) {
          main.inert = true;
        }

        // move focus into dialog
        const focusable = getFocusable(dialog);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          dialog.focus();
        }

        // set up event listeners for keyboard and clicks
        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal() {
        modal.setAttribute('aria-hidden', 'true');
        modal.setAttribute('hidden', '');
        main.removeAttribute('aria-hidden');

        if ('inert' in HTMLElement.prototype) {
          main.inert = false;
        }

        document.body.classList.remove('no-scroll');

        // restore focus to the element that opened the dialog
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }

        document.removeEventListener('keydown', onKeyDown);
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          // focus trap
          const focusable = getFocusable(dialog);
          if (focusable.length === 0) {
            // nothing to focus; keep focus on dialog container
            e.preventDefault();
            dialog.focus();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            // shift + tab
            if (document.activeElement === first || document.activeElement === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            // tab
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // open buttons (those with class "trigger")
      openTriggers.forEach((btn) => {
        btn.addEventListener('click', function (e) {
          openModal(this);
        });
      });

      // close button inside the modal
      closeButton.addEventListener('click', function () {
        closeModal();
      });

      // clicking on the overlay backdrop closes the modal (but clicks inside dialog do not)
      modal.addEventListener('click', function (e) {
        if (e.target === modal) {
          closeModal();
        }
      });

      // handle form submit for demo (prevent navigation)
      const form = document.getElementById('contactForm');
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        // simulate a submission then close
        closeModal();
        // Return focus to the trigger and announce success in a polite way
        const successMessage = document.createElement('div');
        successMessage.className = 'sr-only';
        successMessage.setAttribute('role', 'status');
        successMessage.textContent = 'Form submitted successfully.';
        document.body.appendChild(successMessage);
        setTimeout(() => {
          if (successMessage && successMessage.parentNode) {
            successMessage.parentNode.removeChild(successMessage);
          }
        }, 2000);
      });

      // Ensure modal stays hidden on initial load even if JS disabled (hidden attribute used)
      // No further action needed here.
    }());
  </script>
</body>
</html>