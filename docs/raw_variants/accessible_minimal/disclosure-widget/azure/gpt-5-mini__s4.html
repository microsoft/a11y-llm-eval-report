<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent: #0b5fff;
      --bg: #fff;
      --muted: #6b7280;
      --border: #e6e9ee;
      --radius: 8px;
      --duration: 260ms;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      color: #0f1724;
      padding: 2rem;
      background: #f7f8fb;
    }

    h1{
      margin: 0 0 1rem 0;
      font-size: 1.4rem;
    }

    p.lead{
      margin: 0 0 1.5rem 0;
      color: var(--muted);
      max-width: 50rem;
    }

    .example{
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      margin: 1rem 0;
      box-shadow: 0 1px 0 rgba(15,23,36,0.02);
    }

    .disclosure {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .disclosure .toggle {
      all: unset;
      box-sizing: border-box;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      background: transparent;
      padding: .5rem .75rem;
      border-radius: calc(var(--radius) - 4px);
      cursor: pointer;
      border: 1px solid transparent;
      font-weight: 600;
      color: #06233a;
    }

    .disclosure .toggle:hover{
      background: rgba(11,95,255,0.06);
    }

    .disclosure .toggle:focus{
      outline: 3px solid rgba(11,95,255,0.18);
      outline-offset: 2px;
    }

    .toggle .chev{
      width: 1rem;
      height: 1rem;
      display: inline-block;
      transition: transform var(--duration) ease;
      flex-shrink: 0;
    }

    /* rotate when expanded (via attribute on button) */
    .toggle[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    .details{
      margin-top: 0.75rem;
      overflow: hidden;
      border-radius: calc(var(--radius) - 6px);
      transition: max-height var(--duration) ease, opacity var(--duration) ease;
      max-height: 0; /* collapsed by default (aria-hidden should match) */
      opacity: 0;
      background: #fbfdff;
      border: 1px solid #f0f4ff;
      padding: 0 0.75rem;
    }

    /* visible state when aria-hidden="false" */
    .details[aria-hidden="false"]{
      opacity: 1;
    }

    .details-inner{
      padding: 1rem 0;
    }

    .summary-line{
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0 0 0.5rem 0;
    }

    .visually-hidden{
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
      border: 0; padding: 0; margin: -1px;
    }

    /* Respect user reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .details{
        transition: none;
      }
      .toggle .chev{
        transition: none;
      }
    }

    /* small responsive tweaks */
    @media (max-width: 480px){
      body{padding: 1rem;}
      .disclosure .toggle{padding: .5rem;}
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget (Accessible)</h1>
  <p class="lead">These examples show an accessible expand/collapse (disclosure) pattern. Each widget is wrapped in a container with the class "example". The revealed content container uses the class "details". Use Enter/Space to toggle the buttons.</p>

  <!-- Example 1: Collapsed by default -->
  <div class="example" aria-labelledby="ex1-label">
    <h2 id="ex1-label" class="visually-hidden">Example 1: Collapsed by default</h2>

    <div class="disclosure">
      <button id="ex1-toggle"
              class="toggle"
              aria-expanded="false"
              aria-controls="ex1-details"
              aria-describedby="ex1-desc">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M8.5 6.5l7 5-7 5z" fill="currentColor"></path>
        </svg>
        More information
      </button>
      <div id="ex1-desc" class="summary-line" aria-hidden="true">Click to reveal a short explanation.</div>
    </div>

    <div id="ex1-details"
         class="details"
         role="region"
         aria-labelledby="ex1-toggle"
         aria-hidden="true"
         tabindex="-1">
      <div class="details-inner">
        <p><strong>Why this is accessible:</strong> The button exposes aria-expanded and aria-controls attributes. The content region has role="region" and aria-labelledby to associate it with the button. Keyboard users can toggle with Enter or Space. Screen readers will announce the expanded state.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Expanded by default -->
  <div class="example" aria-labelledby="ex2-label">
    <h2 id="ex2-label" class="visually-hidden">Example 2: Expanded by default</h2>

    <div class="disclosure">
      <button id="ex2-toggle"
              class="toggle"
              aria-expanded="true"
              aria-controls="ex2-details"
              aria-describedby="ex2-desc">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M8.5 6.5l7 5-7 5z" fill="currentColor"></path>
        </svg>
        Product details
      </button>
      <div id="ex2-desc" class="summary-line" aria-hidden="true">Expanded to show product specs.</div>
    </div>

    <div id="ex2-details"
         class="details"
         role="region"
         aria-labelledby="ex2-toggle"
         aria-hidden="false"
         tabindex="-1"
         style="max-height: 1000px;">
      <div class="details-inner">
        <p><strong>Specifications</strong></p>
        <ul>
          <li>Weight: 420g</li>
          <li>Dimensions: 120 × 70 × 8 mm</li>
          <li>Battery life: up to 18 hours</li>
        </ul>
        <p>These details are visible by default to illustrate a widget that starts expanded.</p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Utility: returns true if user prefers reduced motion
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function setupToggle(button) {
        const detailsId = button.getAttribute('aria-controls');
        const details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure that JS-managed max-height reflects initial aria-hidden state.
        // If aria-hidden="false" initially, expand fully; otherwise collapse.
        function setInitialState() {
          const expanded = button.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            details.setAttribute('aria-hidden', 'false');
            // Set max-height to allow animation space; we remove inline height after transition end.
            details.style.maxHeight = details.scrollHeight + 'px';
            // After a tick, remove inline style so it can size naturally (only if not reduced motion)
            if (!reduceMotion) {
              requestAnimationFrame(() => {
                // remove inline style after a short delay so CSS transitions when toggling later will work from auto height
                setTimeout(() => { details.style.maxHeight = ''; }, 250);
              });
            } else {
              details.style.maxHeight = '';
            }
          } else {
            details.setAttribute('aria-hidden', 'true');
            details.style.maxHeight = '0';
          }
        }

        setInitialState();

        // Toggle function with smooth height transition
        function toggle() {
          const isExpanded = button.getAttribute('aria-expanded') === 'true';
          if (isExpanded) {
            // collapse
            button.setAttribute('aria-expanded', 'false');
            details.setAttribute('aria-hidden', 'true');

            if (reduceMotion) {
              details.style.maxHeight = '0';
            } else {
              // start from current computed height
              const startHeight = details.scrollHeight;
              details.style.maxHeight = startHeight + 'px';
              // force reflow to ensure the browser applies the starting height
              details.getBoundingClientRect();
              // then animate to 0
              requestAnimationFrame(() => {
                details.style.maxHeight = '0';
              });
            }
          } else {
            // expand
            button.setAttribute('aria-expanded', 'true');
            details.setAttribute('aria-hidden', 'false');

            if (reduceMotion) {
              details.style.maxHeight = '';
            } else {
              // set to the scrollHeight to animate
              const target = details.scrollHeight;
              details.style.maxHeight = target + 'px';

              // after transition ends, clear the inline max-height so content can grow/shrink naturally
              const onTransitionEnd = function (e) {
                if (e.propertyName === 'max-height') {
                  details.style.maxHeight = '';
                  details.removeEventListener('transitionend', onTransitionEnd);
                }
              };
              details.addEventListener('transitionend', onTransitionEnd);
            }
            // move focus for accessibility if user used keyboard to expand (optional)
            // We leave focus on the toggle button by default.
          }
        }

        button.addEventListener('click', function (e) {
          toggle();
        });

        // Optional: close on Escape when focus is inside the details region
        details.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') {
            button.focus();
            if (button.getAttribute('aria-expanded') === 'true') {
              toggle();
            }
          }
        });

        // Ensure that if JS is enabled and the details is expanded but has no inline height,
        // it still displays. This is handled above by removing maxHeight only after initial set.
      }

      // Initialize all buttons with data-toggle pattern
      document.querySelectorAll('.toggle[aria-controls]').forEach(setupToggle);

      // If JS is disabled the content won't transition smoothly; we do not alter content.
    })();
  </script>
</body>
</html>