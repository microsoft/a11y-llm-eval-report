<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f8fafb;
      --card:#ffffff;
      --accent:#0366d6;
      --muted:#6b7280;
      --radius:8px;
      --focus: 3px solid rgba(3,102,214,0.2);
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;
      background:var(--bg);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
    }
    main{
      max-width:780px;
      margin:40px auto;
      padding:20px;
    }

    h1{
      font-size:1.4rem;
      margin:0 0 18px 0;
    }
    p.lead{
      margin:0 0 24px 0;
      color:var(--muted);
    }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 1px 2px rgba(15,23,42,0.04), 0 4px 8px rgba(15,23,42,0.04);
      margin-bottom:18px;
    }

    .toggle-row{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .expander{
      appearance:none;
      -webkit-appearance:none;
      border:1px solid rgba(15,23,42,0.08);
      background:linear-gradient(#fff,#fbfbfd);
      padding:10px 12px;
      border-radius:8px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      font-size:1rem;
      color:var(--accent);
      font-weight:600;
    }
    .expander:hover{
      box-shadow:0 1px 0 rgba(15,23,42,0.03);
    }
    .expander:focus{
      outline:none;
      box-shadow: var(--focus);
    }

    .expander .icon{
      width:16px;
      height:16px;
      display:inline-block;
      transition:transform 200ms ease;
    }
    .expander[aria-expanded="true"] .icon{
      transform:rotate(180deg);
    }

    /* Controlled content */
    .details{
      overflow:hidden;
      transition:max-height 320ms ease, opacity 240ms ease;
      max-height:0;
      opacity:0;
      margin-top:12px;
      border-left:4px solid rgba(3,102,214,0.06);
      padding:0 12px;
    }
    .details.is-open{
      opacity:1;
    }
    .details-inner{
      padding:12px 0 16px 0;
    }

    /* Small helper text */
    .muted{
      color:var(--muted);
      font-size:0.9rem;
      margin:6px 0 0 0;
    }

    /* Visually hidden for screen readers */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    /* Make keyboard focus visible for content region when focused programmatically */
    .details[tabindex="0"]:focus{
      outline:none;
      box-shadow: inset 0 0 0 3px rgba(3,102,214,0.06);
      border-left-color:var(--accent);
    }

    /* Demo content styling */
    .card-title{
      margin:0 0 6px 0;
      font-weight:700;
      font-size:1rem;
      color:#0b1220;
    }
    .card-body{
      margin:0;
      color:#111827;
    }
  </style>
</head>
<body>
  <main>
    <h1>Accessible Expand/Collapse Widgets</h1>
    <p class="lead">Examples of expand/collapse controls using accessible markup (aria-expanded, aria-controls) and a details container with the class "details". Use Tab/Enter/Space to operate; Escape closes a panel when focused.</p>

    <!-- Example 1: collapsed by default -->
    <div class="example" aria-labelledby="ex1-heading">
      <div class="toggle-row">
        <button id="toggle1" class="expander" aria-expanded="false" aria-controls="details1">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          More details
        </button>
        <div id="ex1-heading" class="muted" aria-hidden="true">Pricing summary</div>
      </div>

      <div id="details1" class="details" role="region" aria-labelledby="toggle1" aria-hidden="true" tabindex="-1">
        <div class="details-inner">
          <h2 class="card-title">Pricing details</h2>
          <p class="card-body">This plan includes basic support, monthly updates, and access to the community forum. If you need priority support, consider the premium plan which includes 24/7 assistance and a personal account manager.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: open by default -->
    <div class="example" aria-labelledby="ex2-heading">
      <div class="toggle-row">
        <button id="toggle2" class="expander" aria-expanded="true" aria-controls="details2">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Release notes
        </button>
        <div id="ex2-heading" class="muted" aria-hidden="true">Latest release information</div>
      </div>

      <div id="details2" class="details is-open" role="region" aria-labelledby="toggle2" aria-hidden="false" tabindex="0" style="max-height:1000px;">
        <div class="details-inner">
          <h2 class="card-title">What's new</h2>
          <p class="card-body">Version 4.2.0 improves performance for large datasets, fixes several accessibility issues, and updates the design system. We recommend testing your workflows with the updated components before rolling out to production.</p>
        </div>
      </div>
    </div>

    <!-- Example 3: nested content -->
    <div class="example" aria-labelledby="ex3-heading">
      <div class="toggle-row">
        <button id="toggle3" class="expander" aria-expanded="false" aria-controls="details3">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Accessibility tips
        </button>
        <div id="ex3-heading" class="muted" aria-hidden="true">Best practices</div>
      </div>

      <div id="details3" class="details" role="region" aria-labelledby="toggle3" aria-hidden="true" tabindex="-1">
        <div class="details-inner">
          <h2 class="card-title">Tips</h2>
          <ul>
            <li>Use semantic HTML elements where possible.</li>
            <li>Provide visible focus styles for interactive elements.</li>
            <li>Ensure buttons control content via aria-controls and aria-expanded.</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <script>
    (function () {
      // Utility to animate max-height smoothly
      function openPanel(panel) {
        // set max-height to measured scrollHeight to enable transition
        panel.style.transition = 'none';
        panel.style.maxHeight = '0px';
        // Force style application
        panel.getBoundingClientRect();
        panel.style.transition = '';
        var full = panel.scrollHeight + 'px';
        panel.style.maxHeight = full;
        panel.classList.add('is-open');
        panel.setAttribute('aria-hidden', 'false');
        // After the transition ends, remove the inline max-height to allow natural height (and better resizing)
        var cleanup = function () {
          panel.style.maxHeight = '';
          panel.removeEventListener('transitionend', cleanup);
        };
        panel.addEventListener('transitionend', cleanup);
      }

      function closePanel(panel) {
        // To animate closing, set max-height to current height then to 0
        panel.style.maxHeight = panel.scrollHeight + 'px';
        // Force reflow
        panel.getBoundingClientRect();
        panel.style.maxHeight = '0px';
        panel.classList.remove('is-open');
        panel.setAttribute('aria-hidden', 'true');
        // Keep tabindex -1 for non-open regions
      }

      function toggle(event) {
        var btn = event.currentTarget;
        var controls = btn.getAttribute('aria-controls');
        if (!controls) return;
        var panel = document.getElementById(controls);
        if (!panel) return;

        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          btn.setAttribute('aria-expanded', 'false');
          closePanel(panel);
        } else {
          btn.setAttribute('aria-expanded', 'true');
          // make region focusable when opened for keyboard users
          panel.setAttribute('tabindex', '0');
          openPanel(panel);
          // move focus into the region in a non-surprising way (optional)
          // panel.focus();
        }
      }

      // Close panel when Escape is pressed while focus is inside the region
      function onKeydownPanel(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          var panel = e.currentTarget;
          var controlsFrom = panel.getAttribute('aria-labelledby');
          if (controlsFrom) {
            var btn = document.getElementById(controlsFrom);
            if (btn) {
              btn.setAttribute('aria-expanded', 'false');
              closePanel(panel);
              btn.focus();
            }
          }
        }
      }

      // Initialize all expanders
      var expanders = document.querySelectorAll('.expander[aria-controls]');
      expanders.forEach(function (btn) {
        var id = btn.getAttribute('aria-controls');
        var panel = document.getElementById(id);
        if (!panel) return;

        // If panel starts open, ensure styles match
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          panel.classList.add('is-open');
          panel.setAttribute('aria-hidden', 'false');
          // allow height to expand naturally
          panel.style.maxHeight = panel.scrollHeight + 'px';
          // After a tick, remove inline maxHeight so it's flexible
          setTimeout(function () { panel.style.maxHeight = ''; }, 350);
          panel.setAttribute('tabindex', '0');
        } else {
          panel.classList.remove('is-open');
          panel.setAttribute('aria-hidden', 'true');
          panel.style.maxHeight = '0px';
          panel.setAttribute('tabindex', '-1');
        }

        btn.addEventListener('click', toggle);
      });

      // Add Escape handling to all panels
      var panels = document.querySelectorAll('.details');
      panels.forEach(function (panel) {
        panel.addEventListener('keydown', onKeydownPanel);
      });

      // Improve reduced-motion preference: disable height transitions
      var mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if (mq && mq.matches) {
        document.querySelectorAll('.details').forEach(function (panel) {
          panel.style.transition = 'none';
        });
        document.querySelectorAll('.expander .icon').forEach(function (icon) {
          icon.style.transition = 'none';
        });
      }
    })();
  </script>
</body>
</html>