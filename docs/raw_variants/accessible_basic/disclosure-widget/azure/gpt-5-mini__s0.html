<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#0b0b0b;
      --accent:#005a9c;
      --accent-contrast:#ffffff;
      --border:#d1d5db;
      --focus: 3px solid Highlight;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      line-height:1.4;
    }

    header{
      padding:1.25rem 1rem;
      border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, rgba(0,90,156,0.03), transparent);
    }

    main{
      max-width:900px;
      margin:1.25rem auto;
      padding:0 1rem 3rem;
    }

    h1{
      margin:0 0 .25rem;
      font-size:1.5rem;
    }

    p.lead{
      margin:.25rem 0 0;
      color:#444;
    }

    /* Example wrapper required by the task */
    .example{
      margin:1.25rem 0;
      padding:1rem;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fbfbfb;
    }

    .example > .controls{
      display:flex;
      gap:.75rem;
      align-items:center;
      margin-bottom:.75rem;
      flex-wrap:wrap;
    }

    .disclosure-button{
      appearance:none;
      -webkit-appearance:none;
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.5rem .75rem;
      font-size:1rem;
      line-height:1;
      border:1px solid var(--accent);
      background:var(--accent);
      color:var(--accent-contrast);
      border-radius:6px;
      cursor:pointer;
    }

    .disclosure-button:focus{
      outline:none;
      box-shadow:var(--focus);
    }

    .disclosure-button[aria-expanded="true"]::after{
      content:"▾";
      font-size:.9rem;
    }

    .disclosure-button[aria-expanded="false"]::after{
      content:"▸";
      font-size:.9rem;
    }

    /* details container required by the task */
    .details{
      padding:.75rem;
      border-top:1px dashed var(--border);
      margin-top:.5rem;
      background:linear-gradient(180deg, rgba(0,0,0,0.01), transparent);
      border-radius:6px;
    }

    /* When hidden attribute is present the UA hides it; provide a small visible fallback for older UA */
    .details[hidden]{
      display:none;
    }

    /* Focus styles for elements inside the details */
    .details a, .details button, .details input, .details textarea, .details select {
      outline-offset:2px;
    }

    .visually-hidden{
      position:absolute!important;
      height:1px;width:1px;
      overflow:hidden;
      clip:rect(1px,1px,1px,1px);
      white-space:nowrap;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      * { transition:none !important; animation:none !important; }
    }

    /* Make interactive targets easier to hit */
    .disclosure-button, .example a, .example button, .example input[type="submit"]{
      min-height:40px;
    }

    footer{
      border-top:1px solid var(--border);
      margin-top:2rem;
      padding-top:1rem;
      color:#444;
      font-size:.9rem;
    }
  </style>
</head>
<body>
  <a class="visually-hidden" href="#main">Skip to main content</a>

  <header>
    <h1>Accessible Expand/Collapse Widgets</h1>
    <p class="lead">Examples of expand/collapse (disclosure) widgets that follow accessible patterns: native button control, aria-expanded, aria-controls, and clearly identified content regions.</p>
  </header>

  <main id="main" tabindex="-1">
    <section aria-label="Demo widgets">
      <!-- Example 1 -->
      <div class="example" data-example="1">
        <div class="controls">
          <button
            class="disclosure-button"
            id="toggle-1"
            aria-expanded="false"
            aria-controls="details-1">
            Show details
          </button>
          <div>
            <p style="margin:.1rem 0 0;">Keyboard: Tab to the button, press Enter or Space to toggle. When focus is inside the details, press Escape to close and return focus to the button.</p>
          </div>
        </div>

        <div
          id="details-1"
          class="details"
          role="region"
          aria-labelledby="toggle-1"
          hidden>
          <h2 id="details-1-heading" style="margin-top:0">More information</h2>
          <p>This content is revealed when the button above is expanded. It is contained in an element with the class "details".</p>
          <p>Links and interactive controls inside the details remain keyboard-accessible:</p>
          <ul>
            <li><a href="#learn-more-1">Learn more</a></li>
            <li><a href="#contact-1">Contact us</a></li>
          </ul>
        </div>
      </div>

      <!-- Example 2: demonstrates form inside details -->
      <div class="example" data-example="2">
        <div class="controls">
          <button
            class="disclosure-button"
            id="toggle-2"
            aria-expanded="false"
            aria-controls="details-2">
            View sign-up form
          </button>
          <div aria-hidden="true" style="color:#444;">(contains form controls)</div>
        </div>

        <div
          id="details-2"
          class="details"
          role="region"
          aria-labelledby="toggle-2"
          hidden>
          <h2 style="margin-top:0">Sign up</h2>
          <form aria-describedby="signup-desc">
            <p id="signup-desc">A simple accessible form contained in the details region. Use Tab to move between fields.</p>
            <div style="display:flex;flex-direction:column;gap:.5rem;max-width:360px">
              <label for="name-2">Name</label>
              <input id="name-2" name="name" type="text" autocomplete="name" />

              <label for="email-2">Email</label>
              <input id="email-2" name="email" type="email" autocomplete="email" />

              <div style="display:flex;gap:.5rem;margin-top:.5rem;">
                <input id="newsletter-2" name="newsletter" type="checkbox" />
                <label for="newsletter-2">Subscribe to newsletter</label>
              </div>

              <div style="margin-top:.5rem;">
                <button type="submit" style="padding:.5rem .75rem;background:var(--accent);color:var(--accent-contrast);border:1px solid var(--accent);border-radius:6px;cursor:pointer;">
                  Submit
                </button>
                <button type="button" id="cancel-2" style="padding:.5rem .75rem;margin-left:.5rem;">
                  Cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <footer>
      <p>These examples use a native <code>button</code> control with <code>aria-expanded</code> and <code>aria-controls</code>. The content containers have the class "details" as required.</p>
    </footer>
  </main>

  <script>
    (function () {
      'use strict';

      /**
       * Utility: find the first focusable element inside a container.
       * This is used only optionally; focus management here is conservative.
       */
      function firstFocusable(root) {
        var selectors = [
          'a[href]:not([tabindex="-1"])',
          'button:not([disabled]):not([tabindex="-1"])',
          'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
          'select:not([disabled]):not([tabindex="-1"])',
          'textarea:not([disabled]):not([tabindex="-1"])',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return root.querySelector(selectors.join(','));
      }

      /**
       * Set up a toggle button and its controlled details element.
       * - Uses hidden attribute to hide/shows content (keeps it out of AT tree when hidden).
       * - Updates aria-expanded on the button.
       * - Adds Escape key handling inside the details to close and return focus.
       */
      function setupToggle(button) {
        var detailsId = button.getAttribute('aria-controls');
        if (!detailsId) return;
        var details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure the details container has role/labeling if not present.
        if (!details.hasAttribute('role')) {
          details.setAttribute('role', 'region');
        }
        if (!details.hasAttribute('aria-labelledby')) {
          details.setAttribute('aria-labelledby', button.id);
        }

        // Click toggles.
        button.addEventListener('click', function (e) {
          var expanded = button.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            // collapse
            button.setAttribute('aria-expanded', 'false');
            details.hidden = true;
            // return focus to the button (if not already there)
            if (document.activeElement !== button) {
              button.focus({ preventScroll: true });
            }
          } else {
            // expand
            button.setAttribute('aria-expanded', 'true');
            details.hidden = false;
            // Do not automatically move focus away from the button.
            // However, set a sensible focus if the user wants it via keyboard navigation.
          }
        });

        // Keyboard: when focus is inside details, Escape will close it and move focus to the button.
        details.addEventListener('keydown', function (event) {
          if (event.key === 'Escape' || event.key === 'Esc') {
            // Collapse
            button.setAttribute('aria-expanded', 'false');
            details.hidden = true;
            // Move focus back to the button
            button.focus({ preventScroll: true });
            // Prevent further handling
            event.stopPropagation();
            event.preventDefault();
          }
        });

        // Provide a small behavior for the Cancel button inside details: close and focus the toggle.
        details.addEventListener('click', function (event) {
          var el = event.target;
          if (el && el.tagName === 'BUTTON' && el.getAttribute('type') === 'button') {
            if (el.id && el.id.toLowerCase().startsWith('cancel')) {
              // Collapse and focus
              button.setAttribute('aria-expanded', 'false');
              details.hidden = true;
              button.focus({ preventScroll: true });
            }
          }
        });

        // Ensure that when the page programmatically focuses an element in the details while it is hidden,
        // it becomes visible (useful for deep-linking). This follows an unobtrusive rule:
        // if a child inside details receives focus and details is hidden, open it.
        details.addEventListener('focusin', function () {
          if (details.hidden) {
            details.hidden = false;
            button.setAttribute('aria-expanded', 'true');
          }
        });
      }

      // Initialize all disclosure buttons with aria-controls attributes.
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(setupToggle);

      // Small enhancement: allow keyboard users to toggle with Space and Enter are handled by button by default.
      // No additional code required.

      // Make the "Skip to main content" visible when focused (works with .visually-hidden)
      var skip = document.querySelector('.visually-hidden');
      skip.addEventListener('focus', function () {
        skip.style.position = 'static';
        skip.style.width = 'auto';
        skip.style.height = 'auto';
        skip.style.clip = 'auto';
        skip.style.margin = '8px';
        skip.style.padding = '8px';
        skip.style.background = '#000';
        skip.style.color = '#fff';
        skip.style.borderRadius = '4px';
        skip.style.zIndex = 1000;
      });
      skip.addEventListener('blur', function () {
        // restore visually-hidden styles
        skip.style.position = '';
        skip.style.width = '';
        skip.style.height = '';
        skip.style.clip = '';
        skip.style.margin = '';
        skip.style.padding = '';
        skip.style.background = '';
        skip.style.color = '';
        skip.style.borderRadius = '';
        skip.style.zIndex = '';
      });

      // Ensure each disclosure button has an id (aria-labelledby expects it)
      toggles.forEach(function(btn, i){
        if (!btn.id) {
          btn.id = 'disclosure-' + (i+1);
        }
      });

    })();
  </script>
</body>
</html>