<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111213;
      --muted:#505763;
      --accent:#0b63d6;
      --surface:#f6f8fb;
      --border:#d7e1ef;
      --focus: 3px solid highlight;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;
      line-height:1.45;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container{
      max-width:860px;
      margin:2rem auto;
      padding:1rem;
    }

    header h1{
      font-size:1.25rem;
      margin:.25rem 0 .5rem 0;
    }

    p.lead{
      margin:0 0 1rem 0;
      color:var(--muted);
      font-size:0.95rem;
    }

    .example{
      border:1px solid var(--border);
      background:var(--surface);
      padding:1rem;
      border-radius:8px;
      margin:1rem 0;
    }

    .example h2{
      font-size:1rem;
      margin:.25rem 0 .5rem 0;
    }

    /* Native details styling */
    details{
      background:transparent;
      margin:0;
      padding:0;
    }

    summary{
      list-style:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:.5rem;
      padding:.5rem;
      border-radius:6px;
      border:1px dashed transparent;
      font-weight:600;
    }

    summary::-webkit-details-marker{ display:none; } /* remove default marker */

    /* Add a custom disclosure triangle + rotate on open using attribute selector on parent details */
    summary::before{
      content:"▸";
      display:inline-block;
      transform-origin:center;
      transition:transform .12s ease;
      color:var(--accent);
      font-size:0.95rem;
    }

    details[open] > summary::before{
      transform:rotate(90deg);
    }

    /* Content container required by user: .details */
    .details{
      padding:.75rem 0 .25rem 0;
      margin-left:1.75rem;
      color:var(--text);
      font-size:0.95rem;
    }

    /* Custom toggle button */
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.5rem .75rem;
      background:white;
      border:1px solid var(--border);
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      color:var(--text);
    }

    .toggle::before{
      content:"▸";
      color:var(--accent);
      transform-origin:center;
      transition:transform .12s ease;
      display:inline-block;
    }

    .toggle[aria-expanded="true"]::before{
      transform:rotate(90deg);
    }

    /* Hidden content for custom widget */
    .details[hidden]{
      display:none;
    }

    /* Focus styles (visible for keyboard users) */
    :focus{
      outline:none;
    }

    .toggle:focus-visible,
    summary:focus-visible,
    button:focus-visible{
      box-shadow:0 0 0 3px rgba(11,99,214,0.18);
      outline:3px solid rgba(11,99,214,0.18);
      outline-offset:3px;
      border-color:var(--accent);
    }

    /* Small helper text */
    .hint{
      font-size:0.9rem;
      color:var(--muted);
      margin-top:.5rem;
    }

    pre.kbd{
      display:inline-block;
      padding:.12rem .4rem;
      background:#fff;
      border:1px solid var(--border);
      border-radius:4px;
      font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
      font-size:0.85rem;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .toggle::before,
      details > summary::before{
        transition:none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Accessible Expand / Collapse Widgets</h1>
      <p class="lead">Two accessible examples: a native details element and a custom button-controlled widget. Both use a container with the class "details" for the controlled content. Each widget is wrapped in an element with the class "example".</p>
    </header>

    <!-- Example 1: native details element -->
    <div class="example" aria-labelledby="native-example-heading">
      <h2 id="native-example-heading">Example 1 — Native details element</h2>

      <p class="hint">Use <span class="kbd">Enter</span> or <span class="kbd">Space</span> to toggle the disclosure. The content container below has class="details".</p>

      <details>
        <summary id="native-summary-1">What's included in this package</summary>
        <div id="native-details-1" class="details" role="region" aria-labelledby="native-summary-1">
          <p>When you expand this section, you'll see a short list of items included in the package:</p>
          <ul>
            <li>Quick-start guide and README</li>
            <li>Prebuilt components and styles</li>
            <li>Accessibility and testing notes</li>
          </ul>
          <p class="hint">Native <code>&lt;details&gt;</code> and <code>&lt;summary&gt;</code> elements provide built-in keyboard support and are widely supported by assistive technologies.</p>
        </div>
      </details>
    </div>

    <!-- Example 2: custom ARIA button controlling a div.details -->
    <div class="example" aria-labelledby="custom-example-heading">
      <h2 id="custom-example-heading">Example 2 — Custom button-controlled widget</h2>

      <p class="hint">This custom version uses a button with <code>aria-expanded</code> and <code>aria-controls</code>. The controlled content is a <code>div</code> with class="details".</p>

      <div>
        <button id="custom-toggle-1" class="toggle" aria-expanded="false" aria-controls="custom-details-1">
          Show full description
        </button>
      </div>

      <div id="custom-details-1" class="details" role="region" aria-labelledby="custom-toggle-1" aria-hidden="true" hidden>
        <p>This description is hidden by default and shown when the button is toggled. The content container uses the required class <strong>details</strong>.</p>
        <p>Tips inside the expanded area:</p>
        <ol>
          <li>Keyboard focus remains on interactive elements; press <kbd>Esc</kbd> to close while focus is inside the content.</li>
          <li>Buttons use <code>aria-expanded</code> to indicate state to assistive technology.</li>
        </ol>
      </div>
    </div>

    <footer>
      <p class="hint">All interactive controls are keyboard accessible. Focus indicators are visible. If you prefer reduced motion, animated indicators are disabled by your system setting.</p>
    </footer>
  </div>

  <script>
    // Custom toggle behavior for the ARIA-controlled widget(s)
    (function () {
      // Polyfill-like helper to toggle a custom widget
      function toggleButton(button) {
        const controlsId = button.getAttribute('aria-controls');
        if (!controlsId) return;
        const panel = document.getElementById(controlsId);
        if (!panel) return;

        const expanded = button.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          // collapse
          button.setAttribute('aria-expanded', 'false');
          panel.hidden = true;
          panel.setAttribute('aria-hidden', 'true');
        } else {
          // expand
          button.setAttribute('aria-expanded', 'true');
          panel.hidden = false;
          panel.setAttribute('aria-hidden', 'false');
          // Move focus only if the panel contains no focusable elements? We keep focus on the button.
        }
      }

      // Click handler (works for mouse and touch)
      document.addEventListener('click', function (event) {
        const el = event.target;
        if (!el) return;
        // Handle clicks on elements with class "toggle"
        if (el.classList && el.classList.contains('toggle')) {
          toggleButton(el);
        }
      });

      // Support Enter/Space is already provided by <button> elements.
      // Add keyboard support to close with Escape when focus is within a details panel.
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape' || event.key === 'Esc') {
          const active = document.activeElement;
          if (!active) return;
          // Find nearest ancestor with class "details"
          const panel = active.closest && active.closest('.details');
          if (panel) {
            // Find the controlling button
            const controller = document.querySelector('[aria-controls="' + panel.id + '"]');
            if (controller && controller.getAttribute('aria-expanded') === 'true') {
              // Collapse
              controller.setAttribute('aria-expanded', 'false');
              panel.hidden = true;
              panel.setAttribute('aria-hidden', 'true');
              // Return focus to the controller
              controller.focus();
              // Prevent default only if we handled it
              event.preventDefault();
            }
          }
        }
      });

      // Enhance accessibility: ensure panels referenced by aria-controls have role="region" and an id
      document.querySelectorAll('[aria-controls]').forEach(function (controller) {
        const id = controller.getAttribute('aria-controls');
        if (!id) return;
        const panel = document.getElementById(id);
        if (!panel) return;
        if (!panel.hasAttribute('role')) {
          panel.setAttribute('role', 'region');
        }
        // If panel has no id (unlikely), give one (we require id by aria-controls, so skip)
      });

      // Ensure native <details> element content (the .details container) respects aria attributes:
      // If a native <details> is present, set aria-hidden on its .details child when collapsed for clarity.
      document.querySelectorAll('details').forEach(function (det) {
        const panel = det.querySelector('.details');
        if (!panel) return;
        // Initial state
        panel.setAttribute('aria-hidden', det.hasAttribute('open') ? 'false' : 'true');
        det.addEventListener('toggle', function () {
          panel.setAttribute('aria-hidden', det.hasAttribute('open') ? 'false' : 'true');
        });
      });
    })();
  </script>
</body>
</html>