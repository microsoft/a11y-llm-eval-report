<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      color-scheme: light dark;
      --bg: #ffffff;
      --fg: #0b1b2b;
      --accent: #0a66c2;
      --muted: #6b7280;
      --focus: 3px solid #ffbf47; /* high contrast visible focus */
      --radius: 8px;
      --shadow: 0 1px 3px rgba(2,6,23,0.08);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg: #071126;
        --fg: #e6eef8;
        --accent: #66a8ff;
        --muted: #9aa6b2;
        --focus: 3px solid #ffbf47;
        --shadow: 0 2px 8px rgba(0,0,0,0.6);
      }
    }

    body{
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 1.25rem;
      padding: 0;
    }

    header h1{
      font-size: 1.375rem;
      margin: 0 0 0.25rem 0;
    }
    header p{
      margin: 0 0 1rem 0;
      color: var(--muted);
    }

    .example{
      border: 1px solid rgba(11,27,43,0.08);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.01));
    }

    /* Accessible button style */
    .expander{
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      background: transparent;
      border: 1px solid rgba(11,27,43,0.12);
      border-radius: 6px;
      color: var(--fg);
      cursor: pointer;
      transition: background 120ms ease, box-shadow 120ms ease;
    }
    .expander:hover{
      background: rgba(10,102,194,0.04);
    }
    .expander:active{
      transform: translateY(1px);
    }
    .expander:focus{
      outline: none;
      box-shadow: var(--focus);
    }

    /* Icon */
    .expander .icon{
      width: 1rem;
      height: 1rem;
      display: inline-block;
      transition: transform 180ms ease;
      flex: 0 0 1rem;
    }
    .expander[aria-expanded="true"] .icon{
      transform: rotate(90deg);
    }

    /* Controlled content: class 'details' required by the task */
    .details{
      margin-top: 0.75rem;
      padding: 0.75rem;
      border-radius: 6px;
      background: rgba(10,102,194,0.03);
      color: var(--fg);
    }

    /* Smooth collapse/expand using max-height for animation */
    .details[hidden]{
      display: none;
    }

    /* Provide visible labels / helper */
    .helper{
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 0.5rem;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce){
      .expander .icon,
      .details{
        transition: none !important;
      }
    }

    /* Strong contrast for focus on the inner focusable content if any */
    .details :focus{
      outline: 3px solid var(--accent);
      outline-offset: 2px;
    }

    /* Visually hidden utility for screen-reader-only text */
    .sr-only{
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap;
      border: 0; padding: 0; margin: -1px;
    }

    /* Ensure links and buttons inside have sufficient contrast */
    .details a{
      color: var(--accent);
    }
  </style>
</head>
<body>
  <header>
    <h1>Accessible Expand/Collapse Widgets</h1>
    <p>Examples of expand/collapse widgets implemented with accessible markup: each widget is wrapped in a div.example and the controlled container uses the details class.</p>
  </header>

  <main>
    <!-- Example 1: initially collapsed -->
    <div class="example" id="ex-1">
      <section aria-labelledby="ex1-heading">
        <h2 id="ex1-heading" class="sr-only">Example 1 — Collapsed by default</h2>

        <button
          id="expander-1"
          class="expander"
          aria-expanded="false"
          aria-controls="details-1"
          aria-describedby="ex1-helper"
        >
          <span class="icon" aria-hidden="true">
            <!-- simple chevron -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span>Show details</span>
        </button>

        <p id="ex1-helper" class="helper">Press Enter or Space to expand. This control uses aria-expanded and aria-controls to indicate state.</p>

        <div
          id="details-1"
          class="details"
          role="region"
          aria-labelledby="expander-1"
          hidden
        >
          <p><strong>What’s inside:</strong> This content is initially hidden and becomes visible when you activate the "Show details" button. The button's aria-expanded attribute is updated to reflect the current state.</p>
          <ul>
            <li>Keyboard focus remains logical and visible.</li>
            <li>Screen readers can discover the region via aria-labelledby and aria-controls.</li>
            <li>The element uses the required <code>details</code> class.</li>
          </ul>
          <p>
            Example link for testing keyboard focus:
            <a href="#" onclick="event.preventDefault()">Accessible link</a>
          </p>
        </div>
      </section>
    </div>

    <!-- Example 2: initially expanded -->
    <div class="example" id="ex-2">
      <section aria-labelledby="ex2-heading">
        <h2 id="ex2-heading" class="sr-only">Example 2 — Expanded by default</h2>

        <button
          id="expander-2"
          class="expander"
          aria-expanded="true"
          aria-controls="details-2"
          aria-describedby="ex2-helper"
        >
          <span class="icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span>Hide details</span>
        </button>

        <p id="ex2-helper" class="helper">This example starts expanded. Use the button to collapse the region.</p>

        <div
          id="details-2"
          class="details"
          role="region"
          aria-labelledby="expander-2"
        >
          <p><strong>Expanded content:</strong> This widget starts open so that users without JavaScript still have access to the content. Activating the button will collapse it.</p>
          <p>Content remains reachable by keyboard and includes an example form control for focus testing:</p>
          <form onsubmit="event.preventDefault()">
            <label for="name-2">Name:</label>
            <input id="name-2" name="name-2" type="text" />
            <button type="submit">Submit</button>
          </form>
        </div>
      </section>
    </div>

    <!-- Additional guidance -->
    <div class="example" id="ex-guidance" aria-hidden="false">
      <h3 style="margin-top:0">Accessibility notes</h3>
      <ul>
        <li>Buttons use aria-expanded and aria-controls to communicate state and relationship with the controlled element.</li>
        <li>The controlled region uses role="region" and aria-labelledby so assistive technology can identify it.</li>
        <li>All interactive elements are keyboard accessible (Enter/Space) and have visible focus styles.</li>
        <li>Animations respect users' prefers-reduced-motion setting.</li>
      </ul>
    </div>
  </main>

  <script>
    (function(){
      'use strict';

      /**
       * Toggle a single expander button and its controlled details area.
       * - Updates aria-expanded
       * - Toggles hidden attribute on the details container
       * - Updates visible label text
       */
      function toggleExpander(button){
        var controlsId = button.getAttribute('aria-controls');
        if (!controlsId) return;
        var details = document.getElementById(controlsId);
        if (!details) return;

        var expanded = button.getAttribute('aria-expanded') === 'true';
        var willExpand = !expanded;

        // Update ARIA state
        button.setAttribute('aria-expanded', String(willExpand));

        // Show/hide the details container using the hidden attribute
        if (willExpand){
          details.removeAttribute('hidden');
        } else {
          details.setAttribute('hidden', '');
        }

        // Update visible text inside button to reflect action
        // We expect the label text to be the second child node of the button
        var labelSpan = Array.prototype.slice.call(button.childNodes).find(function(n){
          return n.nodeType === Node.ELEMENT_NODE && !n.classList.contains('icon');
        });
        if (labelSpan && labelSpan.textContent){
          labelSpan.textContent = willExpand ? 'Hide details' : 'Show details';
        }

        // Optional: move focus into the region when expanded (preserve accessibility)
        if (willExpand){
          // If region contains focusable elements, don't steal focus.
          // We only move focus if nothing inside is focused and if first focusable element exists and is not offscreen.
          var focusable = details.querySelector('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])');
          if (focusable && document.activeElement !== focusable){
            // Do not automatically move focus if user is currently interacting with other controls.
            // For demonstration we do not force focus; screen readers will be informed via aria-expanded.
          }
        }
      }

      // Attach event listeners to all expander buttons
      var expanders = document.querySelectorAll('.expander');
      expanders.forEach(function(btn){
        // Ensure keyboard implicit activation works (native button supports Enter/Space)
        btn.addEventListener('click', function(e){
          toggleExpander(btn);
        });

        // Support Home/End keys for toggling groups if desired.
        // Here we allow Escape to collapse an expanded region for convenience.
        btn.addEventListener('keydown', function(e){
          if (e.key === 'Escape' || e.key === 'Esc'){
            if (btn.getAttribute('aria-expanded') === 'true'){
              e.preventDefault();
              toggleExpander(btn);
            }
          }
        });

        // Ensure initial state matches DOM for cases where JS runs after HTML rendering.
        var cid = btn.getAttribute('aria-controls');
        if (cid){
          var det = document.getElementById(cid);
          if (det){
            var expanded = btn.getAttribute('aria-expanded') === 'true';
            if (expanded){
              det.removeAttribute('hidden');
            } else {
              det.setAttribute('hidden', '');
            }
          }
        }
      });

      // Provide accessible keyboard shortcut: focus first expander with Alt+E (example)
      document.addEventListener('keydown', function(e){
        // Use Alt+E (or Option+E on Mac) to jump to first expander. Not required, optional helper.
        if ((e.altKey || e.metaKey) && e.key && e.key.toLowerCase() === 'e'){
          var first = document.querySelector('.expander');
          if (first){
            first.focus();
            e.preventDefault();
          }
        }
      });
    })();
  </script>
</body>
</html>