<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --brand:#0b63ff;
      --bg:#ffffff;
      --text:#0b0b0b;
      --muted:#4b4b4b;
      --focus: 3px solid #ffbf47;
      --radius:8px;
      --transition: 280ms cubic-bezier(.2,.8,.2,1);
    }

    /* Basic page layout */
    html,body{height:100%;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.45;
      color:var(--text);
      background: #f6f8fb;
      padding:24px;
    }

    header{
      margin-bottom:16px;
    }

    h1{
      font-size:1.25rem;
      margin:0 0 6px 0;
    }

    p.lead{
      margin:0 0 12px 0;
      color:var(--muted);
      font-size:0.95rem;
    }

    /* Skip link */
    .skip-link{
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
      z-index:1000;
    }
    .skip-link:focus{
      left: 8px;
      top: 8px;
      width: auto;
      height: auto;
      padding:8px 12px;
      background:#000;
      color:#fff;
      border-radius:4px;
      text-decoration:none;
    }

    /* Example wrapper */
    .example{
      background:#fff;
      border-radius: var(--radius);
      box-shadow: 0 1px 2px rgba(10,10,10,0.04), 0 6px 18px rgba(11,38,77,0.06);
      padding:16px;
      margin-bottom:18px;
    }

    .example h2{
      font-size:1rem;
      margin:0 0 10px 0;
      color:var(--brand);
    }

    .instructions{
      font-size:0. nine rem;
      margin:0 0 12px 0;
      color:var(--muted);
    }

    /* Toggle button */
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:linear-gradient(180deg,#fff,#f3f6ff);
      border:1px solid rgba(11,99,255,0.12);
      color:var(--brand);
      padding:10px 14px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      font-size:0.95rem;
      transition: box-shadow var(--transition), transform var(--transition);
    }
    .toggle:hover{ transform: translateY(-1px); }
    .toggle:active{ transform: translateY(0); }
    .toggle:focus{
      outline: none;
      box-shadow: var(--focus);
      border-color: var(--brand);
    }

    .toggle .chev{
      display:inline-block;
      width:18px;height:18px;
      transition: transform var(--transition);
      fill: currentColor;
    }
    /* rotate when expanded */
    .toggle[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    /* Controlled content: .details */
    .details{
      margin-top:12px;
      overflow:hidden;
      transition: max-height var(--transition), opacity var(--transition);
      max-height:0;
      opacity:0;
    }
    /* When expanded set to large max height to allow transition (content-driven) */
    .details[aria-hidden="false"]{
      max-height: 1000px; /* large enough for content */
      opacity:1;
    }

    .panel{
      padding:12px 14px;
      background: linear-gradient(180deg,#f8fbff,#fff);
      border-radius:8px;
      border:1px solid rgba(11,63,128,0.06);
    }

    .panel p{ margin:0 0 10px 0; color:#0b2340; }

    /* Focus outline for focusable items inside */
    a, button { outline-offset:3px; }
    a:focus, button:focus { box-shadow: var(--focus); border-radius:6px; }

    /* Small helper styles */
    .meta{ font-size:0.85rem; color:var(--muted); margin-top:8px; }

    /* Ensure good contrast on small text */
    .panel strong{ color:#07204b; }

    /* Responsive */
    @media (max-width:520px){
      body{ padding:16px; }
      .toggle{ width:100%; justify-content:space-between; }
    }
  </style>
</head>
<body>
  <a href="#maincontent" class="skip-link">Skip to main content</a>

  <header>
    <h1>Expand / Collapse Widget — Accessible Examples</h1>
    <p class="lead">Two accessible expand/collapse widgets. Each widget is wrapped in a container with class "example" and the controlled content container uses class "details". Use keyboard: Tab to the button, then Space or Enter to toggle. Press Escape while focus is inside the panel to close it.</p>
  </header>

  <main id="maincontent" tabindex="-1">
    <!-- Example 1 -->
    <div class="example" data-example="basic">
      <h2>Basic expandable panel</h2>
      <p class="instructions">This simple panel uses a button with aria-expanded and aria-controls. The pane has class "details".</p>

      <button
        id="toggle-1"
        class="toggle"
        aria-expanded="false"
        aria-controls="details-1"
        type="button"
      >
        <span>More information</span>
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"></path>
        </svg>
      </button>

      <div
        id="details-1"
        class="details"
        role="region"
        aria-labelledby="toggle-1"
        aria-hidden="true"
      >
        <div class="panel">
          <p><strong>Accessible by design.</strong> This region is controlled by the button above. When collapsed, assistive technologies will be told the region is hidden. Focusable elements inside are made unfocusable while collapsed to prevent keyboard users from tabbing into hidden content.</p>
          <p>Try navigating with Tab, and use <kbd>Enter</kbd>/<kbd>Space</kbd> on the button to open and close. When the panel is open and focus moves inside, press <kbd>Escape</kbd> to close and return focus to the toggle button.</p>
          <p class="meta">Example content includes a link: <a href="https://www.w3.org/WAI/" target="_blank" rel="noopener">WAI — Accessibility</a></p>
        </div>
      </div>
    </div>

    <!-- Example 2 -->
    <div class="example" data-example="long">
      <h2>Expandable panel with more controls</h2>
      <p class="instructions">This example demonstrates restoring focusability of interactive elements inside the details region when it opens.</p>

      <button
        id="toggle-2"
        class="toggle"
        aria-expanded="false"
        aria-controls="details-2"
        type="button"
      >
        <span>Show controls</span>
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"></path>
        </svg>
      </button>

      <div
        id="details-2"
        class="details"
        role="region"
        aria-labelledby="toggle-2"
        aria-hidden="true"
      >
        <div class="panel">
          <p>Form controls inside this panel are disabled for keyboard access while the panel is closed, and restored when opened. That prevents users tabbing to hidden content.</p>

          <form aria-label="Example settings">
            <label>
              <span>Notification level</span><br>
              <select name="level">
                <option>Off</option>
                <option selected>Important only</option>
                <option>All</option>
              </select>
            </label>
            <div style="height:8px;"></div>
            <label>
              <input type="checkbox" name="email" />
              <span>Send email updates</span>
            </label>
            <div style="height:8px;"></div>
            <button type="button">Save</button>
          </form>

          <p class="meta">While collapsed, the form controls are not reachable with Tab. They become focusable again when you open the panel.</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    (function(){
      // Utility: get focusable elements inside a container
      function getFocusable(el) {
        if (!el) return [];
        const selectors = [
          'a[href]:not([tabindex^="-"]):not([inert])',
          'area[href]',
          'input:not([disabled]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex^="-"])'
        ];
        return Array.from(el.querySelectorAll(selectors.join(',')));
      }

      // Initialize all toggle buttons that control a details element
      const toggles = Array.from(document.querySelectorAll('button[aria-controls]'));
      toggles.forEach(button => {
        const detailsId = button.getAttribute('aria-controls');
        const panel = document.getElementById(detailsId);
        if (!panel || !panel.classList.contains('details')) {
          // only operate on containers with class "details"
          return;
        }

        // Ensure role/labels are present
        panel.setAttribute('role', panel.getAttribute('role') || 'region');
        panel.setAttribute('aria-labelledby', panel.getAttribute('aria-labelledby') || button.id);

        // Initialize focusable children state: if collapsed, disable them
        const setChildrenTabindex = (allow) => {
          const focusables = getFocusable(panel);
          focusables.forEach(el => {
            if (allow) {
              // restore previous tabindex if present
              if (el.hasAttribute('data-prev-tabindex')) {
                const prev = el.getAttribute('data-prev-tabindex');
                if (prev === 'null') {
                  el.removeAttribute('tabindex');
                } else {
                  el.setAttribute('tabindex', prev);
                }
                el.removeAttribute('data-prev-tabindex');
              }
            } else {
              // store current tabindex (null if none), then set to -1
              if (!el.hasAttribute('data-prev-tabindex')) {
                el.setAttribute('data-prev-tabindex', el.hasAttribute('tabindex') ? el.getAttribute('tabindex') : 'null');
              }
              el.setAttribute('tabindex','-1');
            }
          });
        };

        // Start collapsed by default if aria-expanded is false
        const isExpanded = button.getAttribute('aria-expanded') === 'true';
        if (!isExpanded) {
          panel.setAttribute('aria-hidden','true');
          setChildrenTabindex(false);
        } else {
          panel.setAttribute('aria-hidden','false');
          setChildrenTabindex(true);
        }

        // Toggle function
        const toggle = (toState) => {
          const now = typeof toState === 'boolean' ? toState : (button.getAttribute('aria-expanded') === 'false');
          if (now) {
            button.setAttribute('aria-expanded','true');
            panel.setAttribute('aria-hidden','false');
            // remove hidden focus barrier
            try { if ('inert' in panel) panel.inert = false; } catch(e){}
            setChildrenTabindex(true);
          } else {
            button.setAttribute('aria-expanded','false');
            panel.setAttribute('aria-hidden','true');
            try { if ('inert' in panel) panel.inert = true; } catch(e){}
            setChildrenTabindex(false);
          }
        };

        // Click handler (button)
        button.addEventListener('click', function(e){
          toggle();
        });

        // If focus moves into the panel and Escape pressed, close and restore focus to button
        panel.addEventListener('keydown', function(e){
          if (e.key === 'Escape' || e.key === 'Esc') {
            // Close and move focus back to button
            toggle(false);
            button.focus({preventScroll:false});
            e.stopPropagation();
            e.preventDefault();
          }
        });

        // Also listen for Escape while any focusable inside panel (bubble from window)
        // (This covers some cases where focus is on elements inside but keydown not on panel)
        panel.addEventListener('focusin', function(){
          // add a one-time listener on document for Escape while focus is inside
          const escHandler = function(e){
            if (e.key === 'Escape' || e.key === 'Esc') {
              toggle(false);
              button.focus({preventScroll:false});
              document.removeEventListener('keydown', escHandler, true);
            }
          };
          document.addEventListener('keydown', escHandler, true);

          // remove the listener when focus leaves the panel
          const cleanup = function() {
            document.removeEventListener('keydown', escHandler, true);
            panel.removeEventListener('focusout', cleanup, true);
          };
          panel.addEventListener('focusout', cleanup, true);
        });

        // Keyboard support on button: Enter/Space are native; add ArrowDown to move focus into panel when opening
        button.addEventListener('keydown', function(e){
          if ((e.key === 'ArrowDown' || e.key === 'Down') && button.getAttribute('aria-expanded') === 'false') {
            // open and move focus to first focusable inside
            toggle(true);
            const first = getFocusable(panel)[0];
            if (first) {
              first.focus();
              e.preventDefault();
            }
          }
        });

        // Preserve state if someone toggles attributes directly (MutationObserver)
        const mo = new MutationObserver(function(mutations){
          for (const m of mutations) {
            if (m.attributeName === 'aria-expanded') {
              const expanded = button.getAttribute('aria-expanded') === 'true';
              const hidden = panel.getAttribute('aria-hidden') === 'true';
              if (expanded && hidden) {
                panel.setAttribute('aria-hidden','false'); setChildrenTabindex(true);
              } else if (!expanded && !hidden) {
                panel.setAttribute('aria-hidden','true'); setChildrenTabindex(false);
              }
            }
          }
        });
        mo.observe(button, { attributes:true });

      }); // end toggles forEach
    })();
  </script>
</body>
</html>