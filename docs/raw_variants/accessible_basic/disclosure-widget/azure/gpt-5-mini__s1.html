<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --focus-outline: 3px solid #005fcc;
      --bg: #ffffff;
      --panel-bg: #f8fafc;
      --accent: #005fcc;
      --text: #0b1220;
      --muted: #495057;
      --max-width: 900px;
      --radius: 8px;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:var(--bg);
      line-height:1.4;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    main{
      max-width:var(--max-width);
      margin:2rem auto;
      padding:1.25rem;
    }

    header h1{
      margin:0 0 .25rem 0;
      font-size:1.5rem;
    }
    header p{
      margin:0 0 1rem 0;
      color:var(--muted);
      font-size:0.95rem;
    }

    .example{
      border:1px solid #e6eef6;
      background:linear-gradient(180deg, #fff 0%, #fbfdff 100%);
      padding:1rem;
      border-radius:var(--radius);
      margin-bottom:1rem;
      box-shadow:0 1px 2px rgba(11,18,32,0.04);
    }

    .expander{
      display:flex;
      align-items:center;
      gap:.75rem;
      background:transparent;
      border:1px solid transparent;
      padding:.45rem .6rem;
      font-size:1rem;
      color:var(--accent);
      cursor:pointer;
      width:100%;
      text-align:left;
      border-radius:6px;
    }

    .expander:hover{
      background:rgba(0,95,204,0.04);
    }

    .expander:focus{
      outline:none;
      box-shadow:var(--focus-outline);
      border-color: rgba(0,95,204,0.12);
      background:rgba(0,95,204,0.03);
    }

    .chevron{
      width:1rem;
      height:1rem;
      flex:0 0 1rem;
      display:inline-block;
      transition:transform 200ms ease;
      color:var(--accent);
    }

    .expander[aria-expanded="true"] .chevron{
      transform:rotate(90deg);
    }

    .summary-text{
      font-weight:600;
      color:var(--text);
      flex:1 1 auto;
    }

    .summary-meta{
      color:var(--muted);
      font-size:. nine; /* fallback */
      font-size:0.95rem;
      flex:0 0 auto;
    }

    .details{
      margin-top:.75rem;
      padding: .75rem;
      background:var(--panel-bg);
      border-radius:6px;
      border:1px solid rgba(11,18,32,0.04);
      transition:opacity 160ms ease, transform 160ms ease;
    }

    .details.hidden{
      display:none;
    }

    /* focus styles for focusable elements inside details */
    .details :focus{
      outline:3px solid rgba(0,95,204,0.18);
      outline-offset:2px;
      border-radius:4px;
    }

    /* small helper */
    .muted{
      color:var(--muted);
      font-size:.95rem;
    }

    /* High contrast link/button color */
    a, button[type="submit"]{
      color:#003f87;
    }

    /* Responsive */
    @media (max-width:520px){
      main{padding:.75rem;}
    }

    /* Utility for visually-hidden (accessible) */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Expand / Collapse Widget Examples</h1>
      <p>These examples demonstrate accessible expand/collapse widgets implemented with a button that controls a content container with class "details". Use Tab to focus the button, then Enter or Space to toggle. Press Escape to close an open region and return focus to its toggle.</p>
    </header>

    <!-- Example 1: Simple informational panel -->
    <div class="example">
      <button class="expander"
              type="button"
              aria-expanded="false"
              aria-controls="details-1"
              id="expander-1">
        <span class="chevron" aria-hidden="true">▸</span>
        <span class="summary-text">What is an expand/collapse widget?</span>
        <span class="summary-meta">Read more</span>
      </button>

      <div class="details hidden"
           id="details-1"
           role="region"
           aria-labelledby="expander-1"
           aria-hidden="true">
        <p class="muted">An expand/collapse widget lets users reveal or hide additional content. The button above updates aria-expanded to reflect the current state, and this region is labeled by that same button.</p>
        <ul>
          <li>Fully keyboard operable (Tab to focus, Enter/Space to toggle).</li>
          <li>Screen readers receive state changes through aria-expanded and aria-hidden.</li>
          <li>Interactive elements inside the region are removed from the accessibility tree when hidden.</li>
        </ul>
      </div>
    </div>

    <!-- Example 2: Interactive content inside details -->
    <div class="example">
      <button class="expander"
              type="button"
              aria-expanded="false"
              aria-controls="details-2"
              id="expander-2">
        <span class="chevron" aria-hidden="true">▸</span>
        <span class="summary-text">Subscribe to the newsletter</span>
        <span class="summary-meta">Sign up</span>
      </button>

      <div class="details hidden"
           id="details-2"
           role="region"
           aria-labelledby="expander-2"
           aria-hidden="true">
        <form aria-describedby="newsletter-desc">
          <p id="newsletter-desc" class="muted">Enter your email and choose preferences. Form controls are reachable only when this panel is expanded.</p>

          <div style="display:flex;gap:.5rem;flex-wrap:wrap;">
            <label for="email" style="display:block;min-width:220px;">
              Email
              <input id="email" name="email" type="email" required style="display:block;width:100%;padding:.45rem .5rem;margin-top:.25rem;border:1px solid #dfe8f5;border-radius:6px;">
            </label>

            <fieldset style="border:none;padding:0;margin:0;min-width:200px;">
              <legend style="font-weight:600;margin-bottom:.25rem;">Frequency</legend>
              <label style="display:block;">
                <input type="radio" name="freq" value="weekly" checked> Weekly
              </label>
              <label style="display:block;">
                <input type="radio" name="freq" value="monthly"> Monthly
              </label>
              <label style="display:block;">
                <input type="radio" name="freq" value="occasionally"> Occasionally
              </label>
            </fieldset>
          </div>

          <div style="margin-top:.75rem;">
            <button type="submit" style="padding:.5rem .75rem;border-radius:6px;background:#eaf3ff;border:1px solid #cfe6ff;cursor:pointer;">Subscribe</button>
            <button type="button" class="close-inline" style="padding:.5rem .75rem;border-radius:6px;background:transparent;border:1px solid transparent;margin-left:.5rem;cursor:pointer;">Close</button>
          </div>
        </form>
      </div>
    </div>

    <footer style="margin-top:1rem;color:var(--muted);font-size:.95rem;">
      <p>Examples conform to accessible patterns: the controlled content container has class="details", and each widget is wrapped in a div.example.</p>
    </footer>
  </main>

  <script>
    (function(){
      // Utility to find all examples and wire up the expander buttons.
      let uid = 0;
      const examples = document.querySelectorAll('.example');

      examples.forEach(example => {
        const btn = example.querySelector('.expander');
        if (!btn) return;

        // Ensure ids exist and match aria-controls / aria-labelledby attributes.
        if (!btn.id) {
          btn.id = 'expander-auto-' + (++uid);
        }

        // Identify the controlled element - prefer aria-controls; fallback to .details inside example
        let controlled = null;
        const controllerId = btn.getAttribute('aria-controls');
        if (controllerId) {
          controlled = document.getElementById(controllerId);
        }
        if (!controlled) {
          controlled = example.querySelector('.details');
        }

        if (!controlled) return;

        // Ensure controlled element has class "details" (as requested) and proper id
        if (!controlled.classList.contains('details')) {
          controlled.classList.add('details');
        }
        if (!controlled.id) {
          controlled.id = 'details-auto-' + (++uid);
        }

        // Sync attributes if not already set
        btn.setAttribute('aria-controls', controlled.id);
        controlled.setAttribute('role', controlled.getAttribute('role') || 'region');
        controlled.setAttribute('aria-labelledby', btn.id);

        // Ensure initial collapsed state: aria-expanded=false and hidden class
        if (btn.getAttribute('aria-expanded') !== 'true') {
          btn.setAttribute('aria-expanded', 'false');
          controlled.classList.add('hidden');
          controlled.setAttribute('aria-hidden','true');
        } else {
          controlled.classList.remove('hidden');
          controlled.removeAttribute('aria-hidden');
        }

        // Click handler to toggle
        btn.addEventListener('click', function(){
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            collapse();
          } else {
            expand();
          }
        });

        // Optional: support the "Close" button inside the details to close and return focus
        const closeInline = example.querySelector('.close-inline');
        if (closeInline) {
          closeInline.addEventListener('click', function(){
            collapse();
            btn.focus();
          });
        }

        // Escape key to close when focus is inside controlled content
        controlled.addEventListener('keydown', function(event){
          if (event.key === 'Escape' || event.key === 'Esc') {
            event.stopPropagation();
            collapse();
            btn.focus();
          }
        });

        function expand(){
          btn.setAttribute('aria-expanded','true');
          controlled.classList.remove('hidden');
          controlled.removeAttribute('aria-hidden');
        }
        function collapse(){
          btn.setAttribute('aria-expanded','false');
          controlled.classList.add('hidden');
          controlled.setAttribute('aria-hidden','true');
        }
      });

      // Global: allow Escape to close any open panels and return focus to their toggle button.
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape' || e.key === 'Esc') {
          // Find any expander with aria-expanded=true
          const open = document.querySelectorAll('.expander[aria-expanded="true"]');
          open.forEach(btn => {
            const controlledId = btn.getAttribute('aria-controls');
            const controlled = document.getElementById(controlledId);
            if (controlled) {
              btn.setAttribute('aria-expanded','false');
              controlled.classList.add('hidden');
              controlled.setAttribute('aria-hidden','true');
              // If focus is inside the controlled region, move it back to the button.
              if (controlled.contains(document.activeElement)) {
                btn.focus();
              }
            }
          });
        }
      });
    })();
  </script>
</body>
</html>