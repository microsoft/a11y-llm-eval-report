<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Expand/Collapse Widget - Examples</title>
  <meta name="description" content="Two accessible expand/collapse widget examples. Each widget has a button that expands or collapses a content region with a container that has class 'details'." />
  <style>
    :root{
      --bg:#ffffff;
      --text:#0b0b0b;
      --muted:#4b5563;
      --accent:#005a9c; /* good contrast blue */
      --accent-contrast:#ffffff;
      --focus:#ffbf47;
      --radius:8px;
      --shadow: 0 2px 6px rgba(11,11,11,0.08);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      font-size:16px;
      line-height:1.4;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--text);
    }

    header{
      padding:1.25rem;
      border-bottom:1px solid #e6e9ee;
      background: linear-gradient(to right, rgba(0,90,156,0.03), transparent);
    }

    .page{
      max-width:880px;
      margin:1.5rem auto;
      padding:1rem;
    }

    h1{
      margin:0 0 .25rem 0;
      font-size:1.5rem;
      font-weight:700;
    }
    p.lead{
      margin:0;
      color:var(--muted);
      font-size:0.95rem;
    }

    .examples{
      margin-top:1.25rem;
      display:grid;
      gap:1rem;
    }

    .example{
      border:1px solid #e6e9ee;
      padding:1rem;
      border-radius:var(--radius);
      background:#fbfdff;
      box-shadow:var(--shadow);
    }

    /* Toggle button */
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:0.75rem;
      padding:0.5rem 0.75rem;
      border-radius:6px;
      border:2px solid transparent;
      background:linear-gradient(180deg,var(--accent),#004a82);
      color:var(--accent-contrast);
      font-weight:600;
      font-size:1rem;
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,0.06);
    }

    .toggle:focus{
      outline:3px solid var(--focus);
      outline-offset:3px;
    }

    .toggle[aria-expanded="true"] .chev{
      transform:rotate(180deg);
    }

    .chev{
      display:inline-block;
      width:1rem;
      height:1rem;
      transition:transform 180ms ease;
      fill:currentColor;
    }

    /* details (controlled content) */
    .details{
      margin-top:0.75rem;
      padding:0.75rem 0.75rem;
      background:#fff;
      border-radius:6px;
      border:1px solid #eef2f6;
    }

    /* Visually hidden helper */
    .visually-hidden{
      position:absolute !important;
      height:1px;width:1px;
      overflow:hidden;
      clip:rect(1px,1px,1px,1px);
      white-space:nowrap;
    }

    /* Ensure sufficient contrast and spacing for content */
    .details h3{
      margin:0 0 .5rem 0;
      font-size:1.05rem;
    }
    .details p{
      margin:0 0 .5rem 0;
      color:var(--muted);
      font-size:0.95rem;
    }

    /* Reduce motion respecting user preference */
    @media (prefers-reduced-motion: reduce) {
      .chev, .toggle, .details { transition: none !important; }
    }

    /* Make example titles */
    .example-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
    }

    /* Make links clearly visible and high contrast */
    a{
      color:var(--accent);
    }

    /* Responsive adjustments */
    @media (max-width:520px){
      .page{ padding:0.75rem; }
      .toggle{ width:100%; justify-content:center; }
      .example{ padding:0.75rem; }
    }
  </style>
</head>
<body>
  <a class="visually-hidden" href="#main">Skip to main content</a>

  <header>
    <div class="page" aria-hidden="false">
      <h1>Accessible Expand/Collapse Widget Examples</h1>
      <p class="lead">Each example uses a button to expand or collapse a content region. The content container for each widget uses the class "details".</p>
    </div>
  </header>

  <main id="main" class="page" tabindex="-1">
    <section aria-label="Examples" class="examples">

      <!-- Example 1: Collapsed by default -->
      <div class="example">
        <div class="example-title">
          <div>
            <strong>Example 1 — Collapsed by default</strong>
            <div style="color:var(--muted); font-size:0.9rem;">Initial state: collapsed</div>
          </div>
        </div>

        <div style="margin-top:0.75rem;">
          <button
            id="toggle-1"
            class="toggle"
            aria-expanded="false"
            aria-controls="details-1"
            type="button">
            <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
              <path d="M5.23 7.21a.75.75 0 0 1 1.06-.02L10 10.88l3.71-3.69a.75.75 0 0 1 1.06 1.06l-4.24 4.22a.75.75 0 0 1-1.06 0L5.25 8.25a.75.75 0 0 1-.02-1.04z"/>
            </svg>
            Show details
          </button>

          <div
            id="details-1"
            class="details"
            role="region"
            aria-labelledby="toggle-1"
            hidden>
            <h3>More information</h3>
            <p>This section is collapsed by default. When expanded, it becomes part of the page flow and is accessible to screen readers and keyboard users.</p>
            <p>Buttons inside this region remain reachable only when the region is expanded.</p>
            <p><a href="#main">Back to top</a></p>
          </div>
        </div>
      </div>

      <!-- Example 2: Expanded by default -->
      <div class="example">
        <div class="example-title">
          <div>
            <strong>Example 2 — Expanded by default</strong>
            <div style="color:var(--muted); font-size:0.9rem;">Initial state: expanded</div>
          </div>
        </div>

        <div style="margin-top:0.75rem;">
          <button
            id="toggle-2"
            class="toggle"
            aria-expanded="true"
            aria-controls="details-2"
            type="button">
            <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
              <path d="M5.23 7.21a.75.75 0 0 1 1.06-.02L10 10.88l3.71-3.69a.75.75 0 0 1 1.06 1.06l-4.24 4.22a.75.75 0 0 1-1.06 0L5.25 8.25a.75.75 0 0 1-.02-1.04z"/>
            </svg>
            Hide details
          </button>

          <div
            id="details-2"
            class="details"
            role="region"
            aria-labelledby="toggle-2">
            <h3>Visible details</h3>
            <p>This section is expanded by default. Notice that assistive technologies can locate this region through the region role and the aria-labelledby reference to the control.</p>
            <p>The button's aria-expanded attribute is synchronized with the visible state of the content.</p>

            <form style="margin-top:0.5rem;" aria-label="Example form inside expanded details">
              <label for="name-2" style="display:block; font-weight:600; margin-bottom:0.25rem;">Name</label>
              <input id="name-2" name="name" type="text" placeholder="Your name" style="padding:0.5rem; border:1px solid #d1d7dd; border-radius:4px; width:100%; max-width:320px;" />

              <div style="margin-top:0.5rem;">
                <button type="button" style="padding:0.45rem 0.6rem; border-radius:6px; border:1px solid #ccd6df; background:#f3f6f9;">Action</button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </section>
  </main>

  <!-- Live region for announcements -->
  <div id="announce" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function () {
      // Helper to initialize expand/collapse buttons
      function initToggle(button) {
        var controlsId = button.getAttribute('aria-controls');
        if (!controlsId) return;
        var panel = document.getElementById(controlsId);
        if (!panel) return;

        // Ensure the panel has class 'details' per requirement
        if (!panel.classList.contains('details')) {
          panel.classList.add('details');
        }

        // Ensure role and aria-labelledby
        if (!panel.hasAttribute('role')) {
          panel.setAttribute('role', 'region');
        }
        panel.setAttribute('aria-labelledby', button.id);

        // Click toggles visibility
        button.addEventListener('click', function () {
          var expanded = button.getAttribute('aria-expanded') === 'true';
          var next = !expanded;
          button.setAttribute('aria-expanded', String(next));
          if (next) {
            panel.removeAttribute('hidden');
            panel.removeAttribute('aria-hidden');
            // Update button text to reflect action (keeps visible label meaningful)
            // If button text contains "Show" or "Hide" we toggle. Otherwise we leave as-is.
            if (/show/i.test(button.textContent)) {
              button.textContent = 'Hide details';
            }
            announce(button, 'expanded');
          } else {
            panel.setAttribute('hidden', '');
            panel.setAttribute('aria-hidden', 'true');
            if (/hide/i.test(button.textContent)) {
              button.textContent = 'Show details';
            }
            announce(button, 'collapsed');
            // Move focus back to button to avoid leaving focus in hidden content
            button.focus({preventScroll:true});
          }
          // Re-append icon for consistent visual
          appendChevron(button);
        });

        // Ensure initial state is consistent: if aria-expanded is false, add hidden
        var isExpanded = button.getAttribute('aria-expanded') === 'true';
        if (!isExpanded) {
          panel.setAttribute('hidden', '');
          panel.setAttribute('aria-hidden', 'true');
        } else {
          panel.removeAttribute('hidden');
          panel.removeAttribute('aria-hidden');
        }

        // Make sure chevron present at initialization
        appendChevron(button);
      }

      // Append a chevron svg as first child of the button, preserving accessible text
      function appendChevron(button) {
        // Remove existing chevrons inserted by script to avoid duplication
        var existing = button.querySelectorAll('svg[data-chev-added]');
        existing.forEach(function (el) { el.remove(); });

        // Create new chevron
        var ns = 'http://www.w3.org/2000/svg';
        var svg = document.createElementNS(ns, 'svg');
        svg.setAttribute('viewBox', '0 0 20 20');
        svg.setAttribute('aria-hidden', 'true');
        svg.setAttribute('focusable', 'false');
        svg.setAttribute('class', 'chev');
        svg.setAttribute('data-chev-added', 'true');
        var path = document.createElementNS(ns, 'path');
        path.setAttribute('d', 'M5.23 7.21a.75.75 0 0 1 1.06-.02L10 10.88l3.71-3.69a.75.75 0 0 1 1.06 1.06l-4.24 4.22a.75.75 0 0 1-1.06 0L5.25 8.25a.75.75 0 0 1-.02-1.04z');
        svg.appendChild(path);

        // Place the chevron at the start of the button content
        button.insertBefore(svg, button.firstChild);
      }

      // Announce state changes in live region for additional clarity
      function announce(control, state) {
        var label = control.textContent.trim();
        var regionLabel = control.getAttribute('aria-controls') || '';
        var msg = label + ' ' + state;
        var live = document.getElementById('announce');
        if (live) {
          live.textContent = msg;
        }
      }

      // Initialize all toggles on the page
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(initToggle);

      // Keyboard support: buttons by default support Enter and Space.
      // Extra keyboard behavior (optional): allow Ctrl+M to toggle for power users.
      document.addEventListener('keydown', function (e) {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'm') {
          // Find the first toggle in document order and toggle it
          var first = document.querySelector('button[aria-controls]');
          if (first) {
            first.click();
            e.preventDefault();
          }
        }
      });

      // Ensure focus styles remain visible for keyboard users (accessibility)
      // No additional polyfills required.
    })();
  </script>
</body>
</html>