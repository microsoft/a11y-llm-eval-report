<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.55);
      --dialog-bg: #ffffff;
      --accent: #0078d4;
      --text: #0b0b0b;
      --shadow: 0 8px 24px rgba(11,11,11,0.25);
      --radius: 8px;
      --focus-outline: 3px solid Highlight;
    }

    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      line-height: 1.4;
      color: var(--text);
      margin: 0;
      background: #f6f7f9;
    }

    header, main {
      padding: 1.25rem;
      max-width: 900px;
      margin: 0 auto;
    }

    h1{
      font-size: 1.25rem;
      margin: .25rem 0 1rem;
    }

    p{
      margin: .5rem 0;
    }

    .trigger {
      display: inline-block;
      padding: .6rem .9rem;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,0.12);
      background: linear-gradient(#fff,#f7f9fc);
      cursor: pointer;
      color: var(--text);
      font-weight: 600;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
    }
    .trigger:focus {
      outline: var(--focus-outline);
      outline-offset: 3px;
    }

    /* Modal overlay and dialog */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      z-index: 1000;
      padding: 1.25rem;
    }
    .modal-overlay[open] {
      display: flex;
    }

    .dialog {
      background: var(--dialog-bg);
      max-width: 680px;
      width: 100%;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1rem;
      box-sizing: border-box;
    }

    .dialog:focus {
      outline: none;
    }

    .dialog-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: .5rem;
    }
    .dialog-title {
      margin: 0;
      font-size: 1.125rem;
    }

    .close {
      background: transparent;
      border: none;
      padding: .25rem;
      margin: 0;
      font-size: 1rem;
      cursor: pointer;
      color: #333;
      border-radius: 6px;
    }
    .close:focus {
      outline: var(--focus-outline);
      outline-offset: 3px;
    }

    .dialog-body {
      padding: .25rem 0 1rem;
      color: #222;
    }

    .dialog-footer {
      display: flex;
      gap: .5rem;
      justify-content: flex-end;
    }

    .btn {
      padding: .5rem .75rem;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,0.12);
      background: #fff;
      cursor: pointer;
    }
    .btn.primary {
      background: var(--accent);
      color: white;
      border-color: transparent;
    }
    .btn:focus {
      outline: var(--focus-outline);
      outline-offset: 3px;
    }

    /* Ensure high contrast for focus outlines and keyboard users */
    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; }
    }

    /* Low-contrast-friendly visible focus for keyboard navigation */
    :focus {
      outline-offset: 3px;
    }

    /* Make overlay content reachable on small screens */
    @media (max-width: 420px) {
      .dialog { padding: .75rem; border-radius: 6px; }
      .dialog-title { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Modal Dialog Component â€” Accessible Example</h1>
    <p>
      This page demonstrates an accessible modal dialog component. The modal is closed by default.
      Use the keyboard to open (Enter/Space on the button), navigate inside, and close (Escape).
    </p>
    <p>
      <button class="trigger" id="open-modal">Open Modal</button>
    </p>
  </header>

  <main id="main-content">
    <section aria-labelledby="content-heading">
      <h2 id="content-heading">Main page content</h2>
      <p>
        This area represents the main content of the page. When the modal opens, this content will be marked as inert to assistive technology.
      </p>
      <p>
        Try tabbing through the page to see keyboard focus move to the Open Modal button. When the modal opens focus will move into the dialog and be trapped there.
      </p>
      <a href="#more">Example link</a>
    </section>
  </main>

  <!-- Modal overlay (hidden by default) -->
  <div class="modal-overlay" id="modal" role="presentation" aria-hidden="true">
    <!-- focus sentinel before dialog for robust keyboard trapping -->
    <div tabindex="0" aria-hidden="true" id="sentinel-start" style="position:absolute;width:1px;height:1px;overflow:hidden;left:-10000px"></div>

    <div
      class="dialog"
      role="dialog"
      aria-modal="true"
      aria-labelledby="dialog-title"
      aria-describedby="dialog-desc"
      id="dialog"
      tabindex="-1"
    >
      <header class="dialog-header">
        <h3 class="dialog-title" id="dialog-title">Confirm action</h3>
        <button class="close" id="close-modal" aria-label="Close dialog">&times;</button>
      </header>

      <div class="dialog-body" id="dialog-desc">
        <p>
          Are you sure you want to proceed with this action? This modal traps focus while open and can be closed with the Escape key, by clicking the close button, or by clicking outside the dialog.
        </p>
      </div>

      <footer class="dialog-footer">
        <button class="btn" id="cancel">Cancel</button>
        <button class="btn primary" id="confirm">Confirm</button>
      </footer>
    </div>

    <!-- focus sentinel after dialog for robust keyboard trapping -->
    <div tabindex="0" aria-hidden="true" id="sentinel-end" style="position:absolute;width:1px;height:1px;overflow:hidden;left:-10000px"></div>
  </div>

  <script>
    (function () {
      // Elements
      const modalOverlay = document.getElementById('modal');
      const dialog = document.getElementById('dialog');
      const openButton = document.querySelector('.trigger');
      const closeButton = document.getElementById('close-modal');
      const cancelButton = document.getElementById('cancel');
      const confirmButton = document.getElementById('confirm');
      const mainContent = document.getElementById('main-content');
      const sentinelStart = document.getElementById('sentinel-start');
      const sentinelEnd = document.getElementById('sentinel-end');

      let lastFocusedElement = null;

      // Utility: find focusable elements within a container
      function getFocusableElements(container) {
        const focusableSelectors = [
          'a[href]:not([tabindex="-1"])',
          'area[href]:not([tabindex="-1"])',
          'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
          'select:not([disabled]):not([tabindex="-1"])',
          'textarea:not([disabled]):not([tabindex="-1"])',
          'button:not([disabled]):not([tabindex="-1"])',
          'iframe:not([tabindex="-1"])',
          '[tabindex]:not([tabindex="-1"])',
          '[contenteditable]'
        ];
        const nodes = container.querySelectorAll(focusableSelectors.join(','));
        return Array.prototype.slice.call(nodes).filter(function (node) {
          return node.offsetWidth > 0 || node.offsetHeight > 0 || node.getClientRects().length;
        });
      }

      // Open modal
      function openModal(trigger) {
        lastFocusedElement = trigger || document.activeElement;
        modalOverlay.setAttribute('open', '');
        modalOverlay.removeAttribute('aria-hidden');
        // mark main content as hidden to AT
        mainContent.setAttribute('aria-hidden', 'true');
        // prevent page scroll
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';
        // focus the dialog for screen reader context
        window.setTimeout(() => {
          // Move focus to first focusable element inside dialog, or the dialog itself
          const focusable = getFocusableElements(dialog);
          if (focusable.length) {
            focusable[0].focus();
          } else {
            dialog.focus();
          }
        }, 0);
        // attach keydown handler
        document.addEventListener('keydown', onKeyDown, true);
      }

      // Close modal
      function closeModal() {
        modalOverlay.removeAttribute('open');
        modalOverlay.setAttribute('aria-hidden', 'true');
        mainContent.removeAttribute('aria-hidden');
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
        // restore focus
        if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          lastFocusedElement.focus();
        }
        document.removeEventListener('keydown', onKeyDown, true);
      }

      // Handle key events for Escape and Tab trapping
      function onKeyDown(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trapping inside dialog
          const focusable = getFocusableElements(dialog);
          if (focusable.length === 0) {
            // if there are no focusable elements, keep focus on dialog
            e.preventDefault();
            dialog.focus();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Click outside to close (overlay click)
      function onOverlayClick(e) {
        // If the click target is the overlay itself (not inside dialog), close
        if (e.target === modalOverlay) {
          closeModal();
        }
      }

      // Focus sentinel handlers for additional robustness (for some AT)
      sentinelStart.addEventListener('focus', function () {
        const focusable = getFocusableElements(dialog);
        if (focusable.length) {
          focusable[focusable.length - 1].focus();
        } else {
          dialog.focus();
        }
      });
      sentinelEnd.addEventListener('focus', function () {
        const focusable = getFocusableElements(dialog);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          dialog.focus();
        }
      });

      // Attach triggers
      if (openButton) {
        openButton.addEventListener('click', function () {
          openModal(openButton);
        });
        // Keyboard activation for accessibility (Enter/Space already handled by button)
        openButton.addEventListener('keydown', function (e) {
          // If a non-button element were used, we'd need to handle Enter/Space.
        });
      }

      // Close handlers
      closeButton.addEventListener('click', closeModal);
      cancelButton.addEventListener('click', closeModal);
      confirmButton.addEventListener('click', function () {
        // Simulate confirm action then close
        // In a real app, you would perform the action here.
        alert('Action confirmed');
        closeModal();
      });

      modalOverlay.addEventListener('click', onOverlayClick);

      // Ensure modal is closed by default
      modalOverlay.removeAttribute('open');
      modalOverlay.setAttribute('aria-hidden', 'true');

      // Accessibility: if focus escapes (rare), bring it back
      document.addEventListener('focusin', function (e) {
        if (modalOverlay.hasAttribute('open')) {
          if (!modalOverlay.contains(e.target)) {
            // If focus moved outside while modal open, move it back to dialog
            const focusable = getFocusableElements(dialog);
            (focusable[0] || dialog).focus();
          }
        }
      });
    })();
  </script>
</body>
</html>