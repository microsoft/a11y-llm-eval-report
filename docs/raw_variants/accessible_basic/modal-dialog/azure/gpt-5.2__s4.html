<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111827;
      --muted: #4b5563;
      --border: #d1d5db;
      --overlay: rgba(0, 0, 0, 0.6);
      --focus: #1d4ed8;
      --primary: #1d4ed8;
      --primaryText: #ffffff;
      --danger: #b91c1c;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
    }

    main {
      padding: 2rem 1rem;
      max-width: 60rem;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0 0 0.75rem;
    }

    p {
      margin: 0 0 1rem;
      color: var(--muted);
      max-width: 60ch;
    }

    button {
      font: inherit;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.6rem 0.9rem;
      background: #f9fafb;
      color: var(--text);
      cursor: pointer;
    }

    button:hover {
      background: #f3f4f6;
    }

    button:active {
      transform: translateY(1px);
    }

    button:focus-visible,
    a:focus-visible,
    input:focus-visible,
    textarea:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--primaryText);
      border-color: transparent;
    }

    .btn-primary:hover {
      background: #1e40af;
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
      border-color: transparent;
    }

    .btn-danger:hover {
      background: #991b1b;
    }

    .actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    /* Dialog */
    dialog {
      border: none;
      padding: 0;
      border-radius: 0.75rem;
      max-width: min(36rem, calc(100vw - 2rem));
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      background: var(--bg);
      color: var(--text);
    }

    dialog::backdrop {
      background: var(--overlay);
    }

    .dialog-inner {
      padding: 1.25rem;
    }

    .dialog-header {
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 1rem;
      border-bottom: 1px solid var(--border);
      padding: 1.25rem;
    }

    .dialog-title {
      margin: 0;
      font-size: 1.25rem;
      line-height: 1.2;
    }

    .dialog-close {
      flex: none;
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      background: #f9fafb;
    }

    .dialog-body {
      padding: 1.25rem;
    }

    .dialog-body p {
      color: var(--text);
      margin: 0 0 1rem;
      max-width: 70ch;
    }

    .dialog-footer {
      border-top: 1px solid var(--border);
      padding: 1.25rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .field {
      display: grid;
      gap: 0.4rem;
      margin: 0.75rem 0 1rem;
    }

    label {
      font-weight: 600;
    }

    input[type="text"] {
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      font: inherit;
    }

    .hint {
      color: var(--muted);
      font-size: 0.95rem;
      margin: 0;
    }
  </style>
</head>
<body>
  <main>
    <h1>Modal dialog example</h1>
    <p>
      This example uses the native <code>&lt;dialog&gt;</code> element. The dialog is closed by default.
      Use the “Open dialog” button to open it. Keyboard support includes <kbd>Tab</kbd> navigation and <kbd>Escape</kbd> to close.
    </p>

    <div class="actions">
      <button class="trigger btn-primary" type="button" aria-haspopup="dialog" aria-controls="example-dialog">
        Open dialog
      </button>
      <button type="button" id="outside-action">
        Another page action
      </button>
    </div>

    <dialog id="example-dialog" aria-labelledby="dialog-title" aria-describedby="dialog-desc">
      <div class="dialog-header">
        <h2 class="dialog-title" id="dialog-title">Example modal dialog</h2>
        <button type="button" class="dialog-close" id="dialog-close">
          <span aria-hidden="true">✕</span>
          <span class="sr-only">Close dialog</span>
        </button>
      </div>

      <div class="dialog-body">
        <p id="dialog-desc">
          This is a modal dialog. Focus is moved into the dialog when it opens and restored to the trigger when it closes.
        </p>

        <div class="field">
          <label for="name">Name</label>
          <input id="name" name="name" type="text" autocomplete="name" />
          <p class="hint" id="name-hint">Optional: type something, then press “Save”.</p>
        </div>
      </div>

      <div class="dialog-footer">
        <button type="button" id="cancel-btn">Cancel</button>
        <button type="button" class="btn-primary" id="save-btn">Save</button>
      </div>
    </dialog>
  </main>

  <style>
    /* Visually hidden utility (accessible to screen readers) */
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>

  <script>
    (function () {
      const dialog = document.getElementById('example-dialog');
      const trigger = document.querySelector('button.trigger');
      const closeBtn = document.getElementById('dialog-close');
      const cancelBtn = document.getElementById('cancel-btn');
      const saveBtn = document.getElementById('save-btn');
      const nameInput = document.getElementById('name');

      let lastActiveElement = null;

      function openDialog() {
        lastActiveElement = document.activeElement;
        trigger.setAttribute('aria-expanded', 'true');

        if (typeof dialog.showModal === 'function') {
          dialog.showModal();
        } else {
          // Fallback (non-modal) if <dialog> isn't supported
          dialog.setAttribute('open', '');
        }

        // Move focus into the dialog
        window.requestAnimationFrame(() => {
          nameInput.focus();
        });
      }

      function closeDialog() {
        trigger.setAttribute('aria-expanded', 'false');

        if (dialog.open) {
          dialog.close();
        } else {
          dialog.removeAttribute('open');
        }

        // Restore focus to the element that opened the dialog
        window.requestAnimationFrame(() => {
          if (lastActiveElement && typeof lastActiveElement.focus === 'function') {
            lastActiveElement.focus();
          } else {
            trigger.focus();
          }
        });
      }

      trigger.addEventListener('click', openDialog);

      closeBtn.addEventListener('click', closeDialog);
      cancelBtn.addEventListener('click', closeDialog);

      saveBtn.addEventListener('click', () => {
        // Example action: "save" then close
        closeDialog();
      });

      // Clicking the backdrop area closes the dialog (but not clicks inside)
      dialog.addEventListener('click', (event) => {
        const rect = dialog.getBoundingClientRect();
        const isInDialog =
          rect.top <= event.clientY &&
          event.clientY <= rect.top + rect.height &&
          rect.left <= event.clientX &&
          event.clientX <= rect.left + rect.width;

        if (!isInDialog) closeDialog();
      });

      // Ensure focus is restored on close (including Esc)
      dialog.addEventListener('close', () => {
        trigger.setAttribute('aria-expanded', 'false');
        window.requestAnimationFrame(() => {
          if (lastActiveElement && typeof lastActiveElement.focus === 'function') {
            lastActiveElement.focus();
          } else {
            trigger.focus();
          }
        });
      });

      // Initialize aria-expanded
      trigger.setAttribute('aria-expanded', 'false');
    })();
  </script>
</body>
</html>