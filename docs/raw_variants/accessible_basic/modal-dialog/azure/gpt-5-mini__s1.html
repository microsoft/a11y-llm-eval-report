<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --dialog-bg: #ffffff;
      --accent: #005a9e;
      --text: #0b0b0b;
      --radius: 8px;
      --max-width: 640px;
      --gap: 1rem;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:#f7f7f7;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Basic page layout */
    header, main, footer {
      padding: 1rem;
      margin: 0 auto;
      max-width: 900px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:var(--gap);
    }
    header h1{
      font-size:1.125rem;
      margin:0;
    }

    /* Trigger button */
    .trigger {
      appearance:none;
      background:var(--accent);
      color:white;
      border:0;
      padding:0.5rem 0.75rem;
      border-radius:6px;
      font-size:1rem;
      cursor:pointer;
      box-shadow:0 1px 0 rgba(0,0,0,0.15);
    }
    .trigger:focus {
      outline:3px solid Highlight;
      outline-offset:3px;
    }

    /* Overlay and dialog */
    .overlay {
      position: fixed;
      inset: 0;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      z-index: 1000;
      padding: 1.25rem;
    }
    .overlay[aria-hidden="false"] {
      display: flex;
    }

    .dialog {
      background: var(--dialog-bg);
      max-width: var(--max-width);
      width: 100%;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      padding: 1rem 1rem 0.75rem 1rem;
      box-sizing: border-box;
      outline: none;
    }

    .dialog-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:0.5rem;
      margin-bottom:0.5rem;
    }
    .dialog h2 {
      margin:0;
      font-size:1rem;
    }

    .close {
      background:transparent;
      border:0;
      color:var(--text);
      padding:0.25rem;
      border-radius:6px;
      cursor:pointer;
      font-size:1rem;
    }
    .close:focus {
      outline:3px solid Highlight;
      outline-offset:3px;
    }

    .dialog-body {
      padding: 0.25rem 0;
      margin-bottom:0.75rem;
      font-size:0.95rem;
      line-height:1.4;
    }

    .dialog-footer {
      display:flex;
      gap:0.5rem;
      justify-content:flex-end;
      margin-top:0.5rem;
    }

    .btn {
      padding:0.5rem 0.75rem;
      border-radius:6px;
      border:1px solid rgba(0,0,0,0.1);
      background:white;
      cursor:pointer;
      font-size:0.95rem;
    }
    .btn.primary {
      background:var(--accent);
      color:white;
      border:0;
    }
    .btn:focus {
      outline:3px solid Highlight;
      outline-offset:3px;
    }

    /* Reduce motion for users who prefer reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .overlay { transition: none; }
      .dialog { transition: none; transform:none; }
    }

    /* Visible focus for keyboard users */
    :focus {
      outline-offset: 3px;
    }

    /* Ensure focusable content in the background is still visible but not obscured */
    main[aria-hidden="true"] {
      filter: blur(0.25px);
    }

    /* Responsive adjustments */
    @media (max-width: 420px) {
      .dialog {
        padding: 0.75rem;
      }
      .dialog-footer {
        flex-direction: column-reverse;
        align-items: stretch;
      }
      .btn { width:100%; }
    }

    /* Make sure overlay covers content for keyboard pointer users */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap; /* added line */
    }
  </style>
</head>
<body>
  <header>
    <h1>Example Page</h1>
    <p class="visually-hidden" id="main-desc">Demo showing an accessible modal dialog component.</p>
  </header>

  <main id="main" aria-labelledby="main-heading" aria-describedby="main-desc">
    <section>
      <h2 id="main-heading">Main content</h2>
      <p>This page contains a button that opens a modal dialog. The dialog is closed by default.</p>
      <p>
        <button type="button" class="trigger" id="openDialog">Open dialog</button>
      </p>

      <p>Some additional interactive controls to demonstrate focus behavior:</p>
      <form>
        <label for="name">Name: </label>
        <input id="name" name="name" type="text">
        <button type="button">Another button</button>
      </form>
    </section>
  </main>

  <!-- Overlay and dialog (closed by default) -->
  <div class="overlay" id="dialogOverlay" role="presentation" aria-hidden="true">
    <div
      class="dialog"
      role="dialog"
      aria-modal="true"
      aria-labelledby="dialogTitle"
      aria-describedby="dialogDescription"
      id="dialog"
      tabindex="-1"
    >
      <div class="dialog-header">
        <h2 id="dialogTitle">Subscribe to updates</h2>
        <button class="close" id="closeDialog" aria-label="Close dialog">&times;</button>
      </div>

      <div class="dialog-body" id="dialogDescription">
        <p id="dialogText">Sign up with your email to receive occasional updates. This modal traps focus while open; press Escape to close.</p>
        <form id="subscribeForm">
          <label for="email">Email</label><br>
          <input id="email" name="email" type="email" required aria-required="true" style="width:100%; padding:0.5rem; margin-top:0.25rem; margin-bottom:0.5rem;">
        </form>
      </div>

      <div class="dialog-footer">
        <button type="button" class="btn" id="cancelBtn">Cancel</button>
        <button type="submit" form="subscribeForm" class="btn primary" id="saveBtn">Subscribe</button>
      </div>
    </div>
  </div>

  <footer>
    <p>Footer content - background page content (should not be accessible while the dialog is open).</p>
  </footer>

  <script>
    (function(){
      const openButton = document.querySelector('.trigger'); // requirement: button has class 'trigger'
      const overlay = document.getElementById('dialogOverlay');
      const dialog = document.getElementById('dialog');
      const closeButton = document.getElementById('closeDialog');
      const cancelBtn = document.getElementById('cancelBtn');
      const main = document.getElementById('main');

      // Track previously focused element to restore focus when closing
      let lastFocusedElement = null;

      // Utility: return all focusable elements within a container
      function getFocusableElements(container){
        const selector = [
          'a[href]:not([tabindex^="-"]):not([inert])',
          'area[href]:not([tabindex^="-"])',
          'input:not([disabled]):not([type="hidden"]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'iframe:not([tabindex^="-"])',
          'audio[controls]:not([tabindex^="-"])',
          'video[controls]:not([tabindex^="-"])',
          '[contenteditable]:not([tabindex^="-"])',
          '[tabindex]:not([tabindex^="-"])'
        ].join(', ');
        return Array.prototype.slice.call(container.querySelectorAll(selector));
      }

      function openDialog() {
        // save current focus
        lastFocusedElement = document.activeElement;

        // show overlay
        overlay.setAttribute('aria-hidden', 'false');

        // mark main content as hidden to assistive tech
        main.setAttribute('aria-hidden', 'true');

        // attempt to set inert on background if supported
        try {
          if ('inert' in HTMLElement.prototype) {
            main.inert = true;
          } else {
            // if inert is not supported, set aria-hidden and rely on focus trap
            main.setAttribute('aria-hidden', 'true');
          }
        } catch (e) {
          main.setAttribute('aria-hidden', 'true');
        }

        // prevent background scroll
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';

        // focus the dialog container so screen readers announce it, but then move focus to first focusable element
        dialog.focus();

        // set focus to first focusable element inside dialog or close button
        const innerFocusable = getFocusableElements(dialog);
        if (innerFocusable.length) {
          innerFocusable[0].focus();
        } else {
          dialog.focus();
        }

        // add keydown listener for focus trap and escape
        document.addEventListener('keydown', handleKeyDown, true);
        // click on overlay to close
        overlay.addEventListener('click', handleOverlayClick);
      }

      function closeDialog(returnFocus = true) {
        overlay.setAttribute('aria-hidden', 'true');
        main.removeAttribute('aria-hidden');
        try {
          if ('inert' in HTMLElement.prototype) {
            main.inert = false;
          }
        } catch (e) {
          /* ignore */
        }
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
        document.removeEventListener('keydown', handleKeyDown, true);
        overlay.removeEventListener('click', handleOverlayClick);

        if (returnFocus && lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          lastFocusedElement.focus();
        }
      }

      function handleKeyDown(event) {
        const isTab = event.key === 'Tab' || event.keyCode === 9;
        const isEsc = event.key === 'Escape' || event.key === 'Esc' || event.keyCode === 27;

        if (isEsc) {
          event.preventDefault();
          closeDialog(true);
          return;
        }

        if (!isTab) return;

        // Focus trap
        const focusable = getFocusableElements(dialog);
        if (focusable.length === 0) {
          // If no focusable elements, keep focus on dialog
          event.preventDefault();
          dialog.focus();
          return;
        }

        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        const active = document.activeElement;

        if (event.shiftKey) {
          // Shift + Tab
          if (active === first || active === dialog) {
            event.preventDefault();
            last.focus();
          }
        } else {
          // Tab
          if (active === last) {
            event.preventDefault();
            first.focus();
          }
        }
      }

      function handleOverlayClick(event) {
        // If click is directly on overlay (not inside dialog), close
        if (event.target === overlay) {
          closeDialog(true);
        }
      }

      // Attach open and close handlers
      openButton.addEventListener('click', function() {
        openDialog();
      });

      // Support keyboard activation from keyboard (Enter/Space) is native for button elements.

      closeButton.addEventListener('click', function() {
        closeDialog(true);
      });

      cancelBtn.addEventListener('click', function() {
        closeDialog(true);
      });

      // Ensure dialog submit does not reload the page for demo
      const subscribeForm = document.getElementById('subscribeForm');
      subscribeForm.addEventListener('submit', function(e){
        e.preventDefault();
        // fake successful submission and close dialog
        alert('Thank you for subscribing!');
        closeDialog(true);
      });

      // If the user navigates (tab) and focus ends up outside for any reason, ensure dialog remains first
      // This is a defensive handler; the main trap is in keydown.
      document.addEventListener('focusin', function(e){
        const overlayVisible = overlay.getAttribute('aria-hidden') === 'false';
        if (!overlayVisible) return;
        if (!dialog.contains(e.target)) {
          // move focus back into dialog
          const focusable = getFocusableElements(dialog);
          if (focusable.length) {
            focusable[0].focus();
          } else {
            dialog.focus();
          }
        }
      }, true);

      // Accessibility: close dialog if user navigates away / unload
      window.addEventListener('beforeunload', function(){
        // ensure background scrolling restored
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
      });
    })();
  </script>
</body>
</html>