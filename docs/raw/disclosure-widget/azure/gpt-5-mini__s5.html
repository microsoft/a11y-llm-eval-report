<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --accent:#2b6cb0;
      --muted:#6b7280;
      --border:#e5e7eb;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111827;
      margin:24px;
      line-height:1.45;
    }

    h1{font-size:1.25rem;margin:0 0 12px;}
    p.lead{margin:0 0 18px;color:var(--muted);}

    .example{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:8px;
      padding:16px;
      margin:16px 0;
      box-shadow:0 1px 2px rgba(15,23,42,0.03);
      max-width:840px;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:12px;
      background:transparent;
      border:0;
      width:100%;
      text-align:left;
      padding:8px 10px;
      font-size:1rem;
      cursor:pointer;
      color:inherit;
    }
    .toggle:focus{
      outline:3px solid rgba(59,130,246,0.15);
      outline-offset:2px;
      border-radius:6px;
    }
    .toggle .label{
      flex:1;
      font-weight:600;
    }
    .toggle .summary{
      color:var(--muted);
      font-size:.9rem;
      white-space:nowrap;
      margin-left:6px;
    }

    .icon{
      width:28px;
      height:28px;
      display:inline-grid;
      place-items:center;
      border-radius:6px;
      background:rgba(15,23,42,0.03);
      color:var(--accent);
      font-weight:700;
      transition:transform .18s ease;
      flex:0 0 28px;
    }
    .open .icon{ transform: rotate(45deg); }

    /* Controlled content: .details */
    .details{
      overflow:hidden;
      transition:max-height .25s cubic-bezier(.2,.9,.2,1), opacity .18s ease, padding .18s ease;
      will-change: max-height, opacity;
      margin-top:8px;
      border-radius:6px;
      padding:10px;
      background:linear-gradient(180deg, rgba(59,130,246,0.03), rgba(99,102,241,0.01));
      border:1px solid rgba(15,23,42,0.02);
    }
    .details[aria-hidden="true"]{
      /* these styles are for when hidden; actual animation handled by JS via max-height */
      pointer-events:none;
      opacity:0;
    }
    .details[aria-hidden="false"]{
      opacity:1;
      pointer-events:auto;
    }

    /* little content styles */
    .details p{margin:0 0 10px;}
    .details ul{margin:0 0 10px 18px;padding:0;}
    .muted{color:var(--muted);font-size:.95rem;}

    /* prefer reduced motion: no transition */
    @media (prefers-reduced-motion: reduce){
      .details{ transition:none !important; }
      .icon{ transition:none !important; }
    }
  </style>
</head>
<body>
  <main>
    <h1>Expand / Collapse Widget Demo</h1>
    <p class="lead">Accessible expand/collapse widgets. Each widget is wrapped in a div.example and the controlled content container uses the class details.</p>

    <!-- Example 1: Simple -->
    <div class="example" id="example-1">
      <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1">
        <span class="icon" aria-hidden="true">+</span>
        <span class="label">Simple details</span>
        <span class="summary muted">Click to reveal extra information</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <p>This is a simple expandable area. Use the button above to show or hide this content. The implementation updates aria-expanded on the button and aria-hidden on this container for accessibility.</p>
      </div>
    </div>

    <!-- Example 2: Multiple items -->
    <div class="example" id="example-2">
      <button class="toggle" id="toggle-2" aria-expanded="false" aria-controls="details-2">
        <span class="icon" aria-hidden="true">+</span>
        <span class="label">FAQ — Multiple points</span>
        <span class="summary muted">Contains several items</span>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="true">
        <p class="muted">Common questions and short answers:</p>
        <ul>
          <li><strong>Q:</strong> How does this work? <br><strong>A:</strong> JavaScript toggles max-height and aria attributes, producing a smooth animation.</li>
          <li><strong>Q:</strong> Is it keyboard accessible? <br><strong>A:</strong> Yes — the control is a native button (Enter/Space will toggle).</li>
          <li><strong>Q:</strong> Are screen readers supported? <br><strong>A:</strong> The button uses aria-expanded and the region uses aria-hidden and aria-labelledby.</li>
        </ul>
      </div>
    </div>

    <!-- Example 3: Nested / interactive content -->
    <div class="example" id="example-3">
      <button class="toggle" id="toggle-3" aria-expanded="true" aria-controls="details-3">
        <span class="icon" aria-hidden="true">+</span>
        <span class="label">Interactive content (open by default)</span>
        <span class="summary muted">Contains a simple form</span>
      </button>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="false">
        <p class="muted">This widget is open by default to demonstrate interactive content inside a details container.</p>
        <form onsubmit="return false;">
          <label style="display:block;margin-bottom:8px;">
            Your name:
            <input type="text" placeholder="Type your name" style="margin-left:8px;padding:6px;border:1px solid var(--border);border-radius:6px;">
          </label>
          <label style="display:block;margin-bottom:8px;">
            Subscribe:
            <input type="checkbox" checked style="margin-left:8px;">
          </label>
          <button type="button" style="padding:8px 12px;border-radius:6px;border:1px solid var(--border);background:var(--accent);color:#fff;">
            Save
          </button>
        </form>
      </div>
    </div>

    <p class="muted" style="max-width:840px">Tip: Buttons use aria-expanded and control the div.details element via aria-controls. The scripts animate height for smooth transitions while keeping the region accessible to assistive technologies.</p>
  </main>

  <script>
    (function(){
      // Utility: detect reduced motion preference
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Find all toggles
      const toggles = Array.from(document.querySelectorAll('.toggle'));
      toggles.forEach(initToggle);

      function initToggle(button){
        const controlsId = button.getAttribute('aria-controls');
        if(!controlsId) return;
        let details = document.getElementById(controlsId);
        if(!details) return;

        // If there is no ID on the button, ensure one exists
        if(!button.id){
          button.id = 'toggle-' + Math.random().toString(36).slice(2,8);
        }

        // Ensure role and labelledby
        details.setAttribute('role', details.getAttribute('role') || 'region');
        if(!details.hasAttribute('aria-labelledby')) details.setAttribute('aria-labelledby', button.id);

        // Initialize visual open state from aria-expanded
        const expanded = button.getAttribute('aria-expanded') === 'true';
        if(expanded){
          details.setAttribute('aria-hidden','false');
          // allow details to size naturally by not forcing max-height,
          // but set a max-height to the measured height to avoid a jump when JS animates later
          details.style.maxHeight = details.scrollHeight + 'px';
          // mark wrapper for icon rotation
          button.closest('.example')?.classList.add('open');
        } else {
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        // Click toggles
        button.addEventListener('click', function(){
          const isExpanded = button.getAttribute('aria-expanded') === 'true';
          if(isExpanded) collapse(button, details);
          else expand(button, details);
        });

        // If animations are disabled, just switch states without animation
        if(reduceMotion){
          // clean up any style to avoid flicker
          details.style.transition = 'none';
        }
      }

      function expand(button, details){
        // Update button state immediately for assistive tech
        button.setAttribute('aria-expanded','true');
        // mark wrapper for icon rotation
        button.closest('.example')?.classList.add('open');

        // Remove aria-hidden first so screen readers can access content as it appears
        details.setAttribute('aria-hidden','false');

        if(reduceMotion){
          // No animation: show content instantly
          details.style.maxHeight = '';
          details.style.opacity = '1';
          return;
        }

        // Start animation: from 0 to scrollHeight
        // Ensure current computed height is 0 (could be '')
        details.style.display = 'block';
        // set from 0
        details.style.maxHeight = '0px';
        // Force a reflow to pick up the starting max-height
        details.getBoundingClientRect();

        const targetHeight = details.scrollHeight + 'px';
        details.style.maxHeight = targetHeight;

        // After transition ends, remove max-height so content can grow naturally
        const cleanup = function(e){
          if(e && e.target !== details) return;
          details.style.maxHeight = '';
          details.removeEventListener('transitionend', cleanup);
        };
        details.addEventListener('transitionend', cleanup);
      }

      function collapse(button, details){
        button.setAttribute('aria-expanded','false');
        // mark wrapper for icon rotation
        button.closest('.example')?.classList.remove('open');

        if(reduceMotion){
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
          details.style.opacity = '0';
          return;
        }

        // To animate from the current height to 0:
        // 1. Fix the current height as an explicit maxHeight (in case it was 'auto')
        const startHeight = details.scrollHeight + 'px';
        details.style.maxHeight = startHeight;

        // Force reflow so the starting maxHeight is applied before transitioning to 0
        details.getBoundingClientRect();

        // 2. Transition to 0
        details.style.maxHeight = '0px';

        // 3. After transition, mark aria-hidden
        const onEnd = function(e){
          if(e && e.target !== details) return;
          details.setAttribute('aria-hidden','true');
          // remove inline style to keep DOM tidy; keep maxHeight 0 so state is consistent visually
          // (we keep maxHeight=0 to avoid a brief flash; remove it if you prefer)
          details.style.maxHeight = '0px';
          details.removeEventListener('transitionend', onEnd);
        };
        details.addEventListener('transitionend', onEnd);
      }

      // Optional: handle window resize to adjust any open panels' max-height if necessary
      // (we clear maxHeight on open after transition, so usually not needed; this helps if some browsers keep a value)
      let resizeTimer;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
          document.querySelectorAll('.details').forEach(function(details){
            if(details.getAttribute('aria-hidden') === 'false'){
              // ensure no stale inline maxHeight blocks layout
              details.style.maxHeight = '';
            }
          });
        }, 120);
      });
    })();
  </script>
</body>
</html>