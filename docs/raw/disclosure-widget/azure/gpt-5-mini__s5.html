<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b74de;
      --bg:#f7f9fc;
      --card:#fff;
      --muted:#6b7280;
      --radius:8px;
      --transition:250ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg, #eef5ff 0%, var(--bg) 100%);
      color: #0f1724;
    }

    h1{ margin: 0 0 18px 0; font-size: 20px; }
    p.lead { margin: 0 0 20px 0; color: var(--muted); }

    .example {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 1px 2px rgba(16,24,40,0.05), 0 6px 18px rgba(12, 50, 120, 0.04);
      padding: 16px;
      margin: 16px 0;
    }

    .widget {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: start;
    }

    .toggle {
      appearance: none;
      border: 1px solid rgba(15,23,36,0.06);
      background: linear-gradient(180deg, #fff, #fbfdff);
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-weight: 600;
      color: #072241;
      font-size: 15px;
      transition: box-shadow var(--transition), transform var(--transition);
    }

    .toggle:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(11,116,222,0.12);
    }

    .toggle .icon {
      display: inline-flex;
      width: 20px;
      height: 20px;
      align-items: center;
      justify-content: center;
      transition: transform var(--transition);
    }

    .toggle[aria-expanded="true"] .icon {
      transform: rotate(180deg);
    }

    /* Controlled details area */
    .details {
      overflow: hidden;
      transition: max-height var(--transition), padding var(--transition);
      max-height: 0;
      padding: 0 0;
    }

    .details.open {
      /* max-height is animated in JS to the right value */
      padding: 12px 12px 0 12px;
    }

    .details .content {
      background: linear-gradient(180deg,#fbfdff 0%, #fff 100%);
      border-radius: 8px;
      border: 1px solid rgba(15,23,36,0.04);
      padding: 12px;
      color: #0f1724;
      line-height: 1.5;
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    /* Small helper to keep examples tidy */
    .note {
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }

    /* Make sure animations are smooth on reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .details { transition: none; }
      .toggle { transition: none; }
      .toggle .icon { transition: none; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Three examples of an accessible expand/collapse widget. Each widget is wrapped in a div.example and the revealed content containers use the details class.</p>

  <!-- Example 1: Basic -->
  <div class="example">
    <div class="widget">
      <div>
        <div class="meta">Basic expand/collapse</div>
        <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1">
          View summary
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="content">
          <strong>Summary</strong>
          <p>This is a simple controlled region. The button above toggles visibility while keeping accessibility attributes in sync (aria-expanded on the button and aria-hidden on this region).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Example 2: Initially open -->
  <div class="example">
    <div class="widget">
      <div>
        <div class="meta">Initially open</div>
        <button id="toggle-2" class="toggle" aria-expanded="true" aria-controls="details-2">
          Release notes
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-2" class="details open" role="region" aria-labelledby="toggle-2" aria-hidden="false">
        <div class="content">
          <strong>Release 1.4.0</strong>
          <ul>
            <li>Improved performance for the widget</li>
            <li>Fixed focus outline on certain browsers</li>
            <li>Minor accessibility tweaks</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Example 3: Longer content -->
  <div class="example">
    <div class="widget">
      <div>
        <div class="meta">Long content (animated)</div>
        <button id="toggle-3" class="toggle" aria-expanded="false" aria-controls="details-3">
          Read more
          <span class="icon" aria-hidden="true">▾</span>
        </button>
      </div>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
        <div class="content">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolorum, minus. Eius enim laborum nesciunt saepe fuga, commodi quas numquam corporis obcaecati quibusdam aspernatur, molestiae aperiam magni pariatur, dignissimos pariatur vero.</p>
          <p>Ut facilisis, velit sit amet dictum gravida, nibh magna vulputate purus, eu convallis lectus arcu vel lectus. Vivamus blandit, eros id hendrerit faucibus, magna purus suscipit nisi, at condimentum ipsum orci sit amet nisl.</p>
          <p class="note">Tip: Try opening and closing this panel repeatedly — the height animates to the content size smoothly.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Utility to set the visual/max-height states for a details element.
      function setOpen(details, open){
        if(open){
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');

          // calculate and animate to the full height, then clear the max-height so it can grow naturally
          var full = details.scrollHeight + 'px';
          details.style.maxHeight = full;

          function handleTransitionEnd(e){
            if(e.propertyName === 'max-height'){
              // allow it to size naturally after animation
              details.style.maxHeight = 'none';
              details.removeEventListener('transitionend', handleTransitionEnd);
            }
          }
          details.addEventListener('transitionend', handleTransitionEnd);
        } else {
          // If previously set to none, set it to scrollHeight first so we can animate to 0
          if(getComputedStyle(details).maxHeight === 'none'){
            details.style.maxHeight = details.scrollHeight + 'px';
            // force a reflow so the transition uses the new start height
            // eslint-disable-next-line no-unused-expressions
            details.offsetHeight;
          }
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }
      }

      // Initialize all toggles that control details containers
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(function(toggle){
        var targetId = toggle.getAttribute('aria-controls');
        var details = document.getElementById(targetId);
        if(!details) return;

        // Ensure the details has the right initial visual state based on aria-expanded
        var expanded = toggle.getAttribute('aria-expanded') === 'true';
        if(expanded){
          // make open visually without skipping the final 'none' max-height state
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          details.style.maxHeight = 'none';
        } else {
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        // Click toggles
        toggle.addEventListener('click', function(){
          var isOpen = toggle.getAttribute('aria-expanded') === 'true';
          toggle.setAttribute('aria-expanded', String(!isOpen));
          setOpen(details, !isOpen);
        });

        // If content inside the details changes height (e.g. images load), adjust when open
        var ro = new MutationObserver(function(){
          if(details.classList.contains('open')){
            // briefly set to scrollHeight to accommodate new content, then clear to none
            details.style.maxHeight = details.scrollHeight + 'px';
            setTimeout(function(){
              details.style.maxHeight = 'none';
            }, 300);
          }
        });
        ro.observe(details, {subtree: true, childList: true, characterData: true});
      });

      // On window resize, ensure any open panels that were set to 'none' remain visually correct
      window.addEventListener('resize', function(){
        document.querySelectorAll('.details.open').forEach(function(details){
          if(getComputedStyle(details).maxHeight === 'none'){
            // briefly set a concrete maxHeight so that future animations start from the right size
            details.style.maxHeight = details.scrollHeight + 'px';
            // allow time for layout, then clear it again
            requestAnimationFrame(function(){
              details.style.maxHeight = 'none';
            });
          }
        });
      });
    })();
  </script>
</body>
</html>