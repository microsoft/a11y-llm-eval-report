<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fb;
      --card:#ffffff;
      --accent:#0366d6;
      --muted:#6b7280;
      --shadow: 0 2px 6px rgba(11, 22, 39, 0.06);
      --radius:8px;
      --transition: 300ms cubic-bezier(.2,.9,.3,1);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #eef3f8 0%, var(--bg) 100%);
      color:#0b1727;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .page{
      max-width:900px;
      margin:48px auto;
      padding:24px;
    }

    header{
      margin-bottom:18px;
    }

    h1{
      margin:0 0 6px 0;
      font-size:20px;
    }

    p.lead{
      margin:0;
      color:var(--muted);
      font-size:14px;
    }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
      margin:18px 0;
      border:1px solid rgba(11,22,39,0.04);
    }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:transparent;
      border:1px solid rgba(11,22,39,0.08);
      padding:10px 12px;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      color:var(--accent);
      transition: box-shadow var(--transition), transform var(--transition);
      user-select:none;
    }
    .toggle:focus{
      outline:3px solid rgba(3,102,214,0.12);
      outline-offset:2px;
    }
    .toggle:hover{ transform: translateY(-1px); box-shadow: 0 4px 12px rgba(3,102,214,0.06); }
    .toggle .icon{
      width:18px;
      height:18px;
      display:inline-block;
      flex:0 0 18px;
      transition: transform 220ms ease;
    }
    .toggle[aria-expanded="true"] .icon{ transform: rotate(45deg); }

    /* Controlled content (.details) */
    .details{
      margin-top:12px;
      overflow:hidden;
      max-height:0;
      opacity:0;
      transition: max-height var(--transition), opacity 180ms ease;
      border-radius:6px;
      background:linear-gradient(180deg, rgba(3,102,214,0.03), rgba(3,102,214,0.01));
      padding:0 12px;
      box-sizing:border-box;
    }
    .details.open{
      opacity:1;
    }

    .details .inner{
      padding:12px 0;
      color:#0b1727;
      font-size:14px;
      line-height:1.45;
    }

    /* small secondary button inside content */
    .link-toggle{
      background:transparent;
      border:0;
      color:var(--accent);
      font-weight:600;
      cursor:pointer;
      padding:2px 6px;
    }

    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:13px;
    }

    /* utility */
    pre {
      background: #0b1727;
      color: #f7fafc;
      padding:12px;
      border-radius:6px;
      overflow:auto;
      font-size:13px;
      margin:8px 0 0;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Expand / Collapse Widget — Examples</h1>
      <p class="lead">Each widget below is wrapped with a div.example. The controlled content container uses the class <code>details</code>.</p>
    </header>

    <!-- Example 1: Basic -->
    <div class="example">
      <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1" type="button">
        <span class="icon" aria-hidden="true">＋</span>
        <span class="label">Show details</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="inner">
          <strong>Basic details</strong>
          <p>
            This is a simple expand/collapse widget. It is keyboard accessible (it's a native button),
            and the controlled content container has the class "details".
          </p>
          <p style="color:var(--muted);font-size:13px;margin:8px 0 0;">
            The button element manages aria-expanded; the details div uses aria-hidden and role="region".
          </p>
        </div>
      </div>
    </div>

    <!-- Example 2: Initially expanded -->
    <div class="example">
      <button id="toggle-2" class="toggle" aria-expanded="true" aria-controls="details-2" type="button">
        <span class="icon" aria-hidden="true">＋</span>
        <span class="label">Hide advanced options</span>
      </button>

      <div id="details-2" class="details open" role="region" aria-labelledby="toggle-2" aria-hidden="false">
        <div class="inner">
          <strong>Advanced options (initially expanded)</strong>
          <p>
            Widgets may start expanded. The script below initializes the visual height so the transition still works.
          </p>
          <ul style="margin:6px 0 0 18px;color:var(--muted);font-size:14px;">
            <li>Option A: Enabled</li>
            <li>Option B: Disabled</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Example 3: Nested widget inside details -->
    <div class="example">
      <button id="toggle-3" class="toggle" aria-expanded="false" aria-controls="details-3" type="button">
        <span class="icon" aria-hidden="true">＋</span>
        <span class="label">Show nested example</span>
      </button>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
        <div class="inner">
          <strong>Parent details</strong>
          <p>
            Inside this content is another expand/collapse widget. Nested widgets should work independently.
          </p>

          <div style="margin-top:10px;">
            <button id="toggle-3-1" class="toggle" aria-expanded="false" aria-controls="details-3-1" type="button">
              <span class="icon" aria-hidden="true">＋</span>
              <span class="label">Show child details</span>
            </button>

            <div id="details-3-1" class="details" role="region" aria-labelledby="toggle-3-1" aria-hidden="true">
              <div class="inner">
                <strong>Child details</strong>
                <p>This content is inside the parent details container.</p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <footer>
      Tip: Use Enter or Space to toggle, or click. The script updates aria-expanded and aria-hidden and animates the height.
    </footer>
  </div>

  <script>
    (function(){
      // Helper: find all toggle buttons that control a .details container
      var toggles = Array.prototype.slice.call(document.querySelectorAll('.toggle[aria-controls]'));

      function openDetails(button, details) {
        // Mark button and details
        button.setAttribute('aria-expanded', 'true');
        details.setAttribute('aria-hidden', 'false');
        details.classList.add('open');

        // Prepare for smooth height transition:
        // Set max-height to the content's scrollHeight (px) so the transition animates.
        var startHeight = details.scrollHeight;
        details.style.maxHeight = startHeight + 'px';

        // After transition completes, remove the inline max-height so it can grow/shrink naturally.
        var cleanup = function() {
          details.style.maxHeight = '';
          details.removeEventListener('transitionend', cleanup);
        };
        details.addEventListener('transitionend', cleanup);
      }

      function closeDetails(button, details) {
        button.setAttribute('aria-expanded', 'false');
        details.setAttribute('aria-hidden', 'true');
        details.classList.remove('open');

        // To animate from current height to 0, set maxHeight to current scrollHeight then to 0.
        var startHeight = details.scrollHeight;
        details.style.maxHeight = startHeight + 'px';
        // force a repaint to ensure the starting height is applied before we set 0
        window.requestAnimationFrame(function(){
          details.style.maxHeight = '0';
        });
      }

      toggles.forEach(function(button){
        var id = button.getAttribute('aria-controls');
        var details = document.getElementById(id);
        if (!details) return;

        // If the details container starts with aria-hidden="false" or class open, ensure visual height is set.
        var expanded = button.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          // temporarily set max-height to scrollHeight so the transition/initial display is correct
          details.classList.add('open');
          details.style.maxHeight = details.scrollHeight + 'px';
          details.setAttribute('aria-hidden', 'false');
          // remove the inline max-height after a short delay so content can size naturally
          setTimeout(function(){ details.style.maxHeight = ''; }, 350);
        } else {
          // ensure hidden state
          details.style.maxHeight = '0';
          details.setAttribute('aria-hidden', 'true');
        }

        button.addEventListener('click', function(e){
          var isExpanded = button.getAttribute('aria-expanded') === 'true';
          if (isExpanded) closeDetails(button, details);
          else openDetails(button, details);

          // update label text (optional, helpful for sighted users)
          var labelEl = button.querySelector('.label');
          if (labelEl){
            labelEl.textContent = (button.getAttribute('aria-expanded') === 'true') ? 'Hide details' : 'Show details';
          }
        });
      });

      // Optional: when window resizes, closed details don't need updates.
      // For open details with inline maxHeight cleared, nothing to do.
      // But for any details currently transitioning to open that still have inline maxHeight,
      // recompute to match new scrollHeight after resize.
      var resizeTimer = null;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
          var openDetailsEls = document.querySelectorAll('.details.open');
          openDetailsEls.forEach(function(d){
            // if maxHeight is empty, set to scrollHeight briefly to allow future close transitions
            if (d.style.maxHeight === '') {
              d.style.maxHeight = d.scrollHeight + 'px';
              // release it shortly after
              setTimeout(function(){ d.style.maxHeight = ''; }, 250);
            }
          });
        }, 120);
      });
    })();
  </script>
</body>
</html>