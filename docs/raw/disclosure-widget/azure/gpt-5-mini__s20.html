<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2563eb;
      --bg:#f8fafc;
      --muted:#6b7280;
      --panel:#ffffff;
      --radius:8px;
      --transition:300ms;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#eef2ff 0%, #ffffff 100%);
      color: #0f172a;
      margin: 32px;
      line-height:1.45;
    }

    h1{
      font-size: 1.25rem;
      margin: 0 0 18px 0;
    }

    p.lead{
      margin: 0 0 24px 0;
      color: var(--muted);
    }

    .examples {
      display: grid;
      gap: 18px;
      max-width: 820px;
    }

    .example{
      background: var(--panel);
      border: 1px solid rgba(15,23,42,0.06);
      box-shadow: 0 6px 18px rgba(12,18,45,0.04);
      padding: 14px;
      border-radius: var(--radius);
    }

    .widget {
      display: flex;
      align-items: stretch;
      gap: 12px;
    }

    .toggle-button{
      appearance: none;
      border: 1px solid rgba(15,23,42,0.06);
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      padding: 10px 12px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-weight: 600;
      color: #0f172a;
      outline: none;
      line-height: 1;
      box-shadow: 0 2px 6px rgba(12,18,45,0.04);
      transition: box-shadow 160ms ease, transform 120ms ease;
    }

    .toggle-button:focus{
      box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
    }

    .toggle-button:hover{
      transform: translateY(-1px);
    }

    .toggle-button .label{
      display:block;
      text-align:left;
    }

    .toggle-button .title{
      font-size: 0.95rem;
    }

    .toggle-button .subtitle{
      font-size: 0.8rem;
      color: var(--muted);
      font-weight: 500;
    }

    .toggle-button .arrow{
      width: 16px;
      height: 16px;
      transition: transform var(--transition) ease;
      display:inline-block;
      transform-origin: center;
      color: var(--accent);
    }

    /* rotate arrow when expanded */
    .toggle-button[aria-expanded="true"] .arrow{
      transform: rotate(180deg);
    }

    /* details area visuals */
    .details {
      background: var(--bg);
      border-radius: 8px;
      padding: 12px;
      box-sizing: border-box;
      overflow: hidden; /* JS will control height for animation */
      border: 1px dashed rgba(15,23,42,0.04);
      margin-top: 6px;
    }

    .details > *:first-child{
      margin-top: 0;
    }

    .note {
      font-size: 0.85rem;
      color: var(--muted);
    }

    /* small helper styles inside details */
    .card{
      background:#fff;
      padding:10px;
      border-radius:6px;
      border:1px solid rgba(2,6,23,0.04);
      margin-bottom:10px;
    }

    /* make sure transition doesn't fire when JS disabled */
    .no-js .details{ transition: none !important; }

    /* Example header area layout */
    .header {
      flex: 1 1 auto;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:2px;
    }

    /* small code-like block */
    pre.snippet{
      background:#0b1220;
      color:#dbeafe;
      padding:10px;
      border-radius:6px;
      font-size:0.8rem;
      overflow:auto;
    }
  </style>
</head>
<body class="no-js">
  <main>
    <h1>Expand / Collapse Widgets</h1>
    <p class="lead">Each widget is wrapped with a div.example. The content container uses the class "details". Buttons control showing and hiding the details content with smooth animation and accessible ARIA attributes.</p>

    <div class="examples">

      <!-- Example 1: Simple description -->
      <div class="example">
        <div class="widget">
          <button class="toggle-button"
                  id="toggle-1"
                  aria-expanded="false"
                  aria-controls="details-1"
                  type="button">
            <span class="arrow" aria-hidden="true">
              <!-- simple chevron -->
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </span>
            <span class="label">
              <span class="title">Show more details</span>
              <span class="subtitle">Click to expand a short description</span>
            </span>
          </button>
        </div>

        <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" hidden>
          <p class="note">This panel uses a scripted height transition for a smooth expand/collapse. The toggle button updates aria-expanded and aria-controls for accessibility.</p>
          <div class="card">
            <strong>Summary</strong>
            <p style="margin:6px 0 0 0;">Expandable content can contain any HTML: text, images, forms, or nested widgets. Use role="region" and aria-labelledby to help assistive tech.</p>
          </div>
        </div>
      </div>

      <!-- Example 2: Nested widget inside details -->
      <div class="example">
        <div class="widget">
          <button class="toggle-button"
                  id="toggle-2"
                  aria-expanded="false"
                  aria-controls="details-2"
                  type="button">
            <span class="arrow" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </span>
            <span class="label">
              <span class="title">More actions</span>
              <span class="subtitle">Example with a nested expandable item</span>
            </span>
          </button>
        </div>

        <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" hidden>
          <p class="note">Below is a nested widget. The nested widget is itself wrapped in an .example and uses its own .details container.</p>

          <div class="card">
            <p style="margin:0 0 8px 0;"><strong>Nested controls</strong></p>

            <!-- Nested example inside details -->
            <div class="example" style="margin-top:8px;">
              <div class="widget">
                <button class="toggle-button"
                        id="toggle-2a"
                        aria-expanded="false"
                        aria-controls="details-2a"
                        type="button">
                  <span class="arrow" aria-hidden="true">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                  <span class="label">
                    <span class="title">Show nested info</span>
                    <span class="subtitle">A second-level expand</span>
                  </span>
                </button>
              </div>

              <div id="details-2a" class="details" role="region" aria-labelledby="toggle-2a" hidden>
                <p style="margin:0;">This nested panel demonstrates multiple independent widgets on the same page. Focus remains on each toggle when used with keyboard navigation.</p>
              </div>
            </div>
            <!-- end nested example -->
          </div>
        </div>
      </div>

      <!-- Example 3: Larger content with code snippet -->
      <div class="example">
        <div class="widget">
          <button class="toggle-button"
                  id="toggle-3"
                  aria-expanded="false"
                  aria-controls="details-3"
                  type="button">
            <span class="arrow" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </span>
            <span class="label">
              <span class="title">View example code</span>
              <span class="subtitle">Larger content with scrolling</span>
            </span>
          </button>
        </div>

        <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" hidden>
          <p class="note">If content is larger than the available viewport, the details area can scroll when open. The JS transitions keep the animation smooth.</p>
          <pre class="snippet" aria-hidden="false">
function toggle(element){
  if(element.open) close(element);
  else open(element);
}
          </pre>
        </div>
      </div>

    </div>
  </main>

  <script>
    // Remove no-js class to allow CSS fallback differences
    document.body.classList.remove('no-js');

    (function(){
      // Helper: get all toggle buttons that control a .details element
      var toggles = Array.from(document.querySelectorAll('.toggle-button[aria-controls]'));

      // If no toggles, nothing to do
      if(!toggles.length) return;

      // For animation duration and easing, keep in sync with CSS
      var animationDuration = 300; // match --transition

      toggles.forEach(function(button){
        var detailsId = button.getAttribute('aria-controls');
        var details = document.getElementById(detailsId);
        if(!details || !details.classList.contains('details')) return; // only accept .details

        // Ensure details has appropriate attributes
        details.setAttribute('role', details.getAttribute('role') || 'region');
        details.setAttribute('aria-labelledby', details.getAttribute('aria-labelledby') || button.id);

        // Initialize collapsed state if no explicit open
        if(button.getAttribute('aria-expanded') === 'true'){
          open(details, button, /*immediate=*/true);
        } else {
          // keep hidden attribute for collapsed state
          details.hidden = true;
        }

        // click toggles
        button.addEventListener('click', function(){
          var expanded = button.getAttribute('aria-expanded') === 'true';
          if(expanded){
            close(details, button);
          } else {
            open(details, button);
          }
        });
      });

      function open(details, button, immediate){
        // Cancel ongoing transition
        details.style.transition = 'none';
        details.hidden = false; // make visible to measure
        // Force layout to calculate sizes
        var startHeight = details.getBoundingClientRect().height;
        // Temporarily set height to current (0 if previously hidden)
        details.style.height = startHeight + 'px';
        // compute target
        var target = details.scrollHeight + 'px';

        // set aria
        button.setAttribute('aria-expanded', 'true');

        // next frame animate to target
        requestAnimationFrame(function(){
          details.style.transition = 'height ' + animationDuration + 'ms ease';
          // If immediate (no animation), jump to end state
          if(immediate){
            details.style.height = 'auto';
            details.style.transition = 'none';
            details.style.overflow = '';
            // ensure visible
            details.hidden = false;
            return;
          }
          details.style.height = target;
          details.style.overflow = 'hidden';
          details.addEventListener('transitionend', function handler(e){
            if(e.propertyName !== 'height') return;
            details.style.transition = 'none';
            details.style.height = 'auto';
            details.style.overflow = '';
          }, {once:true});
        });
      }

      function close(details, button){
        // Cancel ongoing transition
        details.style.transition = 'none';
        // set height to current computed height (might be 'auto')
        var height = details.getBoundingClientRect().height;
        details.style.height = height + 'px';
        details.style.overflow = 'hidden';

        // force layout
        details.offsetHeight; // eslint-disable-line no-unused-expressions

        // update aria
        button.setAttribute('aria-expanded', 'false');

        // animate to 0
        requestAnimationFrame(function(){
          details.style.transition = 'height ' + animationDuration + 'ms ease';
          details.style.height = '0px';
          details.addEventListener('transitionend', function handler(e){
            if(e.propertyName !== 'height') return;
            details.style.transition = 'none';
            details.style.height = '';
            details.style.overflow = '';
            details.hidden = true;
          }, {once:true});
        });
      }

      // Optional: support escape key to close any open details when focused inside
      document.addEventListener('keydown', function(e){
        if(e.key === 'Escape' || e.key === 'Esc'){
          // find any open toggles
          toggles.forEach(function(button){
            if(button.getAttribute('aria-expanded') === 'true'){
              var details = document.getElementById(button.getAttribute('aria-controls'));
              if(details){
                close(details, button);
              }
            }
          });
        }
      });

    })();
  </script>
</body>
</html>