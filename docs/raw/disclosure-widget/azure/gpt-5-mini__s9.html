<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Demo</title>
  <style>
    :root{
      --accent:#0b69ff;
      --bg:#f7f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:10px;
      --shadow:0 6px 18px rgba(16,24,40,.08);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: linear-gradient(180deg,var(--bg),#fff);
      color:#0f172a;
      line-height:1.45;
    }

    h1{
      font-size: 20px;
      margin: 0 0 18px 0;
    }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding: 16px;
      max-width:720px;
      margin-bottom:18px;
      border:1px solid rgba(15,23,42,0.04);
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      background:transparent;
      border:0;
      padding:10px 12px;
      font-size:16px;
      text-align:left;
      cursor:pointer;
      border-radius:8px;
      transition:background .12s ease;
    }

    .toggle:hover{
      background:rgba(11,105,255,0.06);
    }

    .toggle:focus{
      outline:3px solid rgba(11,105,255,0.12);
      outline-offset:2px;
    }

    .chev{
      width:18px;
      height:18px;
      display:inline-block;
      transition: transform .22s ease;
      color:var(--accent);
      flex:0 0 18px;
    }

    .label{
      flex:1 1 auto;
      font-weight:600;
    }

    .summary{
      font-size:13px;
      color:var(--muted);
      margin-top:6px;
      margin-left:30px;
    }

    /* Controlled content container (must have class "details") */
    .details{
      overflow:hidden;
      max-height:0;
      transition: max-height .32s cubic-bezier(.2,.9,.4,1), opacity .22s ease;
      opacity:0;
      margin-top:8px;
      padding:0 12px;
      border-left:3px solid transparent;
    }

    /* When open we'll set attribute data-open="true" on the .example wrapper */
    .example[data-open="true"] .chev{
      transform: rotate(90deg);
    }

    .example[data-open="true"] .details{
      opacity:1;
      border-left-color: rgba(11,105,255,0.14);
    }

    .details > .content{
      padding:12px 0 16px 0;
      font-size:14px;
      color:#0f172a;
    }

    .details p{
      margin:0 0 10px 0;
    }

    .meta{
      font-size:13px;
      color:var(--muted);
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .details{
        transition:none;
      }
      .chev{
        transition:none;
      }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <div class="example" data-open="false">
    <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1">
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M8.59 16.34L13.17 11.76 8.59 7.17 10 5.76 16 11.76 10 17.76z"/>
      </svg>
      <span class="label">Payment details</span>
    </button>

    <div id="details-1" class="details" aria-hidden="true">
      <div class="content">
        <p><strong class="meta">Card ending</strong> •••• 8243</p>
        <p>Billing address: 221B Baker Street, London, NW1</p>
        <p class="meta">You can update payment methods in your account settings.</p>
      </div>
    </div>
  </div>

  <div class="example" data-open="true">
    <button class="toggle" id="toggle-2" aria-expanded="true" aria-controls="details-2">
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M8.59 16.34L13.17 11.76 8.59 7.17 10 5.76 16 11.76 10 17.76z"/>
      </svg>
      <span class="label">Release notes</span>
    </button>

    <div id="details-2" class="details" aria-hidden="false">
      <div class="content">
        <p>Version 2.6 introduces faster loading, improved accessibility, and bug fixes.</p>
        <ul>
          <li>Improved offline behavior</li>
          <li>Fixed a layout issue on small screens</li>
          <li>Accessibility: better keyboard focus management</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="example" data-open="false">
    <button class="toggle" id="toggle-3" aria-expanded="false" aria-controls="details-3">
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M8.59 16.34L13.17 11.76 8.59 7.17 10 5.76 16 11.76 10 17.76z"/>
      </svg>
      <span class="label">Frequently asked questions</span>
    </button>

    <div id="details-3" class="details" aria-hidden="true">
      <div class="content">
        <p><strong>Q:</strong> How do I contact support?</p>
        <p><strong>A:</strong> You can reach support via the Help menu or by emailing support@example.com.</p>
        <p><strong>Q:</strong> Can I change my subscription?</p>
        <p><strong>A:</strong> Yes — subscription changes are available in your billing settings.</p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Utility to animate open/close of an element using max-height
      function openDetails(details) {
        // Clear any inline max-height to measure natural scrollHeight
        details.style.display = 'block';
        const start = details.scrollHeight;
        details.style.maxHeight = '0px';
        // Force a reflow so the starting max-height applies
        // eslint-disable-next-line no-unused-expressions
        details.offsetHeight;
        details.style.transition = '';
        details.style.maxHeight = start + 'px';
        // After transition finishes, remove max-height so content can grow naturally
        const onEnd = function () {
          details.style.maxHeight = 'none';
          details.removeEventListener('transitionend', onEnd);
        };
        details.addEventListener('transitionend', onEnd);
      }

      function closeDetails(details) {
        // From current computed height to 0
        const current = details.scrollHeight;
        // If maxHeight is 'none' set it to current height to allow transition
        details.style.maxHeight = current + 'px';
        // Force reflow
        // eslint-disable-next-line no-unused-expressions
        details.offsetHeight;
        details.style.maxHeight = '0px';
        // Optionally hide after collapse (keeps layout clean)
        const onEnd = function () {
          details.style.display = '';
          details.removeEventListener('transitionend', onEnd);
        };
        details.addEventListener('transitionend', onEnd);
      }

      // Initialize each example
      Array.prototype.slice.call(document.querySelectorAll('.example')).forEach(function (example, index) {
        var button = example.querySelector('.toggle');
        var details = example.querySelector('.details');

        if (!button || !details) return;

        // Ensure controlled element has an id
        if (!details.id) details.id = 'details-auto-' + (index + 1);
        button.setAttribute('aria-controls', details.id);

        // Read initial open state from data-open attribute
        var initiallyOpen = example.getAttribute('data-open') === 'true';
        button.setAttribute('aria-expanded', initiallyOpen ? 'true' : 'false');
        details.setAttribute('aria-hidden', initiallyOpen ? 'false' : 'true');

        if (initiallyOpen) {
          // Make the details visible and remove max-height limit
          details.style.maxHeight = 'none';
          details.style.opacity = '1';
          details.style.display = 'block';
        } else {
          details.style.maxHeight = '0px';
          details.style.opacity = '0';
        }

        function setOpenState(open) {
          example.setAttribute('data-open', open ? 'true' : 'false');
          button.setAttribute('aria-expanded', open ? 'true' : 'false');
          details.setAttribute('aria-hidden', open ? 'false' : 'true');

          if (open) {
            openDetails(details);
            details.style.opacity = '1';
          } else {
            details.style.opacity = '0';
            closeDetails(details);
          }
        }

        // Click toggles
        button.addEventListener('click', function () {
          var isOpen = button.getAttribute('aria-expanded') === 'true';
          setOpenState(!isOpen);
        });

        // Allow Escape to close when focus is inside the details area or button
        document.addEventListener('keydown', function (ev) {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            var isOpen = button.getAttribute('aria-expanded') === 'true';
            if (!isOpen) return;
            // If focus is inside this example, close it
            if (example.contains(document.activeElement)) {
              setOpenState(false);
              button.focus();
            }
          }
        });

        // Make sure tab navigation doesn't trap into collapsed content
        // (When collapsed, set inert-like behavior by toggling tabindex)
        function updateFocusable() {
          var focusables = details.querySelectorAll('a,button,input,select,textarea,[tabindex]');
          var hidden = details.getAttribute('aria-hidden') === 'true';
          Array.prototype.slice.call(focusables).forEach(function (el) {
            if (hidden) {
              el.dataset._savedTabIndex = el.hasAttribute('tabindex') ? el.getAttribute('tabindex') : null;
              el.setAttribute('tabindex', '-1');
            } else {
              if (el.dataset._savedTabIndex !== null) {
                if (el.dataset._savedTabIndex === 'null') {
                  el.removeAttribute('tabindex');
                } else {
                  el.setAttribute('tabindex', el.dataset._savedTabIndex);
                }
              } else {
                el.removeAttribute('tabindex');
              }
              delete el.dataset._savedTabIndex;
            }
          });
        }

        // Update focusable initially
        updateFocusable();

        // Keep focusable in sync after each toggle via a small timeout (after aria-hidden update)
        button.addEventListener('click', function () {
          setTimeout(updateFocusable, 220);
        });
      });
    })();
  </script>
</body>
</html>