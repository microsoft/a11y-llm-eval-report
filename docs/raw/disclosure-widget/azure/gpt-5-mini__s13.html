<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Demo</title>
  <style>
    :root {
      --accent: #0b76ef;
      --bg: #f8f9fb;
      --card: #ffffff;
      --muted: #6b7280;
      --radius: 8px;
      --transition: 280ms cubic-bezier(.2,.9,.3,1);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg, #f6fbff, #ffffff 60%);
      color: #0f172a;
      line-height: 1.5;
    }

    h1 {
      font-size: 1.25rem;
      margin: 0 0 18px;
    }

    .example {
      background: var(--card);
      border: 1px solid rgba(15,23,42,0.06);
      border-radius: var(--radius);
      padding: 14px;
      max-width: 720px;
      margin-bottom: 16px;
      box-shadow: 0 6px 18px rgba(11, 76, 152, 0.04);
    }

    /* Toggle button */
    .toggle {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      background: transparent;
      border: none;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      border-radius: 8px;
      transition: background var(--transition), box-shadow var(--transition);
    }

    .toggle:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(11,118,239,0.12), 0 1px 2px rgba(2,6,23,0.08);
    }

    .toggle:hover {
      background: rgba(11,118,239,0.04);
    }

    .toggle .label {
      flex: 1 1 auto;
    }

    .toggle .summary {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 2px;
    }

    .chev {
      width: 18px;
      height: 18px;
      flex: 0 0 18px;
      transition: transform var(--transition);
      transform-origin: center;
      color: var(--accent);
    }

    /* Rotates when aria-expanded="true" */
    .toggle[aria-expanded="true"] .chev {
      transform: rotate(180deg);
    }

    /* Controlled content */
    .details {
      overflow: hidden;
      transition: max-height var(--transition), opacity var(--transition);
      max-height: 0;
      opacity: 0;
      margin-top: 8px;
      will-change: max-height, opacity;
    }

    .details.open {
      opacity: 1;
    }

    .details .content {
      padding: 12px;
      background: var(--bg);
      border-radius: 6px;
      border: 1px solid rgba(2,6,23,0.04);
    }

    /* Small helper for demo clarity */
    .note {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Demo</h1>

  <!-- Example 1 -->
  <div class="example">
    <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1">
      <div class="label">
        <strong>Account settings</strong>
        <div class="summary">Manage your profile, password, and connected accounts</div>
      </div>
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
      </svg>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" hidden>
      <div class="content">
        <p><strong>Profile</strong>: Change your display name, photo, and bio.</p>
        <p><strong>Password</strong>: Update your password regularly to keep your account secure.</p>
        <p><strong>Connected apps</strong>: Review and remove third-party apps that have access to your account.</p>
      </div>
    </div>
    <div class="note">Keyboard: Use Space or Enter on the toggle button to open/close.</div>
  </div>

  <!-- Example 2 (starts open) -->
  <div class="example">
    <button id="toggle-2" class="toggle" aria-expanded="true" aria-controls="details-2">
      <div class="label">
        <strong>Release notes â€” v2.4.0</strong>
        <div class="summary">See what's new and fixed in this release.</div>
      </div>
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
      </svg>
    </button>

    <div id="details-2" class="details open" role="region" aria-labelledby="toggle-2">
      <div class="content">
        <ul>
          <li>Improved performance for large lists.</li>
          <li>Fixed a bug with offline sync.</li>
          <li>Added support for dark mode in export dialogs.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Initialize all examples with a toggle button and a .details container.
      const examples = document.querySelectorAll('.example');

      examples.forEach(example => {
        const button = example.querySelector('.toggle');
        const details = example.querySelector('.details');

        if (!button || !details) return;

        // Ensure the button has an id for aria-controls target
        if (!button.id) button.id = 'toggle-' + Math.random().toString(36).slice(2,9);

        // Ensure the details has an id and aria-labelledby
        if (!details.id) details.id = 'details-' + Math.random().toString(36).slice(2,9);
        details.setAttribute('aria-labelledby', button.id);

        // Track whether JS will control visibility
        const isInitiallyOpen = button.getAttribute('aria-expanded') === 'true' || details.classList.contains('open');

        // If JS is enabled, use hidden attribute to reflect closed state
        if (!isInitiallyOpen) {
          details.hidden = true;
        } else {
          details.hidden = false;
          // Prepare max-height for animation starting open
          details.style.maxHeight = details.scrollHeight + 'px';
        }

        // Toggle function
        function toggle() {
          const expanded = button.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            // Close
            close();
          } else {
            // Open
            open();
          }
        }

        function open() {
          button.setAttribute('aria-expanded', 'true');
          details.classList.add('open');
          details.hidden = false;

          // From 0 to measured height to animate
          const startHeight = details.scrollHeight;
          details.style.maxHeight = '0px';

          // Force style flush
          requestAnimationFrame(() => {
            details.style.maxHeight = startHeight + 'px';
          });

          // After transition, remove explicit max-height so content can grow naturally
          const finish = () => {
            details.style.maxHeight = '';
            details.removeEventListener('transitionend', finish);
          };
          details.addEventListener('transitionend', finish);
        }

        function close() {
          button.setAttribute('aria-expanded', 'false');
          // Set max-height to current height, then to 0 to animate
          const startHeight = details.scrollHeight;
          details.style.maxHeight = startHeight + 'px';

          // Force next frame then collapse
          requestAnimationFrame(() => {
            details.style.maxHeight = '0px';
          });

          const finish = () => {
            details.classList.remove('open');
            details.hidden = true;
            details.style.maxHeight = '';
            details.removeEventListener('transitionend', finish);
          };
          details.addEventListener('transitionend', finish);
        }

        // Click toggles
        button.addEventListener('click', (e) => {
          e.preventDefault();
          toggle();
        });

        // Ensure Enter/Space work on the button for toggling (button already handles it, but keep consistency)
        button.addEventListener('keydown', (e) => {
          if (e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter') {
            // Let the native button behavior handle it; prevent double-handling if needed.
            // But ensure consistent visual toggling for Space on some browsers:
            e.preventDefault();
            toggle();
          }
        });
      });
    })();
  </script>
</body>
</html>