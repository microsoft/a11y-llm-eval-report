<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --brand:#0077cc;
      --bg:#f7fbff;
      --border:#d0e7ff;
      --radius:8px;
      --transition:250ms cubic-bezier(0.2,0.9,0.2,1);
    }

    body{
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.4;
      margin:24px;
      color:#0b2540;
      background:linear-gradient(180deg,#fff 0%, #f6fbff 100%);
      -webkit-font-smoothing:antialiased;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }

    p.lead{
      margin:0 0 20px 0;
      color:#264a6a;
    }

    .example{
      background:var(--bg);
      border:1px solid var(--border);
      padding:14px;
      border-radius:var(--radius);
      margin:18px 0;
      max-width:720px;
      box-shadow: 0 1px 0 rgba(11,37,64,0.03);
    }

    /* Toggle button */
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      font-size:15px;
      line-height:1;
      color:var(--brand);
      background:white;
      border:1px solid var(--border);
      border-radius:8px;
      cursor:pointer;
      transition:transform var(--transition), box-shadow var(--transition);
      box-shadow: 0 1px 0 rgba(11,37,64,0.02);
    }

    .toggle:active{ transform: translateY(1px); }
    .toggle:focus{
      outline:3px solid rgba(0,119,204,0.18);
      outline-offset:3px;
    }

    .toggle .chev{
      width:18px;
      height:18px;
      display:inline-block;
      transition: transform var(--transition);
      transform-origin:center;
      color:var(--brand);
      font-size:18px;
      line-height:1;
    }

    /* rotated when expanded */
    .toggle[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    /* Controlled content: collapsed by default */
    .details{
      overflow:hidden;
      max-height:0;
      transition: max-height var(--transition), opacity var(--transition);
      opacity:0;
      margin-top:12px;
      border-radius:6px;
      background: #fff;
      padding:0 12px;
      border:1px solid rgba(0,0,0,0.02);
    }

    /* when opened */
    .details.open{
      opacity:1;
      /* max-height will be managed by inline style for smooth animation (JS sets it) */
      padding:12px;
    }

    /* content inside details */
    .details .content{
      margin:0;
    }

    /* small visual examples inside details */
    .card{
      padding:10px;
      border-radius:6px;
      background:linear-gradient(180deg,#ffffff,#fbfeff);
      border:1px solid #eef8ff;
      margin:8px 0;
    }

    /* Respect user preference for reduced motion */
    @media (prefers-reduced-motion: reduce){
      .details{ transition:none; }
      .toggle{ transition:none; }
      .toggle .chev{ transition:none; }
    }

    /* Tiny helper */
    .meta{
      font-size:13px;
      color:#3b6182;
      margin-top:8px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Accessible toggle buttons control the visibility of the following content boxes. Each widget is wrapped in a div.example and the controlled container uses the class details.</p>

  <div class="example" id="ex-1">
    <button class="toggle"
            aria-expanded="false"
            aria-controls="details-1"
            id="toggle-1">
      <span class="chev" aria-hidden="true">▸</span>
      Learn more about the project
    </button>

    <div class="details" id="details-1" role="region" aria-labelledby="toggle-1" aria-hidden="true">
      <div class="content">
        <p>The project aims to improve accessibility and interaction patterns for common UI controls. Use the toggle button to expand or collapse this section. When expanded, the content becomes focusable and visible to assistive technologies.</p>

        <div class="card">
          <strong>Key points</strong>
          <ul>
            <li>Button has aria-expanded and aria-controls.</li>
            <li>The content container has class "details".</li>
            <li>JavaScript updates aria-hidden and manages height for animation.</li>
          </ul>
        </div>

        <p class="meta">Tip: Press Enter or Space on the button to toggle.</p>
      </div>
    </div>
  </div>

  <div class="example" id="ex-2">
    <button class="toggle"
            aria-expanded="false"
            aria-controls="details-2"
            id="toggle-2">
      <span class="chev" aria-hidden="true">▸</span>
      More examples and nested content
    </button>

    <div class="details" id="details-2" role="region" aria-labelledby="toggle-2" aria-hidden="true">
      <div class="content">
        <p>Nested content can include interactive elements. They remain accessible when the parent panel is opened.</p>

        <div class="card">
          <label>
            <input type="checkbox" /> Option A
          </label>
          <br/>
          <label>
            <input type="checkbox" checked /> Option B
          </label>
        </div>

        <p class="meta">This demonstrates that form controls inside the details container remain usable when visible.</p>
      </div>
    </div>
  </div>

  <noscript>
    <div class="example" style="background:#fff6f6;border-color:#ffd6d6;">
      <strong>No JavaScript:</strong> The interactive toggles require JavaScript. Enable JavaScript to operate the expand/collapse widgets.
    </div>
  </noscript>

  <script>
    (function(){
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function setCollapsed(button, details, collapse){
        if(collapse){
          button.setAttribute('aria-expanded','false');
          details.setAttribute('aria-hidden','true');
          details.classList.remove('open');

          if(prefersReduced){
            details.style.maxHeight = '0';
          } else {
            // animate to 0
            details.style.maxHeight = details.scrollHeight + 'px';
            // force repaint so the transition runs
            void details.offsetHeight;
            details.style.maxHeight = '0';
          }
        } else {
          button.setAttribute('aria-expanded','true');
          details.setAttribute('aria-hidden','false');
          details.classList.add('open');

          if(prefersReduced){
            details.style.maxHeight = 'none';
          } else {
            // animate to scrollHeight then clear maxHeight after transition
            details.style.maxHeight = details.scrollHeight + 'px';
            const clearMax = function(){
              // clear only if still expanded
              if(button.getAttribute('aria-expanded') === 'true'){
                details.style.maxHeight = 'none';
              }
              details.removeEventListener('transitionend', clearMax);
            };
            details.addEventListener('transitionend', clearMax);
          }
        }
      }

      // Initialize all widgets
      document.querySelectorAll('.example').forEach(function(example, idx){
        const button = example.querySelector('.toggle');
        const details = example.querySelector('.details');

        if(!button || !details) return;

        // ensure ids exist
        if(!button.id) button.id = 'toggle-auto-' + idx;
        if(!details.id) details.id = 'details-auto-' + idx;

        // ensure ARIA linkage
        button.setAttribute('aria-controls', details.id);
        details.setAttribute('aria-labelledby', button.id);

        // initial collapsed state
        details.style.maxHeight = '0';
        details.setAttribute('aria-hidden','true');
        details.classList.remove('open');
        button.setAttribute('aria-expanded','false');

        // click toggles
        button.addEventListener('click', function(){
          const expanded = button.getAttribute('aria-expanded') === 'true';
          setCollapsed(button, details, expanded);
        });

        // Make sure keyboard semantics available (button already handles Enter/Space).
        // Allow Escape to close when focus inside details
        details.addEventListener('keydown', function(e){
          if(e.key === 'Escape'){
            setCollapsed(button, details, true);
            button.focus();
          }
        });

        // If content changes size while open, adjust maxHeight if needed
        const ro = new MutationObserver(function(){
          if(button.getAttribute('aria-expanded') === 'true' && !prefersReduced){
            // when fully open maxHeight is 'none' (cleared after transition).
            // set to scrollHeight temporarily to animate immediate change
            details.style.maxHeight = details.scrollHeight + 'px';
            // clear after a short delay to allow content to define new natural height
            setTimeout(function(){
              details.style.maxHeight = 'none';
            }, 300);
          }
        });
        ro.observe(details, {subtree:true, childList:true, characterData:true});
      });
    })();
  </script>
</body>
</html>