<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --border:#e0e6ef;
      --accent:#0b63ff;
      --bg:#fbfdff;
      --muted:#6b7280;
      --radius:8px;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f6f9ff 0%, #ffffff 100%);
      color: #0f172a;
      padding: 36px;
      margin: 0;
      line-height:1.45;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
      color: #071033;
    }
    p.lead{
      margin:0 0 28px 0;
      color: var(--muted);
      font-size: 14px;
    }

    .example{
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 14px;
      border-radius: var(--radius);
      margin: 14px 0;
      box-shadow: 0 1px 0 rgba(11,99,255,0.03) inset;
    }

    .toggle{
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      background: transparent;
      border: none;
      text-align: left;
      padding: 8px 10px;
      cursor: pointer;
      border-radius: 6px;
    }
    .toggle:focus{
      outline: 3px solid rgba(11,99,255,0.15);
      outline-offset: 2px;
    }
    .toggle .title{
      flex:1;
      font-weight:600;
      color: #05204a;
      font-size: 15px;
    }
    .toggle .subtitle{
      color: var(--muted);
      font-size: 13px;
    }

    .icon{
      display:inline-grid;
      place-items:center;
      width:30px;
      height:30px;
      border-radius:6px;
      background: rgba(11,99,255,0.06);
      color: var(--accent);
      transform-origin: 50% 50%;
      transition: transform .22s ease;
      flex-shrink:0;
      font-weight:700;
      font-size: 13px;
    }
    /* rotate icon when expanded (button's aria-expanded="true") */
    .toggle[aria-expanded="true"] .icon{
      transform: rotate(90deg);
      background: rgba(11,99,255,0.12);
    }

    .details{
      overflow: hidden;
      max-height: 0;
      transition: max-height 260ms cubic-bezier(.2,.95,.2,1);
      will-change: max-height;
    }

    .details__inner{
      padding: 12px 10px 14px 10px;
      border-top: 1px dashed var(--border);
      color: #0b1b33;
      background: transparent;
    }

    /* visible state for non-JS fallback (if JS sets class) */
    .details.open{
      /* max-height will be set dynamically via JS to the height to animate smoothly */
    }

    /* small helper for content */
    .muted{
      color: var(--muted);
      font-size: 13px;
    }
    pre{
      background: #f3f6fa;
      padding: 10px;
      border-radius: 6px;
      overflow:auto;
      font-size:13px;
      margin: 8px 0 0 0;
    }

    /* demo layout */
    .row{
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      max-width: 840px;
      margin-top: 18px;
    }

    @media (min-width:720px){
      .row{
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Each widget below is wrapped in a container with the class "example". The controlled content container uses the class "details" and is toggled with an accessible button.</p>

  <div class="row">

    <!-- Example 1: basic closed -->
    <div class="example" aria-labelledby="ex1-title">
      <button id="ex1-toggle" class="toggle" aria-controls="ex1-details" aria-expanded="false" type="button">
        <span class="icon" aria-hidden="true">▸</span>
        <span>
          <div id="ex1-title" class="title">Basic details (closed)</div>
          <div class="subtitle">Click to reveal more information</div>
        </span>
      </button>

      <div id="ex1-details" class="details" role="region" aria-labelledby="ex1-toggle">
        <div class="details__inner">
          <p>This is a simple expand/collapse container. It starts closed. The button uses aria-expanded and aria-controls to connect to this container. The content is animated when opened and closed.</p>
          <p class="muted">Use Enter or Space on the button to toggle, or click it with the mouse.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: initially open -->
    <div class="example" aria-labelledby="ex2-title">
      <button id="ex2-toggle" class="toggle" aria-controls="ex2-details" aria-expanded="true" type="button">
        <span class="icon" aria-hidden="true">▸</span>
        <span>
          <div id="ex2-title" class="title">Details (initially open)</div>
          <div class="subtitle">This one opens by default</div>
        </span>
      </button>

      <div id="ex2-details" class="details" role="region" aria-labelledby="ex2-toggle">
        <div class="details__inner">
          <p>This widget is rendered in an expanded state by default. JavaScript will initialize the visual state based on the button's aria-expanded attribute.</p>
          <ul>
            <li>Accessible labeling via aria-labelledby</li>
            <li>Smooth height animation</li>
            <li>Keyboard support</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Example 3: longer content -->
    <div class="example" aria-labelledby="ex3-title">
      <button id="ex3-toggle" class="toggle" aria-controls="ex3-details" aria-expanded="false" type="button">
        <span class="icon" aria-hidden="true">▸</span>
        <span>
          <div id="ex3-title" class="title">Long content example</div>
          <div class="subtitle">Shows how taller content is animated</div>
        </span>
      </button>

      <div id="ex3-details" class="details" role="region" aria-labelledby="ex3-toggle">
        <div class="details__inner">
          <p>The container below contains more content to demonstrate the animation with larger height changes. It includes text, a small code block, and another paragraph.</p>

          <pre>&lt;div class="details"&gt;…&lt;/div&gt;</pre>

          <p class="muted">The script computes and animates the max-height for smooth transitions and resets the inline max-height after expansion to let the content size naturally if it changes (e.g. responsive layout).</p>
        </div>
      </div>
    </div>

    <!-- Example 4: nested multiple toggles (demonstrates reusability) -->
    <div class="example" aria-labelledby="ex4-title">
      <button id="ex4-toggle" class="toggle" aria-controls="ex4-details" aria-expanded="false" type="button">
        <span class="icon" aria-hidden="true">▸</span>
        <span>
          <div id="ex4-title" class="title">Multiple toggles (reusable)</div>
          <div class="subtitle">All toggles use the same JS behavior</div>
        </span>
      </button>

      <div id="ex4-details" class="details" role="region" aria-labelledby="ex4-toggle">
        <div class="details__inner">
          <p>Because the script attaches to all buttons that have aria-controls, you can copy/paste and create many independent widgets on the same page. Each content container is identified by its id and linked from the button.</p>
        </div>
      </div>
    </div>

  </div>

  <script>
    (function(){
      // Utility to open details element with animation
      function openDetails(details){
        details.classList.add('open');
        // Remove any 'max-height: none' so we can measure
        details.style.maxHeight = null;
        // measure
        var height = details.scrollHeight;
        // set to 0 first in case browser had none
        details.style.maxHeight = '0px';
        // allow next frame
        requestAnimationFrame(function(){
          details.style.maxHeight = height + 'px';
        });
      }

      // Utility to close details element with animation
      function closeDetails(details){
        // in case it was set to 'none', compute current height
        var height = details.scrollHeight;
        // set explicit height so transition has a start value
        details.style.maxHeight = height + 'px';
        // allow next frame then set to zero
        requestAnimationFrame(function(){
          details.style.maxHeight = '0px';
        });
        // remove open class after transition completes (or immediately if no transition)
        details.addEventListener('transitionend', function handler(e){
          // ensure we only react to max-height transition
          if (e.propertyName !== 'max-height') return;
          details.classList.remove('open');
          details.removeEventListener('transitionend', handler);
        });
      }

      // After open transition ends, remove inline max-height to allow natural resizing
      function onTransitionEndClearMax(e){
        if (e.propertyName !== 'max-height') return;
        var details = e.currentTarget;
        // If expanded, clear max-height so content can grow/shrink naturally
        if (details.classList.contains('open')){
          details.style.maxHeight = 'none';
        }
      }

      // initialize toggles
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(function(btn){
        var targetId = btn.getAttribute('aria-controls');
        var details = document.getElementById(targetId);
        if (!details) return;

        // If the details element has been left open by server (button aria-expanded === "true"), show it
        if (btn.getAttribute('aria-expanded') === 'true'){
          details.classList.add('open');
          // set maxHeight to none so it renders fully open
          details.style.maxHeight = 'none';
        } else {
          // ensure closed state
          details.classList.remove('open');
          details.style.maxHeight = '0px';
        }

        // ensure region role and aria-labelledby are set (already set in markup)
        details.addEventListener('transitionend', onTransitionEndClearMax);

        // click handler toggles
        btn.addEventListener('click', function(){
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded){
            // close
            btn.setAttribute('aria-expanded','false');
            closeDetails(details);
          } else {
            // open
            btn.setAttribute('aria-expanded','true');
            openDetails(details);
          }
        });

        // prevent page scroll on Space when focused (button normally handles this, but ensure consistent behavior)
        btn.addEventListener('keydown', function(ev){
          if (ev.code === 'Space' || ev.key === ' '){
            // Prevent the page from scrolling in some contexts, let click handler toggle
            ev.preventDefault();
          }
        });
      });
    })();
  </script>
</body>
</html>