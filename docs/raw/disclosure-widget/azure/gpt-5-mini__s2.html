<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent: #0b79d0;
      --muted: #666;
      --bg: #f7fbff;
      --border: #e1e8f0;
      --radius: 8px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      color: #111;
      background: linear-gradient(180deg,#ffffff 0%, #f3f8fc 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
    }

    .example{
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      margin: 12px 0;
      box-shadow: 0 1px 2px rgba(15,23,42,0.03);
      max-width: 740px;
    }

    .controls{
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toggle {
      appearance: none;
      -webkit-appearance: none;
      background: linear-gradient(180deg, #fff, #f4fbff);
      border: 1px solid var(--border);
      color: var(--accent);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 120ms ease, box-shadow 120ms ease, transform 80ms;
      box-shadow: 0 1px 0 rgba(11,121,208,0.06);
    }

    .toggle:focus{
      outline: none;
      box-shadow: 0 0 0 3px rgba(11,121,208,0.12);
    }

    .toggle:active{
      transform: translateY(1px);
    }

    .toggle .icon{
      width: 12px;
      height: 12px;
      display: inline-block;
      transition: transform 220ms ease;
      transform-origin: 50% 50%;
      color: var(--accent);
      font-size: 12px;
      line-height: 1;
    }

    .toggle[aria-expanded="true"] .icon{
      transform: rotate(90deg);
    }

    /* details container (controlled content) */
    .details{
      margin-top: 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      padding: 12px;
      background: var(--bg);
      overflow: hidden;
      transform-origin: top;
      transition: max-height 320ms cubic-bezier(.2,.8,.2,1), opacity 220ms ease;
      max-height: 0;
      opacity: 0;
    }

    /* when JS opens it we add .open to details */
    .details.open{
      opacity: 1;
    }

    /* a small helper to make the content look like a region */
    .details p{
      margin: 0 0 8px 0;
      color: #122;
    }

    .meta{
      color: var(--muted);
      font-size: 13px;
    }

    /* demo: if JS is not available, reveal everything and style accordingly */
    .no-js .details{
      max-height: none;
      opacity: 1;
      overflow: visible;
    }

    /* accessible focus styles for inner focusable elements */
    .details a, .details button{
      border-radius: 4px;
    }

    /* demo smaller example */
    .summary{
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <div class="example" id="ex1">
    <div class="controls">
      <button class="toggle" id="toggle1" aria-expanded="false" aria-controls="details1">
        <span class="icon" aria-hidden="true">▸</span>
        <span>Show more</span>
      </button>
      <div class="meta">Accessible widget using ARIA and animated height</div>
    </div>

    <div id="details1" class="details" role="region" aria-labelledby="toggle1" hidden>
      <p class="summary">This content is controlled by the button above. It can contain any elements — text, lists, images or interactive controls.</p>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla.</p>
      <p>Example interactive control: <button type="button">A sample button</button></p>
    </div>
  </div>

  <div class="example" id="ex2">
    <div class="controls">
      <button class="toggle" id="toggle2" aria-expanded="false" aria-controls="details2">
        <span class="icon" aria-hidden="true">▸</span>
        <span>Details</span>
      </button>
      <div class="meta">Another instance — demonstrates multiple widgets on the same page</div>
    </div>

    <div id="details2" class="details" role="region" aria-labelledby="toggle2" hidden>
      <p class="summary">Nested list and content to show scroll and height handling.</p>
      <ul>
        <li>First item with some text</li>
        <li>Second item with more text</li>
        <li>Third item with extended content that spans multiple lines to demonstrate measuring height and transitions correctly</li>
      </ul>
      <p>Small note: the widget updates aria-expanded and manages the hidden attribute for assistive technologies.</p>
    </div>
  </div>

  <script>
    (function(){
      // Add a class to the documentElement so we can handle a no-js fallback in CSS if desired.
      document.documentElement.classList.remove('no-js');
    })();
    // Mark no-js by default before this script runs (inline contained by server could do it).
    // We'll ensure the page can be used without JS: we'll hide details by default (hidden attr)
    // and provide a noscript-styled override in CSS via a .no-js class if needed.
    // For this delivered file, add no-js quickly so the CSS rule can fallback if this script were absent.
  </script>

  <script>
    // On load we will wire up all buttons with aria-controls to toggle corresponding .details containers.
    (function(){
      // Helper to find element by id and ensure it has .details class
      function getDetails(id){
        try {
          var el = document.getElementById(id);
          if (el && el.classList.contains('details')) return el;
        } catch(e){}
        return null;
      }

      function openDetails(btn, details){
        if (!details) return;
        // Remove hidden so it's measurable and visible to AT once opening starts
        details.removeAttribute('hidden');
        // Force a reflow to ensure transitions run
        details.classList.add('open');
        // measure scrollHeight
        var startHeight = details.scrollHeight;
        // set explicit max-height to measured height to animate
        details.style.maxHeight = startHeight + 'px';
        details.style.opacity = '1';
        btn.setAttribute('aria-expanded','true');
      }

      function closeDetails(btn, details){
        if (!details) return;
        // measure current height
        var height = details.scrollHeight;
        // Set the maxHeight to current height so we can animate to 0
        details.style.maxHeight = height + 'px';
        // Force reflow
        details.getBoundingClientRect();
        // then transition to 0
        details.style.maxHeight = '0px';
        details.style.opacity = '0';
        btn.setAttribute('aria-expanded','false');

        // when transition finishes, hide the element from AT and remove open class
        var listener = function(e){
          if (e.target !== details) return;
          details.removeEventListener('transitionend', listener);
          details.classList.remove('open');
          details.setAttribute('hidden','');
          // cleanup inline style
          details.style.maxHeight = '';
        };
        details.addEventListener('transitionend', listener);
      }

      function toggleHandler(e){
        var btn = e.currentTarget;
        var id = btn.getAttribute('aria-controls');
        var details = getDetails(id);
        if (!details) return;
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded){
          closeDetails(btn, details);
        } else {
          openDetails(btn, details);
        }
      }

      // initialize all toggles
      var toggles = Array.prototype.slice.call(document.querySelectorAll('button.toggle[aria-controls]'));
      toggles.forEach(function(btn){
        var id = btn.getAttribute('aria-controls');
        var details = getDetails(id);
        if (!details){
          // nothing to control
          return;
        }
        // ensure aria-expanded is set (default to false if not)
        if (btn.getAttribute('aria-expanded') !== 'true'){
          btn.setAttribute('aria-expanded','false');
        }

        // The initial state: if not expanded ensure details is hidden (it already has hidden attr in markup)
        // Attach click handler
        btn.addEventListener('click', toggleHandler);

        // Also support keyboard activation for Enter/Space (button already handles it, but keep for robustness)
        // Allow toggling when Enter or Space pressed while button is focused.
        btn.addEventListener('keydown', function(ev){
          if (ev.key === 'Enter' || ev.key === ' ' || ev.key === 'Spacebar'){
            ev.preventDefault();
            btn.click();
          }
        });

        // If the details element does not have an explicit inline max-height, set it to 0 when closed
        if (btn.getAttribute('aria-expanded') === 'false'){
          details.style.maxHeight = '0px';
          details.style.opacity = '0';
        } else {
          // if it starts expanded, set properly
          details.classList.add('open');
          details.style.maxHeight = details.scrollHeight + 'px';
          details.style.opacity = '1';
          details.removeAttribute('hidden');
        }
      });

      // Improve UX: when window resizes, adjust maxHeight for open details to match content size
      var resizeTimeout;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function(){
          var openDetails = document.querySelectorAll('.details.open');
          openDetails.forEach(function(details){
            // set to scrollHeight to adapt to new size
            details.style.maxHeight = details.scrollHeight + 'px';
          });
        }, 120);
      });
    })();
  </script>

  <noscript>
    <style>
      /* If JS is disabled, reveal details content so users can access it */
      .details { max-height: none !important; opacity: 1 !important; overflow: visible !important; }
      .toggle { display: none !important; }
    </style>
    <div style="margin-top:10px;color:#444;font-size:13px;">JavaScript is disabled — all content is shown.</div>
  </noscript>
</body>
</html>