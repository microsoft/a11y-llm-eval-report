<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#2563eb;
      --radius:8px;
      --transition:220ms cubic-bezier(.2,.9,.3,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #f0f4ff 0%, var(--bg) 100%);
      color: #0f172a;
      margin: 24px;
      line-height:1.45;
    }

    h1{
      font-size:1.25rem;
      margin:0 0 18px 0;
      color:#0b1220;
    }

    p.lead{
      margin:0 0 20px 0;
      color:var(--muted);
      font-size:0.95rem;
    }

    .container{
      max-width:780px;
      margin:0 auto;
    }

    /* Example wrapper as required */
    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 6px 18px rgba(17,24,39,0.06);
      margin: 14px 0;
    }

    /* Toggle button */
    .toggle {
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:transparent;
      border:1px solid rgba(15,23,42,0.06);
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      color:#071129;
      font-weight:600;
      font-size:0.95rem;
      transition:box-shadow var(--transition), transform var(--transition);
    }

    .toggle:focus{
      outline:3px solid rgba(37,99,235,0.12);
      outline-offset:3px;
    }

    .toggle .title{
      display:inline-block;
    }

    .toggle .icon{
      display:inline-flex;
      transform-origin:center;
      transition:transform var(--transition);
      width:18px;
      height:18px;
      color:var(--accent);
    }

    .toggle[aria-expanded="true"] .icon{
      transform:rotate(180deg);
    }

    /* details container (required class) */
    .details {
      margin-top:12px;
      overflow:hidden;
      border-radius:6px;
      background:linear-gradient(180deg, rgba(37,99,235,0.03), transparent);
      transition:opacity var(--transition), visibility var(--transition);
      will-change:height, opacity;
      /* accessible default visible for no-JS: we'll collapse via JS on load */
    }

    .details[aria-hidden="true"]{
      opacity:0;
      visibility:hidden;
    }

    .details .inner {
      padding:12px;
      color:#0b1220;
      font-size:0.95rem;
      background:transparent;
    }

    /* small stylistic elements inside details */
    .note{
      font-size:0.9rem;
      color:var(--muted);
      margin-top:8px;
    }

    /* simple list */
    ul.settings{
      margin:8px 0 0 18px;
      color:#0b1220;
    }

    /* show contents if JS is disabled: override the hidden state */
    noscript .details {
      opacity:1 !important;
      visibility:visible !important;
      height:auto !important;
      overflow:visible !important;
    }

    /* subtle divider for examples */
    .example + .example{
      margin-top:18px;
    }

    /* small helper text */
    .hint{
      font-size:0.85rem;
      color:var(--muted);
      margin-top:8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">Two examples demonstrating an accessible expand/collapse pattern. Each widget is wrapped with a div.example and the controlled content container has the "details" class.</p>

    <div class="example">
      <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1" type="button">
        <span class="title">More information</span>
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 15.5a1 1 0 0 1-.7-.29l-5-5a1 1 0 1 1 1.4-1.42L12 13.08l4.3-4.3a1 1 0 0 1 1.4 1.42l-5 5A1 1 0 0 1 12 15.5z"/>
        </svg>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="inner">
          <p>This is a short informational block that is revealed when the "More information" button is toggled. It demonstrates a simple expand/collapse pattern with ARIA attributes: the button has aria-expanded and the content has aria-hidden.</p>
          <p class="note">Tip: Press Escape to close when focus is inside the details area.</p>
        </div>
      </div>
    </div>

    <div class="example">
      <button id="toggle-2" class="toggle" aria-expanded="false" aria-controls="details-2" type="button">
        <span class="title">Advanced settings</span>
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 15.5a1 1 0 0 1-.7-.29l-5-5a1 1 0 1 1 1.4-1.42L12 13.08l4.3-4.3a1 1 0 0 1 1.4 1.42l-5 5A1 1 0 0 1 12 15.5z"/>
        </svg>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="true">
        <div class="inner">
          <p>Toggle a few settings below:</p>
          <ul class="settings">
            <li><label><input type="checkbox" /> Enable notifications</label></li>
            <li><label><input type="checkbox" /> Use compact layout</label></li>
            <li><label><input type="checkbox" /> Advanced logging</label></li>
          </ul>
          <p class="hint">These controls remain interactive while expanded.</p>
        </div>
      </div>
    </div>

  </div>

  <noscript>
    <!-- When JavaScript is disabled, make sure details are visible -->
    <style>
      .details { opacity:1 !important; visibility:visible !important; height:auto !important; overflow:visible !important; }
      .toggle .icon { display:inline-flex; transform:none !important; }
      .toggle[aria-expanded="false"] { box-shadow:none; }
    </style>
  </noscript>

  <script>
    (function(){
      // Utility to animate open/close using element height
      function animateToggle(el, show, ms){
        ms = ms || 220;
        el.style.transition = 'height ' + ms + 'ms cubic-bezier(.2,.9,.3,1), opacity ' + ms + 'ms';
        if(show){
          // get current hidden state
          el.style.display = 'block';
          var startHeight = el.getBoundingClientRect().height;
          el.style.height = '0px';
          el.offsetHeight; // force reflow
          var target = el.scrollHeight;
          el.style.height = target + 'px';
          el.style.opacity = '1';
          // cleanup after transition
          el.addEventListener('transitionend', function handler(e){
            if(e.propertyName === 'height'){
              el.style.height = '';
              el.style.transition = '';
              el.removeEventListener('transitionend', handler);
            }
          });
        } else {
          // closing: set explicit height then animate to 0
          var cur = el.getBoundingClientRect().height;
          el.style.height = cur + 'px';
          el.offsetHeight; // force reflow
          el.style.height = '0px';
          el.style.opacity = '0';
          el.addEventListener('transitionend', function handler(e){
            if(e.propertyName === 'height'){
              el.style.transition = '';
              el.style.display = 'none';
              el.style.height = '';
              el.removeEventListener('transitionend', handler);
            }
          });
        }
      }

      // Grab all toggles
      var toggles = document.querySelectorAll('.toggle[aria-controls]');
      toggles.forEach(function(btn, idx){
        var controlsId = btn.getAttribute('aria-controls');
        var panel = document.getElementById(controlsId);
        if(!panel) return;

        // Initialize state: collapsed by default
        btn.setAttribute('aria-expanded','false');
        panel.setAttribute('aria-hidden','true');
        // Make panel hidden (but allow noscript to override)
        panel.style.display = 'none';
        panel.style.opacity = '0';

        // Click toggles
        btn.addEventListener('click', function(){
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          if(expanded){
            // close
            btn.setAttribute('aria-expanded','false');
            panel.setAttribute('aria-hidden','true');
            panel.classList.remove('open');
            panel.classList.add('closed');
            animateToggle(panel, false, 220);
          } else {
            // open
            btn.setAttribute('aria-expanded','true');
            panel.setAttribute('aria-hidden','false');
            panel.classList.remove('closed');
            panel.classList.add('open');
            animateToggle(panel, true, 220);
            // Move focus into panel if Shift is held? Not needed. Keep focus on button.
          }
        });

        // Keyboard: close on Escape if focus within the panel or button
        panel.addEventListener('keydown', function(e){
          if(e.key === 'Escape' || e.key === 'Esc'){
            btn.focus();
            if(btn.getAttribute('aria-expanded') === 'true'){
              btn.click();
            }
          }
        });

        // Also close on Escape when focus is on the button and panel is open
        btn.addEventListener('keydown', function(e){
          if((e.key === 'Escape' || e.key === 'Esc') && btn.getAttribute('aria-expanded') === 'true'){
            btn.click();
          }
        });
      });

      // Optional: close any open panel when clicking outside it
      document.addEventListener('click', function(e){
        // If click target is inside a toggle or details, do nothing
        var withinToggle = e.target.closest('.toggle');
        var withinDetails = e.target.closest('.details');
        if(withinToggle || withinDetails) return;

        // otherwise close all expanded panels
        toggles.forEach(function(btn){
          if(btn.getAttribute('aria-expanded') === 'true'){
            btn.click();
          }
        });
      });

      // Accessibility improvement: ensure panels that are hidden are not focusable
      // This can be handled by listener on mutation or as we change states already.

    })();
  </script>
</body>
</html>