<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Expand/Collapse Widgets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: light dark;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      line-height: 1.6;
      margin: 0;
      padding: 2rem;
      background: Canvas;
      color: CanvasText;
    }
    h1 {
      font-size: 1.8rem;
      margin: 0 0 1rem;
    }
    .intro {
      margin-bottom: 1.5rem;
      color: GrayText;
    }
    .example {
      background: Field;
      color: FieldText;
      border: 1px solid rgba(127,127,127,0.25);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1.25rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.06);
    }
    .example h2 {
      margin: 0 0 0.75rem;
      font-size: 1.1rem;
    }

    /* The container for controlled content has a .details class */
    .details {
      margin-top: 0.5rem;
      border-top: 1px dashed rgba(127,127,127,0.35);
      padding-top: 0.75rem;
    }

    /* Native details styling */
    details.details {
      border-top: none;
      padding-top: 0;
    }
    details.details > summary {
      font-weight: 600;
      cursor: pointer;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    details.details > summary::-webkit-details-marker {
      display: none;
    }
    details.details > summary::before {
      content: "▸";
      display: inline-block;
      width: 1em;
      transition: transform 160ms ease;
      transform-origin: center;
    }
    details.details[open] > summary::before {
      transform: rotate(90deg);
      content: "▾";
    }

    /* Custom collapsible trigger */
    .collapsible-trigger {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid rgba(127,127,127,0.35);
      background: color-mix(in oklab, Field 93%, Canvas 7%);
      color: FieldText;
      border-radius: 8px;
      padding: 0.4rem 0.6rem;
      box-shadow: 0 1px 0 rgba(0,0,0,0.04);
    }
    .collapsible-trigger:focus-visible {
      outline: 3px solid Highlight;
      outline-offset: 2px;
    }
    .chevron {
      transition: transform 160ms ease;
      display: inline-block;
    }
    .collapsible-trigger[aria-expanded="true"] .chevron {
      transform: rotate(90deg);
    }

    /* Animated content for custom collapsible */
    .details-content {
      overflow: hidden;
      transition: height 200ms ease;
    }

    /* Pretty content */
    .example ul {
      padding-left: 1.25rem;
      margin: 0.5rem 0 0;
    }
    .example code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: color-mix(in oklab, Field 85%, Canvas 15%);
      padding: 0.1rem 0.25rem;
      border-radius: 4px;
      border: 1px solid rgba(127,127,127,0.25);
    }
  </style>
</head>
<body>
  <h1>Expand/Collapse Widgets</h1>
  <p class="intro">Each widget is wrapped in a container with an "example" class, and the container for controlled content uses a "details" class.</p>

  <div class="example">
    <h2>Native details/summary</h2>
    <details class="details">
      <summary>More information</summary>
      <div class="details-content">
        <p>This section expands and collapses using the native HTML <code>&lt;details&gt;</code> and <code>&lt;summary&gt;</code> elements.</p>
        <ul>
          <li>The expanded state is controlled by the browser.</li>
          <li>Keyboard support and semantics are built in.</li>
          <li>You can style the summary line and the disclosure marker.</li>
        </ul>
      </div>
    </details>
  </div>

  <div class="example">
    <h2>Custom accessible collapsible</h2>
    <button class="collapsible-trigger" aria-expanded="false" aria-controls="custom-details-1" id="custom-trigger-1">
      <span class="chevron">▸</span>
      <span>Show details</span>
    </button>
    <div class="details" id="custom-details-1" hidden>
      <div class="details-content">
        <p>This section uses a button to toggle the visibility of controlled content.</p>
        <ul>
          <li>The button announces its state with <code>aria-expanded</code>.</li>
          <li>It references the content by ID via <code>aria-controls</code>.</li>
          <li>The content container is hidden using the <code>hidden</code> attribute.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    (function () {
      function setupTrigger(trigger) {
        var contentId = trigger.getAttribute('aria-controls');
        var container = document.getElementById(contentId);
        if (!contentId || !container) return;

        var contentWrap = container.querySelector('.details-content');
        if (contentWrap) {
          // Ensure initial height is 0 for hidden state
          if (container.hasAttribute('hidden')) {
            contentWrap.style.height = '0px';
          } else {
            contentWrap.style.height = 'auto';
            trigger.setAttribute('aria-expanded', 'true');
          }
        }

        function setExpanded(state) {
          trigger.setAttribute('aria-expanded', state ? 'true' : 'false');
          var labelSpan = trigger.querySelector('span:last-child');
          if (labelSpan) {
            labelSpan.textContent = state ? 'Hide details' : 'Show details';
          }

          if (state) {
            container.removeAttribute('hidden');
            if (!contentWrap) return;

            // Measure and animate open
            contentWrap.style.height = 'auto';
            var full = contentWrap.scrollHeight;
            contentWrap.style.height = '0px';
            requestAnimationFrame(function () {
              contentWrap.style.height = full + 'px';
            });
            var onEndOpen = function (e) {
              if (e.target !== contentWrap) return;
              contentWrap.style.height = 'auto';
              contentWrap.removeEventListener('transitionend', onEndOpen);
            };
            contentWrap.addEventListener('transitionend', onEndOpen);
          } else {
            if (!contentWrap) {
              container.setAttribute('hidden', '');
              return;
            }
            // Measure and animate close
            var full = contentWrap.scrollHeight;
            contentWrap.style.height = full + 'px';
            requestAnimationFrame(function () {
              contentWrap.style.height = '0px';
            });
            var onEndClose = function (e) {
              if (e.target !== contentWrap) return;
              container.setAttribute('hidden', '');
              contentWrap.removeEventListener('transitionend', onEndClose);
            };
            contentWrap.addEventListener('transitionend', onEndClose);
          }
        }

        trigger.addEventListener('click', function () {
          var nowExpanded = trigger.getAttribute('aria-expanded') === 'true';
          setExpanded(!nowExpanded);
        });
      }

      document.querySelectorAll('.collapsible-trigger[aria-controls]').forEach(setupTrigger);
    }());
  </script>
</body>
</html>