<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent: #0b66ff;
      --muted: #6b7280;
      --bg: #f8fafc;
      --panel-bg: #ffffff;
      --radius: 8px;
      --transition: 240ms cubic-bezier(.2,.8,.2,1);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    body{
      margin: 24px;
      background: linear-gradient(180deg,#fbfdff 0%, var(--bg) 100%);
      color: #0f172a;
      line-height: 1.4;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    h1{
      margin: 0 0 12px 0;
      font-size: 20px;
    }

    p.lead{
      margin: 0 0 20px 0;
      color: var(--muted);
      font-size: 14px;
    }

    .container{
      max-width: 820px;
      margin: 0 auto;
    }

    .example{
      background: var(--panel-bg);
      border: 1px solid #e6eefb;
      box-shadow: 0 6px 18px rgba(15,23,42,0.04);
      border-radius: var(--radius);
      padding: 14px;
      margin: 16px 0;
    }

    .header-row{
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .toggle-btn{
      appearance: none;
      border: 0;
      background: transparent;
      cursor: pointer;
      display: inline-flex;
      gap: 10px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 6px;
      font-weight: 600;
      color: #0f172a;
      font-size: 15px;
      line-height: 1;
    }

    .toggle-btn:focus{
      outline: 3px solid rgba(11,102,255,0.12);
      outline-offset: 2px;
    }

    .toggle-btn .label{
      display: inline-block;
      text-align: left;
    }

    .toggle-btn .meta{
      display: block;
      font-weight: 500;
      color: var(--muted);
      font-size: 13px;
      margin-top: 2px;
    }

    .caret{
      width: 18px;
      height: 18px;
      display: inline-block;
      transform-origin: 50% 50%;
      transition: transform var(--transition);
      color: var(--accent);
    }

    /* details (controlled content) */
    .details{
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 0;
      margin-top: 12px;
      border-top: 1px dashed #eef6ff;
      padding-top: 12px;
    }

    .details.open{
      opacity: 1;
    }

    .panel{
      background: linear-gradient(180deg,#fff,#fbfdff);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid #eef6ff;
      color: #0f172a;
      font-size: 14px;
    }

    .small{
      font-size: 13px;
      color: var(--muted);
    }

    /* rotate caret when expanded with attribute selector */
    button[aria-expanded="true"] .caret{
      transform: rotate(90deg);
    }

    /* simple visual example header */
    .example-title{
      font-size: 14px;
      font-weight: 700;
      color: #071133;
    }

    .note{
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget Examples</h1>
    <p class="lead">Each widget below is wrapped in a div.example. The content that is shown/hidden uses the class "details". Buttons control those containers via aria-controls and aria-expanded.</p>

    <!-- Example 1: Basic -->
    <div class="example" >
      <div class="header-row">
        <div>
          <div class="example-title">Basic details toggle</div>
          <div class="note small">Click the button to reveal or hide the content.</div>
        </div>
        <div>
          <button class="toggle-btn" aria-expanded="false" aria-controls="details-1" id="toggle-1" type="button">
            <span class="label">Show more</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8 5v14l11-7z" fill="currentColor" />
            </svg>
          </button>
        </div>
      </div>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="panel">
          <p>This is a simple expanded panel. It demonstrates a basic expand/collapse pattern using a button with aria-expanded and aria-controls. The container for controlled content has the class "details".</p>
          <p class="small">Tip: Buttons automatically receive keyboard events (Enter/Space) — no extra handling is required for basic toggles.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: Initially expanded -->
    <div class="example">
      <div class="header-row">
        <div>
          <div class="example-title">Initially expanded</div>
          <div class="note small">This example starts open. The JS reads the initial aria-expanded state.</div>
        </div>
        <div>
          <button class="toggle-btn" aria-expanded="true" aria-controls="details-2" id="toggle-2" type="button">
            <span class="label">Account settings</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8 5v14l11-7z" fill="currentColor" />
            </svg>
          </button>
        </div>
      </div>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="false">
        <div class="panel">
          <p><strong>Notifications</strong></p>
          <p class="small">Email: enabled<br/>Push: disabled</p>
          <hr/>
          <p><strong>Privacy</strong></p>
          <p class="small">Profile visibility: Friends only</p>
        </div>
      </div>
    </div>

    <!-- Example 3: Long content with nested controls -->
    <div class="example">
      <div class="header-row">
        <div>
          <div class="example-title">Long content & nested widget</div>
          <div class="note small">Demonstrates smooth animation on taller content and nesting.</div>
        </div>
        <div>
          <button class="toggle-btn" aria-expanded="false" aria-controls="details-3" id="toggle-3" type="button">
            <span class="label">Read details</span>
            <svg class="caret" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8 5v14l11-7z" fill="currentColor" />
            </svg>
          </button>
        </div>
      </div>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
        <div class="panel">
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam.</p>
          <p>Suspendisse potenti. Sed dignissim lacinia nunc. Curabitur tortor. Pellentesque nibh. Aenean quam. In scelerisque sem at dolor.</p>

          <div style="margin-top:12px; padding:10px;border-radius:6px;background:#fbfdff;border:1px solid #eef6ff;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <strong style="font-size:13px">More options</strong>
              <button class="toggle-btn nested-toggle" aria-expanded="false" aria-controls="nested-1" id="nested-toggle-1" type="button" style="padding:6px 8px;">
                <span class="label" style="font-size:13px">Show</span>
                <svg class="caret" viewBox="0 0 24 24" aria-hidden="true" style="width:14px;height:14px;">
                  <path d="M8 5v14l11-7z" fill="currentColor" />
                </svg>
              </button>
            </div>

            <div id="nested-1" class="details" role="region" aria-labelledby="nested-toggle-1" aria-hidden="true" style="margin-top:10px;">
              <div class="panel" style="background:#fff; border-color:#f2f9ff; padding:8px;">
                <p class="small">Nested content works the same way — it's just another details container controlled by its button.</p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <p style="font-size:13px;color:var(--muted);margin-top:12px">All examples above use elements with class="details" as the controlled content containers and are wrapped in a div.example.</p>
  </div>

  <script>
    (function(){
      // Initialize toggles: find all buttons that have aria-controls pointing to an element
      function setupToggle(button){
        var targetId = button.getAttribute('aria-controls');
        if(!targetId) return;
        var panel = document.getElementById(targetId);
        if(!panel) return;

        // Ensure panel has class details (requirement)
        if(!panel.classList.contains('details')){
          panel.classList.add('details');
        }

        // Set initial state from aria-expanded
        var expanded = button.getAttribute('aria-expanded') === 'true';
        syncState(button, panel, expanded, true);

        // Click toggles
        button.addEventListener('click', function(){
          var isOpen = button.getAttribute('aria-expanded') === 'true';
          syncState(button, panel, !isOpen, false);
        });

        // Allow Escape to close when focus inside panel
        panel.addEventListener('keydown', function(e){
          if(e.key === 'Escape' || e.key === 'Esc'){
            button.focus();
            syncState(button, panel, false, false);
          }
        });

        // Make panel focusable region for keyboard accessibility
        if(!panel.hasAttribute('tabindex')){
          panel.setAttribute('tabindex', '-1');
        }
      }

      function syncState(button, panel, open, initial){
        button.setAttribute('aria-expanded', open ? 'true' : 'false');
        panel.setAttribute('aria-hidden', open ? 'false' : 'true');

        if(open){
          // add open class (used for opacity)
          panel.classList.add('open');

          // set max-height to scrollHeight to animate
          var full = panel.scrollHeight;
          panel.style.maxHeight = full + 'px';

          // after transition, clear max-height to allow internal size changes
          if(!initial){
            panel.addEventListener('transitionend', function handler(e){
              if(e.propertyName === 'max-height'){
                // remove explicit max-height so content can grow/shrink naturally
                panel.style.maxHeight = 'none';
                panel.removeEventListener('transitionend', handler);
              }
            });
          } else {
            // for initial open, allow natural sizing immediately
            panel.style.maxHeight = 'none';
          }
        } else {
          // when collapsing, set max-height to current height then trigger to 0
          var current = panel.scrollHeight;
          // ensure it's not 'none'
          panel.style.maxHeight = current + 'px';
          // force reflow to ensure the starting maxHeight is applied
          // then set to 0 to animate
          requestAnimationFrame(function(){
            panel.style.maxHeight = '0px';
            panel.classList.remove('open');
          });
        }

        // Toggle caret text if present
        var lbl = button.querySelector('.label');
        if(lbl){
          if(open){
            if(button.classList.contains('nested-toggle')){
              lbl.textContent = 'Hide';
            } else {
              lbl.textContent = lbl.getAttribute('data-open') || (button.id === 'toggle-2' ? 'Account settings' : (button.id === 'toggle-1' ? 'Show less' : 'Hide'));
            }
          } else {
            if(button.classList.contains('nested-toggle')){
              lbl.textContent = 'Show';
            } else {
              // For example 1 restore to "Show more"
              if(button.id === 'toggle-1') lbl.textContent = 'Show more';
              if(button.id === 'toggle-2') lbl.textContent = 'Account settings';
              if(button.id === 'toggle-3') lbl.textContent = 'Read details';
            }
          }
        }
      }

      // Initialize all buttons with aria-controls
      var buttons = document.querySelectorAll('button[aria-controls]');
      buttons.forEach(setupToggle);

      // On window resize, when panels are open and max-height is 'none',
      // ensure nested transitions still work if user toggles again.
      window.addEventListener('resize', function(){
        document.querySelectorAll('.details.open').forEach(function(panel){
          // if maxHeight is none, leave it until close; when closing, script will handle current scrollHeight
          // no action needed here, but we ensure no stale 'none' string prevents collapsing.
          if(panel.style.maxHeight === 'none'){
            panel.style.maxHeight = panel.scrollHeight + 'px';
            // allow it to settle
            requestAnimationFrame(function(){
              panel.style.maxHeight = 'none';
            });
          }
        });
      });
    })();
  </script>
</body>
</html>