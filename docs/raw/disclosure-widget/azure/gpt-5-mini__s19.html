<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b66ff;
      --muted:#6b7280;
      --bg:#f8fafc;
      --card:#ffffff;
      --radius:8px;
      --transition:250ms cubic-bezier(.2,.9,.3,1);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg,var(--bg),#ffffff 60%);
      color:#0f172a;
      line-height:1.4;
    }
    h1{font-size:1.25rem;margin:0 0 12px 0}
    p.lead{margin:0 0 20px 0;color:var(--muted)}
    .example{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:0 1px 2px rgba(0,0,0,0.04), 0 6px 18px rgba(12,18,35,0.04);
      max-width:760px;
      margin-bottom:18px;
      border:1px solid rgba(15,23,42,0.04);
    }
    .example + .example{margin-top:8px}
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .toggle{
      appearance:none;
      background:transparent;
      border:1px solid rgba(15,23,42,0.06);
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:600;
      color:var(--accent);
      transition:background var(--transition), transform var(--transition), border-color var(--transition);
    }
    .toggle:focus{
      outline:3px solid rgba(11,102,255,0.14);
      outline-offset:2px;
    }
    .toggle .chev{
      transition:transform var(--transition);
      display:inline-block;
    }
    .toggle[aria-expanded="true"] .chev{
      transform:rotate(180deg);
    }
    .meta{
      color:var(--muted);
      font-size:0.9rem;
    }
    /* controlled content */
    .details{
      overflow:hidden;
      max-height:0;
      transition:max-height var(--transition), opacity var(--transition);
      opacity:0;
      margin-top:12px;
      will-change:max-height,opacity;
    }
    .details.open{
      opacity:1;
    }
    .details .content{
      padding:8px 0 4px 0;
    }
    .details p{margin:8px 0}
    ul{margin:6px 0 12px 20px}
    /* fallback when JS disabled: show details */
    noscript .details{
      max-height:none;
      opacity:1;
    }
    /* small helper */
    .hint{font-size:0.85rem;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Each example is wrapped in a div.example and the controlled content container uses the class "details". Use the buttons to expand or collapse the content.</p>

  <div class="example" id="example-1">
    <div class="header">
      <div class="title">
        <strong>About Domestic Cats</strong>
        <span class="meta">Short facts</span>
      </div>
      <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1" aria-haspopup="true">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="label">Read more</span>
      </button>
    </div>
    <div class="details" id="details-1" role="region" aria-labelledby="toggle-1" aria-hidden="true">
      <div class="content">
        <p>Cats (Felis catus) are small, carnivorous mammals that are often kept as pets. They are valued by humans for companionship and their ability to hunt vermin.</p>
        <ul>
          <li>Average lifespan: 12–18 years (varies by breed and care)</li>
          <li>Highly agile and excellent climbers</li>
          <li>Communicate with vocalizations, body language and scent</li>
        </ul>
        <p class="hint">Tip: Press the button again to collapse this section.</p>
      </div>
    </div>
  </div>

  <div class="example" id="example-2">
    <div class="header">
      <div class="title">
        <strong>Quick Cake Recipe</strong>
        <span class="meta">Step-by-step</span>
      </div>
      <button class="toggle" id="toggle-2" aria-expanded="false" aria-controls="details-2" aria-haspopup="true">
        <span class="chev" aria-hidden="true">▾</span>
        <span class="label">Show steps</span>
      </button>
    </div>
    <div class="details" id="details-2" role="region" aria-labelledby="toggle-2" aria-hidden="true">
      <div class="content">
        <p>Simple vanilla sponge cake — makes one 8-inch round cake.</p>
        <ul>
          <li>Preheat oven to 350°F (175°C). Grease and flour your pan.</li>
          <li>Mix 1 cup sugar, 1/2 cup butter, 2 eggs, 2 tsp vanilla.</li>
          <li>Stir in 1.5 cups flour, 1.75 tsp baking powder, and 1/2 cup milk.</li>
          <li>Bake for 30–35 minutes or until a toothpick comes out clean.</li>
        </ul>
        <p class="hint">Accessibility: the button updates aria-expanded and aria-hidden on the content.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Setup all examples
      const examples = document.querySelectorAll('.example');
      examples.forEach((ex, idx) => {
        const button = ex.querySelector('.toggle');
        const details = ex.querySelector('.details');

        if(!button || !details) return;

        // ensure ids
        if(!details.id) details.id = 'details-auto-' + idx;
        if(!button.id) button.id = 'toggle-auto-' + idx;
        button.setAttribute('aria-controls', details.id);
        details.setAttribute('aria-labelledby', button.id);

        // initial collapsed state
        details.classList.remove('open');
        details.style.maxHeight = '0px';
        details.setAttribute('aria-hidden', 'true');
        button.setAttribute('aria-expanded', 'false');

        // transitionend handling to clear fixed max-height after opening
        details.addEventListener('transitionend', (e) => {
          if(e.propertyName !== 'max-height') return;
          if(details.classList.contains('open')) {
            // allow content to size naturally after opening
            details.style.maxHeight = 'none';
          }
        });

        function open() {
          // If already open, do nothing
          if(details.classList.contains('open')) return;
          details.classList.add('open');
          details.setAttribute('aria-hidden', 'false');
          button.setAttribute('aria-expanded', 'true');
          // set to measured scrollHeight to animate
          const startHeight = details.scrollHeight;
          details.style.maxHeight = startHeight + 'px';
          // After a tick, if content changes size, we rely on transitionend clearing maxHeight.
        }

        function close() {
          if(!details.classList.contains('open')) return;
          // To animate from current height to 0, we first set maxHeight to the current computed height
          const computed = details.scrollHeight;
          details.style.maxHeight = computed + 'px';
          // Force a reflow so the browser registers the current height before transitioning to 0
          details.getBoundingClientRect();
          details.style.maxHeight = '0px';
          details.classList.remove('open');
          details.setAttribute('aria-hidden', 'true');
          button.setAttribute('aria-expanded', 'false');
        }

        function toggle() {
          if(details.classList.contains('open')) close();
          else open();
        }

        button.addEventListener('click', (e) => {
          e.preventDefault();
          toggle();
        });

        // keyboard support: space/enter already activate button, but handle Escape to close when content focused
        details.addEventListener('keydown', (e) => {
          if(e.key === 'Escape') {
            close();
            button.focus();
          }
        });

        // Allow closing an open panel by pressing Escape anywhere inside the example
        ex.addEventListener('keydown', (e) => {
          if(e.key === 'Escape') {
            close();
            button.focus();
          }
        });

        // Optional: update label text based on state
        const labelEl = button.querySelector('.label');
        function updateLabel() {
          if(!labelEl) return;
          labelEl.textContent = details.classList.contains('open') ? 'Collapse' : (button.getAttribute('data-closed-label') || labelEl.textContent);
        }
        // store original closed label
        button.setAttribute('data-closed-label', labelEl ? labelEl.textContent : '');
        // observe class changes to update label
        const obs = new MutationObserver(updateLabel);
        obs.observe(details, { attributes: true, attributeFilter: ['class'] });
        // initial label update
        updateLabel();
      });

      // Global: close panels when clicking outside (optional, keeps widgets tidy)
      document.addEventListener('click', (e) => {
        // if click is inside any .example, do nothing
        const clickedExample = e.target.closest('.example');
        // Close any open examples that are not the clicked one
        document.querySelectorAll('.example').forEach(ex => {
          if(ex === clickedExample) return;
          const details = ex.querySelector('.details');
          const button = ex.querySelector('.toggle');
          if(details && details.classList.contains('open')) {
            // close
            // emulate same close logic
            details.style.maxHeight = details.scrollHeight + 'px';
            details.getBoundingClientRect();
            details.style.maxHeight = '0px';
            details.classList.remove('open');
            details.setAttribute('aria-hidden','true');
            if(button) button.setAttribute('aria-expanded','false');
          }
        });
      });

    })();
  </script>
</body>
</html>