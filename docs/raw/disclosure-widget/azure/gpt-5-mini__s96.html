<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0366d6;
      --bg:#f7f9fc;
      --surface:#ffffff;
      --muted:#6b7280;
      --radius:8px;
    }
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin:24px;
      background:linear-gradient(180deg,var(--bg),#fff 80%);
      color:#0f1724;
      line-height:1.4;
    }

    h1{font-size:1.25rem;margin:0 0 .75rem;font-weight:600}
    p.lead{margin:0 0 1rem;color:var(--muted)}

    .example{
      background:var(--surface);
      border:1px solid #e6edf3;
      border-radius:var(--radius);
      padding:16px;
      margin:16px 0;
      box-shadow:0 1px 2px rgba(12,18,24,0.04);
    }

    /* Expander button */
    .expander{
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
      gap:12px;
      background:transparent;
      border:1px solid transparent;
      padding:10px 12px;
      font-size:1rem;
      font-weight:600;
      color:var(--accent);
      cursor:pointer;
      border-radius:6px;
    }
    .expander:focus{
      outline:3px solid rgba(3,102,214,0.12);
      outline-offset:2px;
    }
    .expander .summary{
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:2px;
      align-items:flex-start;
    }
    .expander .title{font-weight:700;color:#073763}
    .expander .meta{font-size:.85rem;color:var(--muted);font-weight:500}

    .icon{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:34px;
      height:34px;
      border-radius:6px;
      transition:transform .22s ease;
      color:var(--accent);
      background:rgba(3,102,214,0.06);
      font-size:16px;
      flex-shrink:0;
    }
    .expander[aria-expanded="true"] .icon{
      transform:rotate(90deg);
    }

    /* Controlled content container must use class "details" */
    .details{
      overflow:hidden;
      max-height:0;
      transition:max-height 260ms cubic-bezier(.2,.8,.2,1);
      margin-top:12px;
      border-top:1px dashed #e6edf3;
      padding-top:12px;
      will-change:max-height;
    }
    .details.open{
      /* when open we let JS remove max-height to allow natural height */
    }

    /* content styles inside details */
    .details p{margin:.25rem 0}
    .details ul{margin:.5rem 0 0 1.2rem}
    .small{font-size:.9rem;color:var(--muted)}

    /* small helper */
    .hint{font-size:.85rem;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <main>
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">Accessible expand/collapse widgets. Each widget is wrapped in a container with class="example". The controlled content container uses class="details".</p>

    <div class="example">
      <button class="expander"
              id="expander-1"
              aria-controls="details-1"
              aria-expanded="false"
              type="button">
        <span class="summary">
          <span class="title">Release notes — v2.4.1</span>
          <span class="meta">Click to view changes and improvements</span>
        </span>
        <span class="icon" aria-hidden="true">▸</span>
      </button>

      <div class="details" id="details-1" role="region" aria-labelledby="expander-1" aria-hidden="true">
        <p><strong>Highlights</strong></p>
        <ul>
          <li>Improved performance for list rendering.</li>
          <li>Fixed keyboard focus issues on dialogs.</li>
          <li>Updated dependencies and security patches.</li>
        </ul>
        <p class="small">Released: 2025-09-10 · Size: 1.2MB</p>
      </div>
      <div class="hint">Tip: Use Enter or Space to toggle. Press Escape to close while focused inside content.</div>
    </div>

    <div class="example">
      <button class="expander"
              id="expander-2"
              aria-controls="details-2"
              aria-expanded="false"
              type="button">
        <span class="summary">
          <span class="title">More about accessibility</span>
          <span class="meta">Why we use ARIA and live regions</span>
        </span>
        <span class="icon" aria-hidden="true">▸</span>
      </button>

      <div class="details" id="details-2" role="region" aria-labelledby="expander-2" aria-hidden="true">
        <p>We expose the relationship between the button and the content using aria-controls and aria-labelledby. The button also reflects state using aria-expanded.</p>
        <p>When opened, the container has role="region" so screen reader users can quickly jump to it with their virtual cursor.</p>
      </div>
    </div>
  </main>

  <script>
    (function () {
      // Initialize expand/collapse behavior for all examples
      function setupExpander(button) {
        var detailsId = button.getAttribute('aria-controls');
        if (!detailsId) return;
        var details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure initial collapsed state
        details.setAttribute('aria-hidden', 'true');
        details.style.display = 'block'; // ensure measurable for height calculations
        details.style.maxHeight = '0px';
        details.classList.remove('open');

        // Transitionend handler to tidy inline styles
        details.addEventListener('transitionend', function (ev) {
          if (ev.propertyName !== 'max-height') return;
          if (button.getAttribute('aria-expanded') === 'true') {
            // fully opened: remove max-height so content can grow naturally
            details.style.maxHeight = 'none';
            details.classList.add('open');
          } else {
            // fully closed: keep max-height 0 and ensure aria-hidden stays true
            details.style.display = 'block'; // keep block for consistent measurements
            details.classList.remove('open');
          }
        });

        // Toggle function
        function toggle(expand) {
          var isExpanded = button.getAttribute('aria-expanded') === 'true';
          var willExpand = typeof expand === 'boolean' ? expand : !isExpanded;

          if (willExpand) {
            // measure natural height
            details.style.maxHeight = 'none';
            var natural = details.scrollHeight;
            details.style.maxHeight = '0px'; // reset before animating
            details.setAttribute('aria-hidden', 'false');
            button.setAttribute('aria-expanded', 'true');

            // start animation to natural height
            // use rAF to ensure the 0px max-height is applied before we set the target
            requestAnimationFrame(function () {
              details.style.maxHeight = natural + 'px';
            });
          } else {
            // collapse: if maxHeight is none, set it to current pixel height first
            if (getComputedStyle(details).maxHeight === 'none') {
              details.style.maxHeight = details.scrollHeight + 'px';
            }
            // trigger reflow then set to 0
            requestAnimationFrame(function () {
              details.style.maxHeight = '0px';
              details.setAttribute('aria-hidden', 'true');
              button.setAttribute('aria-expanded', 'false');
            });
          }
        }

        // Click toggles
        button.addEventListener('click', function () {
          toggle();
        });

        // Close on Escape when focus is within the details region
        details.addEventListener('keydown', function (ev) {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            // move focus back to button for clarity
            button.focus();
            toggle(false);
          }
        });

        // Also allow Escape when a child is focused (global handler per widget)
        document.addEventListener('keydown', function (ev) {
          if (ev.key === 'Escape' || ev.key === 'Esc') {
            var active = document.activeElement;
            if (details.contains(active) && button.getAttribute('aria-expanded') === 'true') {
              button.focus();
              toggle(false);
            }
          }
        });
      }

      // Find all expander buttons inside .example containers
      var expanders = document.querySelectorAll('.example .expander');
      expanders.forEach(setupExpander);

      // Optional: support deep-link via hash to open a details region
      if (location.hash) {
        var target = document.getElementById(location.hash.slice(1));
        if (target && target.classList.contains('details')) {
          // find controller button
          var id = target.id;
          var btn = document.querySelector('[aria-controls="' + id + '"]');
          if (btn) {
            // open it
            // small delay to allow initial layout to settle
            setTimeout(function () {
              btn.click();
              // focus the revealed region for screen reader users
              target.setAttribute('tabindex', '-1');
              target.focus();
            }, 60);
          }
        }
      }
    })();
  </script>
</body>
</html>