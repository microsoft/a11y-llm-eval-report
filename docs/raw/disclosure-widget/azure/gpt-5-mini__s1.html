<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b5fff;
      --bg:#ffffff;
      --muted:#666;
      --outline: 3px solid rgba(11,95,255,0.15);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:#f6f8fb;
      color:#111;
      margin:32px;
      line-height:1.5;
    }

    h1{margin:0 0 18px;font-size:20px}
    .container{max-width:820px;margin:0 auto}

    /* Example wrapper */
    .example{
      background:linear-gradient(180deg,#fff,#fbfdff);
      border:1px solid rgba(15,23,42,0.06);
      border-radius:10px;
      padding:14px;
      margin-bottom:18px;
      box-shadow:0 1px 0 rgba(15,23,42,0.02), 0 6px 18px rgba(11,38,88,0.03);
    }

    /* Toggle button */
    .toggle{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      background:transparent;
      border:1px solid transparent;
      padding:10px 12px;
      border-radius:8px;
      font-weight:600;
      color:#042;
      text-align:left;
      cursor:pointer;
      transition:box-shadow .12s ease, background .12s ease, transform .06s ease;
    }
    .toggle:focus{
      outline:none;
      box-shadow:var(--outline);
    }
    .toggle:hover{
      background:rgba(11,95,255,0.03);
    }

    .toggle .label{
      flex:1;
      font-size:15px;
    }
    .toggle .meta{
      color:var(--muted);
      font-size:13px;
    }

    /* icon */
    .toggle .icon{
      width:36px;
      height:36px;
      border-radius:8px;
      display:inline-grid;
      place-items:center;
      background:rgba(11,95,255,0.06);
      flex:0 0 36px;
      transition:transform .18s ease;
      color:var(--accent);
      font-weight:700;
    }
    .toggle[aria-expanded="true"] .icon{
      transform:rotate(180deg);
    }

    /* controlled content - required class name: details */
    .details{
      overflow:hidden;
      max-height:0; /* collapsed by default */
      transition:max-height .28s cubic-bezier(.2,.9,.2,1), opacity .18s ease;
      opacity:0;
      margin-top:12px;
      border-radius:8px;
      padding:0 6px;
    }
    .details.open{
      opacity:1;
    }

    .details .inner{
      padding:12px;
      background:linear-gradient(180deg,#fbfdff,#ffffff);
      border:1px solid rgba(15,23,42,0.04);
      border-radius:8px;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.5);
    }

    /* small utility */
    .hint{color:var(--muted);font-size:13px;margin-top:8px}
    pre{background:#0b1726;color:#e6f0ff;padding:12px;border-radius:8px;overflow:auto;font-size:13px}

    /* respect prefers-reduced-motion */
    @media (prefers-reduced-motion: reduce) {
      .details { transition:none; }
      .toggle .icon { transition:none; }
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>Expand / Collapse widget examples</h1>

    <!-- Example 1 -->
    <div class="example">
      <button id="btn-1" class="toggle" aria-expanded="false" aria-controls="details-1">
        <span class="icon" aria-hidden="true">+</span>
        <span class="label">View more about the project</span>
        <span class="meta">Summary</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="btn-1" aria-hidden="true">
        <div class="inner">
          <p>
            This project demonstrates a simple, accessible expand/collapse widget.
            The button controls the visibility of this content. Use the button or
            the keyboard (Space / Enter) to toggle.
          </p>
          <p class="hint">Tip: the animation uses max-height controlled by JavaScript for smooth transitions.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: initially open -->
    <div class="example">
      <button id="btn-2" class="toggle" aria-expanded="true" aria-controls="details-2">
        <span class="icon" aria-hidden="true">âˆ’</span>
        <span class="label">Advanced settings</span>
        <span class="meta">3 options</span>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="btn-2" aria-hidden="false">
        <div class="inner">
          <form>
            <label style="display:block;margin-bottom:8px;">
              <input type="checkbox" /> Enable experimental features
            </label>
            <label style="display:block;margin-bottom:8px;">
              <input type="checkbox" checked/> Use hardware acceleration
            </label>
            <label style="display:block;margin-bottom:8px;">
              <input type="checkbox" /> Send anonymous usage stats
            </label>
          </form>
        </div>
      </div>
    </div>

    <!-- Example 3: nested content -->
    <div class="example">
      <button id="btn-3" class="toggle" aria-expanded="false" aria-controls="details-3">
        <span class="icon" aria-hidden="true">+</span>
        <span class="label">Show code example</span>
        <span class="meta">JavaScript</span>
      </button>

      <div id="details-3" class="details" role="region" aria-labelledby="btn-3" aria-hidden="true">
        <div class="inner">
          <p>Below is a minimal snippet that toggles a details container:</p>
          <pre><code>const btn = document.getElementById('btn-3');
const details = document.getElementById('details-3');
btn.addEventListener('click', () =&gt; {
  const open = btn.getAttribute('aria-expanded') === 'true';
  btn.setAttribute('aria-expanded', String(!open));
  details.setAttribute('aria-hidden', String(open));
  // animate height...
});</code></pre>
        </div>
      </div>
    </div>

  </main>

  <script>
    (function () {
      // Setup each example: find button and the details container and wire toggle behavior.
      const examples = document.querySelectorAll('.example');

      examples.forEach((example, idx) => {
        const button = example.querySelector('.toggle');
        const details = example.querySelector('.details');

        if (!button || !details) return;

        // Ensure IDs exist (they are present in the markup above, but keep safe).
        if (!button.id) button.id = 'toggle-btn-' + idx;
        if (!details.id) details.id = 'details-' + idx;

        // Align aria-controls and aria-labelledby
        button.setAttribute('aria-controls', details.id);
        details.setAttribute('aria-labelledby', button.id);

        // Initialize visual state based on aria-expanded attribute
        const expanded = button.getAttribute('aria-expanded') === 'true';
        if (expanded) open(details);
        else closeImmediate(details);

        // Click toggles
        button.addEventListener('click', () => {
          const isOpen = button.getAttribute('aria-expanded') === 'true';
          if (isOpen) {
            collapse(button, details);
          } else {
            expand(button, details);
          }
        });

        // Expose keyboard behavior is native for button (Space/Enter). No extra handlers needed.

      });

      // Expand: animate to scrollHeight then remove max-height to allow flexible content.
      function expand(button, details) {
        button.setAttribute('aria-expanded', 'true');
        details.setAttribute('aria-hidden', 'false');
        details.classList.add('open');

        // Start from current height (should be 0)
        details.style.maxHeight = '0px';

        // Force a reflow so the following measurement is accurate
        details.getBoundingClientRect();

        const scroll = details.scrollHeight;
        // Set to scrollHeight to start transition
        details.style.maxHeight = scroll + 'px';
        // When transition ends, remove maxHeight to make container auto-size
        const removeMax = () => {
          // Only remove if still expanded
          if (button.getAttribute('aria-expanded') === 'true') {
            details.style.maxHeight = 'none';
          }
          details.removeEventListener('transitionend', removeMax);
        };
        details.addEventListener('transitionend', removeMax);
      }

      // Collapse: set maxHeight to current height then to 0 to animate.
      function collapse(button, details) {
        button.setAttribute('aria-expanded', 'false');
        details.setAttribute('aria-hidden', 'true');
        details.classList.remove('open');

        // If maxHeight is 'none', compute actual height first
        if (getComputedStyle(details).maxHeight === 'none') {
          details.style.maxHeight = details.scrollHeight + 'px';
          // Force reflow
          details.getBoundingClientRect();
        }
        // then set to 0 to animate
        details.style.maxHeight = '0px';
      }

      // Immediate close without animation (used at init)
      function closeImmediate(details) {
        details.style.maxHeight = '0px';
        details.setAttribute('aria-hidden', 'true');
        details.classList.remove('open');
      }

      // Immediate open without animation (used at init)
      function open(details) {
        details.style.maxHeight = 'none';
        details.setAttribute('aria-hidden', 'false');
        details.classList.add('open');
      }

      // When the window resizes, adjust any open panels that have maxHeight 'none' by forcing a reflow to correct height.
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          document.querySelectorAll('.details').forEach(d => {
            // If currently expanded and using 'none', ensure the element can grow/shrink:
            const relatedBtn = document.getElementById(d.getAttribute('aria-labelledby'));
            if (relatedBtn && relatedBtn.getAttribute('aria-expanded') === 'true') {
              // temporarily set maxHeight to scrollHeight to allow transition if necessary
              d.style.maxHeight = d.scrollHeight + 'px';
              // remove after a tick to allow natural sizing
              requestAnimationFrame(() => d.style.maxHeight = 'none');
            }
          });
        }, 120);
      });

      // Optional: support reduced motion preference by disabling transitions via inline style if requested.
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if (mq.matches) {
        document.querySelectorAll('.details').forEach(d => d.style.transition = 'none');
      }
    })();
  </script>
</body>
</html>