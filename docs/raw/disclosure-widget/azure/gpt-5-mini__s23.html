<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f8fb;
      --card:#ffffff;
      --accent:#2563eb;
      --muted:#6b7280;
      --radius:10px;
      --shadow: 0 4px 14px rgba(16,24,40,0.06);
    }

    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;
      background: linear-gradient(180deg,var(--bg),#fff);
      color:#0f172a;
      margin:24px;
      line-height:1.45;
    }

    h1{
      margin:6px 0 18px;
      font-size:20px;
    }

    p.lead{
      margin:0 0 20px;
      color:var(--muted);
      max-width:60ch;
    }

    .example{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      margin:18px 0;
      border:1px solid rgba(15,23,42,0.04);
    }

    /* Toggle button */
    .toggle{
      display:flex;
      align-items:center;
      width:100%;
      gap:12px;
      background:transparent;
      border:1px solid rgba(15,23,42,0.06);
      padding:12px 14px;
      border-radius:8px;
      cursor:pointer;
      text-align:left;
      color:inherit;
      font-weight:600;
      font-size:14px;
      transition:background .12s ease, border-color .12s ease;
    }
    .toggle:hover{
      background:rgba(37,99,235,0.04);
    }
    .toggle:focus{
      outline:3px solid rgba(37,99,235,0.12);
      outline-offset:3px;
    }

    .toggle .meta{
      margin-left:auto;
      display:flex;
      gap:8px;
      align-items:center;
      color:var(--muted);
      font-weight:500;
      font-size:13px;
    }

    .toggle .icon{
      width:18px;
      height:18px;
      display:inline-block;
      transition:transform .18s ease;
      transform-origin:center;
      color:var(--accent);
      flex:0 0 18px;
    }
    /* rotate the chevron when expanded */
    .toggle[aria-expanded="true"] .icon{
      transform:rotate(180deg);
    }

    /* Controlled content (must use class "details") */
    .details{
      overflow:hidden;
      max-height:0;
      transition:max-height .26s cubic-bezier(.2,.9,.2,1);
      margin-top:10px;
      border-radius:8px;
      padding:0 12px;
      box-sizing:content-box;
    }

    /* When open, we'll add an "open" class to assist with non-animated layout */
    .details.open{
      /* max-height is handled inline via JS for smooth transitions */
      padding-top:12px;
      padding-bottom:12px;
    }

    .details .content{
      background:linear-gradient(180deg, rgba(15,23,42,0.02), transparent);
      border-radius:6px;
      padding:12px;
      color:#0b1220;
      font-size:14px;
      border:1px dashed rgba(15,23,42,0.04);
    }

    /* Small helper for accordion headings */
    .row{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .muted{
      color:var(--muted);
      font-size:13px;
      font-weight:500;
    }

    footer.note{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Three small examples demonstrating accessible expand/collapse widgets. Each widget is wrapped in a container with class "example". The controlled content containers use the class "details".</p>

  <!-- Example 1: Simple collapsed panel -->
  <div class="example">
    <button class="toggle" id="toggle1" aria-expanded="false" aria-controls="details1" type="button">
      Show more information
      <span class="meta">
        <span class="muted">More</span>
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
        </svg>
      </span>
    </button>
    <div id="details1" class="details" aria-hidden="true">
      <div class="content">
        <p>
          This is a simple collapsed panel. Clicking the button toggles the visibility of this content. The container for this content uses the required "details" class.
        </p>
        <p class="muted">Tip: You can also press Space or Enter while the button is focused.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Initially expanded panel -->
  <div class="example">
    <button class="toggle" id="toggle2" aria-expanded="true" aria-controls="details2" type="button">
      Release notes — latest
      <span class="meta">
        <span class="muted">v2.4.1</span>
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
        </svg>
      </span>
    </button>
    <div id="details2" class="details open" aria-hidden="false">
      <div class="content">
        <ul>
          <li>Improved performance for large lists.</li>
          <li>Fixed an issue with keyboard focus in dialogs.</li>
          <li>Updated translations and accessibility improvements.</li>
        </ul>
        <p class="muted">This example starts open. The script sets up the visual state based on aria-expanded on load.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: Simple accordion (only one open at a time) -->
  <div class="example" id="accordion">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
      <strong>FAQ (Accordion)</strong>
      <span class="muted">Only one item opens at a time</span>
    </div>

    <div style="display:grid;gap:8px;">
      <div>
        <button class="toggle" aria-expanded="false" aria-controls="details3a" type="button">
          What is the refund policy?
          <span class="meta">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
            </svg>
          </span>
        </button>
        <div id="details3a" class="details" aria-hidden="true">
          <div class="content">
            Refunds are available within 30 days of purchase for eligible items. Contact support to begin a return.
          </div>
        </div>
      </div>

      <div>
        <button class="toggle" aria-expanded="false" aria-controls="details3b" type="button">
          How do I change my password?
          <span class="meta">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
            </svg>
          </span>
        </button>
        <div id="details3b" class="details" aria-hidden="true">
          <div class="content">
            Go to Account Settings → Security → Change Password. You will need your current password to update it.
          </div>
        </div>
      </div>

      <div>
        <button class="toggle" aria-expanded="false" aria-controls="details3c" type="button">
          Can I integrate the API?
          <span class="meta">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
            </svg>
          </span>
        </button>
        <div id="details3c" class="details" aria-hidden="true">
          <div class="content">
            Yes — we provide a RESTful API. See our developer docs for authentication, rate limits, and examples.
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="note muted">All examples demonstrate the same accessible pattern: a button controlling a container with the class "details".</footer>

  <script>
    (function(){
      // Utility functions to open/close details with smooth height animation
      function openDetails(details, doAnimate = true){
        if (!details) return;
        details.classList.add('open');
        details.setAttribute('aria-hidden', 'false');

        // measure
        var currentMax = details.style.maxHeight;
        // If animate: set maxHeight to the scrollHeight to allow transition
        var height = details.scrollHeight;
        if (doAnimate){
          details.style.maxHeight = height + 'px';
          // after transition, clear maxHeight so content can grow naturally
          var after = function(){
            details.style.maxHeight = '';
            details.removeEventListener('transitionend', after);
          };
          details.addEventListener('transitionend', after);
        } else {
          // no animation - clear any inline style so it shows naturally
          details.style.maxHeight = '';
        }
      }

      function closeDetails(details, doAnimate = true){
        if (!details) return;
        details.setAttribute('aria-hidden', 'true');

        if (doAnimate){
          // set current height explicitly, then animate to 0
          var height = details.scrollHeight;
          details.style.maxHeight = height + 'px';
          // force frame
          requestAnimationFrame(function(){
            requestAnimationFrame(function(){
              details.style.maxHeight = '0px';
            });
          });
          var after = function(){
            details.classList.remove('open');
            details.removeEventListener('transitionend', after);
          };
          details.addEventListener('transitionend', after);
        } else {
          details.style.maxHeight = '0px';
          details.classList.remove('open');
        }
      }

      // Toggle handler for a button
      function toggleHandler(evt){
        var btn = evt.currentTarget;
        var controls = btn.getAttribute('aria-controls');
        if (!controls) return;
        var details = document.getElementById(controls);
        if (!details) return;

        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded){
          btn.setAttribute('aria-expanded', 'false');
          closeDetails(details);
        } else {
          btn.setAttribute('aria-expanded', 'true');
          openDetails(details);
        }

        // If inside an accordion wrapper (#accordion), close siblings (only one open)
        var accordionRoot = btn.closest('#accordion');
        if (accordionRoot){
          // find all other toggles inside the accordion
          var allToggles = accordionRoot.querySelectorAll('.toggle');
          allToggles.forEach(function(other){
            if (other === btn) return;
            var ctrl = other.getAttribute('aria-controls');
            if (!ctrl) return;
            var det = document.getElementById(ctrl);
            if (!det) return;
            if (other.getAttribute('aria-expanded') === 'true'){
              other.setAttribute('aria-expanded', 'false');
              closeDetails(det);
            }
          });
        }
      }

      // Wire up all buttons with class 'toggle'
      var toggles = document.querySelectorAll('.toggle');
      toggles.forEach(function(btn){
        btn.addEventListener('click', toggleHandler);
      });

      // Initialize details states based on aria-expanded on buttons
      document.addEventListener('DOMContentLoaded', function(){
        toggles.forEach(function(btn){
          var controls = btn.getAttribute('aria-controls');
          if (!controls) return;
          var details = document.getElementById(controls);
          if (!details) return;
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded){
            // ensure visible without animation
            details.classList.add('open');
            details.setAttribute('aria-hidden', 'false');
            details.style.maxHeight = '';
          } else {
            details.classList.remove('open');
            details.setAttribute('aria-hidden', 'true');
            details.style.maxHeight = '0px';
          }
        });
      });

      // Make sure keyboard activation is consistent (buttons already handle Space/Enter).
      // Additional helpful feature: allow toggle via Enter/Space for elements that might not be buttons in some future usage.
      // (Not needed here since we use button elements.)
    })();
  </script>
</body>
</html>