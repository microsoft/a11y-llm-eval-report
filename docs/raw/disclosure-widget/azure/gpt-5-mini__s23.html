<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0066cc;
      --bg:#f8f9fb;
      --panel-bg:#ffffff;
      --border:#e0e4ea;
      --radius:8px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.45;
      margin:24px;
      background:linear-gradient(180deg,#ffffff 0%, #f6f8fb 100%);
      color:#0b2540;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
      font-weight:600;
    }

    p.lead{
      margin:0 0 22px 0;
      color:#445669;
    }

    /* Example wrapper */
    .example{
      background:var(--panel-bg);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      margin:0 0 18px 0;
      box-shadow: 0 1px 0 rgba(10,20,30,0.03);
      max-width:720px;
    }

    /* Toggle button */
    .expander{
      display:flex;
      align-items:center;
      width:100%;
      gap:10px;
      background:transparent;
      border:0;
      padding:10px 12px;
      text-align:left;
      cursor:pointer;
      border-radius:6px;
      font-size:15px;
      font-weight:600;
      color:var(--accent);
    }

    .expander:focus{
      outline:3px solid rgba(0,102,204,0.18);
      outline-offset:2px;
    }

    .expander .title{
      flex:1 1 auto;
      color:inherit;
    }

    .chev{
      width:18px;
      height:18px;
      display:inline-block;
      transition:transform 220ms cubic-bezier(.2,.9,.3,1);
      flex:0 0 18px;
      color:var(--accent);
    }

    /* Rotated when expanded (button has aria-expanded="true") */
    .expander[aria-expanded="true"] .chev{
      transform:rotate(90deg);
    }

    /* The controlled content container must have class "details" per requirements */
    .details{
      overflow:hidden;
      transition: max-height 280ms cubic-bezier(.2,.9,.3,1), opacity 200ms ease;
      max-height:0;
      opacity:0;
      margin-top:8px;
      padding:0 12px;
      border-top:1px dashed var(--border);
      background:linear-gradient(180deg, rgba(0,0,0,0.01), transparent);
      border-radius:0 0 6px 6px;
    }

    /* Visible state (we'll set aria-hidden to "false" via JS) */
    .details[aria-hidden="false"]{
      opacity:1;
    }

    .details .content{
      padding:12px 0 16px 0;
      color:#304156;
      font-size:14px;
    }

    /* Small helper/meta text */
    .meta{
      font-size:13px;
      color:#5b6b7b;
      margin-top:10px;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .chev, .details{
        transition:none;
      }
    }

    /* Small demo styles for nested content */
    .details p{
      margin:0 0 10px 0;
    }

    .details ul{
      margin:6px 0 0 18px;
    }

    /* Make button look like inline text in compact examples */
    .compact .expander{
      padding:8px;
      font-weight:600;
      font-size:14px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Two accessible examples of an expand/collapse widget. Each widget is wrapped in a div.example and the controlled content container uses the class "details". Buttons use aria-expanded and aria-controls to relate the control and the content.</p>

  <!-- Example 1: Simple expandable panel -->
  <div class="example">
    <button class="expander" aria-expanded="false" aria-controls="details-1" id="toggle-1">
      <span class="title">More information about this feature</span>
      <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <path d="M6 4 L14 10 L6 16 Z" fill="currentColor"></path>
      </svg>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
      <div class="content">
        <p>This panel provides additional context about the feature. It is hidden by default and revealed when you toggle the button. The button keeps aria-expanded in sync with the visible state for assistive technology.</p>
        <ul>
          <li>Accessible labeling via aria-labelledby</li>
          <li>Smooth height animation for a comfortable reveal</li>
          <li>Arrow icon rotates to indicate the state</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Example 2: Compact variant -->
  <div class="example compact">
    <button class="expander" aria-expanded="false" aria-controls="details-2" id="toggle-2">
      <span class="title">Show quick tips</span>
      <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <path d="M6 4 L14 10 L6 16 Z" fill="currentColor"></path>
      </svg>
    </button>

    <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="true">
      <div class="content">
        <p>Quick tips to get the most out of this tool:</p>
        <ul>
          <li>Press Enter or Space to toggle the panel when the button is focused.</li>
          <li>Use aria-expanded and aria-controls for clear relationships.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    (function(){
      /**
       * Initialize all expand/collapse widgets:
       * - Buttons control a container referenced by aria-controls.
       * - Button aria-expanded toggles between "true" and "false".
       * - Details container (class="details") receives aria-hidden="true" / "false".
       * - We animate max-height for smooth transitions and set max-height to "none" after expansion completes.
       */

      function setExpanded(button, detailsEl, expanded){
        // Update attributes
        button.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        detailsEl.setAttribute('aria-hidden', expanded ? 'false' : 'true');

        // Cancel any running transition and compute heights
        detailsEl.style.transition = ''; // ensure current transition applies from this point
        if (expanded){
          // From collapsed (max-height: 0) -> expanded
          // Set max-height to scrollHeight to animate expansion, then once finished set to none to allow natural height
          var startHeight = detailsEl.scrollHeight;
          detailsEl.style.maxHeight = startHeight + 'px';
          // After the transition finishes, release the max-height constraint
          var onEnd = function(e){
            // Only handle max-height transition
            if (e && e.propertyName && e.propertyName !== 'max-height') return;
            detailsEl.style.maxHeight = 'none';
            detailsEl.removeEventListener('transitionend', onEnd);
          };
          detailsEl.addEventListener('transitionend', onEnd);
        } else {
          // From expanded -> collapsed
          // If maxHeight is "none" (we removed it after expanding), set it to the current content height first so the transition can run
          var currentHeight = detailsEl.scrollHeight;
          detailsEl.style.maxHeight = currentHeight + 'px';
          // Force a reflow so the change is noticed by the browser, then set to 0
          // eslint-disable-next-line no-unused-expressions
          detailsEl.offsetHeight;
          detailsEl.style.maxHeight = '0px';
        }
      }

      // Attach handlers
      var buttons = document.querySelectorAll('.example .expander[aria-controls]');
      buttons.forEach(function(btn){
        var controlsId = btn.getAttribute('aria-controls');
        var details = document.getElementById(controlsId);
        if (!details) return;

        // Ensure initial sync between aria-expanded and details aria-hidden
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        details.setAttribute('aria-hidden', expanded ? 'false' : 'true');
        // If expanded at load, set max-height to none so it displays
        if (expanded){
          details.style.maxHeight = 'none';
          details.style.opacity = '1';
        } else {
          details.style.maxHeight = '0px';
          details.style.opacity = '0';
        }

        btn.addEventListener('click', function(){
          var isExpanded = btn.getAttribute('aria-expanded') === 'true';
          setExpanded(btn, details, !isExpanded);
        });

        // Optional: allow keyboard users to use Enter/Space are already supported by button element.
        // If you wanted custom keyboard interactions (arrow keys, home/end) for an accordion you could add them here.
      });

      // Accessibility: if window is restored from back/forward cache, ensure style values match attributes
      window.addEventListener('pageshow', function(){
        buttons.forEach(function(btn){
          var controlsId = btn.getAttribute('aria-controls');
          var details = document.getElementById(controlsId);
          if (!details) return;
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          details.setAttribute('aria-hidden', expanded ? 'false' : 'true');
          details.style.maxHeight = expanded ? 'none' : '0px';
          details.style.opacity = expanded ? '1' : '0';
        });
      });

    })();
  </script>
</body>
</html>