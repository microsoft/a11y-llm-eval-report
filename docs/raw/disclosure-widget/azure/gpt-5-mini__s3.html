<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent: #0366d6;
      --bg: #fff;
      --muted: #6b7280;
      --surface: #f8fafc;
      --radius: 8px;
      --transition: 320ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f3f4f6 0%, #ffffff 100%);
      margin: 32px;
      color: #0f172a;
      line-height: 1.4;
    }

    h1{
      font-size: 20px;
      margin: 0 0 18px 0;
    }
    p.lead{
      margin: 0 0 24px 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* Example wrapper */
    .example{
      background: var(--surface);
      border-radius: var(--radius);
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 1px 2px rgba(2,6,23,0.04);
    }

    /* Toggle button */
    .toggle{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: transparent;
      border: 1px solid rgba(2,6,23,0.06);
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #0f172a;
      transition: box-shadow var(--transition), transform var(--transition), border-color var(--transition);
      user-select: none;
    }

    .toggle:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(3,102,214,0.12);
      border-color: var(--accent);
    }

    .toggle[aria-expanded="true"]{
      border-color: rgba(3,102,214,0.18);
      background: linear-gradient(180deg, #ffffff, #f8fbff);
    }

    .toggle .caret{
      display: inline-block;
      width: 14px;
      height: 14px;
      transition: transform var(--transition);
      transform-origin: 50% 50%;
      color: var(--accent);
      flex: 0 0 14px;
    }

    .toggle[aria-expanded="true"] .caret{
      transform: rotate(90deg);
    }

    /* Controlled details content */
    .details{
      margin-top: 12px;
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition), opacity var(--transition);
      border-left: 3px solid rgba(2,6,23,0.03);
      padding-left: 12px;
      opacity: 0;
    }

    .details.open{
      opacity: 1;
    }

    .details .content{
      padding: 8px 0 12px 0;
    }

    /* small helper text */
    .meta{
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Demo content appearance */
    .card{
      background: #fff;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 2px rgba(2,6,23,0.04);
      border: 1px solid rgba(2,6,23,0.03);
    }

    /* Simple caret (SVG fallback) */
    svg.caret{
      display: block;
    }

    /* Keep layout tidy on narrow screens */
    @media (max-width:520px){
      body{ margin: 18px; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse widget</h1>
  <p class="lead">Accessible expand/collapse examples. Each widget is wrapped in a container with class "example". The controlled content container uses the class "details".</p>

  <!-- Example 1: Collapsed by default -->
  <div class="example" id="ex1">
    <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1">
      <svg class="caret" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true" focusable="false">
        <path d="M8 5v14l11-7z" fill="currentColor"></path>
      </svg>
      Show more information
    </button>

    <div class="details" id="details-1" role="region" aria-labelledby="toggle-1" aria-hidden="true">
      <div class="content card">
        <p><strong>Overview</strong></p>
        <p>This content is hidden by default. The button above controls visibility using aria-expanded and aria-controls attributes. The details container uses the class "details".</p>
        <p class="meta">Tip: Press Enter or Space while focused on the button to toggle.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Expanded by default -->
  <div class="example" id="ex2">
    <button class="toggle" aria-expanded="true" aria-controls="details-2" id="toggle-2">
      <svg class="caret" viewBox="0 0 24 24" width="14" height="14" aria-hidden="true" focusable="false">
        <path d="M8 5v14l11-7z" fill="currentColor"></path>
      </svg>
      Release notes
    </button>

    <div class="details open" id="details-2" role="region" aria-labelledby="toggle-2" aria-hidden="false">
      <div class="content card">
        <p><strong>Release 1.2.0</strong></p>
        <ul>
          <li>Improved accessibility and keyboard support for widgets.</li>
          <li>Animation smoothing for expand/collapse transitions.</li>
          <li>Bug fixes and small UI improvements.</li>
        </ul>
        <p class="meta">This example starts expanded.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Helper: animate open/close using max-height technique
      function openDetails(details){
        // Remove any explicit 'max-height' none set earlier
        details.classList.add('open');
        details.style.display = 'block';
        // start from current height (0 if closed)
        var startHeight = details.scrollHeight;
        // Set max-height to current scrollHeight to animate open
        details.style.maxHeight = startHeight + 'px';
        details.setAttribute('aria-hidden','false');
      }

      function closeDetails(details){
        // To animate from current visible height to 0:
        var currentHeight = details.scrollHeight;
        // Fix current height then set to 0 to trigger transition
        details.style.maxHeight = currentHeight + 'px';
        // Force browser to recognize the current style before changing
        requestAnimationFrame(function(){
          details.style.maxHeight = '0px';
        });
        details.setAttribute('aria-hidden','true');
        details.classList.remove('open');
      }

      function toggle(button){
        var id = button.getAttribute('aria-controls');
        if(!id) return;
        var details = document.getElementById(id);
        if(!details) return;

        var expanded = button.getAttribute('aria-expanded') === 'true';
        if(expanded){
          // Collapse
          button.setAttribute('aria-expanded','false');
          closeDetails(details);
        } else {
          // Expand
          button.setAttribute('aria-expanded','true');
          openDetails(details);
        }
      }

      // Initialize: attach handlers to all toggle buttons
      var toggles = Array.from(document.querySelectorAll('.toggle[aria-controls]'));
      toggles.forEach(function(btn){
        var id = btn.getAttribute('aria-controls');
        var details = document.getElementById(id);
        if(!details) return;

        // If initial state is expanded, ensure details reflects that
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          // set max-height to none after short delay so animation not triggered on load
          details.style.maxHeight = details.scrollHeight + 'px';
          // After a tick, remove max-height restriction to allow natural sizing
          setTimeout(function(){
            details.style.maxHeight = 'none';
          }, 350);
        } else {
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        // Click toggles
        btn.addEventListener('click', function(e){
          e.preventDefault();
          toggle(btn);
        });

        // Ensure Enter/Space (buttons already handle this) â€” keep for completeness if role=button used in future
        btn.addEventListener('keydown', function(e){
          if(e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter'){
            // Let native button behavior handle it; prevent double activation on Space in some browsers
            e.preventDefault();
            btn.click();
          }
        });

        // When transition ends and details is open, remove max-height so content can grow naturally
        details.addEventListener('transitionend', function(event){
          if(event.propertyName !== 'max-height') return;
          if(details.classList.contains('open')){
            // Remove max-height constraint so content can resize naturally
            details.style.maxHeight = 'none';
          } else {
            // Keep it at 0 to remain collapsed
            details.style.display = '';
          }
        });
      });

      // Accessibility: support reduced motion preference by disabling animation
      var mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if(mq && mq.matches){
        // Remove transitions
        var style = document.createElement('style');
        style.innerHTML = '.details, .toggle .caret { transition: none !important; }';
        document.head.appendChild(style);
      }

      // Optional: handle window resize to update maxHeight if details is open and maxHeight is not 'none'
      window.addEventListener('resize', function(){
        toggles.forEach(function(btn){
          var id = btn.getAttribute('aria-controls');
          var details = document.getElementById(id);
          if(!details) return;
          if(details.classList.contains('open') && details.style.maxHeight !== 'none'){
            details.style.maxHeight = details.scrollHeight + 'px';
          }
        });
      });

    })();
  </script>
</body>
</html>