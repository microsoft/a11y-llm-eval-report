<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2563eb;
      --surface:#fff;
      --muted:#6b7280;
      --radius:8px;
      --transition:250ms cubic-bezier(.2,.9,.3,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: #f9fafb;
      color: #111827;
      line-height:1.4;
    }

    h1{ font-size:1.25rem; margin-bottom: 0.5rem; }
    p.lead{ color:var(--muted); margin-top:0; margin-bottom:1.25rem; }

    .example{
      background: var(--surface);
      border: 1px solid rgba(17,24,39,0.06);
      box-shadow: 0 1px 2px rgba(16,24,40,0.03);
      border-radius: var(--radius);
      padding: 16px;
      max-width: 720px;
      margin-bottom: 16px;
    }

    .toggle-button{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
      border: 1px solid rgba(17,24,39,0.06);
      border-radius: 8px;
      cursor: pointer;
      color: #0f172a;
      font-weight: 600;
      font-size: 0.95rem;
      transition: box-shadow var(--transition), transform var(--transition);
      user-select: none;
    }

    .toggle-button:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(37,99,235,0.12);
    }

    .toggle-button[aria-expanded="true"]{
      background: linear-gradient(180deg, rgba(37,99,235,0.06), rgba(37,99,235,0.03));
      border-color: rgba(37,99,235,0.18);
      color: var(--accent);
    }

    .toggle-icon{
      width: 18px;
      height: 18px;
      display: inline-block;
      transition: transform var(--transition);
      transform-origin: 50% 50%;
      color: var(--muted);
    }

    .toggle-button[aria-expanded="true"] .toggle-icon{
      transform: rotate(180deg);
      color: var(--accent);
    }

    /* Controlled content - must use class "details" per request */
    .details{
      overflow: hidden;
      transition: max-height var(--transition), padding var(--transition), opacity var(--transition);
      max-height: 0;
      opacity: 0;
      padding: 0 0;
      margin-top: 12px;
      border-top: 1px dashed rgba(17,24,39,0.06);
    }

    .details.open{
      opacity: 1;
      padding: 12px 0 0 0;
    }

    .details .content{
      padding: 0 6px 12px 6px;
      color: #111827;
    }

    .meta{
      color: var(--muted);
      font-size: 0.875rem;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce){
      .details{ transition: none; }
      .toggle-icon{ transition: none; }
      .toggle-button{ transition: none; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Three examples showing an accessible expand/collapse widget. Each widget is wrapped in a div.example and controlled content uses the details class.</p>

  <!-- Example 1: Basic -->
  <div class="example">
    <button id="btn-1" class="toggle-button" aria-expanded="false" aria-controls="details-1">
      <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Show more
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="btn-1" aria-hidden="true">
      <div class="content">
        <p><strong>Basic details:</strong> This content is revealed when the button is expanded. It uses aria-controls on the button and aria-hidden on the container for accessibility.</p>
        <p class="meta">Tip: Press Enter or Space while the button is focused to toggle.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Longer content with animation -->
  <div class="example">
    <button id="btn-2" class="toggle-button" aria-expanded="false" aria-controls="details-2">
      <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Read article summary
    </button>

    <div id="details-2" class="details" role="region" aria-labelledby="btn-2" aria-hidden="true">
      <div class="content">
        <h3 style="margin:0 0 8px 0;">Article summary</h3>
        <p>The widget smoothly expands to reveal multi-paragraph content. This allows users to hide long sections until they are needed, keeping the page tidy and scannable.</p>
        <p>Accessibility: the button uses aria-expanded to indicate the current state and aria-controls to reference the details container. The container includes role="region" and aria-labelledby pointing back to the button.</p>
        <p class="meta">This example demonstrates an animated expansion that calculates height so transitions are smooth with variable content length.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: Nested / multiple controls -->
  <div class="example">
    <button id="btn-3" class="toggle-button" aria-expanded="false" aria-controls="details-3">
      <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Settings
    </button>

    <div id="details-3" class="details" role="region" aria-labelledby="btn-3" aria-hidden="true">
      <div class="content">
        <form>
          <label style="display:block; margin-bottom:8px;">
            <input type="checkbox" name="option1" /> Enable notifications
          </label>
          <label style="display:block; margin-bottom:8px;">
            <input type="checkbox" name="option2" /> Dark mode
          </label>
          <label style="display:block; margin-bottom:8px;">
            <input type="checkbox" name="option3" /> Auto-update
          </label>
          <button type="button" style="margin-top:8px; padding:8px 10px; border-radius:6px; border:1px solid rgba(0,0,0,0.06); background:#f3f4f6;">Save</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Initialize all toggle buttons that reference a details container
      var buttons = document.querySelectorAll('.toggle-button[aria-controls]');

      function setCollapsed(button, details, expanded, animate){
        button.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        details.setAttribute('aria-hidden', expanded ? 'false' : 'true');

        if(!animate || window.matchMedia('(prefers-reduced-motion: reduce)').matches){
          // No animation: set max-height to none when expanded, or 0 when collapsed
          if(expanded){
            details.classList.add('open');
            details.style.maxHeight = details.scrollHeight + 'px';
            // then remove fixed max-height to allow content growth
            window.setTimeout(function(){ details.style.maxHeight = 'none'; }, 250);
          } else {
            details.classList.remove('open');
            details.style.maxHeight = '0px';
          }
          return;
        }

        if(expanded){
          // from 0 -> scrollHeight
          details.classList.add('open');
          // ensure it starts at 0
          details.style.maxHeight = '0px';
          // allow a frame to apply starting value
          requestAnimationFrame(function(){
            details.style.maxHeight = details.scrollHeight + 'px';
            // after transition ends, clear maxHeight so it can size naturally
            var cleanup = function(){
              details.style.maxHeight = 'none';
              details.removeEventListener('transitionend', cleanup);
            };
            details.addEventListener('transitionend', cleanup);
          });
        } else {
          // collapse: set maxHeight from current (auto or px) to px then to 0
          // if currently 'none', compute scrollHeight first
          var currentHeight = details.scrollHeight;
          details.style.maxHeight = currentHeight + 'px';
          // allow frame
          requestAnimationFrame(function(){
            details.style.maxHeight = '0px';
            details.classList.remove('open');
          });
        }
      }

      buttons.forEach(function(button, index){
        var detailsId = button.getAttribute('aria-controls');
        var details = document.getElementById(detailsId);

        if(!details) return;

        // Ensure role/label relationship if not present
        if(!details.hasAttribute('role')) details.setAttribute('role','region');
        if(!details.hasAttribute('aria-labelledby')) details.setAttribute('aria-labelledby', button.id || ('toggle-btn-' + index));

        // Initialize collapsed state from aria-expanded (default false)
        var initiallyExpanded = button.getAttribute('aria-expanded') === 'true';
        if(initiallyExpanded){
          details.classList.add('open');
          details.style.maxHeight = 'none';
          details.setAttribute('aria-hidden','false');
        } else {
          details.classList.remove('open');
          details.style.maxHeight = '0px';
          details.setAttribute('aria-hidden','true');
        }

        // Toggle on click
        button.addEventListener('click', function(){
          var expanded = button.getAttribute('aria-expanded') === 'true';
          setCollapsed(button, details, !expanded, true);
        });

        // Allow Ctrl+Click (or meta) to close others: optional behavior not required.
        // Additional keyboard handling unnecessary because button is naturally focusable.
      });
    })();
  </script>
</body>
</html>