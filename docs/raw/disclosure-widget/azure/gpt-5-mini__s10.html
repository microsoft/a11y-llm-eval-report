<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#2563eb;
      --bg:#f8fafc;
      --panel:#ffffff;
      --muted:#6b7280;
      --radius:8px;
      --duration:280ms;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg),#ffffff 60%);
      color:#0f172a;
      margin:24px;
      line-height:1.45;
    }

    h1{font-size:1.35rem;margin:0 0 18px 0}
    p.lead{margin:0 0 18px 0;color:var(--muted)}

    .example{
      background:var(--panel);
      border:1px solid rgba(15,23,42,0.06);
      border-radius:var(--radius);
      padding:14px;
      margin:18px 0;
      box-shadow: 0 6px 18px rgba(2,6,23,0.03);
    }

    /* Toggle button */
    .toggle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      width:100%;
      padding:10px 12px;
      font-weight:600;
      color:var(--accent);
      background:transparent;
      border:1px solid rgba(37,99,235,0.08);
      border-radius:8px;
      cursor:pointer;
      transition:box-shadow var(--duration) ease, transform var(--duration) ease;
      gap:12px;
    }
    .toggle:focus{outline:3px solid rgba(37,99,235,0.12); outline-offset:2px}
    .toggle:hover{transform:translateY(-1px)}
    .toggle .title{flex:1;text-align:left}
    .toggle .hint{font-weight:400;color:var(--muted);font-size:0.95rem;margin-left:12px}

    /* Arrow indicator */
    .toggle .chev{
      width:18px;height:18px;display:inline-block;flex:0 0 18px;
      transition: transform var(--duration) ease;
      color:var(--accent);
      transform-origin:center;
    }
    .toggle[aria-expanded="true"] .chev{transform:rotate(90deg)}

    /* Details container (controlled content) */
    .details{
      overflow:hidden;
      will-change: max-height;
      transition: max-height var(--duration) cubic-bezier(.2,.9,.2,1), opacity var(--duration) ease;
      opacity:1;
      margin-top:12px;
      border-radius:8px;
    }
    .details__inner{
      padding:12px;
      background:linear-gradient(180deg, rgba(2,6,23,0.02), transparent);
      border-radius:6px;
      border:1px dashed rgba(15,23,42,0.04);
      color:#0f172a;
    }

    /* Collapsed state visual */
    .details[aria-hidden="true"]{opacity:0;pointer-events:none}
    .meta{font-size:0.875rem;color:var(--muted);margin-top:8px}

    /* Small example: keyboard hint */
    .kbd{
      background:#111827;color:#fff;border-radius:6px;padding:2px 6px;font-size:0.75rem;margin-left:8px;
      display:inline-block;vertical-align:middle;
    }

    /* For users who prefer reduced motion, disable transitions */
    @media (prefers-reduced-motion: reduce){
      .details{transition:none}
      .toggle{transition:none}
      .toggle .chev{transition:none}
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Each widget below is wrapped in a div.example. The container for controlled content has a class of "details". Use the buttons to expand or collapse content.</p>

  <!-- Example 1: Basic collapsed -->
  <div class="example">
    <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1" type="button">
      <span class="title">Basic information</span>
      <span class="hint">Click to view</span>
      <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <path d="M6 5l8 5-8 5V5z" fill="currentColor"></path>
      </svg>
    </button>

    <div id="details-1" class="details" aria-hidden="true" role="region" aria-labelledby="toggle-1">
      <div class="details__inner">
        <p><strong>Summary</strong>: This is a simple example of an expandable panel. It opens and closes with a smooth animation and keeps ARIA attributes in sync for assistive technologies.</p>
        <p class="meta">Tip: You can also press Space or Enter when the toggle button has focus.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: Open by default -->
  <div class="example">
    <button class="toggle" aria-expanded="true" aria-controls="details-2" id="toggle-2" type="button">
      <span class="title">Account settings</span>
      <span class="hint">Open</span>
      <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <path d="M6 5l8 5-8 5V5z" fill="currentColor"></path>
      </svg>
    </button>

    <div id="details-2" class="details" aria-hidden="false" role="region" aria-labelledby="toggle-2">
      <div class="details__inner">
        <p>Notification preferences, email addresses, and connected accounts are shown here. This panel is initialized in the expanded state.</p>
        <ul>
          <li>Email: user@example.com</li>
          <li>Two-factor authentication: enabled</li>
          <li>Sync: active</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Example 3: Nested content -->
  <div class="example">
    <button class="toggle" aria-expanded="false" aria-controls="details-3" id="toggle-3" type="button">
      <span class="title">Advanced options</span>
      <span class="hint">Contains nested panels</span>
      <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
        <path d="M6 5l8 5-8 5V5z" fill="currentColor"></path>
      </svg>
    </button>

    <div id="details-3" class="details" aria-hidden="true" role="region" aria-labelledby="toggle-3">
      <div class="details__inner">
        <p>Below are nested options. Each nested panel also uses the same pattern.</p>

        <div style="margin-top:12px;">
          <button class="toggle" aria-expanded="false" aria-controls="details-3a" id="toggle-3a" type="button">
            <span class="title">Network settings</span>
            <span class="hint">Hidden</span>
            <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
              <path d="M6 5l8 5-8 5V5z" fill="currentColor"></path>
            </svg>
          </button>

          <div id="details-3a" class="details" aria-hidden="true" role="region" aria-labelledby="toggle-3a">
            <div class="details__inner">
              <p>Proxy, DNS, and advanced network options are configurable here.</p>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <button class="toggle" aria-expanded="false" aria-controls="details-3b" id="toggle-3b" type="button">
            <span class="title">Developer tools</span>
            <span class="hint">Hidden</span>
            <svg class="chev" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
              <path d="M6 5l8 5-8 5V5z" fill="currentColor"></path>
            </svg>
          </button>

          <div id="details-3b" class="details" aria-hidden="true" role="region" aria-labelledby="toggle-3b">
            <div class="details__inner">
              <p>Logs, debug flags, and experiment toggles.</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    (function(){
      // Setup all toggle buttons
      const toggles = Array.from(document.querySelectorAll('.toggle'));

      function collapse(details){
        // Prepare for transition from current height to 0
        details.style.maxHeight = details.scrollHeight + 'px';
        // Force reflow so the starting height is taken
        details.getBoundingClientRect();
        details.style.maxHeight = '0px';
        details.setAttribute('aria-hidden','true');
      }

      function expand(details){
        // From 0 to scrollHeight
        details.style.maxHeight = details.scrollHeight + 'px';
        details.setAttribute('aria-hidden','false');

        // When transition ends, clear maxHeight to allow natural growth
        const afterTransition = function(e){
          if (e.target !== details) return;
          details.style.maxHeight = 'none';
          details.removeEventListener('transitionend', afterTransition);
        };
        details.addEventListener('transitionend', afterTransition);
      }

      function setInitial(button, details){
        const expanded = button.getAttribute('aria-expanded') === 'true';
        if (expanded){
          // ensure details visible
          details.setAttribute('aria-hidden','false');
          details.style.maxHeight = 'none';
        } else {
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }
      }

      toggles.forEach(btn=>{
        const targetId = btn.getAttribute('aria-controls');
        if (!targetId) return;
        const details = document.getElementById(targetId);
        if (!details) return;

        // Ensure role/attributes exist (role=region set in markup)
        setInitial(btn, details);

        btn.addEventListener('click', ()=>{
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded){
            btn.setAttribute('aria-expanded','false');
            collapse(details);
          } else {
            btn.setAttribute('aria-expanded','true');
            expand(details);
          }
        });

        // Support keyboard activation via Space/Enter is provided by button element.
        // Ensure nested content size changes are handled (e.g., images loading)
        // When the details container is expanded (maxHeight none) and its content changes,
        // we don't need to do anything special; however when it's in transition or expanded
        // with maxHeight set, adjust if needed on resize.
        const ro = new ResizeObserver(() => {
          if (details.getAttribute('aria-hidden') === 'false') {
            // If currently expanded, and maxHeight was left at 'none', nothing to do.
            if (details.style.maxHeight === 'none') return;
            // Otherwise update to accommodate new content size
            details.style.maxHeight = details.scrollHeight + 'px';
          }
        });
        ro.observe(details);
      });

      // Enhance: if JS runs after page load and some details are expanded, ensure proper sizing
      window.addEventListener('load', () => {
        document.querySelectorAll('.details').forEach(d=>{
          if (d.getAttribute('aria-hidden') === 'false' && d.style.maxHeight !== 'none'){
            d.style.maxHeight = d.scrollHeight + 'px';
            // After a tick, remove maxHeight so layout can adjust naturally
            requestAnimationFrame(()=> d.style.maxHeight = 'none');
          }
        });
      });
    })();
  </script>
</body>
</html>