<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Expand/Collapse Widget Examples</title>
<style>
  :root{
    --bg:#f8f9fb;
    --card:#ffffff;
    --accent:#0b66ff;
    --muted:#6b7280;
    --radius:10px;
    --transition:300ms cubic-bezier(.2,.8,.2,1);
  }

  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#eef2ff 0%,var(--bg) 100%);
    padding: 36px;
    color:#0b1220;
    line-height:1.4;
  }

  h1{
    margin:0 0 18px 0;
    font-size:20px;
  }

  .container{
    max-width:880px;
    margin:auto;
  }

  /* Example wrapper */
  .example{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:0 10px 25px rgba(11,17,32,0.06);
    padding:16px;
    margin:16px 0;
    border:1px solid rgba(11,17,32,0.04);
  }

  /* Summary / toggle button */
  .toggle{
    background:transparent;
    border:0;
    padding:10px 12px;
    display:flex;
    width:100%;
    align-items:center;
    justify-content:space-between;
    text-align:left;
    gap:12px;
    cursor:pointer;
    border-radius:8px;
    font-size:15px;
  }

  .toggle:focus{
    outline:3px solid rgba(11,102,255,0.15);
    outline-offset:2px;
  }

  .toggle .title{
    display:flex;
    flex-direction:column;
    gap:2px;
  }

  .toggle .title .label{
    font-weight:600;
  }
  .toggle .title .hint{
    font-size:13px;
    color:var(--muted);
  }

  .chev{
    width:28px;
    height:28px;
    display:inline-grid;
    place-items:center;
    transition:transform var(--transition);
    color:var(--muted);
    flex:0 0 28px;
  }

  /* rotated when expanded */
  .example.open .chev{
    transform:rotate(180deg);
    color:var(--accent);
  }

  /* The controlled content container */
  .details{
    overflow:hidden;
    transition:max-height var(--transition), opacity var(--transition) var(--transition);
    will-change:opacity,max-height;
    max-height:0;
    opacity:0;
    margin-top:12px;
    border-radius:8px;
    padding:0 12px;
  }

  .details.inner{
    /* nested details get slightly different background/padding */
    background:linear-gradient(180deg, rgba(11,102,255,0.03), transparent);
    padding:12px;
    border-radius:8px;
  }

  /* when open, JS sets max-height to measured value; keep this stateful style fallback */
  .example.open .details{
    opacity:1;
  }

  .content{
    padding:10px 4px 18px 4px;
    color:#111827;
  }

  /* simple styled list for demonstration */
  .list{
    margin:0;
    padding-left:18px;
    color:var(--muted);
  }

  /* small helpers */
  .muted{
    color:var(--muted);
    font-size:13px;
  }

  /* small code-like box for localStorage key */
  .key{
    background:#eef2ff;
    color:var(--accent);
    padding:4px 8px;
    border-radius:6px;
    font-weight:600;
    font-size:13px;
    display:inline-block;
  }

  /* Make nested example visually nested */
  .nested-indicator{
    margin:8px 0 6px 0;
    font-size:13px;
    color:var(--muted);
  }

  /* a11y: reduce motion preference */
  @media (prefers-reduced-motion: reduce){
    .details{ transition:none; }
    .chev{ transition:none; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Expand / Collapse Widget Examples</h1>

  <!-- Example 1: Basic -->
  <div class="example" data-example="basic">
    <button class="toggle" id="toggle-basic" aria-expanded="false" aria-controls="details-basic">
      <span class="title">
        <span class="label">Basic Expand/Collapse</span>
        <span class="hint">Click or press Space/Enter to toggle</span>
      </span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-basic" class="details" role="region" aria-labelledby="toggle-basic" aria-hidden="true">
      <div class="content">
        <p>This is a basic example of an expand/collapse widget. The button controls the visibility of this content. State is exposed via aria-expanded on the button and aria-hidden on this region.</p>
        <ul class="list">
          <li>Accessible: uses aria-expanded and aria-controls.</li>
          <li>Keyboard: Space/Enter toggles the panel.</li>
          <li>Animated: smooth height transition handled by JavaScript.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Example 2: Animated with dynamic height -->
  <div class="example" data-example="animated">
    <button class="toggle" id="toggle-animated" aria-expanded="false" aria-controls="details-animated">
      <span class="title">
        <span class="label">Animated Panel (dynamic height)</span>
        <span class="hint">Animation measures content height for smooth transitions</span>
      </span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-animated" class="details" role="region" aria-labelledby="toggle-animated" aria-hidden="true">
      <div class="content">
        <p>When opened, the script measures the natural height of this block and animates max-height so the transition is smooth regardless of content size.</p>
        <p class="muted">Try adding more text here or resizing your window; the animation adapts.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: Nested widget -->
  <div class="example" data-example="nested">
    <button class="toggle" id="toggle-parent" aria-expanded="false" aria-controls="details-parent">
      <span class="title">
        <span class="label">Parent Panel (contains nested)</span>
        <span class="hint">Nested expanders are supported</span>
      </span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-parent" class="details" role="region" aria-labelledby="toggle-parent" aria-hidden="true">
      <div class="content">
        <p>This parent panel contains another expand/collapse widget inside.</p>

        <div class="nested-indicator">Nested widget:</div>

        <div class="example" style="box-shadow:none;padding:8px;margin:0;background:transparent;" data-example="nested-child">
          <button class="toggle" id="toggle-child" aria-expanded="false" aria-controls="details-child">
            <span class="title">
              <span class="label">Child Panel</span>
              <span class="hint">Independent control</span>
            </span>
            <span class="chev" aria-hidden="true">▾</span>
          </button>

          <div id="details-child" class="details inner" role="region" aria-labelledby="toggle-child" aria-hidden="true">
            <div class="content">
              <p>The child panel opens and closes independently from the parent.</p>
              <ul class="list">
                <li>Works with keyboard and screen readers.</li>
                <li>IDs are unique to avoid collisions.</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Example 4: Persistent state -->
  <div class="example" data-example="persistent">
    <button class="toggle" id="toggle-persist" aria-expanded="false" aria-controls="details-persist">
      <span class="title">
        <span class="label">Persistent Panel</span>
        <span class="hint">State is saved to localStorage (key displayed)</span>
      </span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-persist" class="details" role="region" aria-labelledby="toggle-persist" aria-hidden="true">
      <div class="content">
        <p>This example remembers whether you last left the panel open or closed. The key used is <span class="key">expand.persist.details-persist</span>.</p>
        <p class="muted">Open the panel, reload the page, and it will restore its state.</p>
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  // Utility: get all toggle buttons inside .example wrappers
  const examples = Array.from(document.querySelectorAll('.example'));

  // Helper to toggle a widget
  function setOpen(exampleEl, isOpen, { animate = true } = {}) {
    const button = exampleEl.querySelector('.toggle');
    const details = exampleEl.querySelector('.details');
    if (!button || !details) return;
    const id = details.id || ('details-' + Math.random().toString(36).slice(2));
    details.id = id;
    button.setAttribute('aria-controls', id);

    // aria-expanded on button and aria-hidden on region
    button.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    details.setAttribute('aria-hidden', isOpen ? 'false' : 'true');

    if (isOpen) {
      exampleEl.classList.add('open');
      // animate: set max-height to scrollHeight to show
      if (animate) {
        // allow content to size naturally first
        details.style.display = ''; // in case removed
        const startHeight = details.scrollHeight;
        details.style.maxHeight = '0px';
        // Force a repaint to ensure transition
        details.getBoundingClientRect();
        details.style.transition = details.style.transition || '';
        details.style.maxHeight = startHeight + 'px';
        // After transition, remove max-height to allow natural growth
        const clean = () => {
          details.style.maxHeight = 'none';
          details.removeEventListener('transitionend', clean);
        };
        details.addEventListener('transitionend', clean);
      } else {
        details.style.maxHeight = 'none';
        details.style.opacity = '1';
      }
    } else {
      // closing: set max-height from current height then to 0
      const currentHeight = details.scrollHeight;
      details.style.maxHeight = currentHeight + 'px';
      // Force repaint
      details.getBoundingClientRect();
      details.style.maxHeight = '0px';
      // After transition, keep max-height 0
      const cleanClose = () => {
        details.style.maxHeight = '0px';
        details.removeEventListener('transitionend', cleanClose);
      };
      details.addEventListener('transitionend', cleanClose);
      exampleEl.classList.remove('open');
    }
  }

  // Attach listeners to all toggles
  examples.forEach(exampleEl => {
    const button = exampleEl.querySelector('.toggle');
    const details = exampleEl.querySelector('.details');

    if (!button || !details) return;

    // Ensure unique ids
    if (!button.id) button.id = 'toggle-' + Math.random().toString(36).slice(2);
    if (!details.id) details.id = 'details-' + Math.random().toString(36).slice(2);
    button.setAttribute('aria-controls', details.id);
    details.setAttribute('aria-labelledby', button.id);

    // Initial state: closed
    const persistedKey = 'expand.persist.' + details.id;
    if (localStorage.getItem(persistedKey) !== null) {
      const open = localStorage.getItem(persistedKey) === '1';
      setOpen(exampleEl, open, { animate: false });
    } else {
      // ensure attributes reflect closed
      button.setAttribute('aria-expanded', 'false');
      details.setAttribute('aria-hidden', 'true');
      details.style.maxHeight = '0px';
    }

    // Click / activation
    button.addEventListener('click', (e) => {
      const currentlyOpen = button.getAttribute('aria-expanded') === 'true';
      setOpen(exampleEl, !currentlyOpen);
      // Persist for this example if it's the "persistent" example
      if (persistedKey && exampleEl.dataset.example === 'persistent') {
        localStorage.setItem(persistedKey, (!currentlyOpen) ? '1' : '0');
      }
    });

    // Keyboard: Space/Enter toggle; Home/End and Arrow up/down could navigate between toggles
    button.addEventListener('keydown', (e) => {
      const key = e.key;
      if (key === ' ' || key === 'Spacebar' || key === 'Enter') {
        e.preventDefault();
        button.click();
      } else if (key === 'Home') {
        // focus first toggle in document
        const first = document.querySelector('.example .toggle');
        if (first) { first.focus(); e.preventDefault(); }
      } else if (key === 'End') {
        const all = Array.from(document.querySelectorAll('.example .toggle'));
        const last = all[all.length - 1];
        if (last) { last.focus(); e.preventDefault(); }
      } else if (key === 'Escape') {
        // Close this panel if open
        if (button.getAttribute('aria-expanded') === 'true') {
          button.click();
          e.preventDefault();
        }
      }
    });

    // Ensure that when content images or fonts load and change height, open panels adapt
    // Use a ResizeObserver on details content when open to update maxHeight if needed
    const ro = new ResizeObserver(entries => {
      if (button.getAttribute('aria-expanded') === 'true') {
        // if currently set to none, leave it
        if (details.style.maxHeight === 'none' || details.style.maxHeight === '') return;
        details.style.maxHeight = details.scrollHeight + 'px';
      }
    });
    // Observe the content inside details
    ro.observe(details);

  });

  // Progressive enhancement: if user navigates with fragment links to a details id, open it
  if (location.hash) {
    const targetId = location.hash.slice(1);
    const button = document.querySelector('.toggle[aria-controls="' + CSS.escape(targetId) + '"]');
    if (button) {
      button.click();
      // Focus target region for easy reading
      const region = document.getElementById(targetId);
      if (region) region.focus && region.focus();
    }
  }
})();
</script>
</body>
</html>