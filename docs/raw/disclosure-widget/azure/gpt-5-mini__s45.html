<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Example</title>
  <style>
    :root{
      --accent: #0b6efd;
      --bg: #fff;
      --muted: #6b7280;
      --border: #e6e7ea;
      --radius: 8px;
      --duration: 260ms;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f6f7fb;
      color: #111827;
      margin: 32px;
      line-height: 1.4;
    }

    h1{
      font-size: 1.25rem;
      margin-bottom: 16px;
    }

    /* Widget wrapper required by the prompt */
    .example{
      max-width: 720px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      box-shadow: 0 1px 2px rgba(16,24,40,0.03);
    }

    /* Summary button */
    .summary-button{
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: transparent;
      border: none;
      padding: 10px;
      font-size: 1rem;
      text-align: left;
      cursor: pointer;
      color: inherit;
      border-radius: 6px;
    }

    .summary-button:focus{
      outline: 3px solid rgba(11,110,253,0.18);
      outline-offset: 2px;
    }

    .summary-title{
      display:flex;
      gap: 12px;
      align-items: center;
    }

    .summary-title .icon{
      width: 36px;
      height: 36px;
      display:inline-grid;
      place-items:center;
      background: linear-gradient(180deg, rgba(11,110,253,0.08), rgba(11,110,253,0.04));
      color: var(--accent);
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .summary-meta{
      display:flex;
      flex-direction:column;
      text-align: left;
    }

    .summary-meta .label{
      font-weight: 600;
      font-size: 0.98rem;
    }

    .summary-meta .hint{
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 2px;
    }

    /* Chevron */
    .chevron{
      width: 20px;
      height: 20px;
      margin-left: 12px;
      transition: transform var(--duration) ease;
      color: var(--muted);
      flex-shrink: 0;
    }

    /* Rotate chevron when expanded */
    .summary-button[aria-expanded="true"] .chevron{
      transform: rotate(180deg);
      color: var(--accent);
    }

    /* Controlled content container required by the prompt */
    .details{
      overflow: hidden;
      height: 0; /* collapsed by default */
      transition: height var(--duration) ease;
      border-top: 1px solid var(--border);
      padding: 0 10px;
      margin-top: 10px;
      border-radius: 0 0 8px 8px;
    }

    .details-inner{
      padding: 12px 6px;
    }

    .details p{
      margin: 0 0 10px 0;
      color: #333;
    }

    .details a{
      color: var(--accent);
      text-decoration: none;
    }

    @media (prefers-reduced-motion: reduce){
      .details{
        transition: none;
      }
      .chevron{
        transition: none;
      }
    }

    /* Small helper text at top */
    .note{
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 12px;
    }

  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="note">This example demonstrates an accessible expand/collapse widget. The button controls the content container (class="details").</p>

  <div class="example">
    <button
      id="summary-1"
      class="summary-button"
      aria-expanded="false"
      aria-controls="details-1"
      aria-describedby="summary-desc-1"
    >
      <span class="summary-title">
        <span class="icon" aria-hidden="true">Q</span>
        <span class="summary-meta">
          <span class="label">What is this widget?</span>
          <span id="summary-desc-1" class="hint">Click to reveal more information</span>
        </span>
      </span>

      <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div
      id="details-1"
      class="details"
      role="region"
      aria-labelledby="summary-1"
      aria-hidden="true"
    >
      <div class="details-inner">
        <p>
          This panel contains the detailed information for the widget. It's controlled by the button above using aria-expanded and aria-controls. The container uses the class "details" as requested.
        </p>
        <p>
          The open/close transition is animated (unless the user prefers reduced motion). When expanded, the button's aria-expanded becomes "true" and the details are exposed to assistive technologies.
        </p>
        <p>
          You can put any content here â€” text, images, or links. Example link:
          <a href="https://www.w3.org/WAI/ARIA/apg/patterns/accordion/" target="_blank" rel="noopener">Accessible Accordion Guidance</a>.
        </p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Polyfill-like helper to respect prefers-reduced-motion
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function toggle(detailsEl, btnEl, toExpand){
        if (prefersReduced){
          // No animation: simply toggle height and aria attributes
          if (toExpand){
            detailsEl.style.height = 'auto';
            detailsEl.setAttribute('aria-hidden', 'false');
            btnEl.setAttribute('aria-expanded', 'true');
          } else {
            detailsEl.style.height = '0px';
            detailsEl.setAttribute('aria-hidden', 'true');
            btnEl.setAttribute('aria-expanded', 'false');
          }
          return;
        }

        // Animated toggle
        const startHeight = detailsEl.getBoundingClientRect().height;
        if (toExpand){
          // from 0 -> scrollHeight
          // Ensure height is 0 to compute properly if it was 'auto'
          detailsEl.style.height = '0px';
          // Force layout to apply the starting height
          detailsEl.offsetHeight; // eslint-disable-line no-unused-expressions
          const endHeight = detailsEl.scrollHeight;
          detailsEl.style.height = endHeight + 'px';
          detailsEl.setAttribute('aria-hidden', 'false');
          btnEl.setAttribute('aria-expanded', 'true');

          function onEnd(e){
            // Only run for the container; guard in case of nested transitions
            if (e.target !== detailsEl) return;
            detailsEl.style.height = 'auto'; // allow natural growth
            detailsEl.removeEventListener('transitionend', onEnd);
          }
          detailsEl.addEventListener('transitionend', onEnd);
        } else {
          // from current height (auto or explicit) -> 0
          // If height is 'auto' or '0', set explicit px to allow transition
          const actualHeight = detailsEl.scrollHeight;
          detailsEl.style.height = actualHeight + 'px';
          // Force layout
          detailsEl.offsetHeight; // eslint-disable-line no-unused-expressions
          // then set to 0
          detailsEl.style.height = '0px';
          detailsEl.setAttribute('aria-hidden', 'true');
          btnEl.setAttribute('aria-expanded', 'false');

          function onEnd(e){
            if (e.target !== detailsEl) return;
            // keep height at 0px
            detailsEl.removeEventListener('transitionend', onEnd);
          }
          detailsEl.addEventListener('transitionend', onEnd);
        }
      }

      // Wire the single widget on the page
      const btn = document.getElementById('summary-1');
      const details = document.getElementById('details-1');

      // Ensure initial ARIA states are consistent (collapsed by default)
      btn.setAttribute('aria-expanded', 'false');
      details.setAttribute('aria-hidden', 'true');
      details.style.height = '0px';

      btn.addEventListener('click', function(){
        const isExpanded = btn.getAttribute('aria-expanded') === 'true';
        toggle(details, btn, !isExpanded);
      });

      // Optional: allow programmatic collapse if focus moves away and user presses Escape
      btn.addEventListener('keydown', function(e){
        if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true'){
          toggle(details, btn, false);
          btn.focus();
        }
      });

      // Also handle Escape inside details region to collapse
      details.addEventListener('keydown', function(e){
        if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true'){
          toggle(details, btn, false);
          btn.focus();
        }
      });
    })();
  </script>
</body>
</html>