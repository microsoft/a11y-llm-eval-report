<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      color: #111;
      background: #f7f8fb;
    }

    h1 {
      margin-bottom: 16px;
      font-size: 20px;
    }

    .example {
      background: white;
      border: 1px solid #e3e6ea;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 0 rgba(16,24,40,0.02);
    }

    .summary {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle {
      appearance: none;
      -webkit-appearance: none;
      border: none;
      background: transparent;
      padding: 8px 12px;
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: #0b5fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 6px;
    }

    .toggle:focus {
      outline: 3px solid rgba(11,95,255,0.15);
      outline-offset: 3px;
    }

    .chev {
      width: 14px;
      height: 14px;
      display: inline-block;
      transform-origin: center;
      transition: transform 230ms ease;
      color: #0b5fff;
    }

    .details {
      overflow: hidden;
      transition: max-height 260ms cubic-bezier(.2,.8,.2,1), opacity 200ms ease;
      max-height: 0;
      opacity: 0;
      margin-top: 12px;
      will-change: max-height, opacity;
      border-top: 1px dashed #eef2f6;
      padding-top: 12px;
    }

    .details.open {
      opacity: 1;
    }

    .toggle[aria-expanded="true"] .chev {
      transform: rotate(90deg);
    }

    /* Content styling */
    .details p {
      margin: 0 0 12px 0;
      line-height: 1.45;
      color: #263238;
    }

    .details ul {
      margin: 0 0 12px 20px;
      color: #34444f;
    }

    /* Small demo of multiple paragraphs to show height change */
    .details .note {
      font-size: 13px;
      color: #556;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <!-- Example 1: Simple expand/collapse -->
  <div class="example">
    <div class="summary">
      <button id="expander-1" class="toggle" aria-expanded="false" aria-controls="details-1">
        <span class="chev" aria-hidden="true">▸</span>
        More information
      </button>
    </div>

    <div id="details-1" class="details" role="region" aria-labelledby="expander-1" hidden aria-hidden="true">
      <p>This is a simple expandable region. It is hidden by default and becomes visible when the button above is pressed.</p>
      <p class="note">The button uses aria-expanded and aria-controls; the region has role="region" and aria-labelledby for screen readers.</p>
    </div>
  </div>

  <!-- Example 2: Expanded by default with multiple items -->
  <div class="example">
    <div class="summary">
      <button id="expander-2" class="toggle" aria-expanded="true" aria-controls="details-2">
        <span class="chev" aria-hidden="true">▸</span>
        Details (expanded)
      </button>
    </div>

    <div id="details-2" class="details open" role="region" aria-labelledby="expander-2" aria-hidden="false">
      <p>Here are a few items that are visible when this region is expanded:</p>
      <ul>
        <li>Item A - explanation and notes.</li>
        <li>Item B - additional details.</li>
        <li>Item C - more content to show height change.</li>
      </ul>
      <p class="note">This example starts open. You can collapse it by clicking the button again.</p>
    </div>
  </div>

  <script>
    (function () {
      // Initialize widgets: find buttons that control a details region
      var buttons = document.querySelectorAll('button[aria-controls]');

      buttons.forEach(function (btn) {
        var detailsId = btn.getAttribute('aria-controls');
        var details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure accessible attributes exist
        btn.setAttribute('aria-expanded', btn.getAttribute('aria-expanded') === 'true' ? 'true' : 'false');
        details.setAttribute('role', details.getAttribute('role') || 'region');
        details.setAttribute('aria-labelledby', details.getAttribute('aria-labelledby') || btn.id);

        // If the details starts with .open or aria-hidden=false, ensure it's visible
        if (btn.getAttribute('aria-expanded') === 'true') {
          details.classList.add('open');
          details.hidden = false;
          details.style.maxHeight = details.scrollHeight + 'px';
          details.setAttribute('aria-hidden', 'false');
        } else {
          details.classList.remove('open');
          details.hidden = true;
          details.style.maxHeight = '';
          details.setAttribute('aria-hidden', 'true');
        }

        // Transition end handler to clean up inline max-height
        details.addEventListener('transitionend', function (ev) {
          if (ev.propertyName !== 'max-height') return;
          if (details.classList.contains('open')) {
            // Remove max-height so content can grow naturally if resized
            details.style.maxHeight = '';
          } else {
            // keep hidden state handled by hidden attribute
            details.style.maxHeight = '';
          }
        });

        btn.addEventListener('click', function () {
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            // collapse
            collapse(details, btn);
          } else {
            // expand
            expand(details, btn);
          }
        });

        // Utility: expand with height animation
        function expand(el, controller) {
          el.classList.add('open');
          el.hidden = false;
          // start from current computed height (0) to scrollHeight
          el.style.maxHeight = '0px';
          // Allow the style to settle then set to scrollHeight
          requestAnimationFrame(function () {
            var h = el.scrollHeight;
            el.style.maxHeight = h + 'px';
            el.setAttribute('aria-hidden', 'false');
            controller.setAttribute('aria-expanded', 'true');
          });
        }

        function collapse(el, controller) {
          // set maxHeight to current height, then to 0
          var h = el.scrollHeight;
          el.style.maxHeight = h + 'px';
          // Force reflow to ensure transition
          el.getBoundingClientRect();
          requestAnimationFrame(function () {
            el.style.maxHeight = '0px';
            el.setAttribute('aria-hidden', 'true');
            controller.setAttribute('aria-expanded', 'false');
          });
          // After transition, hide the element to remove it from tab order
          var once = function () {
            el.hidden = true;
            el.removeEventListener('transitionend', once);
          };
          el.addEventListener('transitionend', once);
        }
      });
    })();
  </script>
</body>
</html>