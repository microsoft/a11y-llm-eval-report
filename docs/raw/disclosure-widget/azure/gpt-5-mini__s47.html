<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Demo</title>
  <style>
    :root{
      --accent:#0b67ff;
      --muted:#6b7280;
      --bg:#f8fafc;
      --surface:#ffffff;
      --radius:8px;
      --transition:250ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: linear-gradient(180deg, var(--bg), #ffffff);
      color:#0f172a;
      line-height:1.5;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
      color:#0f172a;
    }

    .example{
      background:var(--surface);
      border:1px solid rgba(15,23,42,0.06);
      box-shadow:0 6px 18px rgba(15,23,42,0.04);
      padding:14px;
      border-radius:var(--radius);
      max-width:760px;
      margin-bottom:18px;
    }

    .toggle {
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      background:transparent;
      border:1px solid rgba(15,23,42,0.06);
      padding:10px 12px;
      border-radius:8px;
      cursor:pointer;
      text-align:left;
      transition:box-shadow var(--transition), transform var(--transition);
    }

    .toggle:focus{
      outline:4px solid rgba(11,103,255,0.12);
      outline-offset:2px;
    }

    .toggle:hover{
      box-shadow:0 6px 18px rgba(11,103,255,0.06);
    }

    .toggle .title{
      display:flex;
      flex-direction:column;
      flex:1;
      gap:4px;
    }

    .toggle .label{
      font-weight:600;
      color:#081222;
      font-size:15px;
    }

    .toggle .subtitle{
      font-size:13px;
      color:var(--muted);
    }

    .toggle .chev{
      width:18px;
      height:18px;
      flex:0 0 18px;
      transition:transform var(--transition);
      color:var(--muted);
    }

    .toggle[aria-expanded="true"] .chev{
      transform:rotate(180deg);
      color:var(--accent);
    }

    /* controlled content container */
    .details{
      overflow:hidden;
      transition:max-height var(--transition), padding var(--transition);
      max-height:0;
      padding:0 12px;
      border-radius:6px;
      margin-top:10px;
    }

    /* when open we'll add open class via JS and adjust spacing */
    .details.open{
      padding:12px;
    }

    .details .content{
      background:linear-gradient(180deg, rgba(11,103,255,0.03), rgba(11,103,255,0.01));
      border-radius:6px;
      padding:12px;
      color:#0f172a;
      font-size:14px;
    }

    /* small utility */
    .muted{
      color:var(--muted);
      font-size:13px;
    }

    /* nested example styling */
    .nested .toggle{
      background:linear-gradient(90deg, rgba(11,103,255,0.03), rgba(11,103,255,0.01));
    }

    /* responsive */
    @media (max-width:520px){
      body{margin:16px;}
      .example{padding:12px;}
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Demo</h1>

  <div class="example">
    <button id="btn-1" class="toggle" aria-expanded="false" aria-controls="details-1" type="button">
      <div class="title">
        <span class="label">Release notes — v2.3.0</span>
        <span class="subtitle">Click to read what changed in the latest release</span>
      </div>
      <svg class="chev" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="btn-1" aria-hidden="true">
      <div class="content">
        <p><strong>Highlights:</strong></p>
        <ul>
          <li>Improved performance for large datasets — faster rendering and reduced memory usage.</li>
          <li>Added accessible keyboard navigation for interactive tables.</li>
          <li>Fixed a bug causing sign-in failures on certain devices.</li>
        </ul>
        <p class="muted">Published: 2025-11-11</p>
      </div>
    </div>
  </div>

  <div class="example nested">
    <button id="btn-2" class="toggle" aria-expanded="false" aria-controls="details-2" type="button">
      <div class="title">
        <span class="label">FAQ — Payment & Billing</span>
        <span class="subtitle">Common questions about invoices, subscriptions and refunds</span>
      </div>
      <svg class="chev" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div id="details-2" class="details" role="region" aria-labelledby="btn-2" aria-hidden="true">
      <div class="content">
        <p><strong>How do I update my billing details?</strong></p>
        <p>Visit the Billing page in your account settings to update card details or billing addresses. Changes take effect immediately for future invoices.</p>

        <details style="margin-top:12px;">
          <summary style="cursor:pointer; font-weight:600;">Can I get a refund?</summary>
          <div style="margin-top:8px;">
            <p>Refunds are handled on a case-by-case basis. Contact support with your invoice number and a brief explanation.</p>
          </div>
        </details>

        <p class="muted" style="margin-top:10px;">If you have account-specific questions, reach out to support.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Initialize toggles
      const toggles = document.querySelectorAll('.toggle');

      toggles.forEach(btn => {
        const controlsId = btn.getAttribute('aria-controls');
        const details = document.getElementById(controlsId);
        if(!details) return;

        // Ensure initial state matches attributes
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          // remove max-height to let CSS handle it after a tick
          details.style.maxHeight = details.scrollHeight + 'px';
          // remove inline height after transition to allow flexible content
          details.addEventListener('transitionend', function removeMax(e){
            if(details.classList.contains('open')){
              details.style.maxHeight = '';
            }
            details.removeEventListener('transitionend', removeMax);
          });
        } else {
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          details.style.maxHeight = '0px';
        }

        btn.addEventListener('click', () => {
          const isExpanded = btn.getAttribute('aria-expanded') === 'true';

          if(isExpanded){
            // collapse
            btn.setAttribute('aria-expanded', 'false');
            details.setAttribute('aria-hidden','true');

            // start from current height to animate smoothly
            details.style.maxHeight = details.scrollHeight + 'px';
            // allow the browser to render the starting height
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                details.style.maxHeight = '0px';
                details.classList.remove('open');
              });
            });

          } else {
            // expand
            btn.setAttribute('aria-expanded', 'true');
            details.setAttribute('aria-hidden','false');
            details.classList.add('open');

            // set max-height to scrollHeight to animate
            details.style.maxHeight = details.scrollHeight + 'px';

            // when transition ends, remove fixed max-height so content can grow/shrink naturally
            const onTransitionEnd = function(e){
              if(e.propertyName === 'max-height'){
                details.style.maxHeight = '';
                details.removeEventListener('transitionend', onTransitionEnd);
              }
            };
            details.addEventListener('transitionend', onTransitionEnd);
          }
        });

        // Close when Escape is pressed and focus is inside the details region
        details.addEventListener('keydown', function(e){
          if(e.key === 'Escape' || e.key === 'Esc'){
            if(btn.getAttribute('aria-expanded') === 'true'){
              btn.click();
              btn.focus();
            }
          }
        });
      });

      // Optional: close open panels when clicking outside (non-destructive)
      document.addEventListener('click', function(e){
        // if click is inside any .example, do nothing
        const insideExample = e.target.closest('.example');
        if(insideExample) return;

        // otherwise close any open details
        document.querySelectorAll('.toggle[aria-expanded="true"]').forEach(openBtn => {
          openBtn.click();
        });
      });

      // Accessibility: allow Enter/Space handling is default for buttons, but ensure role and labels are present.
    })();
  </script>
</body>
</html>