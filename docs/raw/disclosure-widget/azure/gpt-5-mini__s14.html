<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Demo</title>
  <style>
    :root{
      --accent:#0b66ff;
      --muted:#666;
      --radius:8px;
      --bg:#f8fafc;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      color:#111;
      background: linear-gradient(180deg,#ffffff, #fbfdff);
      line-height:1.45;
    }

    h1{
      margin:0 0 18px 0;
      font-size:1.4rem;
    }
    p.lead{
      margin:0 0 20px 0;
      color:var(--muted);
    }

    /* Example wrapper */
    .example{
      border:1px solid #e6eefc;
      background: linear-gradient(180deg, #fff, var(--bg));
      padding:14px;
      margin:14px 0;
      border-radius:12px;
      box-shadow: 0 2px 6px rgba(12, 40, 80, 0.03);
    }

    /* Toggle button */
    .toggle{
      appearance:none;
      -webkit-appearance:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
      border:0;
      background:transparent;
      width:100%;
      text-align:left;
      padding:10px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      font-size:1rem;
      color:var(--accent);
    }
    .toggle:focus{
      outline:3px solid rgba(11,102,255,0.12);
      outline-offset:2px;
    }
    .toggle .icon{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:28px;
      height:28px;
      border-radius:6px;
      background:rgba(11,102,255,0.08);
      color:var(--accent);
      flex:0 0 28px;
    }
    .meta{
      margin-left:auto;
      color:var(--muted);
      font-weight:500;
      font-size:0.9rem;
    }

    /* Controlled content container (must have class "details") */
    .details{
      overflow:hidden;
      max-height:0;
      transition: max-height 320ms cubic-bezier(.2,.9,.2,1), padding 220ms;
      padding:0 12px;
      margin-top:6px;
      border-radius:8px;
    }
    .details > *{
      margin:12px 0;
    }
    /* Styling when open */
    .details.open{
      /* when open, max-height is set inline for animation; this class toggles spacing/visuals */
      padding:12px;
      background:linear-gradient(180deg, rgba(11,102,255,0.03), rgba(11,102,255,0.01));
      border-radius:8px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5);
    }

    /* Small content styling */
    .details .small{
      font-size:0.95rem;
      color:#222;
    }
    .details .muted{
      color:var(--muted);
      font-size:0.92rem;
    }

    /* A simple chevron rotate via attribute */
    .toggle[aria-expanded="true"] .chev{
      transform: rotate(180deg);
    }
    .chev{
      transition: transform 220ms;
      display:inline-block;
    }

    /* For demo variation */
    .example.note{
      border-color: #f0e6ff;
      background: linear-gradient(180deg,#fff,#fbf7ff);
    }

    /* Responsive */
    @media (max-width:520px){
      .toggle{ font-size:0.95rem; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Demo</h1>
  <p class="lead">Examples of an accessible expand/collapse widget. Each widget is wrapped in a div.example and the content container uses the class details.</p>

  <!-- Example 1: Simple short content -->
  <div class="example">
    <button class="toggle" aria-expanded="false" aria-controls="details-1" type="button">
      <span class="icon" aria-hidden="true">+</span>
      Quick summary
      <span class="meta">1 line</span>
      <span class="chev" aria-hidden="true" style="margin-left:8px;">▾</span>
    </button>

    <div id="details-1" class="details" role="region" aria-hidden="true">
      <div class="small">
        This is a short explanation that expands when you activate the control above. It stays visible until you collapse it.
      </div>
    </div>
  </div>

  <!-- Example 2: Longer content, starts closed -->
  <div class="example note">
    <button class="toggle" aria-expanded="false" aria-controls="details-2" type="button">
      <span class="icon" aria-hidden="true">i</span>
      More information
      <span class="meta">Details</span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-2" class="details" role="region" aria-hidden="true">
      <div>
        <p class="muted">This panel contains more detailed information. Use it to surface additional paragraphs, lists, or other content that people may want to read without overwhelming the surrounding UI.</p>
        <ul>
          <li>Point one with a short explanation.</li>
          <li>Point two which may include slightly more text to show wrapping behavior.</li>
          <li>Point three — demonstrates that lists work inside the details container.</li>
        </ul>
        <p class="muted">Keyboard: Focus the button and press Enter or Space to toggle. The button also exposes aria-expanded and aria-controls for assistive technologies.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: Initially open -->
  <div class="example">
    <button class="toggle" aria-expanded="true" aria-controls="details-3" type="button">
      <span class="icon" aria-hidden="true">▣</span>
      Open by default
      <span class="meta">Shown</span>
      <span class="chev" aria-hidden="true">▾</span>
    </button>

    <div id="details-3" class="details open" role="region" aria-hidden="false" data-open="true">
      <div>
        <p class="small">This example is rendered open by default. It demonstrates the initial-open state. The script will respect data-open="true" on the details container to initialize it as open.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Initialize all examples
      var examples = document.querySelectorAll('.example');
      examples.forEach(function(example, idx){
        var btn = example.querySelector('.toggle');
        var details = example.querySelector('.details');
        if(!btn || !details) return;

        // Ensure the details has an id for aria-controls
        if(!details.id){
          details.id = 'details-' + (idx + 1) + '-' + Math.random().toString(36).slice(2,7);
        }
        btn.setAttribute('aria-controls', details.id);

        // Track state
        var isOpen = details.classList.contains('open') || details.getAttribute('data-open') === 'true';

        // Apply initial visual state
        if(isOpen){
          details.classList.add('open');
          details.style.maxHeight = details.scrollHeight + 'px';
          details.setAttribute('aria-hidden','false');
          btn.setAttribute('aria-expanded','true');
        } else {
          details.classList.remove('open');
          details.style.maxHeight = '0px';
          details.setAttribute('aria-hidden','true');
          btn.setAttribute('aria-expanded','false');
        }

        // Clean up inline max-height after open transition ends to allow natural height growth
        details.addEventListener('transitionend', function(e){
          if(e.propertyName !== 'max-height') return;
          if(details.classList.contains('open')){
            // remove explicit max-height so content can grow/shrink naturally
            details.style.maxHeight = 'none';
          }
        });

        // Toggle function with smooth height animation
        function open(animate){
          animate = (animate !== false);
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          btn.setAttribute('aria-expanded','true');
          // If animate: set max-height to scrollHeight, then clear it after transition.
          if(animate){
            // Ensure we start from a pixel value (not 'none')
            details.style.maxHeight = '0px';
            // Force a reflow to make the animation work from 0 -> scrollHeight
            void details.offsetWidth;
            details.style.maxHeight = details.scrollHeight + 'px';
          } else {
            details.style.maxHeight = 'none';
          }
        }

        function close(animate){
          animate = (animate !== false);
          // If currently maxHeight is 'none' (after being opened), set it to the scrollHeight first
          var currentMax = window.getComputedStyle(details).maxHeight;
          if(currentMax === 'none'){
            details.style.maxHeight = details.scrollHeight + 'px';
            // Force reflow to ensure the starting height is applied
            void details.offsetWidth;
          }
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          btn.setAttribute('aria-expanded','false');
          if(animate){
            // animate to 0
            details.style.maxHeight = '0px';
          } else {
            details.style.maxHeight = '0px';
          }
        }

        function toggle(){
          isOpen = !isOpen;
          if(isOpen) open();
          else close();
        }

        // Attach click handler
        btn.addEventListener('click', function(e){
          e.preventDefault();
          toggle();
        });

        // Allow keyboard activation for Enter/Space (buttons already handle this, but keep robust)
        btn.addEventListener('keydown', function(e){
          if(e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter'){
            e.preventDefault();
            toggle();
          }
        });

        // If window resizes and details is open with maxHeight none, nothing to do.
        // But if open and maxHeight is 'none' -> nothing. If open and maxHeight set, reset to none after transitionend covers it.
        // For a case where window resizes while open and maxHeight was 'none', nothing needed. If it's set to a pixel value, update it.
        window.addEventListener('resize', function(){
          if(details.classList.contains('open')){
            // If maxHeight is 'none', nothing to adjust.
            if(details.style.maxHeight && details.style.maxHeight !== 'none'){
              // Update to the new scrollHeight to keep content fully visible
              details.style.maxHeight = details.scrollHeight + 'px';
              // After a tick, remove max-height to allow automatic height
              setTimeout(function(){
                details.style.maxHeight = 'none';
              }, 350);
            }
          }
        });
      });
    })();
  </script>
</body>
</html>