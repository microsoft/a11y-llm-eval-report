<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --brand:#0066cc;
      --muted:#666;
      --bg:#f8f9fb;
      --card:#fff;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg,var(--bg),white);
      color:#111;
      line-height:1.4;
    }

    h1{ font-size:1.2rem; margin-bottom:0.5rem; }
    p.lead{ color:var(--muted); margin-top:0; margin-bottom:18px; }

    .example{
      background:var(--card);
      border:1px solid #e6e9ef;
      border-radius:8px;
      padding:16px;
      margin-bottom:16px;
      box-shadow:0 1px 2px rgba(20,30,40,0.03);
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }

    .toggle{
      background:linear-gradient(180deg,var(--brand),#004a99);
      color:white;
      border:0;
      padding:8px 12px;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 1px 0 rgba(0,0,0,0.05);
    }

    .toggle.secondary{
      background:transparent;
      color:var(--brand);
      border:1px solid #dcecff;
      box-shadow:none;
      font-weight:600;
      padding:7px 10px;
    }

    /* Controlled content base */
    .details{
      border-top: 1px dashed #eef3fb;
      padding-top:12px;
      margin-top:8px;
    }

    /* Hidden by aria-hidden=true */
    .details[aria-hidden="true"] {
      display:none;
    }

    /* Animated example: use max-height transitions */
    .animated .details{
      overflow:hidden;
      transition: max-height 280ms ease, opacity 220ms ease, transform 220ms ease;
      opacity:0;
      transform: translateY(-6px);
      max-height:0;
      padding-top:0;
      margin-top:0;
      border-top:0;
    }

    .animated .details.open{
      opacity:1;
      transform:translateY(0);
      /* max-height will be set inline to the content height by JS for smooth animation */
      padding-top:12px;
      margin-top:8px;
      border-top:1px dashed #eef3fb;
    }

    /* Small utility */
    .note{ font-size:0.9rem; color:var(--muted); margin:8px 0 0; }
    .content-box{
      background:#fbfdff;
      border:1px solid #e6f0ff;
      padding:12px;
      border-radius:6px;
    }

    /* Focus visible for keyboard users */
    .toggle:focus{
      outline:3px solid rgba(0,102,204,0.18);
      outline-offset:2px;
    }

    /* container for demo layout */
    .grid{
      display:grid;
      gap:12px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widgets</h1>
  <p class="lead">Each widget below is wrapped in a div.example. The container for the controlled content uses the class "details". Buttons use aria-expanded and aria-controls for accessibility.</p>

  <div class="grid">
    <!-- Example 1: Basic toggle -->
    <div class="example">
      <h2 style="font-size:1rem;margin:0 0 8px 0;">Basic Expand/Collapse</h2>
      <div class="controls">
        <button id="btn-basic" class="toggle" aria-expanded="false" aria-controls="det-basic">Show details</button>
      </div>

      <div id="det-basic" class="details" role="region" aria-labelledby="btn-basic" aria-hidden="true">
        <div class="content-box">
          <strong>Summary:</strong> This is a simple reveal region. The button's aria-expanded attribute toggles between true/false and the content has aria-hidden to reflect visibility for assistive technologies.
          <p class="note">Tip: Use the button to toggle the content.</p>
        </div>
      </div>
    </div>

    <!-- Example 2: Animated expand/collapse -->
    <div class="example animated">
      <h2 style="font-size:1rem;margin:0 0 8px 0;">Animated Expand/Collapse</h2>
      <div class="controls">
        <button id="btn-anim" class="toggle" aria-expanded="false" aria-controls="det-anim">Show more</button>
        <button id="btn-anim-secondary" class="toggle secondary" aria-expanded="false" aria-controls="det-anim">Toggle (secondary)</button>
      </div>

      <div id="det-anim" class="details" role="region" aria-labelledby="btn-anim" aria-hidden="true">
        <div class="content-box">
          <p><strong>Animated content:</strong> This content expands and collapses with a smooth transition of height, opacity and slight movement. The script sets aria-hidden and aria-expanded consistently for accessibility.</p>
          <ul>
            <li>Point A</li>
            <li>Point B</li>
            <li>Point C</li>
          </ul>
          <p class="note">Keyboard: focus the toggle and press Space or Enter to open/close. Press Escape while focus is inside the details to close it.</p>
        </div>
      </div>
    </div>

    <!-- Example 3: Multi-section with independent controls -->
    <div class="example">
      <h2 style="font-size:1rem;margin:0 0 8px 0;">Multiple Independent Sections</h2>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;">
        <div style="min-width:220px;">
          <button id="btn-a" class="toggle" aria-expanded="false" aria-controls="det-a">Section A</button>
          <div id="det-a" class="details" role="region" aria-labelledby="btn-a" aria-hidden="true" style="margin-top:8px;">
            <div class="content-box">Content for section A</div>
          </div>
        </div>

        <div style="min-width:220px;">
          <button id="btn-b" class="toggle" aria-expanded="false" aria-controls="det-b">Section B</button>
          <div id="det-b" class="details" role="region" aria-labelledby="btn-b" aria-hidden="true" style="margin-top:8px;">
            <div class="content-box">Content for section B</div>
          </div>
        </div>
      </div>
      <p class="note">Each section is independent and uses the same role/attributes pattern.</p>
    </div>
  </div>

  <script>
    // Generic toggle logic for buttons controlling .details regions
    (function(){
      function toggleDetails(button){
        var id = button.getAttribute('aria-controls');
        if(!id) return;
        var details = document.getElementById(id);
        if(!details) return;

        var isExpanded = button.getAttribute('aria-expanded') === 'true';
        // For animated containers, we handle max-height transitions
        var animatedParent = button.closest('.animated');

        if(isExpanded){
          // Collapse
          button.setAttribute('aria-expanded','false');
          details.setAttribute('aria-hidden','true');

          if(animatedParent){
            // Set current height then collapse to 0 to animate
            var curHeight = details.scrollHeight;
            details.style.maxHeight = curHeight + 'px';
            // Force paint
            details.getBoundingClientRect();
            details.classList.remove('open');
            // After a tick, set max-height to 0 to trigger transition
            requestAnimationFrame(function(){
              details.style.maxHeight = '0px';
            });
          }
        } else {
          // Expand
          button.setAttribute('aria-expanded','true');
          details.setAttribute('aria-hidden','false');

          if(animatedParent){
            details.classList.add('open');
            // measure and set max-height to content height for smooth expand
            var targetHeight = details.scrollHeight;
            details.style.maxHeight = targetHeight + 'px';

            // When transition ends, remove the explicit max-height (so content can grow naturally)
            var onTransitionEnd = function(e){
              if(e.propertyName === 'max-height'){
                details.style.maxHeight = '';
                details.removeEventListener('transitionend', onTransitionEnd);
              }
            };
            details.addEventListener('transitionend', onTransitionEnd);
          }
        }

        // Update visible label text if present for clarity
        if(button.id === 'btn-basic'){
          button.textContent = button.getAttribute('aria-expanded') === 'true' ? 'Hide details' : 'Show details';
        } else if(button.id === 'btn-anim'){
          button.textContent = button.getAttribute('aria-expanded') === 'true' ? 'Show less' : 'Show more';
        } else if(button.id === 'btn-anim-secondary'){
          // keep secondary label in sync with primary control for the same region
          var primary = document.getElementById('btn-anim');
          if(primary){
            button.textContent = primary.getAttribute('aria-expanded') === 'true' ? 'Hide' : 'Toggle';
            primary.textContent = primary.getAttribute('aria-expanded') === 'true' ? 'Show less' : 'Show more';
          }
        }
      }

      // Attach click handlers to all buttons that control a details region
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(function(btn){
        btn.addEventListener('click', function(){
          toggleDetails(btn);
          // If there are other buttons pointing to the same region, sync their aria-expanded
          var id = btn.getAttribute('aria-controls');
          if(id){
            var others = document.querySelectorAll('button[aria-controls="'+id+'"]');
            others.forEach(function(o){
              if(o !== btn){
                o.setAttribute('aria-expanded', btn.getAttribute('aria-expanded'));
                // update text for synced secondary buttons
                if(o.id === 'btn-anim-secondary'){
                  var primary = document.getElementById('btn-anim');
                  o.textContent = primary.getAttribute('aria-expanded') === 'true' ? 'Hide' : 'Toggle';
                }
              }
            });
          }
        });

        // Close on Escape when focus inside the details region
        var id = btn.getAttribute('aria-controls');
        if(id){
          var details = document.getElementById(id);
          if(details){
            details.addEventListener('keydown', function(e){
              if(e.key === 'Escape' || e.key === 'Esc'){
                // collapse and move focus back to controller
                btn.focus();
                if(btn.getAttribute('aria-expanded') === 'true'){
                  toggleDetails(btn);
                }
              }
            });
          }
        }
      });

      // Optional: Ensure initial aria consistency if any .details elements are visible by stylesheet
      document.querySelectorAll('.details').forEach(function(details){
        var id = details.id;
        if(!id) return;
        var controllers = document.querySelectorAll('button[aria-controls="'+id+'"]');
        controllers.forEach(function(btn){
          var expanded = btn.getAttribute('aria-expanded') === 'true';
          details.setAttribute('aria-hidden', expanded ? 'false' : 'true');
          if(btn.closest('.animated') && expanded){
            details.classList.add('open');
            details.style.maxHeight = '';
          }
        });
      });
    })();
  </script>
</body>
</html>