<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0366d6;
      --bg:#f8fafc;
      --card:#ffffff;
      --muted:#6b7280;
      --transition: 300ms cubic-bezier(.2,.8,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: linear-gradient(180deg,var(--bg),#fff);
      color:#0f172a;
      line-height:1.4;
    }

    h1{margin:0 0 16px 0;font-size:20px}
    p.lead{margin:0 0 24px 0;color:var(--muted)}

    .example{
      background:var(--card);
      border:1px solid rgba(15,23,42,0.06);
      border-radius:10px;
      padding:16px;
      max-width:700px;
      box-shadow:0 1px 2px rgba(2,6,23,0.04);
      margin: 16px 0;
    }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:transparent;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      color:var(--accent);
      font-weight:600;
      font-size:15px;
    }
    .toggle:focus{
      outline:3px solid rgba(3,102,214,0.12);
      outline-offset:3px;
    }

    .chev{
      width:18px;height:18px;
      display:inline-block;
      transform:rotate(0deg);
      transition: transform var(--transition);
      flex-shrink:0;
    }
    .toggle[aria-expanded="true"] .chev{
      transform:rotate(90deg);
    }

    /* The controlled content container requested to have class "details" */
    .details{
      overflow:hidden;
      transition: height var(--transition), opacity var(--transition);
      height:auto; /* will be managed by script */
      opacity:1;
      margin-top:12px;
      border-radius:8px;
    }

    /* When collapsed, JS will set height to 0 and aria-hidden=true; we also apply this style for noscript fallback */
    .details.collapsed{
      height:0;
      opacity:0;
      padding-top:0;
      padding-bottom:0;
    }

    .detailsInner{
      padding:12px;
      background:linear-gradient(180deg, rgba(3,102,214,0.03), rgba(3,102,214,0.01));
      border:1px dashed rgba(3,102,214,0.06);
      border-radius:8px;
      color:#022b52;
    }

    /* small demonstration controls for layout */
    .meta{font-size:13px;color:var(--muted);margin-top:8px}
    .code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; background:#f3f4f6; padding:6px 8px; border-radius:6px; display:inline-block}

    /* Respect user preference for reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .chev, .details { transition: none; }
    }

    /* Small responsive tweak */
    @media (max-width:420px){
      body{margin:16px}
      .example{padding:12px}
      .toggle{font-size:14px; padding:8px}
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Two examples of an accessible expand/collapse widget. Each widget is wrapped in a div.example. The controlled content container uses the class "details".</p>

  <!-- Example 1: closed by default -->
  <div class="example" id="ex1">
    <button
      class="toggle"
      id="toggle-1"
      aria-expanded="false"
      aria-controls="details-1"
      type="button"
    >
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M8 5v14l11-7z" fill="currentColor"></path>
      </svg>
      Show more information
    </button>

    <div id="details-1" class="details collapsed" role="region" aria-hidden="true" aria-labelledby="toggle-1">
      <div class="detailsInner">
        <p><strong>What this widget does:</strong> This section is hidden by default and is revealed when you activate the button. The button uses aria-expanded to indicate state and aria-controls to reference the content region. The content region uses role="region" and aria-labelledby to associate it with the triggering control.</p>
        <p class="meta">Keyboard: The button is focusable and activates with Enter/Space.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: open by default with more content -->
  <div class="example" id="ex2">
    <button
      class="toggle"
      id="toggle-2"
      aria-expanded="true"
      aria-controls="details-2"
      type="button"
    >
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M8 5v14l11-7z" fill="currentColor"></path>
      </svg>
      Project notes (expanded)
    </button>

    <div id="details-2" class="details" role="region" aria-hidden="false" aria-labelledby="toggle-2">
      <div class="detailsInner">
        <h3 style="margin:0 0 8px 0; font-size:15px;">Highlights</h3>
        <ul style="margin:0 0 8px 20px; padding:0">
          <li>Accessible toggle with aria-expanded and aria-controls</li>
          <li>Smooth height animation (skipped if user prefers reduced motion)</li>
          <li>Collapsible content wrapped in an element with class "details"</li>
        </ul>
        <p style="margin:0">You can include any content inside the details container: text, images, forms, or interactive controls.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Utility to set the height of the element for smooth animation
      function setHeightForOpen(el){
        // Remove explicit height to measure natural height
        el.style.height = 'auto';
        const h = el.scrollHeight;
        el.style.height = h + 'px';
      }

      function openDetails(btn, details){
        btn.setAttribute('aria-expanded','true');
        details.classList.remove('collapsed');
        details.setAttribute('aria-hidden','false');

        // animate collapse -> to natural height
        setHeightForOpen(details);

        // After transition, clear explicit height so content can grow/shrink naturally
        const cleanup = function(){
          details.style.height = 'auto';
          details.removeEventListener('transitionend', cleanup);
        };
        details.addEventListener('transitionend', cleanup);
      }

      function closeDetails(btn, details){
        // To animate from current height -> 0, set explicit height to current scrollHeight
        const current = details.scrollHeight;
        details.style.height = current + 'px';

        // Force a reflow so the height is applied before transitioning to 0
        // eslint-disable-next-line no-unused-expressions
        details.offsetHeight;

        details.classList.add('collapsed');
        details.setAttribute('aria-hidden','true');
        btn.setAttribute('aria-expanded','false');

        // After transition, keep height at 0 (class collapsed sets height 0)
      }

      // Initialize widgets: find all buttons with aria-controls inside .example wrappers
      const toggles = document.querySelectorAll('.example .toggle[aria-controls]');
      toggles.forEach(function(btn){
        const controlsId = btn.getAttribute('aria-controls');
        const details = document.getElementById(controlsId);
        if(!details) return;

        // Normalize initial state: if aria-expanded is "true", ensure details visible; otherwise collapsed
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          details.classList.remove('collapsed');
          details.setAttribute('aria-hidden','false');
          // set height to auto so it's fully visible
          details.style.height = 'auto';
        } else {
          details.classList.add('collapsed');
          details.setAttribute('aria-hidden','true');
          details.style.height = '0px';
        }

        // Click toggles
        btn.addEventListener('click', function(){
          const isExpanded = btn.getAttribute('aria-expanded') === 'true';
          if(isExpanded){
            closeDetails(btn, details);
          } else {
            openDetails(btn, details);
          }
        });

        // Optional: support Escape to close when focus is inside content
        details.addEventListener('keydown', function(e){
          if(e.key === 'Escape'){
            btn.focus();
            closeDetails(btn, details);
          }
        });
      });

      // If user has reduced motion preference, disable height transitions by ensuring auto heights are used
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      if(mq.matches){
        document.querySelectorAll('.details').forEach(function(d){
          if(d.classList.contains('collapsed')){
            d.style.display = 'none';
          } else {
            d.style.display = 'block';
          }
        });
      }
    })();
  </script>
</body>
</html>