<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --brand:#0066cc;
      --muted:#6b7280;
      --radius:8px;
      --transition:0.28s cubic-bezier(.2,.9,.3,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg,var(--bg),#fff 60%);
      color:#111827;
      line-height:1.45;
    }

    h1{
      font-size:1.25rem;
      margin:0 0 18px 0;
    }

    .grid{
      display:grid;
      gap:18px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .example{
      background:var(--card);
      border:1px solid rgba(16,24,40,0.04);
      padding:14px;
      border-radius:var(--radius);
      box-shadow: 0 6px 18px rgba(13, 20, 33, 0.04);
    }

    .widget-header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:8px;
    }

    .toggle-button{
      appearance:none;
      border:1px solid rgba(16,24,40,0.06);
      background:linear-gradient(180deg,#fff,#fbfdff);
      color:var(--brand);
      padding:8px 10px;
      font-weight:600;
      border-radius:8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:box-shadow var(--transition),transform var(--transition);
      box-shadow: 0 1px 0 rgba(16,24,40,0.02);
    }
    .toggle-button:focus{
      outline: none;
      box-shadow: 0 0 0 4px rgba(0,102,204,0.12);
    }
    .toggle-button .chev{
      display:inline-block;
      transition: transform var(--transition);
      transform-origin: center;
    }
    .toggle-button[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    /* Controlled content container - class "details" required */
    .details{
      overflow: hidden;
      max-height: 0;
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 0;
      margin-top: 6px;
      border-radius:6px;
      background: linear-gradient(180deg,#fbfdff,#fff);
      padding: 0 12px;
      border: 1px solid rgba(16,24,40,0.03);
    }
    .details.open{
      opacity: 1;
      /* large enough for typical content; we also set inline maxHeight on toggle for smoother measurement */
      max-height: 800px;
      padding: 12px;
    }

    .details p{
      margin: 0 0 10px 0;
      color: #111827;
    }
    .hint{
      color:var(--muted);
      font-size:0.875rem;
      margin-left:auto;
    }

    /* small subtle style for nested example */
    .nested .details{
      background: #f9fafb;
      border-left: 3px solid rgba(0,102,204,0.06);
    }

    /* No-JS: show details content when JavaScript is disabled */
    noscript .details{
      max-height: none;
      opacity:1;
      padding:12px;
    }

    /* Utility */
    .small{
      font-size:0.9rem;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse widget examples</h1>

  <div class="grid">

    <!-- Example 1: Basic -->
    <div class="example">
      <div class="widget-header">
        <button class="toggle-button" id="btn-1" aria-expanded="false" aria-controls="details-1">
          <span class="chev" aria-hidden="true">▶</span>
          Toggle details
        </button>
        <div class="hint small">Basic</div>
      </div>

      <div id="details-1" class="details" role="region" aria-labelledby="btn-1" aria-hidden="true">
        <p><strong>Summary:</strong> This is a straightforward expandable area controlled by the button above. It uses ARIA attributes (aria-expanded on the button and aria-hidden on the region) and a visible chevron that rotates when expanded.</p>
        <p>Use keyboard (Tab to focus, Space/Enter to toggle) or click to open and close the content.</p>
      </div>
    </div>

    <!-- Example 2: Nested content -->
    <div class="example nested">
      <div class="widget-header">
        <button class="toggle-button" id="btn-2" aria-expanded="false" aria-controls="details-2">
          <span class="chev" aria-hidden="true">▶</span>
          More info
        </button>
        <div class="hint small">Nested</div>
      </div>

      <div id="details-2" class="details" role="region" aria-labelledby="btn-2" aria-hidden="true">
        <p>Here is some additional information. The content can include lists, forms, or even another toggle inside.</p>

        <div style="margin-top:8px; padding:10px; background:#fff; border-radius:6px; border:1px solid rgba(16,24,40,0.03);">
          <div style="display:flex; gap:10px; align-items:center;">
            <button class="toggle-button" id="btn-2a" aria-expanded="false" aria-controls="details-2a" style="padding:6px 8px; font-size:0.9rem;">
              <span class="chev" aria-hidden="true">▶</span>
              View sub-section
            </button>
            <div class="small" style="color:var(--muted)">Nested toggle</div>
          </div>

          <div id="details-2a" class="details" role="region" aria-labelledby="btn-2a" aria-hidden="true" style="margin-top:8px;">
            <p class="small" style="margin:0">This is a nested details area. Accessible patterns still apply: the inner button controls the inner region independently.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 3: Long content with animation -->
    <div class="example">
      <div class="widget-header">
        <button class="toggle-button" id="btn-3" aria-expanded="false" aria-controls="details-3">
          <span class="chev" aria-hidden="true">▶</span>
          Read more
        </button>
        <div class="hint small">Animated</div>
      </div>

      <div id="details-3" class="details" role="region" aria-labelledby="btn-3" aria-hidden="true">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam.</p>
        <p>Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris.</p>
        <p>Fusce nec tellus sed augue semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla.</p>
      </div>
    </div>

  </div>

  <script>
    (function(){
      // Utility to set max-height dynamically for smooth animation if content height is known
      function setMaxHeight(el, open){
        if(open){
          // Temporarily remove max-height to measure content height
          el.style.maxHeight = 'none';
          var h = el.scrollHeight;
          el.style.maxHeight = '0px';
          // Force reflow to apply
          void el.offsetHeight;
          el.style.maxHeight = h + 'px';
        } else {
          el.style.maxHeight = el.scrollHeight + 'px';
          // Force reflow then collapse
          void el.offsetHeight;
          el.style.maxHeight = '0px';
        }
      }

      function toggle(button, content){
        var expanded = button.getAttribute('aria-expanded') === 'true';
        var willOpen = !expanded;

        button.setAttribute('aria-expanded', String(willOpen));
        content.setAttribute('aria-hidden', String(!willOpen));

        if(willOpen){
          content.classList.add('open');
          // For animation: set measured max-height
          setMaxHeight(content, true);
          // Remove hard-coded max-height after transition to allow natural growth
          content.addEventListener('transitionend', function cleanup(){
            if(content.classList.contains('open')){
              content.style.maxHeight = 'none';
            }
            content.removeEventListener('transitionend', cleanup);
          });
        } else {
          // ensure max-height is set to current height then animate to 0
          setMaxHeight(content, false);
          content.classList.remove('open');
          // After collapse transition, clear inline maxHeight
          content.addEventListener('transitionend', function cleanup(){
            if(!content.classList.contains('open')){
              content.style.maxHeight = '';
            }
            content.removeEventListener('transitionend', cleanup);
          });
        }
      }

      // Attach to all toggle-button elements
      var buttons = Array.from(document.querySelectorAll('.toggle-button'));
      buttons.forEach(function(btn){
        var controls = btn.getAttribute('aria-controls');
        if(!controls) return;
        var content = document.getElementById(controls);
        if(!content) return;

        // Ensure initial attributes are present
        if(!btn.hasAttribute('aria-expanded')) btn.setAttribute('aria-expanded','false');
        if(!content.hasAttribute('aria-hidden')) content.setAttribute('aria-hidden','true');

        // Click toggles
        btn.addEventListener('click', function(e){
          toggle(btn, content);
        });

        // Enhance keyboard: Enter/Space are handled by button by default.
        // Provide Home/End behavior for multiple toggles inside a region (optional)
      });

      // If JS is enabled, ensure <noscript> fallback not needed. (No action required.)
    })();
  </script>
  <noscript>
    <style>
      .details{ max-height:none !important; opacity:1 !important; padding:12px !important; }
    </style>
  </noscript>
</body>
</html>