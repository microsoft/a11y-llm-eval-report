<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Demo</title>
  <style>
    :root{
      --bg:#f7f8fb;
      --card:#fff;
      --accent:#2563eb;
      --muted:#6b7280;
      --border:#e6e9ef;
      --radius:8px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 24px;
      background: linear-gradient(180deg, #fbfdff, var(--bg));
      color:#111827;
      line-height:1.4;
    }

    header h1{
      margin:0 0 10px 0;
      font-size:20px;
    }
    p.lead{ margin:0 0 20px 0; color:var(--muted); }

    .example{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
      margin: 16px 0;
      box-shadow:0 1px 2px rgba(16,24,40,0.03);
    }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      background:transparent;
      border:1px solid transparent;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      color:var(--accent);
      transition: background .12s, transform .08s;
    }
    .toggle:focus{
      outline:3px solid rgba(37,99,235,0.12);
      outline-offset:2px;
    }
    .toggle:hover{ background:rgba(37,99,235,0.04); }

    .chev{
      display:inline-block;
      width:14px;height:14px;
      transform-origin:center;
      transition:transform .18s ease;
      color:var(--accent);
    }
    .toggle[aria-expanded="true"] .chev { transform: rotate(180deg); }

    /* Controlled content container (required: class="details") */
    .details{
      overflow:hidden;
      transition: max-height .28s cubic-bezier(.2,.9,.3,1), opacity .18s ease;
      max-height:0;
      opacity:0;
      margin-top:12px;
      border-radius:6px;
      background:linear-gradient(180deg, rgba(37,99,235,0.02), rgba(37,99,235,0.01));
      padding:0 12px;
      box-sizing:border-box;
    }
    .details.open{ opacity:1; padding:12px; }

    .details .inner{
      padding:0;
      margin:0;
    }

    /* small styles for example content */
    .meta{ color:var(--muted); font-size:13px; margin-bottom:8px; }
    ul{ margin:8px 0 0 20px; }
    .hint{ font-size:13px; color:var(--muted); margin-top:8px; }

    /* Responsive */
    @media (max-width:480px){
      .toggle{ width:100%; justify-content:space-between; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Expand / Collapse Widget â€” Demo</h1>
    <p class="lead">Each widget is wrapped with a .example container. The controlled content container uses the class "details".</p>
  </header>

  <!-- Example 1 -->
  <div class="example">
    <button id="toggle-1"
            class="toggle"
            aria-expanded="false"
            aria-controls="details-1"
            data-open-text="Hide details"
            data-closed-text="Show details">
      <span class="label">Show details</span>
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
      </svg>
    </button>

    <div id="details-1" class="details" hidden aria-hidden="true" role="region" aria-labelledby="toggle-1">
      <div class="inner">
        <div class="meta">Quick summary</div>
        <p>This is a short description that is revealed when the widget is expanded. It demonstrates a basic accessible expand/collapse pattern using aria-controls and aria-expanded on the button.</p>
        <div class="hint">Tip: Use the button (or press Enter/Space) to toggle.</div>
      </div>
    </div>
  </div>

  <!-- Example 2 -->
  <div class="example">
    <button id="toggle-2"
            class="toggle"
            aria-expanded="false"
            aria-controls="details-2"
            data-open-text="Hide features"
            data-closed-text="Show features">
      <span class="label">Show features</span>
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
      </svg>
    </button>

    <div id="details-2" class="details" hidden aria-hidden="true" role="region" aria-labelledby="toggle-2">
      <div class="inner">
        <div class="meta">Feature list</div>
        <ul>
          <li>Accessible control with aria-expanded and aria-controls</li>
          <li>Smooth height animation using max-height + JS to measure content</li>
          <li>Keyboard friendly: buttons activate on Enter / Space</li>
          <li>Graceful fallback: if JavaScript is disabled the section stays collapsed</li>
        </ul>
        <p class="hint">This widget calculates the content height on open to animate smoothly even for dynamic content.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Helper to toggle a single widget
      function toggle(details, button){
        var expanded = button.getAttribute('aria-expanded') === 'true';
        if(expanded){
          // close
          // set explicit current height so we can transition to 0
          details.style.maxHeight = details.scrollHeight + 'px';
          // allow the style to be applied before collapsing
          requestAnimationFrame(function(){
            details.style.maxHeight = '0px';
          });
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          button.setAttribute('aria-expanded','false');
          setButtonText(button, false);
          // remove explicit maxHeight after transition to keep layout flexible
          details.addEventListener('transitionend', function handler(e){
            if(e.propertyName === 'max-height'){
              details.style.maxHeight = '';
              details.removeEventListener('transitionend', handler);
            }
          });
        } else {
          // open
          details.classList.add('open');
          details.setAttribute('aria-hidden','false');
          button.setAttribute('aria-expanded','true');
          setButtonText(button, true);
          // set to content height to animate
          var targetHeight = details.scrollHeight + 'px';
          details.style.maxHeight = targetHeight;
          // remove maxHeight after transition so content can grow naturally
          details.addEventListener('transitionend', function handler(e){
            if(e.propertyName === 'max-height'){
              // reset to allow responsive changes
              details.style.maxHeight = '';
              details.removeEventListener('transitionend', handler);
            }
          });
        }
      }

      function setButtonText(button, open){
        var openText = button.dataset.openText || 'Hide details';
        var closedText = button.dataset.closedText || 'Show details';
        var label = button.querySelector('.label');
        if(label) label.textContent = open ? openText : closedText;
      }

      // Initialize widgets
      document.querySelectorAll('.example').forEach(function(wrapper, index){
        var button = wrapper.querySelector('.toggle');
        if(!button) return;
        var controlsId = button.getAttribute('aria-controls');
        var details = document.getElementById(controlsId);
        if(!details) return;

        // Remove the hidden attribute (used as a no-JS fallback) and ensure collapsed state
        if(details.hasAttribute('hidden')) details.removeAttribute('hidden');
        details.classList.remove('open');
        details.setAttribute('aria-hidden','true');
        button.setAttribute('aria-expanded','false');
        // ensure initial collapsed max-height
        details.style.maxHeight = '0px';

        // Click handler
        button.addEventListener('click', function(){
          toggle(details, button);
        });

        // Allow keyboard Home/End to focus and not break expansion (button handles Enter/Space)
        // Optional: allow Escape to close when open
        button.addEventListener('keydown', function(e){
          if(e.key === 'Escape'){
            var expanded = button.getAttribute('aria-expanded') === 'true';
            if(expanded){
              toggle(details, button);
              button.focus();
            }
          }
        });
      });
    })();
  </script>
</body>
</html>