<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#fff;
      --accent:#0b5fff;
      --muted:#6b7280;
      --border:#e6e9ef;
      --radius:8px;
      --gap:12px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg),#fff 60%);
      color:#0f1724;
      margin:32px;
      line-height:1.4;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }

    .example{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px;
      margin:18px 0;
      max-width:720px;
      box-shadow:0 6px 18px rgba(15,23,36,0.04);
    }

    .header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:10px;
    }

    .toggle{
      appearance:none;
      -webkit-appearance:none;
      background:transparent;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
      color:var(--accent);
      font-weight:600;
      font-size:14px;
    }

    .toggle:focus{
      outline:3px solid rgba(11,95,255,0.12);
      outline-offset:2px;
    }

    .toggle .icon{
      width:16px;
      height:16px;
      display:inline-block;
      transition:transform 220ms ease;
      transform-origin:50% 50%;
    }

    .toggle[aria-expanded="true"] .icon{
      transform:rotate(90deg);
    }

    .summary{
      color:var(--muted);
      font-size:13px;
      margin-left:auto;
    }

    .details{
      overflow:hidden;
      height:0;
      transition:height 260ms cubic-bezier(.2,.9,.2,1);
      will-change:height;
      border-top:1px dashed var(--border);
      padding:0 var(--gap);
      margin-top:12px;
      box-sizing:border-box;
      border-radius:0 0 var(--radius) var(--radius);
    }

    .details-content{
      padding:12px 0;
    }

    .details[aria-hidden="true"]{
      /* visually hidden state is handled via height/overflow */
    }

    /* When expanded and JS sets height:auto after transition we still keep spacing */
    .details.open{
      /* additional styling when open */
    }

    /* small content styles */
    p{margin:0 0 10px 0}
    ul{margin:6px 0 10px 18px}
    code{background:#f3f6fb;padding:2px 6px;border-radius:6px;font-family:monospace;font-size:13px}
    .note{font-size:13px;color:var(--muted)}

    @media (prefers-reduced-motion: reduce){
      .details{ transition:none !important; }
      .toggle .icon{ transition:none !important; }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse widget examples</h1>

  <div class="example">
    <div class="header">
      <button class="toggle" type="button" aria-expanded="false">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
        More information
      </button>
      <div class="summary">Click to reveal details</div>
    </div>

    <div class="details" role="region" aria-hidden="true">
      <div class="details-content">
        <p>This is additional content that can be shown or hidden. It demonstrates an accessible expand/collapse widget using a button that controls the container below.</p>
        <p class="note">Keyboard: focus the button and press Space or Enter to toggle. Press Escape while focus is inside the content to close.</p>
        <ul>
          <li>Accessible attributes: aria-expanded, aria-controls, aria-hidden, role="region"</li>
          <li>Smooth height animation handled by JavaScript</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="example">
    <div class="header">
      <button class="toggle" type="button" aria-expanded="true">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
        Details (open by default)
      </button>
      <div class="summary">Form preview</div>
    </div>

    <div class="details" role="region" aria-hidden="false">
      <div class="details-content">
        <form>
          <p><label>First name: <input name="first" /></label></p>
          <p><label>Last name: <input name="last" /></label></p>
          <p class="note">The form is part of the collapsible region and remains interactive while visible.</p>
        </form>
      </div>
    </div>
  </div>

  <script>
    (function(){
      let counter = 0;

      function setupExample(example){
        const button = example.querySelector('button.toggle');
        const details = example.querySelector('.details');

        if(!button || !details) return;

        // Ensure unique ids
        counter++;
        if(!details.id){
          details.id = 'details-' + counter;
        }
        if(!button.id){
          button.id = 'toggle-' + counter;
        }

        // wire accessible relationships
        button.setAttribute('aria-controls', details.id);
        details.setAttribute('aria-labelledby', button.id);

        // initialize based on aria-expanded / aria-hidden if present
        const expanded = button.getAttribute('aria-expanded') === 'true';
        if(expanded){
          openInstant(details);
        } else {
          closeInstant(details);
        }

        // click handler
        button.addEventListener('click', function(){
          const isExpanded = button.getAttribute('aria-expanded') === 'true';
          if(isExpanded){
            collapse(details, button);
          } else {
            expand(details, button);
          }
        });

        // allow Escape to close when focus is inside the details region
        details.addEventListener('keydown', function(e){
          if(e.key === 'Escape' || e.key === 'Esc'){
            collapse(details, button);
            button.focus();
          }
        });
      }

      function openInstant(details){
        details.classList.add('open');
        details.setAttribute('aria-hidden','false');
        // clear height to allow natural flow
        details.style.height = 'auto';
      }

      function closeInstant(details){
        details.classList.remove('open');
        details.setAttribute('aria-hidden','true');
        details.style.height = '0px';
      }

      function expand(details, button){
        // set states
        button.setAttribute('aria-expanded','true');
        details.classList.add('open');
        details.setAttribute('aria-hidden','false');

        // remove any fixed height to measure natural height
        details.style.display = 'block';
        const startHeight = details.getBoundingClientRect().height;
        // temporarily set height to current so transition works from current -> target
        details.style.height = startHeight + 'px';

        // measure target
        const contentHeight = measureContentHeight(details);

        // allow the browser to paint before changing height
        requestAnimationFrame(() => {
          details.style.height = contentHeight + 'px';
        });

        // when transition ends, clear the explicit height to allow natural resizing
        const onTransitionEnd = function(e){
          if(e.propertyName !== 'height') return;
          details.style.height = 'auto';
          details.removeEventListener('transitionend', onTransitionEnd);
        };
        details.addEventListener('transitionend', onTransitionEnd);
      }

      function collapse(details, button){
        button.setAttribute('aria-expanded','false');

        // from auto to fixed height so we can animate to 0
        const startHeight = details.getBoundingClientRect().height;
        details.style.height = startHeight + 'px';

        // force reflow
        details.getBoundingClientRect();

        requestAnimationFrame(() => {
          details.style.height = '0px';
        });

        const onTransitionEnd = function(e){
          if(e.propertyName !== 'height') return;
          details.classList.remove('open');
          details.setAttribute('aria-hidden','true');
          // keep height at 0
          details.style.height = '0px';
          details.removeEventListener('transitionend', onTransitionEnd);
        };
        details.addEventListener('transitionend', onTransitionEnd);
      }

      function measureContentHeight(details){
        // Create a clone or temporarily set height auto to measure content height
        const prevHeight = details.style.height;
        details.style.height = 'auto';
        const h = details.getBoundingClientRect().height;
        details.style.height = prevHeight;
        return h;
      }

      // initialize all examples
      document.querySelectorAll('.example').forEach(setupExample);

      // Ensure when the page loads, any details that should be open (aria-hidden=false) are resized appropriately
      window.addEventListener('load', function(){
        document.querySelectorAll('.details').forEach(function(details){
          if(details.getAttribute('aria-hidden') === 'false'){
            details.style.height = 'auto';
          } else {
            details.style.height = '0px';
          }
        });
      });

    })();
  </script>
</body>
</html>