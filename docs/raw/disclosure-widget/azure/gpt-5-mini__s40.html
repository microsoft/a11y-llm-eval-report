<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Expand/Collapse Widget Examples</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --gap: 12px;
      --radius: 8px;
      --bg: #f7f9fc;
      --accent: #2563eb;
      --muted: #6b7280;
      --shadow: 0 2px 8px rgba(16,24,40,0.06);
    }

    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin: 24px;
      background: #ffffff;
      color: #0f172a;
      line-height: 1.45;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
    }

    .example{
      border-radius: var(--radius);
      background: var(--bg);
      padding: 14px;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
    }

    /* Toggle button */
    .expand-toggle{
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 10px 12px;
      background: transparent;
      border: 1px solid rgba(15,23,42,0.06);
      border-radius: 8px;
      font-size: 15px;
      color: #06152a;
      cursor: pointer;
      gap: 12px;
    }
    .expand-toggle:hover{
      box-shadow: 0 1px 0 rgba(15,23,42,0.04) inset;
    }
    .expand-toggle:focus{
      outline: 3px solid rgba(37,99,235,0.15);
      outline-offset: 2px;
    }

    .chev{
      transition: transform 220ms ease;
      display: inline-block;
      width: 18px;
      height: 18px;
      fill: none;
      stroke: var(--accent);
      stroke-width: 2.2;
      transform-origin: center;
    }
    .expand-toggle[aria-expanded="true"] .chev{
      transform: rotate(90deg);
    }

    /* Controlled details area - must have .details class */
    .details{
      overflow: hidden;
      transition: max-height 260ms ease, opacity 160ms ease;
      max-height: 0;
      opacity: 0;
      margin-top: 10px;
      border-radius: 6px;
      padding: 0 10px;
      box-sizing: border-box;
      background: #fff;
      border: 1px solid rgba(15,23,42,0.04);
    }
    .details.open{
      opacity: 1;
    }

    .details .content{
      padding: 12px 8px 16px 8px;
      color: #0f172a;
      font-size: 14px;
    }

    /* Nested example visuals */
    .details .example{
      margin: 6px 0 0 0;
      padding: 8px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border: 1px solid rgba(15,23,42,0.03);
    }

    .meta{
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
    }

    /* Small utility */
    small{
      color: var(--muted);
    }
  </style>
</head>
<body>
  <h1>Expand/Collapse Widget Examples</h1>

  <!-- Example 1: Simple expand/collapse -->
  <div class="example" id="example-1">
    <button class="expand-toggle"
            aria-expanded="false"
            aria-controls="details-1"
            id="trigger-1">
      Simple details
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M8 6 L16 12 L8 18" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="trigger-1" aria-hidden="true">
      <div class="content">
        <p>This is a basic expand/collapse panel. It uses a button with aria-expanded and aria-controls for accessibility, and the controlled container has the class "details".</p>
        <p class="meta"><small>Tip: Use the Enter or Space key when the button is focused to toggle.</small></p>
      </div>
    </div>
  </div>

  <!-- Example 2: Starts open -->
  <div class="example" id="example-2">
    <button class="expand-toggle"
            aria-expanded="true"
            aria-controls="details-2"
            id="trigger-2">
      Open by default
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M8 6 L16 12 L8 18" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button>

    <div id="details-2" class="details open" role="region" aria-labelledby="trigger-2" aria-hidden="false">
      <div class="content">
        <p>This panel is opened by default. The script keeps the expanded state in sync with aria-expanded and aria-hidden so assistive technologies can understand the state.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: Nested details -->
  <div class="example" id="example-3">
    <button class="expand-toggle"
            aria-expanded="false"
            aria-controls="details-3"
            id="trigger-3">
      Parent panel (contains a nested panel)
      <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M8 6 L16 12 L8 18" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button>

    <div id="details-3" class="details" role="region" aria-labelledby="trigger-3" aria-hidden="true">
      <div class="content">
        <p>The parent panel contains another expand/collapse widget inside it.</p>

        <div class="example">
          <button class="expand-toggle"
                  aria-expanded="false"
                  aria-controls="details-3-1"
                  id="trigger-3-1">
            Nested panel
            <svg class="chev" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M8 6 L16 12 L8 18" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
          <div id="details-3-1" class="details" role="region" aria-labelledby="trigger-3-1" aria-hidden="true">
            <div class="content">
              <p>This is the nested panel. Nested toggles are supported independently.</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Initialize all toggles inside .example wrappers
    (function(){
      function collapseElement(el){
        // prepare for a smooth collapse: set current height then animate to 0
        el.style.maxHeight = el.scrollHeight + 'px';
        // force a frame so the browser registers the starting maxHeight
        requestAnimationFrame(function(){
          el.style.maxHeight = '0px';
        });
        el.classList.remove('open');
        el.setAttribute('aria-hidden','true');
      }

      function expandElement(el){
        // remove hidden attribute and animate from current 0 to scrollHeight
        el.classList.add('open');
        el.setAttribute('aria-hidden','false');
        // set to exact height to animate; after transition, clear inline maxHeight to allow natural growth
        var full = el.scrollHeight + 'px';
        el.style.maxHeight = full;

        // after transition finishes, remove max-height so content can grow naturally
        var onEnd = function(e){
          // ensure it's the max-height transition
          if(e && e.propertyName && e.propertyName !== 'max-height') return;
          el.style.maxHeight = 'none';
          el.removeEventListener('transitionend', onEnd);
        };
        el.addEventListener('transitionend', onEnd);
      }

      function toggle(evt){
        var btn = evt.currentTarget;
        var ctrl = btn.getAttribute('aria-controls');
        if(!ctrl) return;
        var panel = document.getElementById(ctrl);
        if(!panel) return;

        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          btn.setAttribute('aria-expanded','false');
          collapseElement(panel);
        } else {
          btn.setAttribute('aria-expanded','true');
          expandElement(panel);
        }
      }

      // Attach handlers
      var toggles = document.querySelectorAll('.example .expand-toggle[aria-controls]');
      toggles.forEach(function(btn){
        // Bind click
        btn.addEventListener('click', toggle);

        // Ensure initial state for controlled panel matches attributes
        var ctrl = btn.getAttribute('aria-controls');
        if(!ctrl) return;
        var panel = document.getElementById(ctrl);
        if(!panel) return;

        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          // Start opened: mark aria-hidden false and clear maxHeight to allow natural height
          panel.classList.add('open');
          panel.setAttribute('aria-hidden','false');
          panel.style.maxHeight = 'none';
        } else {
          panel.classList.remove('open');
          panel.setAttribute('aria-hidden','true');
          panel.style.maxHeight = '0px';
        }
      });

      // Optional: ensure panels collapse properly when user reduces window size (recompute max-heights)
      window.addEventListener('resize', function(){
        document.querySelectorAll('.details.open').forEach(function(panel){
          // if max-height is 'none', temporarily set to scrollHeight to keep transitions consistent later
          if(window.getComputedStyle(panel).maxHeight === 'none'){
            panel.style.maxHeight = panel.scrollHeight + 'px';
            // remove after a tick
            requestAnimationFrame(function(){
              panel.style.maxHeight = 'none';
            });
          }
        });
      });
    })();
  </script>
</body>
</html>