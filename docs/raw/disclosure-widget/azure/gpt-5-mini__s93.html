<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Demo</title>
  <style>
    :root{
      --accent:#0066cc;
      --muted:#666;
      --bg:#f7f9fc;
      --card:#ffffff;
      --radius:8px;
      --transition:300ms cubic-bezier(.2,.9,.3,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #f4f7fb 0%, #ffffff 100%);
      margin: 0;
      padding: 32px;
      color: #0b1220;
    }

    h1{
      margin: 0 0 18px 0;
      font-size: 20px;
    }
    p.lead{
      margin: 0 0 24px 0;
      color: var(--muted);
    }

    /* Example wrapper */
    .example{
      background: var(--card);
      border: 1px solid rgba(12,17,25,0.06);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 2px rgba(12,17,25,0.04);
      max-width: 760px;
    }

    /* Toggle button */
    .toggle{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(2,6,23,0.06);
      background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
      color: var(--accent);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      user-select: none;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .toggle:hover{ transform: translateY(-1px); }
    .toggle:active{ transform: translateY(0); }
    .toggle:focus{
      outline: 3px solid rgba(0,102,204,0.12);
      outline-offset: 3px;
      box-shadow: 0 3px 10px rgba(2,6,23,0.06);
    }

    .toggle .icon{
      width: 18px;
      height: 18px;
      display:inline-block;
      transition: transform var(--transition);
      transform-origin: center;
      color: var(--accent);
    }
    /* rotated when expanded */
    .toggle[aria-expanded="true"] .icon{ transform: rotate(180deg); }

    /* Controlled details container */
    .details{
      overflow: hidden;
      max-height: 0; /* collapsed by default */
      transition: max-height var(--transition), opacity var(--transition);
      opacity: 0;
      margin-top: 12px;
      border-radius: 6px;
      background: var(--bg);
      padding: 0 12px; /* padding vertical managed inside content */
    }

    /* Visual inner content */
    .details .inner{
      padding: 12px 8px;
    }

    /* When open */
    .details.open{
      opacity: 1;
    }

    /* Example content styles */
    .content-title{
      margin: 0 0 8px 0;
      font-size: 15px;
      color: #072;
    }
    .content-body{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }

    /* Small demo: an accordion-like group */
    .accordion .example{
      margin-bottom: 8px;
    }
    .small{
      font-size: 13px;
      padding: 6px 10px;
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>
  <p class="lead">Each widget is wrapped in a div.example. The controlled content container uses the class "details". Click the buttons to toggle the content.</p>

  <!-- Example 1: simple collapsed by default -->
  <div class="example" id="ex1">
    <button class="toggle" aria-expanded="false" aria-controls="details-1" id="toggle-1" type="button">
      <span class="icon" aria-hidden="true">▾</span>
      Show more details
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="toggle-1">
      <div class="inner">
        <h3 class="content-title">More information</h3>
        <p class="content-body">This is additional information that can be shown or hidden. The container has the class "details" and is controlled by the button above via aria-controls. The expand/collapse animation is handled with a smooth transition.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: expanded by default -->
  <div class="example" id="ex2">
    <button class="toggle" aria-expanded="true" aria-controls="details-2" id="toggle-2" type="button">
      <span class="icon" aria-hidden="true">▾</span>
      Hide details
    </button>

    <div id="details-2" class="details open" role="region" aria-labelledby="toggle-2">
      <div class="inner">
        <h3 class="content-title">Initially expanded</h3>
        <p class="content-body">This example starts expanded. The script initializes each details container to either the expanded or collapsed state based on the button's aria-expanded attribute. Try collapsing and expanding again to see the animation.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: small accordion set -->
  <div class="example accordion" id="ex3">
    <div style="display:flex; gap:10px; align-items:flex-start; justify-content:space-between;">
      <h3 style="margin:0;font-size:15px;">Accordion group</h3>
      <small style="color:var(--muted);">Demo of multiple widgets</small>
    </div>

    <div style="margin-top:12px;">
      <div class="example" style="margin:0 0 8px 0; box-shadow:none; border:none; padding:0;">
        <button class="toggle small" aria-expanded="false" aria-controls="details-3a" id="toggle-3a" type="button">
          <span class="icon" aria-hidden="true">▾</span>
          Topic A
        </button>
        <div id="details-3a" class="details" role="region" aria-labelledby="toggle-3a">
          <div class="inner">
            <p class="content-body">Short blurb about topic A.</p>
          </div>
        </div>
      </div>

      <div class="example" style="margin:0 0 8px 0; box-shadow:none; border:none; padding:0;">
        <button class="toggle small" aria-expanded="false" aria-controls="details-3b" id="toggle-3b" type="button">
          <span class="icon" aria-hidden="true">▾</span>
          Topic B
        </button>
        <div id="details-3b" class="details" role="region" aria-labelledby="toggle-3b">
          <div class="inner">
            <p class="content-body">Details for topic B are revealed here.</p>
          </div>
        </div>
      </div>

      <div class="example" style="margin:0; box-shadow:none; border:none; padding:0;">
        <button class="toggle small" aria-expanded="false" aria-controls="details-3c" id="toggle-3c" type="button">
          <span class="icon" aria-hidden="true">▾</span>
          Topic C
        </button>
        <div id="details-3c" class="details" role="region" aria-labelledby="toggle-3c">
          <div class="inner">
            <p class="content-body">Extra content for topic C.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Utility: animate expand/collapse using max-height measured from scrollHeight.
      function expand(details){
        // Remove any existing transitionend listener to avoid multiple triggers
        details.classList.add('open');
        // Set explicit max-height to scrollHeight to animate
        var startHeight = details.scrollHeight;
        details.style.maxHeight = startHeight + 'px';

        // After transition, clear max-height so the container can grow/shrink naturally
        function cleanup(){
          // Only clear if currently open (to avoid clearing on collapse)
          if(details.classList.contains('open')){
            details.style.maxHeight = 'none';
          }
          details.removeEventListener('transitionend', cleanup);
        }
        details.addEventListener('transitionend', cleanup);
      }

      function collapse(details){
        // If currently max-height is 'none' (no limit), set it to current pixel height first to animate
        var computed = window.getComputedStyle(details);
        if(computed.maxHeight === 'none'){
          details.style.maxHeight = details.scrollHeight + 'px';
          // Force reflow to ensure the browser registers the starting height
          details.getBoundingClientRect();
        }
        // Trigger collapse
        details.style.maxHeight = '0px';
        // Remove open class when transition finishes
        function cleanup(){
          details.classList.remove('open');
          details.removeEventListener('transitionend', cleanup);
        }
        details.addEventListener('transitionend', cleanup);
      }

      // Find all toggles with aria-controls and wire them up
      var toggles = document.querySelectorAll('button[aria-controls]');
      toggles.forEach(function(btn){
        var detailsId = btn.getAttribute('aria-controls');
        var details = document.getElementById(detailsId);
        if(!details) return;

        // Initialize state based on aria-expanded
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if(expanded){
          // Ensure class present
          details.classList.add('open');
          // Remove any max-height so content flows naturally after a tiny delay to allow CSS to set initial state
          details.style.maxHeight = 'none';
          details.style.opacity = '1';
        } else {
          details.classList.remove('open');
          details.style.maxHeight = '0px';
          details.style.opacity = '0';
        }

        // Click handler
        btn.addEventListener('click', function(){
          var isExpanded = btn.getAttribute('aria-expanded') === 'true';
          if(isExpanded){
            // collapse
            btn.setAttribute('aria-expanded','false');
            // ensure opacity transition; we toggle open class after animation
            details.style.opacity = '0';
            // collapse will remove open class after transition
            collapse(details);
            // Update visible label if any
            updateLabel(btn, false);
          } else {
            // expand
            btn.setAttribute('aria-expanded','true');
            details.style.opacity = '1';
            expand(details);
            updateLabel(btn, true);
          }
        });

        // Optional: update label text based on state
        function updateLabel(button, expanded){
          // If button has default label words "Show" or "Hide" toggle them; otherwise do nothing.
          var txt = button.textContent.trim();
          if(/show/i.test(txt) || /hide/i.test(txt)){
            if(expanded){
              // replace show with hide
              button.childNodes.forEach(function(n){
                if(n.nodeType === Node.TEXT_NODE){
                  n.nodeValue = n.nodeValue.replace(/show/i, 'Hide').replace(/Show/i, 'Hide');
                }
              });
            } else {
              button.childNodes.forEach(function(n){
                if(n.nodeType === Node.TEXT_NODE){
                  n.nodeValue = n.nodeValue.replace(/hide/i, 'Show').replace(/Hide/i, 'Show');
                }
              });
            }
          }
        }
      });

      // Accessibility: allow Enter/Space to toggle when focus is on the button (native buttons already do this).
      // Nothing extra required here.

      // Ensure that when window resizes, any open details that had max-height cleared still behave.
      // If a details is open and had max-height 'none', we don't need to update, but if an open details
      // currently has a pixel max-height (in the middle of transition), we leave it alone.
      window.addEventListener('resize', function(){
        var allDetails = document.querySelectorAll('.details.open');
        allDetails.forEach(function(details){
          // Reset explicit maxHeight if we previously had 'none' cleared.
          if(window.getComputedStyle(details).maxHeight !== 'none'){
            details.style.maxHeight = details.scrollHeight + 'px';
            // clear it after a short tick
            setTimeout(function(){
              details.style.maxHeight = 'none';
            }, 350);
          }
        });
      });
    })();
  </script>
</body>
</html>