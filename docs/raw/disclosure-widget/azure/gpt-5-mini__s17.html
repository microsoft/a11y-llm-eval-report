<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#1e88e5;
      --bg:#f7f9fc;
      --surface:#ffffff;
      --muted:#6b7280;
      --radius:8px;
      --transition:200ms cubic-bezier(.2,.9,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg),#eef4fb 60%);
      margin: 32px;
      color:#0f172a;
      line-height:1.4;
    }

    h1{
      margin:0 0 20px 0;
      font-size:20px;
    }

    .container{
      max-width:800px;
      margin:0 auto;
    }

    .example{
      background:var(--surface);
      border:1px solid rgba(15,23,42,0.06);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: 0 6px 18px rgba(16,24,40,0.04);
      margin-bottom:18px;
    }

    .example h2{
      margin:0 0 12px 0;
      font-size:15px;
      color:#0f172a;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      padding:10px 12px;
      background:linear-gradient(180deg, rgba(30,136,229,0.06), rgba(30,136,229,0.02));
      border:1px solid rgba(30,136,229,0.12);
      color:var(--accent);
      font-weight:600;
      border-radius:8px;
      cursor:pointer;
      user-select:none;
      transition:transform var(--transition), box-shadow var(--transition);
      transition-property:transform, box-shadow;
    }

    .toggle:active{ transform:translateY(1px); }
    .toggle:focus{ outline:none; box-shadow:0 4px 18px rgba(30,136,229,0.18); }

    /* caret */
    .toggle .caret{
      display:inline-block;
      width:18px;
      height:18px;
      flex:0 0 18px;
      transition:transform var(--transition);
      transform-origin:50% 48%;
      color:var(--accent);
    }

    .toggle[aria-expanded="true"] .caret{
      transform:rotate(90deg);
    }

    /* details content */
    .details{
      overflow:hidden;
      height:0;
      transition:height 260ms cubic-bezier(.2,.9,.2,1);
      margin-top:12px;
      border-left:4px solid rgba(15,23,42,0.04);
      padding:0 12px;
      border-radius:6px;
      background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
    }

    .details .content{
      padding:12px 0;
    }

    .muted{
      color:var(--muted);
      font-size:13px;
    }

    /* small visual examples inside details */
    .card{
      background:#fff;
      border:1px solid rgba(15,23,42,0.06);
      padding:12px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(16,24,40,0.04);
    }

    /* make nested toggle look slightly different */
    .nested .toggle{
      background:transparent;
      border:1px dashed rgba(15,23,42,0.04);
      color:#0f172a;
      font-weight:600;
    }

    .note{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget Demonstration</h1>

    <!-- Example 1: Basic collapsed by default -->
    <div class="example" id="example-1">
      <h2>Basic details (collapsed by default)</h2>
      <button class="toggle"
              aria-expanded="false"
              aria-controls="details-1"
              id="toggle-1">
        <span class="caret" aria-hidden>▸</span>
        <span>Show more information</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1">
        <div class="content">
          <div class="card">
            <p class="muted">This content is hidden by default and revealed when the toggle is activated. Use Enter or Space to open/close with the keyboard. The container for controlled content has the "details" class.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 2: Open by default -->
    <div class="example" id="example-2">
      <h2>Open by default</h2>
      <button class="toggle"
              aria-expanded="true"
              aria-controls="details-2"
              id="toggle-2">
        <span class="caret" aria-hidden>▸</span>
        <span>Collapse information</span>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2">
        <div class="content">
          <div class="card">
            <p>This example starts open. The script initializes the visible state from the button's aria-expanded attribute and sets heights for a smooth CSS transition.</p>
            <p class="muted">The container that is shown/hidden uses the class="details".</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Example 3: Nested details -->
    <div class="example nested" id="example-3">
      <h2>Nested expand/collapse</h2>
      <button class="toggle"
              aria-expanded="false"
              aria-controls="details-3"
              id="toggle-3">
        <span class="caret" aria-hidden>▸</span>
        <span>Show nested options</span>
      </button>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3">
        <div class="content">
          <div class="card">
            <p class="muted">You can place interactive content inside the details container — for example another expand/collapse:</p>

            <div style="margin-top:12px;">
              <button class="toggle"
                      aria-expanded="false"
                      aria-controls="details-3a"
                      id="toggle-3a">
                <span class="caret" aria-hidden>▸</span>
                <span>Advanced option</span>
              </button>

              <div id="details-3a" class="details" role="region" aria-labelledby="toggle-3a" style="margin-top:8px;">
                <div class="content">
                  <div class="card">
                    <p>Nested content lives here. Because each controlled area uses the "details" class, the script treats them uniformly.</p>
                    <p class="muted">Try opening the outer one, then the inner one.</p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <p class="note">All interactive toggles are wrapped in a div.example and each controlled content area has class="details".</p>
  </div>

  <script>
    (function(){
      // Initialize toggles
      function initToggle(button){
        var detailsId = button.getAttribute('aria-controls');
        if(!detailsId) return;
        var details = document.getElementById(detailsId);
        if(!details) return;

        // Ensure role and aria-labelledby already set in markup; set defaults if missing
        if(!details.hasAttribute('role')) details.setAttribute('role','region');
        if(!details.hasAttribute('aria-labelledby')) details.setAttribute('aria-labelledby', button.id || '');

        // Utility: set collapsed/expanded visual state
        function setInitial(){
          var expanded = button.getAttribute('aria-expanded') === 'true';
          if(expanded){
            // make content visible: set height to auto so it fits content
            details.style.height = 'auto';
          } else {
            details.style.height = '0px';
          }
        }

        // Open with smooth animation
        function open(){
          // set height to current scrollHeight then after transition set to auto
          details.style.display = 'block';
          var startHeight = details.scrollHeight;
          // Start from current computed height (could be 0 or auto)
          details.style.height = startHeight + 'px';
          button.setAttribute('aria-expanded','true');

          // When transition ends, allow auto height for dynamic content
          var transitionEnd = function(e){
            if(e.target !== details || e.propertyName !== 'height') return;
            details.style.height = 'auto';
            details.removeEventListener('transitionend', transitionEnd);
          };
          details.addEventListener('transitionend', transitionEnd);
        }

        // Close with smooth animation
        function close(){
          // from auto or known height to 0
          var currentHeight = details.scrollHeight;
          // If height is 'auto', set explicit height first to enable transition
          details.style.height = currentHeight + 'px';

          // Force a reflow to ensure the starting height is taken
          details.getBoundingClientRect();

          // then animate to 0
          details.style.height = '0px';
          button.setAttribute('aria-expanded','false');
        }

        // Toggle handler
        function toggle(){
          var isExpanded = button.getAttribute('aria-expanded') === 'true';
          if(isExpanded){
            close();
          } else {
            open();
          }
        }

        // Keyboard support: Space or Enter toggles
        button.addEventListener('keydown', function(e){
          if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){
            e.preventDefault();
            toggle();
          }
        });

        // Click/tap support
        button.addEventListener('click', function(){
          toggle();
        });

        // If images or async content resize the details while open, keep it fitting:
        var ro = new ResizeObserver(function(){
          // Only adjust if visible and height is auto (we want natural sizing),
          // or if visible and height is explicitly set to the scrollHeight.
          if(button.getAttribute('aria-expanded') === 'true'){
            // If currently using auto height, nothing to do.
            if(details.style.height === 'auto' || details.style.height === ''){
              // nothing
            } else {
              // Update to new scrollHeight so it continues to animate correctly if needed.
              details.style.height = details.scrollHeight + 'px';
            }
          }
        });
        ro.observe(details);

        // Set initial visual state
        setInitial();
      }

      // Find all toggle buttons inside examples
      var toggles = document.querySelectorAll('.example .toggle[aria-controls]');
      toggles.forEach(initToggle);

      // Accessibility: allow programmatic toggling via data attribute on space/enter for nested controls
      // No further global handlers necessary.
    })();
  </script>
</body>
</html>