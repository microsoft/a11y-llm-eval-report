<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand/Collapse Widget Examples</title>
  <style>
    :root {
      --accent: #0b6efd;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --radius: 8px;
      --transition: 320ms cubic-bezier(.2,.9,.2,1);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #eef2ff 120%);
      color: var(--text);
      margin: 32px;
      line-height: 1.4;
    }

    h1 {
      margin: 0 0 18px 0;
      font-size: 20px;
      color: var(--text);
    }

    p.lead {
      margin: 0 0 24px 0;
      color: var(--muted);
      font-size: 14px;
    }

    .example {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      padding: 16px;
      margin: 16px 0;
      max-width: 760px;
    }

    .widget-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle {
      background: transparent;
      border: 1px solid #e6eefb;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--accent);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background var(--transition), box-shadow var(--transition), transform 120ms;
      user-select: none;
    }

    .toggle:focus {
      outline: 3px solid rgba(11, 110, 253, 0.14);
      outline-offset: 2px;
    }

    .toggle:hover {
      transform: translateY(-1px);
    }

    .toggle .icon {
      width: 16px;
      height: 16px;
      display: inline-block;
      transition: transform var(--transition);
      transform-origin: 50% 50%;
    }

    .toggle[aria-expanded="true"] .icon {
      transform: rotate(180deg);
    }

    .summary {
      margin-left: auto;
      color: var(--muted);
      font-size: 13px;
    }

    /* Controlled content styling */
    .details {
      margin-top: 12px;
      overflow: hidden;
      will-change: height;
      border-radius: 8px;
      padding: 0 12px;
      background: linear-gradient(180deg, rgba(11,110,253,0.03), rgba(11,110,253,0.01));
      border: 1px solid rgba(11,110,253,0.06);
    }

    .details .inner {
      padding: 12px 0 16px 0;
      color: #0f172a;
      font-size: 14px;
    }

    .details p {
      margin: 0 0 8px 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* Transition fallback for users who prefer reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .details {
        transition: none !important;
      }
      .toggle {
        transition: none !important;
      }
      .toggle .icon {
        transition: none !important;
      }
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget</h1>
  <p class="lead">Two examples below demonstrate an accessible expand/collapse pattern. Each widget is wrapped in a div.example and the controlled content container uses the class "details".</p>

  <div class="example" id="example-1">
    <div class="widget-header">
      <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1">
        <span class="icon" aria-hidden="true">
          <!-- simple chevron -->
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </span>
        Show more
      </button>
      <div class="summary" aria-hidden="true">Short summary</div>
    </div>

    <div id="details-1" class="details" hidden role="region" aria-labelledby="toggle-1">
      <div class="inner">
        <p><strong>About this item:</strong> This section contains a short paragraph of descriptive text. It demonstrates how content is revealed and hidden while preserving focus and accessibility attributes.</p>
        <p>Try using the button to expand or collapse this content. Keyboard users can press Space or Enter when the button is focused.</p>
      </div>
    </div>
  </div>

  <div class="example" id="example-2">
    <div class="widget-header">
      <button id="toggle-2" class="toggle" aria-expanded="false" aria-controls="details-2">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </span>
        Read details
      </button>
      <div class="summary" aria-hidden="true">Longer content example</div>
    </div>

    <div id="details-2" class="details" hidden role="region" aria-labelledby="toggle-2">
      <div class="inner">
        <p><strong>Technical details:</strong> The expand/collapse control uses aria-expanded on the controlling button and aria-controls to associate the content region. The content container has class="details" per the requirement.</p>
        <p>The script animates height for a smooth transition and sets the hidden attribute when collapsed. This keeps the content out of assistive technology tree when closed.</p>
        <ul>
          <li>Accessible labeling via aria-labelledby</li>
          <li>Keyboard operable (button semantics)</li>
          <li>Smooth height animation with transitionend cleanup</li>
        </ul>
        <p>When expanded, the region is revealed and focus remains on the toggle button. Visual styles are intentionally subtle to keep the interface lightweight.</p>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Initialize all toggle buttons that control a .details container
      const toggles = document.querySelectorAll('.toggle[aria-controls]');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      toggles.forEach(button => {
        const detailsId = button.getAttribute('aria-controls');
        const details = document.getElementById(detailsId);
        if (!details) return;

        // Ensure the controlled element has the "details" class (per requirement)
        if (!details.classList.contains('details')) {
          details.classList.add('details');
        }

        // Set initial state if not present
        if (!button.hasAttribute('aria-expanded')) {
          button.setAttribute('aria-expanded', 'false');
        }
        if (!details.hasAttribute('role')) {
          details.setAttribute('role', 'region');
        }

        // Helper: animate opening
        function open() {
          // if already open, bail
          if (button.getAttribute('aria-expanded') === 'true') return;

          // remove hidden first so it participates in layout
          details.hidden = false;

          // measure
          const startHeight = details.clientHeight; // likely 0
          const targetHeight = details.scrollHeight;

          // If reduced motion, skip animation
          if (prefersReduced) {
            details.style.height = '';
            button.setAttribute('aria-expanded', 'true');
            return;
          }

          details.style.height = startHeight + 'px';
          // Force repaint
          details.getBoundingClientRect();

          // animate to target
          details.style.transition = 'height 320ms cubic-bezier(.2,.9,.2,1)';
          requestAnimationFrame(() => {
            details.style.height = targetHeight + 'px';
          });

          // Cleanup after transition
          const onEnd = (e) => {
            if (e && e.propertyName !== 'height') return;
            details.style.transition = '';
            details.style.height = '';
            details.removeEventListener('transitionend', onEnd);
          };
          details.addEventListener('transitionend', onEnd);

          button.setAttribute('aria-expanded', 'true');
        }

        // Helper: animate closing
        function close() {
          if (button.getAttribute('aria-expanded') === 'false') return;

          const startHeight = details.scrollHeight;
          // If reduced motion, skip animation
          if (prefersReduced) {
            details.hidden = true;
            button.setAttribute('aria-expanded', 'false');
            return;
          }

          details.style.height = startHeight + 'px';
          // Force repaint
          details.getBoundingClientRect();

          details.style.transition = 'height 320ms cubic-bezier(.2,.9,.2,1)';
          requestAnimationFrame(() => {
            details.style.height = '0px';
          });

          const onEnd = (e) => {
            if (e && e.propertyName !== 'height') return;
            details.style.transition = '';
            details.style.height = '';
            details.hidden = true; // hide from ATs and remove from flow
            details.removeEventListener('transitionend', onEnd);
          };
          details.addEventListener('transitionend', onEnd);

          button.setAttribute('aria-expanded', 'false');
        }

        // Click toggles
        button.addEventListener('click', () => {
          const expanded = button.getAttribute('aria-expanded') === 'true';
          if (expanded) close(); else open();
        });

        // Support initialization: if aria-expanded is true on load, ensure visible
        if (button.getAttribute('aria-expanded') === 'true') {
          details.hidden = false;
          details.style.height = '';
        } else {
          details.hidden = true;
          details.style.height = '';
        }
      });
    })();
  </script>
</body>
</html>