<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --bg:#f7f9fb;
      --card:#fff;
      --accent:#0366d6;
      --muted:#6b7280;
      --border:#e6e9ef;
      --radius:8px;
      --duration:320ms;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f3f6fb 0%, #fff 100%);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
    }

    h1{ margin:0 0 20px 0; font-size:20px; color:#0f172a; }
    p.lead{ margin:0 0 24px 0; color:var(--muted); max-width:60ch; }

    .container{
      max-width:820px;
      margin:0 auto;
    }

    /* Example wrapper */
    .example{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
      box-shadow: 0 1px 2px rgba(15,23,42,0.04);
      margin-bottom:18px;
    }

    /* Toggle button */
    .toggle{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      background:transparent;
      border: none;
      padding:12px;
      text-align:left;
      font-size:16px;
      cursor:pointer;
      border-radius:6px;
      transition: background-color var(--duration);
    }
    .toggle:focus{
      outline:3px solid rgba(3,102,214,0.15);
      outline-offset:2px;
    }
    .toggle:hover{
      background:rgba(3,102,214,0.03);
    }

    .toggle .title{
      font-weight:600;
      color:#0b1220;
    }
    .toggle .subtitle{
      margin-left:auto;
      font-size:13px;
      color:var(--muted);
    }

    /* arrow indicator */
    .toggle .arrow{
      width:20px;
      height:20px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      color:var(--accent);
      transition: transform var(--duration) ease;
      flex: 0 0 20px;
      font-size:14px;
      margin-right:4px;
    }
    button[aria-expanded="true"] .arrow{
      transform:rotate(90deg);
    }

    /* Controlled content area */
    .details{
      overflow:hidden;
      max-height:0;
      transition: max-height var(--duration) cubic-bezier(.2,.9,.3,1), opacity var(--duration) ease;
      opacity:0;
      will-change: max-height, opacity;
    }

    .details.open{
      opacity:1;
    }

    .details .inner{
      padding:12px 4px 4px 4px;
      margin-top:8px;
      border-top:1px dashed var(--border);
      color:#111827;
      line-height:1.5;
      font-size:15px;
    }

    /* Small helper for long text in second example */
    .details p{ margin:0 0 10px 0; color: #222831; }

    /* noscript fallback - show content if JS is disabled */
    noscript .details{
      max-height:none !important;
      opacity:1 !important;
      overflow:visible !important;
    }

    /* Minor responsive tweaks */
    @media (max-width:520px){
      .toggle{ font-size:15px; gap:8px; padding:10px; }
      .toggle .subtitle{ display:none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expand / Collapse Widget</h1>
    <p class="lead">These examples show accessible expand/collapse controls. Each widget is wrapped with a div.example and the controlled content container uses the class "details". Use the arrow or Enter/Space to toggle; Escape closes while focused inside the details.</p>

    <!-- Example 1 -->
    <div class="example">
      <button id="toggle-1" class="toggle" aria-expanded="false" aria-controls="details-1" >
        <span class="arrow" aria-hidden="true">▸</span>
        <span class="title">About this widget</span>
        <span class="subtitle">Click to expand</span>
      </button>

      <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
        <div class="inner">
          <p>This simple widget demonstrates an accessible expand/collapse pattern using a button with aria-expanded and aria-controls. The content area uses the class "details" as requested and is shown/hidden with a smooth transition.</p>
          <p>Keyboard tips: the toggle button responds to Enter and Space (native button behavior). When focus is inside the details content, pressing Escape will close the section.</p>
        </div>
      </div>
    </div>

    <!-- Example 2 -->
    <div class="example">
      <button id="toggle-2" class="toggle" aria-expanded="false" aria-controls="details-2">
        <span class="arrow" aria-hidden="true">▸</span>
        <span class="title">More information</span>
        <span class="subtitle">Includes a longer block of text</span>
      </button>

      <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="true">
        <div class="inner">
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer euismod, nibh a laoreet feugiat, nisl erat elementum est, id dapibus lectus lorem a magna. Curabitur a nisl ipsum.</p>
          <p>Phasellus commodo, neque in interdum eleifend, ipsum lorem volutpat nunc, at sagittis risus arcu non velit. Donec at interdum lacus. Vestibulum id libero nec nunc gravida aliquet.</p>
          <p>Pro tip: the script measures the content height to animate the max-height smoothly and removes the inline style after expansion so the element can grow naturally if its contents change.</p>
        </div>
      </div>
    </div>

    <!-- Example 3: multiple small items (accordion-like) -->
    <div class="example">
      <button id="toggle-3" class="toggle" aria-expanded="false" aria-controls="details-3">
        <span class="arrow" aria-hidden="true">▸</span>
        <span class="title">FAQ: How does this work?</span>
        <span class="subtitle">Short answer</span>
      </button>

      <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
        <div class="inner">
          <p>JS listens for clicks on the toggle, toggles aria-expanded, and animates the details container by adjusting max-height. It also supports Escape to close while focus is inside the details area.</p>
        </div>
      </div>
    </div>

  </div>

  <noscript>
    <style>
      .details{ max-height:none !important; opacity:1 !important; overflow:visible !important; }
    </style>
  </noscript>

  <script>
    (function(){
      // Find all toggle buttons that control a details container
      const toggles = Array.from(document.querySelectorAll('.toggle[aria-controls]'));

      // Helper: smoothly expand/collapse a details element
      function expand(detailsEl, btn) {
        detailsEl.classList.add('open');
        detailsEl.setAttribute('aria-hidden','false');
        btn.setAttribute('aria-expanded','true');

        // Set to current height to kick-start animation if necessary
        detailsEl.style.maxHeight = detailsEl.scrollHeight + 'px';

        // After the transition, remove the inline max-height so content can grow/shrink naturally
        const onTransitionEnd = function(e){
          if (e.target !== detailsEl || e.propertyName !== 'max-height') return;
          detailsEl.style.maxHeight = 'none';
          detailsEl.removeEventListener('transitionend', onTransitionEnd);
        };
        detailsEl.addEventListener('transitionend', onTransitionEnd);
      }

      function collapse(detailsEl, btn) {
        // To animate from current full height, temporarily set the maxHeight to the scrollHeight
        detailsEl.style.maxHeight = detailsEl.scrollHeight + 'px';

        // Force reflow so the browser acknowledges the starting height
        // eslint-disable-next-line no-unused-expressions
        detailsEl.getBoundingClientRect();

        // Then transition to 0
        requestAnimationFrame(() => {
          detailsEl.style.maxHeight = '0px';
          detailsEl.classList.remove('open');
          detailsEl.setAttribute('aria-hidden','true');
          btn.setAttribute('aria-expanded','false');
        });
      }

      function toggleHandler(e){
        const btn = e.currentTarget;
        const id = btn.getAttribute('aria-controls');
        const detailsEl = document.getElementById(id);
        if (!detailsEl) return;

        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          collapse(detailsEl, btn);
        } else {
          expand(detailsEl, btn);
        }
      }

      toggles.forEach(btn => {
        btn.addEventListener('click', toggleHandler);

        // Allow closing with Escape when focus is inside the details content
        const detailsEl = document.getElementById(btn.getAttribute('aria-controls'));
        if (detailsEl) {
          detailsEl.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape' || ev.key === 'Esc') {
              // return focus to the button and close
              btn.focus();
              collapse(detailsEl, btn);
            }
          });

          // Also support clicks on links or buttons inside details without closing unexpectedly
          detailsEl.addEventListener('click', (ev) => {
            // If clicking a link with target _blank or an interactive element, don't interfere.
            // No extra handling needed here; kept for future extensions.
          });
        }
      });

      // Enhance semantics: if JS is disabled, the noscript CSS will show content.
      // Optionally, set ARIA defaults here (already present in markup).
    })();
  </script>
</body>
</html>