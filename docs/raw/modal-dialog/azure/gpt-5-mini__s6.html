<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --radius: 10px;
      --max-width: 600px;
      --gap: 24px;
      --transition: 180ms cubic-bezier(.2,.9,.2,1);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: #f6f7fb;
      color: #111;
    }

    header {
      padding: 24px;
      background: white;
      box-shadow: 0 1px 0 rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    main {
      padding: 32px;
      max-width: 980px;
      margin: 32px auto;
    }

    .trigger {
      background: #0066ff;
      color: #fff;
      padding: 10px 16px;
      border: 0;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(2, 66, 255, 0.12);
    }

    .trigger:focus {
      outline: 3px solid rgba(0,102,255,0.2);
      outline-offset: 2px;
    }

    /* Modal overlay */
    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: var(--overlay-bg);
      padding: 24px;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition);
      -webkit-tap-highlight-color: transparent;
    }

    /* When modal is visible */
    .modal[aria-hidden="false"] {
      opacity: 1;
      pointer-events: auto;
    }

    /* Dialog panel */
    .dialog {
      background: var(--modal-bg);
      border-radius: var(--radius);
      max-width: var(--max-width);
      width: 100%;
      box-shadow: 0 10px 30px rgba(6, 18, 44, 0.2);
      transform: translateY(10px) scale(.98);
      transition: transform var(--transition), opacity var(--transition);
      opacity: 0;
      max-height: calc(100vh - 96px);
      overflow: auto;
    }

    .modal[aria-hidden="false"] .dialog {
      transform: none;
      opacity: 1;
    }

    .dialog__header {
      padding: 20px 20px 0 20px;
      display: flex;
      align-items: start;
      justify-content: space-between;
      gap: 12px;
    }

    .dialog__title {
      margin: 0;
      font-size: 1.125rem;
      font-weight: 700;
    }

    .close {
      background: transparent;
      border: 0;
      color: #333;
      padding: 6px;
      margin-left: 8px;
      border-radius: 6px;
      cursor: pointer;
    }

    .close:focus {
      outline: 3px solid rgba(0,0,0,0.08);
    }

    .dialog__body {
      padding: 16px 20px 24px 20px;
      font-size: 0.99rem;
      color: #222;
    }

    .dialog__footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding: 0 20px 20px 20px;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
    }

    .btn.secondary {
      background: #f1f5f9;
      color: #0f172a;
    }

    .btn.primary {
      background: #0b84ff;
      color: white;
      font-weight: 600;
    }

    /* Make overlay clickable area (so clicks outside the dialog close it) */
    .modal-inner {
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
    }

    /* Visually hide content when modal open for assistive tech */
    [aria-hidden="true"].inert-hide {
      user-select: none;
      pointer-events: none;
    }

    /* Small responsive */
    @media (max-width: 480px) {
      .dialog {
        border-radius: 8px;
      }
      .dialog__title {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:700">Demo App</div>
    <div>
      <button class="trigger" aria-controls="example-modal">Open modal</button>
    </div>
  </header>

  <main id="main">
    <section>
      <h1>Page content</h1>
      <p>This demonstrates an accessible modal dialog component. The modal is closed by default. Use the "Open modal" button (has class "trigger") to open it. You can close it by pressing Escape, clicking outside, or using the close button inside the dialog.</p>

      <p>Try tabbing around to see focus management in action.</p>

      <p><a href="#">Sample link</a> · <button>Another button</button></p>
    </section>
  </main>

  <!-- Modal: closed by default via aria-hidden="true" -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-inner" tabindex="-1">
      <div class="dialog" role="document">
        <div class="dialog__header">
          <h2 id="modal-title" class="dialog__title">Example Modal</h2>
          <div>
            <button class="close" aria-label="Close dialog" title="Close">✕</button>
          </div>
        </div>
        <div class="dialog__body">
          <p>This is a sample modal dialog. It traps focus while open and returns focus to the trigger when closed. Press Escape to close, or click outside the dialog.</p>
          <form>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <label>
                Name<br />
                <input type="text" name="name" />
              </label>
              <label>
                Email<br />
                <input type="email" name="email" />
              </label>
            </div>
          </form>
        </div>
        <div class="dialog__footer">
          <button class="btn secondary close">Cancel</button>
          <button class="btn primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('example-modal');
      const main = document.getElementById('main');
      const triggers = document.querySelectorAll('.trigger');
      const closeButtons = modal.querySelectorAll('.close');
      const modalInner = modal.querySelector('.modal-inner');
      let lastFocused = null;
      let activeTrigger = null;

      // utility: list focusable elements inside an element
      function getFocusable(container) {
        if (!container) return [];
        return Array.from(
          container.querySelectorAll(
            'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex]:not([tabindex="-1"]), [contenteditable]'
          )
        ).filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function open(trigger) {
        if (modal.getAttribute('aria-hidden') === 'false') return;
        lastFocused = document.activeElement;
        activeTrigger = trigger || lastFocused;
        modal.setAttribute('aria-hidden', 'false');
        // mark main as hidden to assistive tech
        main.setAttribute('aria-hidden', 'true');
        main.classList.add('inert-hide');
        document.body.style.overflow = 'hidden';
        // focus the first focusable element in modal, or the modal container
        const focusable = getFocusable(modal);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          modalInner.focus();
        }
        document.addEventListener('keydown', onKeyDown);
      }

      function close(returnFocus = true) {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        modal.setAttribute('aria-hidden', 'true');
        main.removeAttribute('aria-hidden');
        main.classList.remove('inert-hide');
        document.body.style.overflow = '';
        document.removeEventListener('keydown', onKeyDown);
        if (returnFocus && activeTrigger) {
          try {
            activeTrigger.focus();
          } catch (e) {
            if (lastFocused) lastFocused.focus();
          }
        }
      }

      function onKeyDown(e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          close();
          return;
        }
        if (e.key === 'Tab') {
          // trap focus inside modal
          const focusable = getFocusable(modal);
          if (focusable.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === modal) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Open when trigger(s) clicked
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          open(btn);
        });
      });

      // Close when clicking close buttons inside modal
      closeButtons.forEach(btn => {
        btn.addEventListener('click', () => close());
      });

      // Close when clicking on overlay area (outside the dialog)
      modal.addEventListener('pointerdown', (e) => {
        // If the pointerdown target is the overlay (modal) or the modalInner but outside the dialog, close
        // We check if the click target is the modal (overlay) or is inside modalInner but not inside .dialog
        if (e.target === modal || (modalInner.contains(e.target) && !modal.querySelector('.dialog').contains(e.target))) {
          // use pointerup to confirm it wasn't a drag; close on pointerup so focus behavior is consistent
          const onPointerUp = (upEvent) => {
            if (upEvent.target === e.target) {
              close();
            }
            window.removeEventListener('pointerup', onPointerUp);
          };
          window.addEventListener('pointerup', onPointerUp);
        }
      });

      // Close on click of overlay where click target is the modal itself
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          close();
        }
      });

      // close if user navigates focus outside the modal using pointer (defensive)
      document.addEventListener('focusin', (e) => {
        if (modal.getAttribute('aria-hidden') === 'false') {
          if (!modal.contains(e.target)) {
            // bring back focus
            const focusable = getFocusable(modal);
            if (focusable.length) focusable[0].focus();
            else modalInner.focus();
          }
        }
      });

      // Allow opening modal via keyboard on trigger (Enter/Space is default for button elements)
      // Expose open/close on window for demo/testing convenience
      window.__demoModal = { open: () => open(), close: () => close() };
    })();
  </script>
</body>
</html>