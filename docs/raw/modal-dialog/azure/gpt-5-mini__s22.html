<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.5);
      --dialog-bg: #fff;
      --radius: 8px;
      --max-width: 600px;
      --space: 1rem;
      --accent: #0066ff;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 0;
      padding: 0;
      color: #111;
      background: #f6f7fb;
    }

    header, main {
      padding: 24px;
      max-width: 900px;
      margin: 0 auto;
    }

    .trigger {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }

    /* Modal overlay */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      z-index: 1000;
      padding: 24px;
    }

    /* Hidden by default for accessibility; aria-hidden="true" will keep it hidden */
    .modal[aria-hidden="true"] {
      display: none;
    }

    .dialog {
      background: var(--dialog-bg);
      max-width: var(--max-width);
      width: 100%;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      overflow: hidden;
      transform-origin: center;
      outline: none;
    }

    .dialog header {
      padding: 16px 20px;
      border-bottom: 1px solid #e6e9ef;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .dialog header h2 {
      margin: 0;
      font-size: 1.125rem;
      font-weight: 600;
    }

    .close {
      background: transparent;
      border: none;
      padding: 6px;
      border-radius: 6px;
      cursor: pointer;
      color: #333;
      font-size: 1rem;
    }

    .close:focus {
      box-shadow: 0 0 0 3px rgba(0,102,255,0.15);
    }

    .dialog .content {
      padding: 16px 20px;
      font-size: 0.98rem;
      color: #222;
    }

    .dialog .actions {
      padding: 12px 20px;
      border-top: 1px solid #e6e9ef;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      background: #fafbff;
    }

    .btn {
      padding: 0.5rem 0.9rem;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .btn.primary {
      background: var(--accent);
      color: white;
    }

    .btn.secondary {
      background: #fff;
      border-color: #d5d9e3;
      color: #111;
    }

    /* Focus styles for keyboard users */
    .trigger:focus, .btn:focus {
      box-shadow: 0 0 0 3px rgba(0,102,255,0.15);
      outline: none;
    }

    /* Small responsive adjustments */
    @media (max-width: 420px) {
      .dialog {
        max-width: calc(100% - 32px);
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Modal Dialog Component (Example)</h1>
    <p>This page demonstrates a small accessible modal dialog component. The modal is closed by default. Use the "Open dialog" button below to open it.</p>
    <p>
      <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">
        Open dialog
      </button>
    </p>
  </header>

  <main id="main">
    <section>
      <h2>Page content</h2>
      <p>Some page content that will be inert to assistive technologies when the modal is open.</p>
      <p>Try opening the dialog and use Tab / Shift+Tab to cycle focus inside the dialog. Press Escape to close, or click outside the dialog on the overlay.</p>
    </section>
  </main>

  <!-- Modal -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="dialog" role="document">
      <header>
        <h2 id="modal-title">Example Modal</h2>
        <button class="close" aria-label="Close dialog" title="Close dialog">&times;</button>
      </header>

      <div class="content">
        <p>This is an example of a modal dialog. It traps focus while open and returns focus to the opening button when closed.</p>
        <form>
          <label>
            Your name
            <input type="text" name="name" style="display:block;margin-top:6px;padding:8px;width:100%;box-sizing:border-box;" />
          </label>
        </form>
      </div>

      <div class="actions">
        <button class="btn secondary close" type="button">Cancel</button>
        <button class="btn primary" type="button">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('example-modal');
      const dialog = modal.querySelector('.dialog');
      const triggers = document.querySelectorAll('.trigger');
      const closeButtons = modal.querySelectorAll('.close');
      const main = document.getElementById('main');

      // Keep track of the element that opened the modal to return focus later.
      let lastFocused = null;
      // Save previous body overflow to restore later
      let previousBodyOverflow = '';

      // CSS selector to find focusable elements inside the modal
      const focusableSelector = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      function getFocusableElements(container) {
        return Array.from(container.querySelectorAll(focusableSelector))
          .filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal(triggerEl) {
        if (modal.getAttribute('aria-hidden') === 'false') return;
        lastFocused = triggerEl || document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        // mark main content as hidden to assistive tech
        main.setAttribute('aria-hidden', 'true');
        previousBodyOverflow = document.body.style.overflow || '';
        document.body.style.overflow = 'hidden';

        // focus the first focusable element inside the dialog, or the dialog itself
        const focusable = getFocusableElements(dialog);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          dialog.setAttribute('tabindex', '-1');
          dialog.focus();
        }

        document.addEventListener('keydown', onKeyDown, true);
        document.addEventListener('focus', enforceFocus, true);
      }

      function closeModal() {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        modal.setAttribute('aria-hidden', 'true');
        main.removeAttribute('aria-hidden');
        document.body.style.overflow = previousBodyOverflow || '';
        document.removeEventListener('keydown', onKeyDown, true);
        document.removeEventListener('focus', enforceFocus, true);

        // return focus to the triggering element
        try {
          if (lastFocused && typeof lastFocused.focus === 'function') {
            lastFocused.focus();
          }
        } catch (e) {
          // ignore focus errors
        }
      }

      // Keep focus inside the modal
      function enforceFocus(event) {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        if (!modal.contains(event.target)) {
          const focusable = getFocusableElements(dialog);
          if (focusable.length) {
            focusable[0].focus();
          } else {
            dialog.focus();
          }
        }
      }

      function onKeyDown(event) {
        if (modal.getAttribute('aria-hidden') === 'true') return;

        if (event.key === 'Escape' || event.key === 'Esc') {
          event.preventDefault();
          closeModal();
          return;
        }

        if (event.key === 'Tab') {
          // handle focus trapping
          const focusable = getFocusableElements(dialog);
          if (focusable.length === 0) {
            // nothing to trap, keep focus on dialog
            event.preventDefault();
            dialog.focus();
            return;
          }

          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          const active = document.activeElement;

          if (!event.shiftKey && active === last) {
            // Tab on last -> move to first
            event.preventDefault();
            first.focus();
          } else if (event.shiftKey && active === first) {
            // Shift+Tab on first -> move to last
            event.preventDefault();
            last.focus();
          }
        }
      }

      // Open handlers for all triggers
      triggers.forEach(t => {
        t.addEventListener('click', function (e) {
          openModal(t);
        });
      });

      // Close handlers for close buttons
      closeButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          closeModal();
        });
      });

      // Click on overlay closes when clicking outside the dialog
      modal.addEventListener('click', function (event) {
        if (event.target === modal) {
          closeModal();
        }
      });

      // Prevent clicks inside the dialog from bubbling to overlay
      dialog.addEventListener('click', function (event) {
        event.stopPropagation();
      });

      // Optional: allow opening the modal with keyboard on focused trigger via Enter or Space
      triggers.forEach(t => {
        t.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openModal(t);
          }
        });
      });

      // Expose open/close for debugging or programmatic control (not required)
      window.exampleModal = {
        open: openModal,
        close: closeModal
      };
    })();
  </script>
</body>
</html>