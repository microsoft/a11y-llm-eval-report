<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.5);
      --panel-bg: #fff;
      --radius: 8px;
      --max-width: 520px;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 0; line-height: 1.4; background: #f3f4f6; color: #111827; }
    header { padding: 1rem; background: #111827; color: white; }
    main { padding: 2rem; max-width: 900px; margin: 0 auto; }

    /* Trigger button */
    .trigger {
      background: linear-gradient(180deg,#2563eb,#1e40af);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    .trigger:focus { outline: 3px solid rgba(37,99,235,0.25); }

    /* Modal base styles (hidden by default) */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal.open { display: flex; }

    /* Backdrop */
    .modal__backdrop {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      backdrop-filter: blur(2px);
      opacity: 0;
      transition: opacity 220ms ease;
    }
    .modal.open .modal__backdrop { opacity: 1; }

    /* Panel */
    .modal__panel {
      position: relative;
      background: var(--panel-bg);
      border-radius: var(--radius);
      padding: 1.25rem;
      width: calc(100% - 3rem);
      max-width: var(--max-width);
      box-shadow: 0 10px 30px rgba(2,6,23,0.2);
      transform: translateY(8px) scale(0.995);
      opacity: 0;
      transition: transform 220ms ease, opacity 220ms ease;
      z-index: 1;
    }
    .modal.open .modal__panel { transform: translateY(0) scale(1); opacity: 1; }

    .modal__header { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
    .modal__title { margin: 0; font-size: 1.125rem; }
    .modal__close {
      background: transparent;
      border: none;
      font-size: 1rem;
      padding: 0.25rem;
      cursor: pointer;
      color: #374151;
      border-radius: 6px;
    }
    .modal__close:focus { outline: 3px solid rgba(99,102,241,0.25); }

    .modal__body { margin-top: 0.75rem; color: #374151; }
    .modal__footer { margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: flex-end; }
    .btn { padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid transparent; cursor: pointer; }
    .btn.primary { background: #10b981; color: white; border-color: rgba(16,185,129,0.2); }
    .btn.secondary { background: #e5e7eb; color: #111827; }

    /* Small helper: visually hidden for accessibility */
    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:1.125rem;">Example Page</h1>
  </header>

  <main id="main">
    <p>This page demonstrates a small accessible modal dialog. The modal is closed by default. Click the button below to open it.</p>
    <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">Open modal</button>

    <p style="margin-top:1.5rem;">Background content remains interactive only when the dialog is closed. When the dialog opens, focus is moved into it and trapped. You can close the dialog with the close button, by pressing Escape, or by clicking outside the panel.</p>
  </main>

  <!-- Modal (closed by default) -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal__backdrop" data-close="backdrop"></div>

    <div class="modal__panel" role="document" tabindex="-1">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Subscribe to updates</h2>
        <button class="modal__close" aria-label="Close dialog" data-close="button">&times;</button>
      </div>

      <div class="modal__body">
        <p>Enter your email to receive occasional updates and announcements.</p>
        <label for="email" class="sr-only">Email address</label>
        <input id="email" type="email" placeholder="you@example.com" style="width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;" />
      </div>

      <div class="modal__footer">
        <button class="btn secondary" data-close="button">Cancel</button>
        <button class="btn primary">Subscribe</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      var modal = document.getElementById('example-modal');
      var panel = modal.querySelector('.modal__panel');
      var backdrop = modal.querySelector('.modal__backdrop');
      var closeButtons = modal.querySelectorAll('[data-close="button"]');
      var triggers = document.querySelectorAll('.trigger');
      var main = document.getElementById('main');
      var lastFocused = null;

      var FOCUSABLE_SELECTORS = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      function getFocusableElements(container) {
        return Array.prototype.slice.call(container.querySelectorAll(FOCUSABLE_SELECTORS));
      }

      function openModal() {
        if (modal.classList.contains('open')) return;
        lastFocused = document.activeElement;
        modal.classList.add('open');
        modal.setAttribute('aria-hidden', 'false');

        // Mark background as inert/hidden to assistive tech
        if ('inert' in HTMLElement.prototype) {
          main.inert = true;
        } else {
          main.setAttribute('aria-hidden', 'true');
        }

        // Wait a frame then focus panel for consistent behavior
        window.requestAnimationFrame(function () {
          // Try to focus the first focusable element; fallback to panel
          var focusables = getFocusableElements(modal);
          if (focusables.length) {
            focusables[0].focus();
          } else {
            panel.focus();
          }
        });

        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal() {
        if (!modal.classList.contains('open')) return;
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');

        if ('inert' in HTMLElement.prototype) {
          main.inert = false;
        } else {
          main.removeAttribute('aria-hidden');
        }

        document.removeEventListener('keydown', onKeyDown);
        // Return focus to the element that triggered the modal
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          trapFocus(e);
        }
      }

      function trapFocus(e) {
        var focusables = getFocusableElements(modal);
        if (focusables.length === 0) {
          // No focusables â€” keep focus on the panel
          e.preventDefault();
          panel.focus();
          return;
        }
        var first = focusables[0];
        var last = focusables[focusables.length - 1];
        var active = document.activeElement;

        if (e.shiftKey) {
          if (active === first || modal === active) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (active === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }

      // Attach open handlers to all triggers
      triggers.forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          openModal();
        });
      });

      // Close on backdrop click
      backdrop.addEventListener('click', function (e) {
        closeModal();
      });

      // Close on any close buttons inside
      closeButtons.forEach(function (btn) {
        btn.addEventListener('click', function () {
          closeModal();
        });
      });

      // Close if clicking outside the panel but inside modal (extra safety)
      modal.addEventListener('mousedown', function (e) {
        if (e.target === modal) {
          // On some browsers, clicking the transparent area might target modal itself
          closeModal();
        }
      });

      // Accessibility: allow opening via keyboard on trigger if it's not a button
      triggers.forEach(function (t) {
        t.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openModal();
          }
        });
      });

      // Ensure modal is hidden from assistive tech on load
      modal.setAttribute('aria-hidden', 'true');
    })();
  </script>
</body>
</html>