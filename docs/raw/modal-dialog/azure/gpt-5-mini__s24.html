<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.5);
      --modal-bg: #fff;
      --modal-radius: 8px;
      --modal-padding: 1.25rem;
      --max-width: 520px;
      --transition: 180ms ease;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      line-height: 1.4;
      padding: 2rem;
      background: #f7f7f8;
      color: #111;
    }

    /* Example page content */
    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      margin-bottom:1.5rem;
    }

    .trigger {
      background: #0b5fff;
      color: #fff;
      border: 0;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,0.05);
      font-weight: 600;
    }
    .trigger:focus {
      outline: 3px solid rgba(11,95,255,0.25);
      outline-offset: 2px;
    }

    main {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Modal overlay + dialog */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none; /* closed by default */
      align-items: center;
      justify-content: center;
      background: var(--overlay-bg);
      z-index: 1000;
    }
    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: var(--modal-bg);
      width: calc(100% - 2rem);
      max-width: var(--max-width);
      border-radius: var(--modal-radius);
      padding: var(--modal-padding);
      box-shadow: 0 10px 30px rgba(2,6,23,0.2);
      transform: translateY(8px) scale(0.99);
      opacity: 0;
      transition: transform var(--transition), opacity var(--transition);
    }
    .modal-overlay.open .modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      margin-bottom: 0.5rem;
    }

    .modal h2 {
      margin: 0;
      font-size: 1.125rem;
    }
    .close {
      background: transparent;
      border: 0;
      padding: 0.35rem;
      cursor: pointer;
      border-radius: 6px;
      color: #333;
    }
    .close:focus {
      outline: 3px solid rgba(0,0,0,0.12);
      outline-offset: 2px;
    }

    .modal-body {
      margin-top: 0.5rem;
      font-size: 0.97rem;
      color: #333;
    }

    .modal-footer {
      display:flex;
      justify-content:flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .btn {
      padding: 0.5rem 0.85rem;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 600;
    }
    .btn.secondary {
      background: #f1f1f4;
      color: #111;
    }
    .btn.primary {
      background: #0b5fff;
      color: #fff;
    }

    /* Prevent body scroll while modal open */
    body.modal-open {
      overflow: hidden;
    }

    /* For demonstration: dim background content via aria-hidden when modal open */
    [data-hidden-when-modal] {
      transition: filter 200ms ease;
    }
    [data-hidden-when-modal].behind {
      filter: blur(1px) brightness(0.95);
    }

    /* Small responsive tweak */
    @media (max-width: 420px) {
      .modal { padding: 1rem; border-radius: 10px; }
      .modal h2 { font-size: 1rem; }
      .modal-footer { flex-direction: column-reverse; align-items: stretch; }
      .modal-footer .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <header data-hidden-when-modal>
    <h1>Demo: Modal Dialog Component</h1>
    <div>
      <button class="trigger" type="button" aria-haspopup="dialog">Open modal</button>
    </div>
  </header>

  <main data-hidden-when-modal>
    <p>
      This page demonstrates a small accessible modal dialog. The trigger button above has the class "trigger".
    </p>

    <p>
      Additional content to show background behaviour while the modal is open.
    </p>

    <p>
      Try using TAB to cycle through controls, ESC to close, and clicking outside the dialog to dismiss it. When the modal opens focus moves into the dialog and is trapped inside until the dialog is closed. Focus is returned to the trigger after closing.
    </p>
  </main>

  <!-- Modal structure, closed by default -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modalTitle"
      aria-describedby="modalDesc"
      id="dialog"
    >
      <div class="modal-header">
        <h2 id="modalTitle">Example Modal</h2>
        <button class="close" id="closeBtn" aria-label="Close dialog">&times;</button>
      </div>
      <div class="modal-body" id="modalDesc">
        <p>
          This is a simple example of a modal dialog component. It is hidden by default and opened by clicking the button with the class "trigger".
        </p>
        <form>
          <label>
            Your name
            <input type="text" name="name" placeholder="Jane Doe" style="margin-top:0.35rem; width:100%; padding:0.45rem; border-radius:6px; border:1px solid #ddd;">
          </label>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" id="cancelBtn" type="button">Cancel</button>
        <button class="btn primary" id="saveBtn" type="button">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Elements
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const overlay = document.getElementById('modalOverlay');
      const dialog = document.getElementById('dialog');
      const closeBtn = document.getElementById('closeBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const saveBtn = document.getElementById('saveBtn');
      const hiddenBackgroundElements = Array.from(document.querySelectorAll('[data-hidden-when-modal]'));

      // Focusable selector
      const FOCUSABLE = 'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex], [contenteditable]';

      let lastFocusedTrigger = null;

      // Helpers
      function getFocusableElements(container) {
        return Array.from(container.querySelectorAll(FOCUSABLE)).filter(el => el.offsetParent !== null);
      }

      function openModal(trigger) {
        lastFocusedTrigger = trigger || document.activeElement;
        overlay.classList.add('open');
        overlay.removeAttribute('aria-hidden');
        document.body.classList.add('modal-open');
        hiddenBackgroundElements.forEach(el => el.classList.add('behind'));

        // Move focus into dialog
        // Wait a tick for elements to be visible
        window.requestAnimationFrame(() => {
          const focusable = getFocusableElements(dialog);
          if (focusable.length) focusable[0].focus();
          else dialog.focus();
        });

        // Add event listeners for keyboard trapping
        document.addEventListener('keydown', onKeyDown);
        overlay.addEventListener('click', onOverlayClick);
      }

      function closeModal() {
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');
        hiddenBackgroundElements.forEach(el => el.classList.remove('behind'));

        // Return focus
        if (lastFocusedTrigger && typeof lastFocusedTrigger.focus === 'function') {
          lastFocusedTrigger.focus();
        }

        // Clean up
        document.removeEventListener('keydown', onKeyDown);
        overlay.removeEventListener('click', onOverlayClick);
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trap
          const focusable = getFocusableElements(dialog);
          if (focusable.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || dialog === document.activeElement) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      function onOverlayClick(e) {
        // If user clicked on the overlay (not inside the modal), close
        if (e.target === overlay) {
          closeModal();
        }
      }

      // Wire up triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          openModal(btn);
        });
      });

      // Close controls
      closeBtn.addEventListener('click', () => closeModal());
      cancelBtn.addEventListener('click', () => closeModal());

      // Example: Save closes modal and logs a message
      saveBtn.addEventListener('click', () => {
        // Could validate or process data here
        console.log('Saved (demo)');
        closeModal();
      });

      // Ensure dialog is closed on load (explicit)
      overlay.setAttribute('aria-hidden', 'true');
      overlay.classList.remove('open');

      // Make dialog focusable in case there are no focusable controls inside
      if (!dialog.hasAttribute('tabindex')) {
        dialog.setAttribute('tabindex', '-1');
      }
    })();
  </script>
</body>
</html>