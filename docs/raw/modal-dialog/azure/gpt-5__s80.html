<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Modal Dialog Example</title>
<style>
  :root {
    --overlay-bg: rgba(0,0,0,0.5);
    --dialog-bg: #fff;
    --dialog-radius: 12px;
    --dialog-shadow: 0 20px 40px rgba(0,0,0,0.25);
    --dialog-max-width: 560px;
  }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; margin: 0; }
  .page {
    padding: 24px;
    min-height: 100vh;
  }
  .trigger {
    appearance: none;
    border: none;
    background: #1e6cff;
    color: #fff;
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 16px;
    cursor: pointer;
  }
  .trigger:focus { outline: 3px solid #99c2ff; outline-offset: 2px; }

  .modal {
    position: fixed;
    inset: 0;
    display: none;
    z-index: 1000;
    background: var(--overlay-bg);
  }
  .modal.open { display: block; }
  .modal[aria-hidden="true"] { visibility: hidden; }
  .modal__dialog {
    position: relative;
    margin: 10vh auto 4vh auto;
    background: var(--dialog-bg);
    color: #111;
    max-width: var(--dialog-max-width);
    box-shadow: var(--dialog-shadow);
    border-radius: var(--dialog-radius);
    padding: 24px;
    width: calc(100% - 32px);
  }
  .modal__header {
    display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;
  }
  .modal__title {
    margin: 0;
    font-size: 20px;
    line-height: 1.4;
  }
  .modal__close {
    appearance: none; border: none; background: transparent; font-size: 18px; cursor: pointer; color: #444;
    padding: 8px; margin: -8px; border-radius: 8px;
  }
  .modal__close:focus { outline: 3px solid #99c2ff; }
  .modal__content { margin-top: 12px; font-size: 16px; line-height: 1.6; }
  .modal__actions {
    margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end; flex-wrap: wrap;
  }
  .btn {
    appearance: none; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 16px;
  }
  .btn.primary { background: #1e6cff; color: #fff; }
  .btn.secondary { background: #eee; color: #222; }
  .btn:focus { outline: 3px solid #99c2ff; }

  @media (prefers-reduced-motion: no-preference) {
    .modal.open .modal__dialog {
      animation: modal-in 180ms cubic-bezier(.2,.9,.3,1) both;
    }
    @keyframes modal-in {
      from { opacity: 0; transform: translateY(8px) scale(.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
  }
</style>
</head>
<body>
  <main class="page" id="page-content">
    <h1>Modal Dialog Component</h1>
    <p>This example shows a modal dialog that is closed by default. Click the button to open it.</p>
    <button class="trigger" data-target="#example-modal">Open Modal</button>
    <p>Other content on the page to demonstrate overlay and focus behavior.</p>
    <a href="#">A sample link</a>
  </main>

  <div class="modal" id="example-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="example-modal-title" aria-describedby="example-modal-desc">
    <div class="modal__dialog">
      <div class="modal__header">
        <h2 class="modal__title" id="example-modal-title">Subscribe to updates</h2>
        <button class="modal__close" type="button" aria-label="Close dialog" title="Close" data-close>&times;</button>
      </div>
      <div class="modal__content" id="example-modal-desc">
        <p>Join our mailing list to receive the latest news. You can unsubscribe at any time.</p>
        <form>
          <label for="email">Email</label><br>
          <input id="email" name="email" type="email" required placeholder="you@example.com" style="width:100%; padding:10px; margin-top:6px;" data-autofocus>
          <div class="modal__actions">
            <button class="btn primary" type="submit">Subscribe</button>
            <button class="btn secondary" type="button" data-close>Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
(function() {
  const selectorFocusable = [
    'a[href]',
    'area[href]',
    'input:not([disabled]):not([type="hidden"])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    'button:not([disabled])',
    'iframe',
    'object',
    'embed',
    '[contenteditable]',
    '[tabindex]:not([tabindex="-1"])'
  ].join(',');

  let activeModal = null;
  let lastFocused = null;

  function getFocusable(container) {
    return Array.from(container.querySelectorAll(selectorFocusable))
      .filter(el => el.offsetParent !== null || el === document.activeElement);
  }

  function openModal(modal) {
    if (!modal || activeModal === modal) return;
    lastFocused = document.activeElement;

    activeModal = modal;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';

    const content = modal.querySelector('.modal__dialog') || modal;
    const focusables = getFocusable(content);
    const autoFocus = content.querySelector('[data-autofocus]');
    if (autoFocus) {
      autoFocus.focus();
    } else if (focusables.length) {
      focusables[0].focus();
    } else {
      content.setAttribute('tabindex', '-1');
      content.focus();
    }

    document.addEventListener('keydown', trapKeys, true);
    modal.addEventListener('click', onBackdropClick, true);
    modal.addEventListener('keydown', onEscape, true);
  }

  function closeModal(modal) {
    if (!modal || activeModal !== modal) return;
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    document.removeEventListener('keydown', trapKeys, true);
    modal.removeEventListener('click', onBackdropClick, true);
    modal.removeEventListener('keydown', onEscape, true);
    activeModal = null;

    if (lastFocused && typeof lastFocused.focus === 'function') {
      lastFocused.focus();
    }
  }

  function onBackdropClick(event) {
    if (!activeModal) return;
    const dialog = activeModal.querySelector('.modal__dialog');
    if (!dialog.contains(event.target)) {
      closeModal(activeModal);
    }
  }

  function onEscape(event) {
    if (event.key === 'Escape' && activeModal) {
      event.preventDefault();
      closeModal(activeModal);
    }
  }

  function trapKeys(event) {
    if (!activeModal) return;
    if (event.key !== 'Tab') return;

    const dialog = activeModal.querySelector('.modal__dialog') || activeModal;
    const focusables = getFocusable(dialog);
    if (focusables.length === 0) {
      dialog.focus();
      event.preventDefault();
      return;
    }

    const first = focusables[0];
    const last = focusables[focusables.length - 1];
    const active = document.activeElement;

    if (event.shiftKey) {
      if (active === first || !dialog.contains(active)) {
        last.focus();
        event.preventDefault();
      }
    } else {
      if (active === last) {
        first.focus();
        event.preventDefault();
      }
    }
  }

  function findModalFromTrigger(trigger) {
    const target = trigger.getAttribute('data-target') || '#example-modal';
    try {
      return document.querySelector(target);
    } catch (_) {
      return document.getElementById('example-modal');
    }
  }

  document.addEventListener('click', function(e) {
    const trigger = e.target.closest('.trigger');
    if (trigger) {
      e.preventDefault();
      const modal = findModalFromTrigger(trigger);
      openModal(modal);
      return;
    }

    const closeBtn = e.target.closest('[data-close]');
    if (closeBtn && activeModal) {
      e.preventDefault();
      closeModal(activeModal);
    }
  });

  window.addEventListener('hashchange', function() {
    if (activeModal) closeModal(activeModal);
  });

})();
</script>
</body>
</html>