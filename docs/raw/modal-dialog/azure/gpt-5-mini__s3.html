<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --panel-bg: #fff;
      --panel-radius: 8px;
      --panel-width: 520px;
      --gap: 16px;
      --transition: 240ms cubic-bezier(.2,.9,.3,1);
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#111;
      background: #f7f7fb;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      padding:24px;
      background:linear-gradient(90deg,#5b8cff,#8ec5ff);
      color:white;
    }
    main{
      padding:24px;
      max-width:900px;
      margin:0 auto;
    }
    .trigger{
      display:inline-block;
      padding:10px 14px;
      border-radius:6px;
      background:#0b63ff;
      color:white;
      border:0;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(11,99,255,0.18);
    }

    /* Modal base (hidden by default) */
    .modal{
      position: fixed;
      inset: 0;
      display: block;
      pointer-events: none;
      z-index: 9999;
    }
    .modal[aria-hidden="true"]{
      visibility: hidden;
    }

    .modal__overlay{
      position:absolute;
      inset:0;
      background:var(--overlay-bg);
      opacity:0;
      transition: opacity var(--transition);
      will-change: opacity;
      pointer-events: none;
    }

    .modal__panel{
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-48%) scale(0.98);
      width: calc(var(--panel-width) - 2*var(--gap));
      max-width: calc(100% - 2*var(--gap));
      background: var(--panel-bg);
      border-radius: var(--panel-radius);
      box-shadow: 0 12px 40px rgba(8,18,50,0.16);
      padding: 20px;
      opacity: 0;
      transition: transform var(--transition), opacity var(--transition);
      pointer-events: none;
      outline: none;
    }

    .modal__panel:focus{
      outline: 2px solid #cfe1ff;
      outline-offset: 4px;
    }

    .modal.is-open{
      pointer-events: auto;
    }
    .modal.is-open .modal__overlay{
      opacity:1;
      pointer-events: auto;
    }
    .modal.is-open .modal__panel{
      transform: translate(-50%,-50%) scale(1);
      opacity:1;
      pointer-events: auto;
    }

    .modal__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:8px;
    }
    .modal__title{
      margin:0;
      font-size:18px;
      line-height:1.2;
    }
    .modal__close{
      background:transparent;
      border:0;
      font-size:20px;
      line-height:1;
      padding:6px;
      border-radius:6px;
      cursor:pointer;
      color:#333;
    }
    .modal__close:focus{
      box-shadow:0 0 0 3px rgba(11,99,255,0.16);
    }
    .modal__body{
      margin-top:6px;
      font-size:15px;
      color:#2a2a2a;
      line-height:1.5;
    }
    .modal__footer{
      margin-top:18px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }

    .btn{
      padding:8px 12px;
      border-radius:6px;
      border:0;
      cursor:pointer;
      font-weight:600;
    }
    .btn--primary{ background:#0b63ff; color:#fff; }
    .btn--muted{ background:#f1f4f9; color:#222; }

    /* Lock scroll when modal open */
    .no-scroll{ overflow:hidden; }

    /* Small responsive tweaks */
    @media (max-width:520px){
      .modal__panel{ width: calc(100% - 32px); }
    }

    /* Demo page content */
    .card{
      background:white;
      padding:18px;
      border-radius:10px;
      box-shadow:0 6px 20px rgba(12,24,64,0.06);
      margin-bottom:14px;
    }
    a{ color:#0b63ff; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:20px">Modal Component Demo</h1>
  </header>

  <main id="page-content" aria-live="polite">
    <section class="card">
      <h2 style="margin-top:0">Example</h2>
      <p>This page demonstrates an accessible modal dialog. The open button uses the required <code>trigger</code> class.</p>
      <button class="trigger" type="button">Open Modal</button>
    </section>

    <section class="card">
      <h3>Background content</h3>
      <p>While the modal is open, this content is hidden from assistive technologies and visually inert.</p>
      <p><a href="#">Example link</a> — try tabbing through elements before and after opening the dialog.</p>
    </section>
  </main>

  <!-- Modal (closed by default) -->
  <div id="demo-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="modal__overlay" data-overlay></div>

    <div class="modal__panel" role="document" tabindex="-1">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Confirm Changes</h2>
        <button class="modal__close" aria-label="Close dialog">&times;</button>
      </div>

      <div id="modal-desc" class="modal__body">
        <p>Are you sure you want to apply these changes? This action cannot be undone. You can either confirm or cancel.</p>

        <form id="demo-form" style="margin-top:12px;">
          <label style="display:block;margin-bottom:8px;">
            <span style="display:block;font-weight:600;margin-bottom:6px;">Example option</span>
            <select>
              <option>Option A</option>
              <option>Option B</option>
            </select>
          </label>
        </form>
      </div>

      <div class="modal__footer">
        <button class="btn btn--muted modal__cancel">Cancel</button>
        <button class="btn btn--primary modal__confirm">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Elements
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const modal = document.getElementById('demo-modal');
      const overlay = modal.querySelector('[data-overlay]');
      const panel = modal.querySelector('.modal__panel');
      const closeBtns = Array.from(modal.querySelectorAll('.modal__close, .modal__cancel'));
      const confirmBtn = modal.querySelector('.modal__confirm');
      const pageContent = document.getElementById('page-content');

      let lastFocused = null;

      // Helper: get focusable elements inside the modal
      const FOCUSABLE_SELECTORS = [
        'a[href]:not([tabindex="-1"]):not([disabled])',
        'button:not([disabled])',
        'textarea:not([disabled])',
        'input[type="text"]:not([disabled])',
        'input[type="radio"]:not([disabled])',
        'input[type="checkbox"]:not([disabled])',
        'select:not([disabled])',
        '[tabindex]:not([tabindex="-1"])'
      ].join(', ');

      function getFocusableElements() {
        return Array.from(modal.querySelectorAll(FOCUSABLE_SELECTORS))
          .filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el.getClientRects().length);
      }

      function openModal(fromTrigger){
        if (modal.classList.contains('is-open')) return;
        lastFocused = fromTrigger || document.activeElement;
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
        pageContent.setAttribute('aria-hidden', 'true');

        // Use inert if available to make background truly inert to assistive tech and scripts
        try {
          if ('inert' in HTMLElement.prototype) {
            pageContent.inert = true;
          }
        } catch(e){ /* ignore */ }

        // Lock body scroll
        document.body.classList.add('no-scroll');

        // Focus the first focusable element, or panel fallback
        const focusables = getFocusableElements();
        const first = focusables.length ? focusables[0] : panel;
        // Delay focus slightly to allow CSS transitions to finish in some browsers
        window.setTimeout(() => first.focus(), 10);

        // Attach keydown listener for focus trap and Escape
        document.addEventListener('keydown', onKeyDown, true);
      }

      function closeModal(restoreFocus = true){
        if (!modal.classList.contains('is-open')) return;
        modal.classList.remove('is-open');
        modal.setAttribute('aria-hidden', 'true');
        pageContent.setAttribute('aria-hidden', 'false');

        try {
          if ('inert' in HTMLElement.prototype) {
            pageContent.inert = false;
          }
        } catch(e){ /* ignore */ }

        document.body.classList.remove('no-scroll');

        document.removeEventListener('keydown', onKeyDown, true);

        if (restoreFocus && lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function onKeyDown(e){
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal(true);
          return;
        }

        if (e.key === 'Tab') {
          // Focus trap
          const focusables = getFocusableElements();
          if (focusables.length === 0) {
            // Nothing to focus, keep focus on panel
            e.preventDefault();
            panel.focus();
            return;
          }
          const currentIndex = focusables.indexOf(document.activeElement);
          let nextIndex;
          if (e.shiftKey) {
            // backward
            if (currentIndex === -1 || currentIndex === 0) nextIndex = focusables.length - 1;
            else nextIndex = currentIndex - 1;
          } else {
            // forward
            if (currentIndex === -1 || currentIndex === focusables.length - 1) nextIndex = 0;
            else nextIndex = currentIndex + 1;
          }
          e.preventDefault();
          focusables[nextIndex].focus();
        }
      }

      // Bind triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          openModal(btn);
        });
      });

      // Overlay click closes modal
      overlay.addEventListener('click', () => closeModal(true));

      // Panel click should not close
      panel.addEventListener('click', (e) => e.stopPropagation());

      // Close buttons
      closeBtns.forEach(b => b.addEventListener('click', () => closeModal(true)));

      // Confirm example: perform an action then close
      confirmBtn.addEventListener('click', () => {
        // Example action: show a short message, then close
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Applying...';
        setTimeout(() => {
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Confirm';
          closeModal(true);
          // You could replace this with a real result handler
          alert('Changes applied (demo).');
        }, 800);
      });

      // Ensure focus is contained if modal loses focus unexpectedly (e.g. clicking browser chrome)
      window.addEventListener('focus', () => {
        if (modal.classList.contains('is-open')) {
          const focusables = getFocusableElements();
          const active = document.activeElement;
          if (!modal.contains(active)) {
            (focusables[0] || panel).focus();
          }
        }
      }, true);

      // Prevent accidental form submissions in demo form
      const demoForm = document.getElementById('demo-form');
      if (demoForm) demoForm.addEventListener('submit', (e) => e.preventDefault());

      // For progressive enhancement: if JavaScript is disabled, ensure modal remains hidden
      // (no extra handling needed here — modal is inert via aria-hidden by default)
    })();
  </script>
</body>
</html>