<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 540px;
      --gap: 16px;
      --z: 1000;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      line-height: 1.4;
      padding: 2rem;
      background: #f7f7fb;
      color: #111;
    }

    button, input {
      font: inherit;
    }

    /* Trigger button */
    .trigger {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: #2563eb;
      color: white;
      border: 0;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Main page content for demo */
    main {
      margin-top: 1rem;
      max-width: 60rem;
    }

    /* Modal base */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z);
      pointer-events: none;
    }

    /* Overlay layer */
    .modal__overlay {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      opacity: 0;
      transition: opacity 160ms ease;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    /* Dialog panel */
    .modal__dialog {
      background: var(--modal-bg);
      border-radius: var(--radius);
      width: min(92%, var(--max-width));
      max-height: 90vh;
      box-shadow: 0 10px 30px rgba(2,6,23,0.2);
      overflow: auto;
      transform: translateY(8px) scale(0.995);
      transition: transform 160ms ease, opacity 160ms ease;
      opacity: 0;
      pointer-events: auto;
      padding: 1rem;
      box-sizing: border-box;
    }

    .modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--gap);
      border-bottom: 1px solid #eee;
      padding-bottom: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .modal__title {
      font-size: 1.125rem;
      margin: 0;
    }

    .modal__close {
      background: transparent;
      border: 0;
      font-size: 1.5rem;
      line-height: 1;
      cursor: pointer;
      padding: 0.25rem;
      color: #666;
    }

    .modal__body {
      padding: 0.25rem 0;
    }

    .modal__footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
      border-top: 1px solid #eee;
      padding-top: 0.75rem;
    }

    .modal__button {
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: 0;
      cursor: pointer;
    }

    .modal__button.primary {
      background: #2563eb;
      color: #fff;
    }

    /* Visible state when aria-hidden is false */
    .modal[aria-hidden="false"] {
      pointer-events: auto;
    }

    .modal[aria-hidden="false"] .modal__overlay {
      opacity: 1;
    }

    .modal[aria-hidden="false"] .modal__dialog {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    /* When modal hidden, remove from accessibility and layout */
    .modal[aria-hidden="true"] {
      display: none;
    }

    /* Small utilities */
    .sr-only {
      position: absolute !important;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <button class="trigger" type="button">Open Modal</button>

  <main id="main-content">
    <h1>Page Content</h1>
    <p>This is some example page content behind the modal. When the modal opens, focus will move into it and keyboard navigation will be trapped inside the dialog. Press Escape or click outside the dialog to close it.</p>
    <p>Try tabbing through elements and opening the modal with the button that has class "trigger".</p>
  </main>

  <!-- Modal (closed by default) -->
  <div class="modal" id="demo-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal__overlay" data-overlay>
      <div class="modal__dialog" role="document">
        <header class="modal__header">
          <h2 id="modal-title" class="modal__title">Example Modal</h2>
          <button class="modal__close" type="button" aria-label="Close dialog">&times;</button>
        </header>
        <div class="modal__body">
          <p>Dialogs are a common pattern for getting user attention. This dialog demonstrates accessible behaviors: focus is trapped, Escape closes it, and focus returns to the trigger when closed.</p>
          <form>
            <label>
              Your name
              <input data-autofocus type="text" name="name" placeholder="Type your name" />
            </label>
            <p>
              <a href="https://example.com" target="_blank" rel="noopener">Example link</a>
            </p>
          </form>
        </div>
        <footer class="modal__footer">
          <button class="modal__button" type="button" data-close>Cancel</button>
          <button class="modal__button primary" type="button">Confirm</button>
        </footer>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('demo-modal');
      const overlay = modal.querySelector('[data-overlay]');
      const dialog = modal.querySelector('.modal__dialog');
      const closeButtons = modal.querySelectorAll('.modal__close, [data-close]');
      const triggers = document.querySelectorAll('.trigger');
      const main = document.getElementById('main-content');
      let lastFocused = null;

      // Utility: return focusable elements inside container
      function getFocusable(container = modal) {
        const selectors = [
          'a[href]:not([tabindex="-1"])',
          'area[href]',
          'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
          'select:not([disabled]):not([tabindex="-1"])',
          'textarea:not([disabled]):not([tabindex="-1"])',
          'button:not([disabled]):not([tabindex="-1"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(','))).filter(el => el.offsetWidth || el.offsetHeight || el.getClientRects().length);
      }

      function openModal(triggerEl = null) {
        lastFocused = triggerEl || document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        // hide main from assistive tech while modal open
        if (main) main.setAttribute('aria-hidden', 'true');
        // prevent body scroll
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';

        // pick initial focus
        const autofocus = modal.querySelector('[data-autofocus]');
        const focusables = getFocusable();
        const toFocus = autofocus || focusables[0] || dialog;
        // ensure focus after styles applied
        setTimeout(() => toFocus.focus(), 10);

        // attach key listener to trap keyboard
        document.addEventListener('keydown', handleKeyDown, true);
      }

      function closeModal() {
        modal.setAttribute('aria-hidden', 'true');
        if (main) main.removeAttribute('aria-hidden');
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
        document.removeEventListener('keydown', handleKeyDown, true);
        // restore focus
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function handleKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          // trap focus
          const focusables = getFocusable();
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Open on trigger click(s)
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          openModal(btn);
        });
      });

      // Close on close button(s)
      closeButtons.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          closeModal();
        });
      });

      // Close when clicking the overlay (but not when clicking inside the dialog)
      overlay.addEventListener('click', (ev) => {
        if (ev.target === overlay) {
          closeModal();
        }
      });

      // If focus somehow leaves the dialog, bring it back (extra safeguard)
      document.addEventListener('focus', (ev) => {
        if (modal.getAttribute('aria-hidden') === 'false') {
          if (!modal.contains(ev.target)) {
            const focusables = getFocusable();
            (focusables[0] || dialog).focus();
          }
        }
      }, true);

      // Expose for debugging (optional)
      window.__demoModal = {
        open: () => openModal(),
        close: closeModal
      };
    })();
  </script>
</body>
</html>