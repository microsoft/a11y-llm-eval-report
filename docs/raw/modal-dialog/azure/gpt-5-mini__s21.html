<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root {
      --bg: #fff;
      --overlay: rgba(0,0,0,0.6);
      --accent: #2563eb;
      --radius: 10px;
      --max-width: 520px;
      --gap: 1rem;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      padding: 2rem;
      line-height: 1.4;
      background: #f8fafc;
      color: #0f172a;
    }

    /* Trigger button */
    .trigger {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    .trigger:focus {
      outline: 3px solid rgba(37,99,235,0.25);
      outline-offset: 2px;
    }

    /* <dialog> styling */
    dialog.example {
      border: none;
      border-radius: var(--radius);
      padding: 0;
      width: min(var(--max-width), calc(100% - 2rem));
      box-shadow: 0 20px 40px rgba(2,6,23,0.25);
      background: var(--bg);
      color: inherit;
      max-width: var(--max-width);
    }

    dialog.example::backdrop {
      background: var(--overlay);
      backdrop-filter: blur(2px);
      animation: fadeIn 160ms ease;
    }

    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }

    .dialog-header {
      padding: 1rem 1rem 0.25rem 1rem;
      border-bottom: 1px solid rgba(15,23,42,0.06);
    }

    .dialog-body {
      padding: 1rem;
    }

    .dialog-footer {
      padding: 0.75rem 1rem 1rem 1rem;
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      border-top: 1px solid rgba(15,23,42,0.04);
    }

    .close-btn {
      background: #e5e7eb;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .close-btn:hover { filter: brightness(0.98) }
    .primary-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Polyfill overlay (used if <dialog> isn't supported) */
    .modal-polyfill-overlay {
      position: fixed;
      inset: 0;
      background: var(--overlay);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-polyfill-overlay.open {
      display: flex;
    }
    .modal-polyfill {
      background: var(--bg);
      border-radius: var(--radius);
      width: min(var(--max-width), calc(100% - 2rem));
      box-shadow: 0 20px 40px rgba(2,6,23,0.25);
      max-width: var(--max-width);
      outline: none;
    }

    /* Small responsive tweaks */
    @media (max-width: 480px) {
      .dialog-header, .dialog-body, .dialog-footer { padding-left: 0.75rem; padding-right: 0.75rem; }
      .dialog-header { padding-top: 0.75rem }
    }

  </style>
</head>
<body>
  <main>
    <h1>Modal Dialog Component</h1>
    <p>This demo shows a modal dialog component. The dialog is closed by default. Use the button below to open it.</p>

    <button class="trigger" id="openDialog" aria-haspopup="dialog" aria-controls="exampleDialog">
      Open modal
    </button>
  </main>

  <!-- Native <dialog> used when available -->
  <dialog id="exampleDialog" class="example" aria-labelledby="dialogTitle" aria-describedby="dialogDesc">
    <div class="dialog-header">
      <h2 id="dialogTitle" style="margin:0; font-size:1.125rem;">Subscribe to updates</h2>
    </div>

    <div class="dialog-body" id="dialogDesc">
      <p style="margin-top:0.4rem; margin-bottom:0.75rem;">Get occasional updates about new features and examples.</p>

      <form method="dialog" id="dialogForm" style="display:flex; flex-direction:column; gap:0.6rem;">
        <label style="font-size:0.9rem;">
          Email
          <input type="email" name="email" required placeholder="you@example.com" style="display:block; width:100%; padding:0.5rem; border-radius:8px; border:1px solid rgba(15,23,42,0.08);" />
        </label>

        <label style="font-size:0.9rem;">
          <input type="checkbox" name="agree" style="margin-right:0.35rem;" />
          I agree to receive emails.
        </label>
      </form>
    </div>

    <div class="dialog-footer">
      <button class="close-btn" data-close>Cancel</button>
      <button class="primary-btn" id="confirmBtn">Subscribe</button>
    </div>
  </dialog>

  <!-- Polyfill fallback (hidden by default) -->
  <div id="polyfillOverlay" class="modal-polyfill-overlay" aria-hidden="true">
    <div id="polyfillDialog" class="modal-polyfill" role="dialog" aria-modal="true" aria-labelledby="dialogTitle" aria-describedby="dialogDesc" tabindex="-1">
      <!-- Container content is cloned into this node when <dialog> isn't available -->
    </div>
  </div>

  <script>
    (function () {
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const dialog = document.getElementById('exampleDialog');
      const polyOverlay = document.getElementById('polyfillOverlay');
      const polyDialog = document.getElementById('polyfillDialog');

      // Utility: find focusable elements within a container
      function getFocusable(container) {
        const focusable = container.querySelectorAll('a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])');
        return Array.from(focusable);
      }

      // Remember the last focused element to return focus on close
      let lastFocused = null;

      // Focus trap handler
      function trapFocus(container, event) {
        if (event.key !== 'Tab') return;
        const nodes = getFocusable(container);
        if (nodes.length === 0) {
          event.preventDefault();
          return;
        }
        const first = nodes[0];
        const last = nodes[nodes.length - 1];
        if (event.shiftKey) {
          if (document.activeElement === first) {
            event.preventDefault();
            last.focus();
          }
        } else {
          if (document.activeElement === last) {
            event.preventDefault();
            first.focus();
          }
        }
      }

      // Close logic common to both implementations
      function closeModal(instanceType) {
        lastFocused = lastFocused || document.activeElement;
        if (instanceType === 'native') {
          if (dialog.open) dialog.close();
        } else {
          polyOverlay.classList.remove('open');
          polyOverlay.setAttribute('aria-hidden', 'true');
          document.body.style.overflow = '';
        }
        // return focus to the trigger if possible
        if (lastFocused) lastFocused.focus();
      }

      // Open logic common
      function openModal(triggerEl) {
        lastFocused = triggerEl || document.activeElement;
        if (typeof dialog.showModal === 'function') {
          try {
            dialog.showModal();
            // focus first focusable element or the dialog itself
            const focusables = getFocusable(dialog);
            (focusables[0] || dialog).focus();
          } catch (e) {
            // fallback to polyfill below if showModal fails
            openPolyfill(triggerEl);
          }
        } else {
          openPolyfill(triggerEl);
        }
      }

      // Polyfill open: clone the content of the <dialog> into the polyfill container
      function openPolyfill(triggerEl) {
        // copy content
        polyDialog.innerHTML = dialog.innerHTML;
        polyOverlay.classList.add('open');
        polyOverlay.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';

        // wire up buttons inside the polyfilled dialog
        const closeBtn = polyDialog.querySelector('[data-close]');
        if (closeBtn) closeBtn.addEventListener('click', () => closeModal('polyfill'));

        const confirmBtn = polyDialog.querySelector('#confirmBtn');
        if (confirmBtn) confirmBtn.addEventListener('click', () => {
          // Example action: just close
          closeModal('polyfill');
        });

        // close on backdrop click
        polyOverlay.addEventListener('click', (e) => {
          if (e.target === polyOverlay) closeModal('polyfill');
        }, { once: false });

        // trap focus
        polyDialog.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            e.preventDefault();
            closeModal('polyfill');
          } else {
            trapFocus(polyDialog, e);
          }
        });

        // focus first focusable
        setTimeout(() => {
          const focusables = getFocusable(polyDialog);
          (focusables[0] || polyDialog).focus();
        }, 0);
      }

      // Wire up triggers
      triggers.forEach(t => {
        t.addEventListener('click', (e) => {
          openModal(t);
        });
      });

      // Native dialog event handling (if supported)
      if (typeof dialog.showModal === 'function') {
        // close buttons inside dialog
        dialog.addEventListener('click', (e) => {
          // Close when clicking the backdrop (target === dialog)
          if (e.target === dialog) {
            closeModal('native');
          }
        });

        dialog.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            // close on Escape
            closeModal('native');
          } else {
            trapFocus(dialog, e);
          }
        });

        const nativeCloseButtons = dialog.querySelectorAll('[data-close]');
        nativeCloseButtons.forEach(btn => {
          btn.addEventListener('click', () => closeModal('native'));
        });

        const confirm = dialog.querySelector('#confirmBtn');
        if (confirm) {
          confirm.addEventListener('click', () => {
            // Example action: read form data then close
            const form = dialog.querySelector('form');
            if (form) {
              const formData = new FormData(form);
              // (In a real app you'd send formData; here we just close)
            }
            closeModal('native');
          });
        }
      } else {
        // If native dialog not supported, ensure the polyfill overlay has close handlers for keyboard
        polyOverlay.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeModal('polyfill');
        });
      }

      // Expose close to global for debugging (optional)
      window._exampleModal = {
        open: () => openModal(document.querySelector('.trigger')),
        close: () => {
          if (typeof dialog.showModal === 'function') closeModal('native');
          else closeModal('polyfill');
        }
      };
    })();
  </script>
</body>
</html>