<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --backdrop: rgba(0,0,0,.6);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 540px;
      --ease: cubic-bezier(.2,.8,.2,1);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      padding: 2rem;
      background: linear-gradient(180deg,#f8fafc,#eef2f7);
      color: #0f172a;
      min-height: 100vh;
    }

    /* Trigger button */
    .trigger{
      padding: .65rem 1rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      background: linear-gradient(#fff,#f8fafc);
      cursor: pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }

    /* Modal root hidden by default */
    .modal{
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      z-index: 1000;
      pointer-events: none;
    }

    .modal[aria-hidden="true"]{
      visibility: hidden;
    }

    .modal__backdrop{
      position: absolute;
      inset: 0;
      background: var(--backdrop);
      opacity: 0;
      transition: opacity 220ms var(--ease);
      backdrop-filter: blur(4px);
    }

    .modal__panel{
      position: relative;
      width: calc(100% - 2rem);
      max-width: var(--max-width);
      background: var(--modal-bg);
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(2,6,23,.18);
      transform: translateY(10px) scale(.99);
      opacity: 0;
      transition: transform 220ms var(--ease), opacity 220ms var(--ease);
      z-index: 2;
      pointer-events: auto;
      overflow: hidden;
    }

    .modal.is-open{
      pointer-events: auto;
    }

    .modal.is-open .modal__backdrop{
      opacity: 1;
    }

    .modal.is-open .modal__panel{
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal__header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1rem;
      border-bottom: 1px solid #eef2f7;
    }

    .modal__title{
      margin: 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: #0f172a;
    }

    .modal__close{
      border: none;
      background: transparent;
      font-size: 1.25rem;
      padding: .25rem;
      line-height: 1;
      cursor: pointer;
      color: #334155;
      border-radius: 6px;
    }
    .modal__close:focus{
      box-shadow: 0 0 0 3px rgba(59,130,246,.25);
      outline: none;
    }

    .modal__body{
      padding: 1rem;
      color: #334155;
      line-height: 1.5;
    }

    .modal__footer{
      padding: 0.75rem 1rem 1rem;
      display: flex;
      gap: .5rem;
      justify-content: flex-end;
      border-top: 1px solid #f1f5f9;
    }

    .btn{
      padding: .5rem .75rem;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      background: linear-gradient(#fff,#f8fafc);
      cursor: pointer;
    }

    .btn.primary{
      background: linear-gradient(180deg,#3b82f6,#2563eb);
      color: #fff;
      border-color: transparent;
    }

    /* For focus ring when keyboard is used */
    :focus{
      outline: none;
    }
    .focus-ring:focus{
      box-shadow: 0 0 0 3px rgba(59,130,246,.25);
      border-radius: 6px;
    }

    /* Small responsive tweaks */
    @media (max-width:480px){
      .modal__panel{
        width: calc(100% - 1.5rem);
      }
    }
  </style>
</head>
<body>
  <h1>Modal Dialog Example</h1>
  <p>Click the button to open the modal. The open button has the class "trigger".</p>

  <button class="trigger" aria-controls="example-modal" aria-haspopup="dialog">Open Modal</button>

  <!-- Modal (closed by default) -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <!-- Backdrop -->
    <div class="modal__backdrop" data-backdrop tabindex="-1"></div>

    <!-- Panel -->
    <div class="modal__panel" role="document" aria-describedby="modal-desc">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Example Modal</h2>
        <button class="modal__close focus-ring" aria-label="Close modal">&times;</button>
      </div>

      <div id="modal-desc" class="modal__body">
        <p>This is a simple accessible modal dialog. It supports keyboard focus trapping, closes when you press Escape, click outside, or use the close button. Focus is restored to the button that opened it.</p>

        <p>
          Try navigating with Tab. Focus is kept inside while open.
        </p>

        <label for="sample-input">Sample input:</label>
        <input id="sample-input" type="text" placeholder="Type something..." style="width:100%;padding:.5rem;border:1px solid #cbd5e1;border-radius:6px;margin-top:.5rem;">
      </div>

      <div class="modal__footer">
        <button class="btn" data-dismiss>Cancel</button>
        <button class="btn primary" data-action>Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const focusableSelector = 'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex]:not([tabindex="-1"]), [contenteditable]';
      const modal = document.getElementById('example-modal');
      if(!modal) return;

      let activeTrigger = null;
      let lastFocused = null;

      // Open modal function
      function openModal(trigger){
        activeTrigger = trigger || null;
        lastFocused = document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        modal.classList.add('is-open');

        // allow CSS transition to run before focusing
        requestAnimationFrame(() => {
          trapFocus();
        });

        document.addEventListener('keydown', handleKeyDown);
        modal.addEventListener('click', handleBackdropClick);
      }

      // Close modal function
      function closeModal(returnFocus = true){
        modal.setAttribute('aria-hidden', 'true');
        modal.classList.remove('is-open');

        document.removeEventListener('keydown', handleKeyDown);
        modal.removeEventListener('click', handleBackdropClick);

        if(returnFocus && activeTrigger instanceof HTMLElement){
          activeTrigger.focus();
        } else if(returnFocus && lastFocused instanceof HTMLElement){
          lastFocused.focus();
        }
        activeTrigger = null;
      }

      // Keyboard handling
      function handleKeyDown(e){
        if(e.key === 'Escape' || e.key === 'Esc'){
          e.preventDefault();
          closeModal(true);
          return;
        }
        if(e.key === 'Tab'){
          maintainFocus(e);
        }
      }

      // Click outside to close
      function handleBackdropClick(e){
        // click on backdrop element or outside panel
        const panel = modal.querySelector('.modal__panel');
        if(!panel) return;
        if(!panel.contains(e.target)){
          closeModal(true);
        }
      }

      // Focus trap: find first/last focusable and wrap Tab
      function maintainFocus(e){
        const focusables = Array.from(modal.querySelectorAll(focusableSelector)).filter(el => el.offsetParent !== null);
        if(focusables.length === 0){
          e.preventDefault();
          return;
        }
        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        const active = document.activeElement;

        if(e.shiftKey){
          if(active === first || modal === active){
            e.preventDefault();
            last.focus();
          }
        } else {
          if(active === last){
            e.preventDefault();
            first.focus();
          }
        }
      }

      // On open, focus the first focusable element in the modal
      function trapFocus(){
        const focusables = Array.from(modal.querySelectorAll(focusableSelector)).filter(el => el.offsetParent !== null);
        const toFocus = focusables.length ? focusables[0] : modal.querySelector('.modal__panel') || modal;
        toFocus.focus();
      }

      // Wire triggers with class "trigger"
      document.querySelectorAll('.trigger').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const controls = btn.getAttribute('aria-controls');
          if(controls && document.getElementById(controls) === modal){
            openModal(btn);
          } else if(!controls){
            // fallback: open the modal we have
            openModal(btn);
          }
        });
      });

      // Close buttons and dismiss elements
      modal.querySelectorAll('[data-dismiss], .modal__close').forEach(btn => {
        btn.addEventListener('click', () => closeModal(true));
      });

      // Example of an action button that closes the modal after doing something
      modal.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          // Example action: you could perform async work here
          // After action, close modal and restore focus
          closeModal(true);
        });
      });

      // Ensure focus is contained if the user clicks inside the modal panel but not on a focusable element
      modal.addEventListener('focusin', (e) => {
        if(modal.getAttribute('aria-hidden') === 'true') return;
        const panel = modal.querySelector('.modal__panel');
        if(panel && !panel.contains(e.target)){
          trapFocus();
        }
      });

      // Make backdrop non-focusable but dismissible with click - already handled
      // Prevent focus from escaping by mouse down on the background
      modal.addEventListener('mousedown', (e) => {
        const panel = modal.querySelector('.modal__panel');
        if(panel && !panel.contains(e.target)){
          // Let the click handler close on mouseup/click; ensure focus doesn't jump
          e.preventDefault();
        }
      });

      // Accessibility: hide content outside modal from screen readers while open (simple approach)
      // This implementation toggles inertness by setting aria-hidden on siblings.
      function setSiblingsAriaHidden(hide){
        const parent = document.body;
        Array.from(parent.children).forEach(child => {
          if(child === modal) return;
          if(hide){
            child.setAttribute('aria-hidden', 'true');
          } else {
            child.removeAttribute('aria-hidden');
          }
        });
      }

      // Observe modal open/close to toggle siblings' aria-hidden
      const observer = new MutationObserver((mutations) => {
        mutations.forEach(m => {
          if(m.attributeName === 'aria-hidden'){
            const hidden = modal.getAttribute('aria-hidden') === 'true';
            setSiblingsAriaHidden(!hidden);
          }
        });
      });
      observer.observe(modal, { attributes: true });

      // Ensure initial state is closed
      modal.setAttribute('aria-hidden', 'true');
      modal.tabIndex = -1;
    })();
  </script>
</body>
</html>