<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root {
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-width: 520px;
      --modal-radius: 8px;
      --transition: 180ms cubic-bezier(.2,.9,.3,1);
      --focus-ring: 3px solid rgba(59,130,246,0.4);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      background: linear-gradient(180deg,#f7fafc,#ffffff);
      color: #0f172a;
    }

    /* Trigger button */
    .trigger {
      background: #0ea5e9;
      color: white;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(14,165,233,0.18);
    }
    .trigger:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    /* Modal base */
    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      z-index: 9999;
      /* hidden by default */
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
    }
    .modal[aria-hidden="false"] {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }

    /* Overlay */
    .modal__overlay {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      opacity: 0;
      transition: opacity var(--transition);
      will-change: opacity;
    }
    .modal[aria-hidden="false"] .modal__overlay {
      opacity: 1;
    }

    /* Dialog panel */
    .modal__panel {
      position: relative;
      width: min(92vw, var(--modal-width));
      background: #fff;
      border-radius: var(--modal-radius);
      box-shadow: 0 20px 50px rgba(2,6,23,0.2);
      transform: translateY(10px) scale(.98);
      opacity: 0;
      transition: transform var(--transition), opacity var(--transition);
      z-index: 1;
      padding: 20px 20px 18px 20px;
      max-height: 80vh;
      overflow: auto;
    }
    .modal[aria-hidden="false"] .modal__panel {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }
    .modal__title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .modal__close {
      background: transparent;
      border: 0;
      font-size: 18px;
      padding: 6px;
      border-radius: 6px;
      cursor: pointer;
    }
    .modal__close:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .modal__body {
      font-size: 15px;
      color: #374151;
      line-height: 1.45;
      margin-top: 8px;
    }

    .modal__footer {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 18px;
    }
    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      font-size: 14px;
    }
    .btn--primary {
      background: #0ea5e9;
      color: white;
    }
    .btn--muted {
      background: #f1f5f9;
      color: #0f172a;
    }

    /* Visually hidden helper */
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0 0 0 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    /* Small responsive tweak */
    @media (max-width:480px) {
      .modal__panel {
        border-radius: 12px;
        padding: 16px;
      }
      .modal__title { font-size: 16px; }
    }
  </style>
</head>
<body>
  <main id="page-main">
    <h1 style="margin-bottom:12px;">Example page</h1>
    <p style="margin-bottom:18px;max-width:46ch">This demonstrates a small accessible modal dialog component. The button below opens the modal. The opener has the class "trigger".</p>
    <button class="trigger" data-target="#exampleModal" type="button">Open Modal</button>
  </main>

  <!-- Modal (closed by default) -->
  <div class="modal" id="exampleModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="modal__overlay" data-close="overlay" tabindex="-1"></div>

    <div class="modal__panel" role="document">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Subscribe to updates</h2>
        <button class="modal__close" aria-label="Close modal" data-close="button">&times;</button>
      </div>

      <div class="modal__body" id="modal-desc">
        <p>Join our mailing list to receive occasional updates and curated content. You can unsubscribe at any time.</p>

        <form id="subscribeForm" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
          <label for="email" class="visually-hidden">Email</label>
          <input id="email" name="email" type="email" placeholder="your@email.com" required
                 style="flex:1 1 220px;padding:10px;border-radius:8px;border:1px solid #e2e8f0;" />
          <button class="btn btn--primary" type="submit">Subscribe</button>
        </form>
      </div>

      <div class="modal__footer" role="group" aria-label="Dialog actions">
        <button class="btn btn--muted" data-close="button" type="button">Cancel</button>
        <button class="btn btn--primary" type="button" id="saveBtn">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Utilities
      function q(selector, context=document) { return context.querySelector(selector); }
      function qa(selector, context=document) { return Array.from(context.querySelectorAll(selector)); }
      function isVisible(el) {
        return el && el.getAttribute('aria-hidden') === 'false';
      }

      // Focusable selectors
      var focusableSelectors = [
        'a[href]:not([tabindex="-1"])',
        'button:not([disabled]):not([tabindex="-1"])',
        'textarea:not([disabled]):not([tabindex="-1"])',
        'input:not([type="hidden"]):not([disabled]):not([tabindex="-1"])',
        'select:not([disabled]):not([tabindex="-1"])',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      var lastActiveTrigger = null;

      // Open/close modal logic
      function openModal(modal, triggerEl) {
        if (!modal) return;
        lastActiveTrigger = triggerEl || document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        document.getElementById('page-main').setAttribute('aria-hidden', 'true');
        // prevent background scroll
        document.body.style.overflow = 'hidden';

        // set focus to first focusable element
        var focusables = qa(focusableSelectors, modal);
        var toFocus = focusables.length ? focusables[0] : q('.modal__panel', modal);
        toFocus.focus();
        // attach listeners
        document.addEventListener('keydown', handleKeydown);
        // remember for focus trap
      }

      function closeModal(modal) {
        if (!modal) return;
        modal.setAttribute('aria-hidden', 'true');
        document.getElementById('page-main').removeAttribute('aria-hidden');
        document.body.style.overflow = '';
        // restore focus to trigger
        if (lastActiveTrigger && typeof lastActiveTrigger.focus === 'function') {
          lastActiveTrigger.focus();
        }
        lastActiveTrigger = null;
        document.removeEventListener('keydown', handleKeydown);
      }

      // Handle global keydown when modal open (Escape + Tab focus trap)
      function handleKeydown(e) {
        var modal = q('.modal[aria-hidden="false"]');
        if (!modal) return;
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal(modal);
          return;
        }
        if (e.key === 'Tab') {
          // focus trap
          var focusables = qa(focusableSelectors, modal).filter(function(el){ return el.offsetParent !== null || el === document.activeElement; });
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          var currentIndex = focusables.indexOf(document.activeElement);
          var nextIndex = currentIndex;
          if (e.shiftKey) {
            nextIndex = (currentIndex <= 0) ? focusables.length - 1 : currentIndex - 1;
          } else {
            nextIndex = (currentIndex === focusables.length - 1) ? 0 : currentIndex + 1;
          }
          e.preventDefault();
          focusables[nextIndex].focus();
        }
      }

      // Attach trigger handlers (any element with .trigger)
      qa('.trigger').forEach(function(btn){
        btn.addEventListener('click', function (ev) {
          var target = btn.getAttribute('data-target') || '#exampleModal';
          var modal = document.querySelector(target);
          if (modal) openModal(modal, btn);
        });
      });

      // Close handlers (buttons and overlay)
      qa('[data-close]').forEach(function(el){
        el.addEventListener('click', function (ev) {
          var modal = el.closest('.modal');
          if (!modal) return;
          closeModal(modal);
        });
      });

      // Click outside dialog panel closes modal (if click is on overlay)
      qa('.modal__overlay').forEach(function(overlay){
        overlay.addEventListener('click', function (ev) {
          var modal = overlay.closest('.modal');
          if (!modal) return;
          closeModal(modal);
        });
      });

      // Example: the Save button just closes the modal and demonstrates action
      q('#saveBtn').addEventListener('click', function () {
        var modal = q('.modal[aria-hidden="false"]');
        // do any action here (e.g., save)
        // For demo: close
        closeModal(modal);
        // small accessible announcement
        // (In real apps, use polite live region updates)
      });

      // Prevent form submit from reloading the page; simulate async action then close.
      q('#subscribeForm').addEventListener('submit', function (ev) {
        ev.preventDefault();
        var modal = q('.modal[aria-hidden="false"]');
        // simple feedback
        q('#saveBtn').textContent = 'Saved';
        setTimeout(function(){
          closeModal(modal);
          q('#saveBtn').textContent = 'Save';
        }, 700);
      });

      // Ensure modal starts closed (explicit)
      var initialModal = q('#exampleModal');
      if (initialModal) initialModal.setAttribute('aria-hidden','true');
    })();
  </script>
</body>
</html>