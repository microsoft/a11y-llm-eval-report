<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 520px;
      --padding: 20px;
      --transition: 180ms cubic-bezier(.2,.9,.3,1);
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin:0;
      padding:20px;
      line-height:1.4;
      color:#111;
      background: linear-gradient(180deg,#f7f9fb,#fff);
      min-height:100vh;
    }

    /* Trigger button */
    .trigger{
      display:inline-block;
      padding:10px 16px;
      background:#0b76ef;
      color:#fff;
      border:none;
      border-radius:6px;
      font-weight:600;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(11,118,239,0.18);
    }
    .trigger:focus{
      outline:3px solid rgba(11,118,239,0.18);
      outline-offset:2px;
    }

    /* Modal base (hidden by default) */
    .modal{
      position:fixed;
      inset:0;
      display:none; /* closed by default */
      align-items:center;
      justify-content:center;
      z-index:1000;
    }
    .modal.open{
      display:flex;
    }

    /* Overlay */
    .modal__overlay{
      position:absolute;
      inset:0;
      background:var(--overlay-bg);
      opacity:0;
      transition:opacity var(--transition);
      will-change:opacity;
    }
    .modal.open .modal__overlay{
      opacity:1;
    }

    /* Dialog panel */
    .modal__panel{
      position:relative;
      z-index:1;
      width:clamp(300px, 90%, var(--max-width));
      max-height:85vh;
      overflow:auto;
      background:var(--modal-bg);
      border-radius:var(--radius);
      padding:var(--padding);
      box-shadow: 0 20px 50px rgba(2,6,23,0.16);
      transform:translateY(12px) scale(.995);
      opacity:0;
      transition:transform var(--transition), opacity var(--transition);
      will-change:transform, opacity;
    }
    .modal.open .modal__panel{
      transform:translateY(0) scale(1);
      opacity:1;
    }

    .modal__header{
      display:flex;
      align-items:start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .modal__title{
      margin:0;
      font-size:1.1rem;
      font-weight:700;
      color:#081229;
    }
    .modal__close{
      background:transparent;
      border:none;
      padding:6px;
      margin:-6px;
      border-radius:6px;
      cursor:pointer;
      color:#6b7280;
      font-size:16px;
    }
    .modal__close:focus{
      outline:3px solid rgba(11,118,239,0.18);
      outline-offset:2px;
    }

    .modal__body{
      margin-bottom:16px;
      color:#213547;
      font-size:0.98rem;
    }

    .modal__actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    .btn{
      padding:8px 12px;
      border-radius:6px;
      border:1px solid transparent;
      cursor:pointer;
      background:#eef2ff;
      color:#0b3b8a;
      font-weight:600;
    }
    .btn.primary{
      background:#0b76ef;
      color:#fff;
      box-shadow: 0 8px 16px rgba(11,118,239,0.12);
    }

    /* Small utility for focus-visible simulation on mouse users */
    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }

    /* Prevent body scroll when modal open */
    body.modal-open{
      overflow:hidden;
    }
  </style>
</head>
<body>
  <h1>Modal Dialog Example</h1>
  <p>This example demonstrates an accessible modal dialog. The modal is closed by default. Click the button to open it.</p>

  <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">Open Modal</button>

  <!-- Modal (closed by default) -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal__overlay" data-close-overlay tabindex="-1"></div>

    <div class="modal__panel" role="document">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Example Modal</h2>
        <button class="modal__close" aria-label="Close dialog" title="Close dialog">&times;</button>
      </div>

      <div class="modal__body">
        <p>This is an example modal dialog. It traps focus while open, can be closed by pressing Escape, clicking outside the dialog, or using the close button. Focus returns to the trigger when the dialog closes.</p>
        <label>
          Example input:
          <input type="text" name="example" placeholder="Type something..." />
        </label>
      </div>

      <div class="modal__actions">
        <button class="btn" type="button">Secondary</button>
        <button class="btn primary" type="button">Primary action</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const modal = document.getElementById('example-modal');
      const overlay = modal.querySelector('.modal__overlay');
      const panel = modal.querySelector('.modal__panel');
      const closeBtn = modal.querySelector('.modal__close');
      const triggers = document.querySelectorAll('.trigger');
      let lastFocused = null;

      // Utility: find focusable elements inside modal
      function getFocusable(container){
        const selectors = [
          'a[href]',
          'area[href]',
          'input:not([disabled]):not([type="hidden"])',
          'select:not([disabled])',
          'textarea:not([disabled])',
          'button:not([disabled])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(container.querySelectorAll(selectors.join(',')))
                    .filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal(triggerEl){
        if (modal.classList.contains('open')) return;
        lastFocused = triggerEl || document.activeElement;
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.classList.add('modal-open');

        // Focus the first focusable element inside the modal, or the close button
        const focusables = getFocusable(panel);
        const toFocus = focusables.length ? focusables[0] : closeBtn;
        toFocus.focus({preventScroll: true});

        // Add event listeners
        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal(){
        if (!modal.classList.contains('open')) return;
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        document.body.classList.remove('modal-open');
        document.removeEventListener('keydown', onKeyDown);

        // Return focus to last focused element if possible
        try {
          if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
        } catch(e){}
      }

      function onKeyDown(e){
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trap
          const focusables = getFocusable(panel);
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length -1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === panel) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Open modal when any trigger is clicked
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          openModal(ev.currentTarget);
        });
      });

      // Close interactions
      closeBtn.addEventListener('click', closeModal);

      overlay.addEventListener('click', (ev) => {
        // Only close when clicking the overlay itself
        if (ev.target === overlay) closeModal();
      });

      // Close if the user tabs out of the modal and lands on overlay (some screen reader behaviours)
      overlay.addEventListener('focus', () => {
        const focusables = getFocusable(panel);
        if (focusables.length) focusables[0].focus();
      });

      // Prevent focus from escaping by clicking outside panel (mousedown on overlay)
      overlay.addEventListener('mousedown', (ev) => {
        // keep focus inside until click ends; allow overlay click to trigger close via click listener above
        ev.preventDefault();
      });

      // In case user changes viewport or other, ensure modal stays accessible
      window.addEventListener('resize', () => {
        if (modal.classList.contains('open')) {
          // ensure panel isn't offscreen
          panel.scrollIntoView({block:'center'});
        }
      });

      // Ensure initial state: closed
      modal.setAttribute('aria-hidden','true');
      modal.classList.remove('open');
    })();
  </script>
</body>
</html>