<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Dialog Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --max-width: 680px;
      --radius: 8px;
      --spacing: 18px;
      --focus-ring: 3px rgba(21,156,228,0.45);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      background: linear-gradient(180deg,#f7fbff,#eef6ff);
      color: #0b1220;
    }

    main.app {
      width: 100%;
      max-width: 900px;
      text-align: center;
    }

    .trigger{
      padding: 12px 18px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid rgba(11,18,32,0.08);
      background: linear-gradient(#fff,#f7fbff);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(16,24,40,0.06);
    }
    .trigger:focus{
      outline: none;
      box-shadow: 0 0 0 var(--focus-ring);
      border-color: #159ce4;
    }

    /* Modal overlay */
    .modal-overlay{
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: var(--overlay-bg);
      z-index: 1000;
      padding: 24px;
      animation: fadeIn 160ms ease-out;
    }
    .modal-overlay[hidden]{
      display: none;
    }

    @keyframes fadeIn{
      from{opacity:0}
      to{opacity:1}
    }

    .modal {
      width: 100%;
      max-width: var(--max-width);
      background: var(--modal-bg);
      border-radius: var(--radius);
      box-shadow: 0 12px 32px rgba(8, 15, 30, 0.28);
      padding: 18px;
      transform-origin: center;
      animation: popIn 180ms cubic-bezier(.2,.9,.2,1);
    }
    @keyframes popIn{
      from{opacity:0; transform: translateY(8px) scale(.995)}
      to{opacity:1; transform: translateY(0) scale(1)}
    }

    .modal header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }
    .modal h2{
      margin: 0;
      font-size: 20px;
      line-height: 1.15;
    }
    .close {
      background: transparent;
      border: none;
      padding: 8px;
      margin: -8px;
      border-radius: 6px;
      cursor: pointer;
      color: #334155;
    }
    .close:focus{
      outline: none;
      box-shadow: 0 0 0 var(--focus-ring);
    }

    .modal .body{
      margin-top: 14px;
      text-align: left;
      font-size: 15px;
      color: #122028;
    }
    .modal .actions{
      margin-top: 20px;
      text-align: right;
      display:flex;
      gap: 8px;
      justify-content: flex-end;
    }
    .btn{
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(11,18,32,0.08);
      background: white;
      cursor: pointer;
    }
    .btn.primary{
      background: linear-gradient(180deg,#0ea5e9,#0576b6);
      color: #fff;
      border: none;
    }
    .btn:focus{
      outline: none;
      box-shadow: 0 0 0 var(--focus-ring);
    }

    /* For demo layout under modal */
    .demo-grid{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr 1fr;
      margin-top: 28px;
      align-items:center;
    }
    .card{
      background:white;
      border-radius:10px;
      padding: 14px;
      text-align:left;
      box-shadow: 0 6px 12px rgba(11,18,32,0.04);
    }

    /* small screen */
    @media (max-width:520px){
      .demo-grid{
        grid-template-columns: 1fr;
      }
      .modal{
        max-width: 96%;
      }
    }
  </style>
</head>
<body>
  <main class="app" id="app">
    <h1>Modal Dialog Example</h1>
    <p>This example demonstrates an accessible modal dialog. The open button has the class "trigger".</p>

    <button type="button" class="trigger" id="openDialog">Open Dialog</button>

    <div class="demo-grid" aria-hidden="false">
      <div class="card">
        <h3>Page Content A</h3>
        <p>Some interactive controls to show focus trapping when the modal is open.</p>
        <input placeholder="Name" />
      </div>
      <div class="card">
        <h3>Page Content B</h3>
        <p>More elements on the page.</p>
        <a href="#">A sample link</a>
      </div>
    </div>
  </main>

  <!-- Modal overlay (closed by default via hidden attribute) -->
  <div class="modal-overlay" id="modalOverlay" role="presentation" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="dialogTitle" aria-describedby="dialogDesc" id="dialog" tabindex="-1">
      <header>
        <h2 id="dialogTitle">Confirm action</h2>
        <button class="close" id="closeBtn" aria-label="Close dialog">&times;</button>
      </header>
      <div class="body" id="dialogDesc">
        <p>Are you sure you want to proceed with this action? This dialog traps focus while open and can be closed by the Close button, pressing Escape, or clicking outside the dialog content.</p>
        <label for="reason">Reason (optional)</label>
        <input id="reason" type="text" placeholder="Type a reason..." style="width:100%; margin-top:6px; padding:8px; border-radius:6px; border:1px solid rgba(11,18,32,0.08)" />
      </div>

      <div class="actions" role="toolbar" aria-label="Dialog actions">
        <button class="btn" id="cancelBtn">Cancel</button>
        <button class="btn primary" id="confirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const modalOverlay = document.getElementById('modalOverlay');
      const dialog = document.getElementById('dialog');
      const openTriggers = document.querySelectorAll('.trigger');
      const closeBtn = document.getElementById('closeBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const appRoot = document.getElementById('app');

      let lastFocusedTrigger = null;

      // Utility: focusable selectors inside the dialog
      const FOCUSABLE_SELECTORS = [
        'a[href]:not([tabindex="-1"])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"]):not([tabindex="-1"])',
        'select:not([disabled]):not([tabindex="-1"])',
        'textarea:not([disabled]):not([tabindex="-1"])',
        'button:not([disabled]):not([tabindex="-1"])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      function getFocusableElements(container){
        return Array.from(container.querySelectorAll(FOCUSABLE_SELECTORS))
          .filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal(triggerEl){
        lastFocusedTrigger = triggerEl || document.activeElement;
        // Show overlay
        modalOverlay.hidden = false;
        // Make other content inert-like: set aria-hidden for screen readers
        appRoot.setAttribute('aria-hidden','true');

        // Put focus into dialog
        // Wait a frame to ensure elements are visible
        requestAnimationFrame(() => {
          // Focus the first focusable element, or the dialog container as fallback
          const focusables = getFocusableElements(dialog);
          if (focusables.length) {
            focusables[0].focus();
          } else {
            dialog.focus();
          }
        });

        // Add listeners
        document.addEventListener('keydown', onKeyDown, true);
        modalOverlay.addEventListener('click', onOverlayClick);
      }

      function closeModal(){
        modalOverlay.hidden = true;
        // restore aria-hidden
        appRoot.removeAttribute('aria-hidden');

        // Remove listeners
        document.removeEventListener('keydown', onKeyDown, true);
        modalOverlay.removeEventListener('click', onOverlayClick);

        // Return focus to trigger that opened the dialog
        try {
          if (lastFocusedTrigger && typeof lastFocusedTrigger.focus === 'function') {
            lastFocusedTrigger.focus();
          }
        } finally {
          lastFocusedTrigger = null;
        }
      }

      function onOverlayClick(e){
        // Close only when clicking outside the modal content
        if (e.target === modalOverlay) {
          closeModal();
        }
      }

      function onKeyDown(e){
        // Close on Escape
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }

        // Focus trap
        if (e.key === 'Tab') {
          const focusables = getFocusableElements(dialog);
          if (focusables.length === 0) {
            // Nothing to tab to; keep focus on dialog
            e.preventDefault();
            dialog.focus();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          const active = document.activeElement;

          if (e.shiftKey) {
            // shift+tab
            if (active === first || active === dialog) {
              e.preventDefault();
              last.focus();
            }
          } else {
            // tab
            if (active === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Attach open handlers to any element with class "trigger"
      openTriggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openModal(btn);
        });
      });

      // Close controls
      closeBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);

      // Confirm action demonstrates you can interact with dialog then close
      document.getElementById('confirmBtn').addEventListener('click', function(){
        alert('Confirmed!');
        closeModal();
      });

      // Ensure focus styles for keyboard users but not when clicking
      (function manageFocusOutline(){
        let mouseDown = false;
        document.addEventListener('mousedown', () => { mouseDown = true; }, true);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Tab') mouseDown = false;
        }, true);

        document.addEventListener('focusin', (e) => {
          const el = e.target;
          if (mouseDown) return;
          if (el && el.style) {
            // rely on :focus styles defined in CSS; nothing extra needed here
          }
        }, true);
      })();

      // Optional: close modal when page visibility changes or user navigates away
      window.addEventListener('beforeunload', () => {
        if (!modalOverlay.hidden) {
          // clean up
          closeModal();
        }
      });
    })();
  </script>
</body>
</html>