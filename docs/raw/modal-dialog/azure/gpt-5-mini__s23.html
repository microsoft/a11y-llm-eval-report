<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-width: 520px;
      --radius: 8px;
      --max-width: calc(100% - 48px);
      --gap: 16px;
      --bg: #fff;
      --focus: 3px solid #4c9aff;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f4f6f8;
      color:#111;
    }
    .page {
      padding: 32px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Trigger */
    .trigger {
      background: linear-gradient(180deg,#007bff,#005ecb);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .trigger:focus { outline: none; box-shadow: var(--focus); }

    /* Modal base */
    .modal {
      position: fixed;
      inset: 0;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      z-index: 1000;
      /* make keyboard focus reachable on container if needed */
    }
    .modal[aria-hidden="false"] {
      display: flex;
    }

    /* Overlay */
    .modal__overlay {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      backdrop-filter: blur(2px);
      opacity: 0;
      transition: opacity 180ms ease;
    }
    .modal[aria-hidden="false"] .modal__overlay {
      opacity: 1;
    }

    /* Dialog */
    .modal__dialog {
      position: relative;
      background: var(--bg);
      width: var(--modal-width);
      max-width: var(--max-width);
      margin: 20px;
      border-radius: var(--radius);
      box-shadow: 0 12px 32px rgba(2,10,24,0.24);
      transform: translateY(8px) scale(.995);
      opacity: 0;
      transition: opacity 200ms ease, transform 200ms ease;
      z-index: 1;
      max-height: calc(100vh - 64px);
      overflow: auto;
    }
    .modal[aria-hidden="false"] .modal__dialog{
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 18px 20px;
      border-bottom: 1px solid #eef2f6;
    }
    .modal__title{
      margin:0;
      font-size:18px;
      font-weight:600;
    }
    .modal__close{
      background:transparent;
      border:none;
      padding:6px;
      border-radius:6px;
      cursor:pointer;
      color:#333;
    }
    .modal__close:focus { outline: none; box-shadow: var(--focus); }
    .modal__body{
      padding: 18px 20px;
      font-size:15px;
      line-height:1.45;
    }
    .modal__footer{
      display:flex;
      gap:12px;
      padding: 14px 20px 20px 20px;
      justify-content:flex-end;
      border-top: 1px solid #f1f4f8;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor:pointer;
      background: #e9eef7;
    }
    .btn.primary {
      background: linear-gradient(180deg,#007bff,#005ecb);
      color:white;
      border:none;
    }
    .btn:focus { outline:none; box-shadow: var(--focus); }

    /* Small helper for content behind modal */
    .dimmed {
      transition: filter 160ms ease;
    }
    .dimmed.dimmed--inactive {
      filter: blur(2px) brightness(.9);
    }

    /* Responsive */
    @media (max-width:560px){
      .modal__dialog { width: 100%; margin: 12px; border-radius: 12px; }
    }
  </style>
</head>
<body>
  <div id="page" class="page dimmed" aria-hidden="false">
    <h1>Page content</h1>
    <p>
      This is an example page showing a modal dialog component. The dialog is closed by default.
    </p>

    <p>
      <button class="trigger" id="open-modal">Open modal</button>
    </p>

    <p>
      Some more content behind the modal. Try tabbing through, and then open the modal — keyboard focus will be constrained inside the dialog.
    </p>

    <a href="#">A sample link</a> · <a href="#">Another link</a>

  </div>

  <!-- Modal -->
  <div class="modal" id="example-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
    <div class="modal__overlay" data-action="close"></div>

    <div class="modal__dialog" role="document">
      <header class="modal__header">
        <h2 id="modal-title" class="modal__title">Example modal dialog</h2>
        <button class="modal__close" aria-label="Close modal" data-action="close">
          <!-- simple X -->
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12l-4.89 4.89a1 1 0 1 0 1.41 1.41L12 13.41l4.89 4.89a1 1 0 0 0 1.41-1.41L13.41 12l4.89-4.89a1 1 0 0 0 .0-1.4z"/>
          </svg>
        </button>
      </header>

      <section class="modal__body">
        <p>
          This modal demonstrates accessible behaviors:
        </p>
        <ul>
          <li>Opens with the button that has the class "trigger".</li>
          <li>Traps keyboard focus while open (Tab / Shift+Tab).</li>
          <li>Closes on Escape, on overlay click, or by pressing the close button.</li>
          <li>Restores focus to the trigger when it closes.</li>
        </ul>
        <p>
          Focusable elements inside: <a href="#">a link</a>, <button class="btn">a neutral button</button>
        </p>
      </section>

      <footer class="modal__footer">
        <button class="btn" data-action="close">Cancel</button>
        <button class="btn primary" id="confirm-action">Confirm</button>
      </footer>
    </div>
  </div>

  <script>
    (function(){
      const modal = document.getElementById('example-modal');
      const page = document.getElementById('page');
      const triggerSelector = '.trigger';
      const triggers = Array.from(document.querySelectorAll(triggerSelector));
      const overlay = modal.querySelector('.modal__overlay');
      const closeElements = Array.from(modal.querySelectorAll('[data-action="close"]'));
      let lastFocused = null;

      // Focusable selector
      const FOCUSABLE_SELECTORS = [
        'a[href]:not([tabindex^="-"])',
        'area[href]',
        'input:not([disabled]):not([type="hidden"]):not([tabindex^="-"])',
        'select:not([disabled]):not([tabindex^="-"])',
        'textarea:not([disabled]):not([tabindex^="-"])',
        'button:not([disabled]):not([tabindex^="-"])',
        'iframe',
        'object',
        'embed',
        '[contenteditable]',
        '[tabindex]:not([tabindex^="-"])'
      ].join(',');

      function getFocusableElements(container){
        return Array.from(container.querySelectorAll(FOCUSABLE_SELECTORS)).filter(el => el.offsetParent !== null || el.tabIndex >= 0);
      }

      function openModal(opener){
        if (modal.getAttribute('aria-hidden') === 'false') return;
        lastFocused = opener || document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        page.setAttribute('aria-hidden', 'true');
        page.classList.add('dimmed--inactive');
        document.body.style.overflow = 'hidden';

        // If browser supports inert, apply to page for additional safety
        if ('inert' in HTMLElement.prototype) {
          page.inert = true;
        }

        // Move focus to first focusable inside modal or dialog container
        const focusable = getFocusableElements(modal);
        if (focusable.length) {
          focusable[0].focus();
        } else {
          // fallback to dialog
          const dialog = modal.querySelector('.modal__dialog');
          if (dialog) dialog.focus();
        }

        // Track keydown for Escape + focus trap
        document.addEventListener('keydown', handleKeyDown);
        // clicking outside handled via overlay and close buttons
      }

      function closeModal(){
        if (modal.getAttribute('aria-hidden') === 'true') return;
        modal.setAttribute('aria-hidden', 'true');
        page.setAttribute('aria-hidden', 'false');
        page.classList.remove('dimmed--inactive');
        document.body.style.overflow = '';

        if ('inert' in HTMLElement.prototype) {
          page.inert = false;
        }

        document.removeEventListener('keydown', handleKeyDown);

        // restore focus
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function handleKeyDown(e){
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Focus trap
          const focusable = getFocusableElements(modal);
          if (focusable.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          const active = document.activeElement;

          if (e.shiftKey) {
            if (active === first || modal === active) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (active === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Attach open handlers to all triggers (class "trigger")
      triggers.forEach(t => {
        t.addEventListener('click', (ev) => {
          ev.preventDefault();
          openModal(t);
        });
      });

      // Overlay click closes
      overlay.addEventListener('click', (ev) => {
        closeModal();
      });

      // Close buttons inside modal
      closeElements.forEach(el => {
        el.addEventListener('click', (ev) => {
          ev.preventDefault();
          closeModal();
        });
      });

      // Also close on clicking Cancel (has data-action close) - already handled
      // Example confirm action: close and alert
      const confirm = document.getElementById('confirm-action');
      if (confirm) {
        confirm.addEventListener('click', () => {
          closeModal();
          setTimeout(() => {
            alert('Confirmed!');
          }, 150);
        });
      }

      // Accessibility: ensure dialog container can be focused if no focusable inside
      const dialog = modal.querySelector('.modal__dialog');
      if (dialog && !dialog.hasAttribute('tabindex')) {
        dialog.setAttribute('tabindex', '-1');
      }

      // Close modal if user navigates focus out (for robustness) - optional:
      // Not implemented to avoid unexpected closes.

      // Keep focus visible for keyboard users:
      (function manageFocusOutline(){
        function handleMouseDown(){ document.body.classList.add('using-mouse'); }
        function handleKeyDown(){ document.body.classList.remove('using-mouse'); }
        window.addEventListener('mousedown', handleMouseDown);
        window.addEventListener('keydown', handleKeyDown);
        // minimal styling tweak if desired via class; not used further here.
      })();

      // Ensure modal is closed on load
      modal.setAttribute('aria-hidden','true');
      page.setAttribute('aria-hidden','false');

    })();
  </script>
</body>
</html>