<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Example Modal Dialog</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.5);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 520px;
      --space: 1rem;
      --accent: #0066ff;
      --shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1.4;
      margin: 0;
      min-height: 100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:3rem;
      background: #f6f8fb;
      color: #111;
    }

    main {
      max-width: 760px;
      width: 100%;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(12,20,30,0.06);
    }

    button.trigger {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,102,255,0.12);
    }

    /* Modal overlay & wrapper (hidden by default) */
    .modal {
      position: fixed;
      inset: 0;
      display: none; /* closed by default */
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.open {
      display: flex;
    }

    .modal__overlay {
      position: absolute;
      inset: 0;
      background: var(--overlay-bg);
      opacity: 0;
      transition: opacity 180ms ease;
    }

    .modal.open .modal__overlay {
      opacity: 1;
    }

    .modal__panel {
      position: relative;
      background: var(--modal-bg);
      border-radius: var(--radius);
      max-width: var(--max-width);
      width: calc(100% - 2rem);
      margin: 1rem;
      box-shadow: var(--shadow);
      transform: translateY(12px) scale(.98);
      opacity: 0;
      transition: transform 200ms cubic-bezier(.2,.8,.2,1), opacity 160ms ease;
      z-index: 1;
      padding: 1.25rem;
    }

    .modal.open .modal__panel {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal__header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 1rem;
    }

    h2 {
      margin: 0;
      font-size: 1.125rem;
    }

    .modal__body {
      margin-top: 0.75rem;
      color: #333;
    }

    .modal__footer {
      display:flex;
      justify-content:flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .btn {
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: 1px solid transparent;
      background: #e8eefc;
      color: #03307b;
      cursor: pointer;
    }

    .btn.primary {
      background: var(--accent);
      color: white;
      border: none;
    }

    .close {
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 6px;
    }

    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }

    /* Small responsive tweak */
    @media (max-width:480px){
      .modal__panel { padding: 1rem; }
    }
  </style>
</head>
<body>
  <main id="page">
    <h1>Page with a modal dialog example</h1>
    <p>This demonstrates an accessible modal dialog component. The dialog is closed by default. Use the button below to open it.</p>

    <button type="button" class="trigger" aria-haspopup="dialog" aria-controls="example-modal">Open modal</button>

    <section style="margin-top:1.5rem">
      <p>Some other focusable elements on the page to show focus handling:</p>
      <a href="#">A sample link</a> &middot;
      <button>Another button</button>
    </section>
  </main>

  <!-- Modal (closed by default) -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal__overlay" data-modal-overlay></div>

    <div class="modal__panel" role="document" tabindex="-1">
      <div class="modal__header">
        <h2 id="modal-title">Example modal dialog</h2>
        <button class="close" data-modal-close aria-label="Close dialog">&times;</button>
      </div>

      <div class="modal__body">
        <p>This is a simple example of a modal dialog component. It traps focus inside while open, can be closed with the Escape key, by clicking the overlay, or by the close button.</p>
        <p>Try pressing Tab/Shift+Tab to cycle focus within the dialog.</p>
      </div>

      <div class="modal__footer">
        <button class="btn" data-modal-close>Cancel</button>
        <button class="btn primary">Save changes</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const modal = document.getElementById('example-modal');
      const panel = modal.querySelector('.modal__panel');
      const overlay = modal.querySelector('[data-modal-overlay]');
      const closeButtons = modal.querySelectorAll('[data-modal-close]');
      const triggers = document.querySelectorAll('.trigger');
      const page = document.getElementById('page');

      let lastActiveTrigger = null;

      function isOpen() {
        return modal.classList.contains('open');
      }

      function openModal(trigger) {
        lastActiveTrigger = trigger || document.activeElement;
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        // mark main content as inert for AT (simpler approach)
        page.setAttribute('aria-hidden','true');
        // focus first focusable element inside the dialog (prefer close button)
        const focusable = getFocusableElements();
        const toFocus = focusable.length ? focusable[0] : panel;
        // allow CSS transition to settle then focus
        window.setTimeout(()=> { toFocus.focus(); }, 10);
        // listen to key events at document level
        document.addEventListener('keydown', onKeyDown, true);
      }

      function closeModal() {
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        page.removeAttribute('aria-hidden');
        document.removeEventListener('keydown', onKeyDown, true);
        // restore focus
        if (lastActiveTrigger && typeof lastActiveTrigger.focus === 'function') {
          lastActiveTrigger.focus();
        }
      }

      function onKeyDown(e) {
        if (!isOpen()) return;
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // focus trap
          const focusable = getFocusableElements();
          if (focusable.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === panel) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      function getFocusableElements() {
        const selectors = [
          'a[href]:not([disabled])',
          'button:not([disabled])',
          'textarea:not([disabled])',
          'input:not([disabled])',
          'select:not([disabled])',
          '[tabindex]:not([tabindex="-1"])'
        ];
        return Array.from(modal.querySelectorAll(selectors.join(',')))
          .filter(el => el.offsetParent !== null); // visible only
      }

      // Wire triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (e) => {
          openModal(btn);
        });
      });

      // Close buttons
      closeButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          closeModal();
        });
      });

      // clicking overlay closes
      overlay.addEventListener('click', (e) => {
        closeModal();
      });

      // prevent clicks inside panel from closing
      panel.addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // accessibility: if focus somehow leaves modal, bring it back
      document.addEventListener('focusin', (e) => {
        if (!isOpen()) return;
        if (!modal.contains(e.target)) {
          // move focus to panel
          const focusable = getFocusableElements();
          (focusable.length ? focusable[0] : panel).focus();
        }
      });

      // Ensure modal is closed on load (explicit)
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');

    })();
  </script>
</body>
</html>