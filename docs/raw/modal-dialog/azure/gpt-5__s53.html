<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Modal Dialog Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --backdrop: rgba(0,0,0,0.55);
      --modal-bg: #fff;
      --modal-color: #222;
      --radius: 12px;
      --shadow: 0 18px 40px rgba(0,0,0,0.25);
      --accent: #3a7afe;
    }

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: #111;
      background: #f6f7fb;
      line-height: 1.5;
    }

    body.modal-open {
      overflow: hidden;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 32px 20px 80px;
    }

    h1 {
      font-size: 1.6rem;
      margin: 0 0 16px;
    }

    p {
      margin: 0 0 16px;
      color: #333;
    }

    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
    }

    button {
      appearance: none;
      border: none;
      border-radius: 8px;
      padding: 12px 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .trigger {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 6px 18px rgba(58, 122, 254, 0.35);
    }

    .secondary {
      background: #e6e9f3;
      color: #1a1a1a;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: var(--backdrop);
      z-index: 1000;
      padding: 24px;
    }

    .modal-backdrop.open {
      display: flex;
      animation: fadeIn 160ms ease-out;
    }

    .modal {
      position: relative;
      width: 100%;
      max-width: 600px;
      background: var(--modal-bg);
      color: var(--modal-color);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transform: translateY(8px) scale(0.98);
      opacity: 0;
      transition: transform 160ms ease-out, opacity 160ms ease-out;
    }

    .modal-backdrop.open .modal {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px;
      border-bottom: 1px solid #eceff6;
    }

    .modal-title {
      font-size: 1.25rem;
      margin: 0;
    }

    .modal-close {
      background: transparent;
      color: #444;
      padding: 8px;
      border-radius: 6px;
      line-height: 0;
    }
    .modal-close:hover {
      background: #f1f4fb;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 16px 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      border-top: 1px solid #eceff6;
      background: #fafbff;
    }

    .ghost {
      background: transparent;
      color: #222;
      border: 1px solid #d6d9e6;
    }

    .primary {
      background: var(--accent);
      color: #fff;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Visually hidden utility */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
      border: 0;
      padding: 0; margin: -1px;
    }

    /* Demo content card */
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.08);
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Modal Dialog Component</h1>
    <div class="card">
      <p>This example shows a modal dialog that is closed by default. Click the button to open it. Press Escape to close, or click outside the dialog.</p>
      <div class="actions">
        <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="modal" aria-expanded="false">Open Modal</button>
        <button class="secondary trigger" type="button" aria-haspopup="dialog" aria-controls="modal" aria-expanded="false">Open Another Trigger</button>
      </div>
    </div>
  </div>

  <div id="modal-backdrop" class="modal-backdrop" aria-hidden="true">
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="-1">
      <div class="modal-header">
        <h2 id="modal-title" class="modal-title">Confirm Action</h2>
        <button class="modal-close close" type="button" aria-label="Close dialog" title="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M13.41 12l4.3-4.29a1 1 0 10-1.42-1.42L12 10.59 7.71 6.29A1 1 0 106.29 7.71L10.59 12l-4.3 4.29a1 1 0 101.42 1.42L12 13.41l4.29 4.3a1 1 0 001.42-1.42z"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p id="modal-desc">This action will perform an irreversible change. Are you sure you want to continue?</p>
        <ul>
          <li>Press Escape to close.</li>
          <li>Tab cycles within the dialog.</li>
          <li>Click outside the dialog to close.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="ghost close" type="button">Cancel</button>
        <button class="primary" type="button">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const backdrop = document.getElementById('modal-backdrop');
      const modal = document.getElementById('modal');
      const triggers = document.querySelectorAll('.trigger');
      const closeButtons = modal.querySelectorAll('.close');
      let lastFocused = null;

      const focusableSelectors = [
        'a[href]',
        'area[href]',
        'input:not([disabled]):not([type="hidden"])',
        'select:not([disabled])',
        'textarea:not([disabled])',
        'button:not([disabled])',
        'iframe',
        'audio[controls]',
        'video[controls]',
        '[contenteditable]:not([contenteditable="false"])',
        '[tabindex]:not([tabindex="-1"])'
      ].join(',');

      function getFocusable() {
        const nodes = Array.from(modal.querySelectorAll(focusableSelectors));
        // Only visible elements
        return nodes.filter(el => {
          const style = window.getComputedStyle(el);
          return style.visibility !== 'hidden' && style.display !== 'none';
        });
      }

      function openModal() {
        if (backdrop.classList.contains('open')) return;
        lastFocused = document.activeElement;
        backdrop.classList.add('open');
        backdrop.removeAttribute('aria-hidden');
        modal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('modal-open');

        // Update triggers expanded state
        triggers.forEach(btn => btn.setAttribute('aria-expanded', 'true'));

        // Focus management
        requestAnimationFrame(() => {
          const focusables = getFocusable();
          if (focusables.length) {
            focusables[0].focus();
          } else {
            modal.focus();
          }
        });

        document.addEventListener('keydown', onKeyDown);
      }

      function closeModal() {
        if (!backdrop.classList.contains('open')) return;
        backdrop.classList.remove('open');
        backdrop.setAttribute('aria-hidden', 'true');
        modal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');

        // Update triggers expanded state
        triggers.forEach(btn => btn.setAttribute('aria-expanded', 'false'));

        document.removeEventListener('keydown', onKeyDown);
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus();
        }
      }

      function onKeyDown(e) {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          const focusables = getFocusable();
          if (focusables.length === 0) return;
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          const active = document.activeElement;

          if (e.shiftKey) {
            if (active === first || !modal.contains(active)) {
              last.focus();
              e.preventDefault();
            }
          } else {
            if (active === last || !modal.contains(active)) {
              first.focus();
              e.preventDefault();
            }
          }
        }
      }

      // Open handlers
      triggers.forEach(btn => {
        btn.addEventListener('click', openModal);
      });

      // Close handlers: buttons
      closeButtons.forEach(btn => {
        btn.addEventListener('click', closeModal);
      });

      // Close on click outside (backdrop)
      backdrop.addEventListener('click', (e) => {
        if (e.target === backdrop) {
          closeModal();
        }
      });

      // Example: Confirm button action (no-op)
      const confirmBtn = modal.querySelector('.primary');
      confirmBtn.addEventListener('click', () => {
        // Perform action here...
        closeModal();
      });

      // Prevent page scroll with touch inside modal on iOS (optional)
      modal.addEventListener('touchmove', (e) => {
        e.stopPropagation();
      }, { passive: true });
    })();
  </script>
</body>
</html>