<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modal Dialog Example</title>
  <style>
    :root{
      --overlay: rgba(0,0,0,0.5);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 520px;
      --gap: 16px;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin:0;
      line-height:1.4;
      background: #f5f7fa;
      color:#111827;
      padding:32px;
    }
    main{
      max-width:900px;
      margin:0 auto;
    }
    .trigger{
      display:inline-block;
      padding:10px 16px;
      background:#2563eb;
      color:#fff;
      border:0;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 2px 6px rgba(37,99,235,.18);
    }
    /* Modal (hidden by default via aria-hidden="true") */
    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      z-index: 1000;
      pointer-events: none;
    }
    .modal[aria-hidden="false"]{
      pointer-events: auto;
    }
    .modal__overlay {
      position:absolute;
      inset:0;
      background:var(--overlay);
      opacity:0;
      transition:opacity .18s ease;
      will-change: opacity;
    }
    .modal[aria-hidden="false"] .modal__overlay{
      opacity:1;
    }
    .modal__panel {
      position:relative;
      background:var(--modal-bg);
      border-radius:var(--radius);
      width:clamp(320px, 86%, var(--max-width));
      max-width:var(--max-width);
      box-shadow: 0 10px 30px rgba(2,6,23,.2);
      transform: translateY(-8px) scale(.995);
      opacity:0;
      transition: transform .18s cubic-bezier(.2,.9,.3,1), opacity .18s ease;
      z-index: 1;
      pointer-events: auto;
      padding:24px;
    }
    .modal[aria-hidden="false"] .modal__panel{
      transform: translateY(0) scale(1);
      opacity:1;
    }
    .modal__header{
      display:flex;
      align-items:start;
      gap:12px;
    }
    .modal__title{
      font-size:18px;
      font-weight:700;
      margin:0;
    }
    .modal__body{
      margin-top:12px;
      font-size:14px;
      color:#374151;
    }
    .modal__footer{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      margin-top:20px;
    }
    .btn {
      padding:8px 12px;
      border-radius:6px;
      border:0;
      cursor:pointer;
      font-weight:600;
    }
    .btn--primary { background:#0ea5e9; color:#fff; }
    .btn--secondary { background:#e6e9ef; color:#111827; }
    .close {
      margin-left:auto;
      background:transparent;
      border:0;
      color:#6b7280;
      font-size:18px;
      cursor:pointer;
    }
    /* Visually hide when modal closed (so screen readers obey aria-hidden) */
    .modal[aria-hidden="true"] .modal__panel,
    .modal[aria-hidden="true"] .modal__overlay {
      pointer-events: none;
    }
    /* Focus outlines */
    button:focus, a:focus {
      outline: 3px solid rgba(14,165,233,.18);
      outline-offset: 3px;
    }
    /* Simple demo page content */
    .demo-card{
      padding:18px;
      background:#fff;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(15,23,42,.06);
    }
    footer{
      margin-top:40px;
      font-size:13px;
      color:#6b7280;
    }
  </style>
</head>
<body>
  <main id="main">
    <h1>Modal Dialog Component</h1>
    <div class="demo-card" aria-hidden="false">
      <p>This example demonstrates an accessible modal dialog component. It is closed by default. Use the button below to open it.</p>
      <button class="trigger" type="button" aria-haspopup="dialog" aria-controls="example-modal">Open Modal</button>
    </div>

    <footer>
      Tip: press Escape to close the modal, or click outside the panel.
    </footer>
  </main>

  <!-- Modal (closed by default via aria-hidden="true") -->
  <div id="example-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title" tabindex="-1">
    <div class="modal__overlay" data-dismiss="overlay"></div>

    <div class="modal__panel" role="document">
      <div class="modal__header">
        <h2 id="modal-title" class="modal__title">Example Modal</h2>
        <button class="close" type="button" aria-label="Close modal" data-dismiss="close">&times;</button>
      </div>

      <div class="modal__body">
        <p>This is a simple modal dialog. It traps focus while open and returns focus to the triggering element when closed.</p>
        <p>Try tabbing through the focusable controls and closing with the Escape key or the close button.</p>
      </div>

      <div class="modal__footer">
        <button class="btn btn--secondary" type="button" data-dismiss="close">Cancel</button>
        <button class="btn btn--primary" type="button">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const modal = document.getElementById('example-modal');
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const main = document.getElementById('main');
      let lastFocused = null;

      // Utility: get focusable elements inside modal
      function getFocusable(el) {
        return Array.from(el.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'))
          .filter(node => node.offsetWidth > 0 || node.offsetHeight > 0 || node.getClientRects().length);
      }

      function openModal(triggerEl) {
        lastFocused = triggerEl || document.activeElement;
        // mark main as inert/hidden for assistive tech
        main.setAttribute('aria-hidden', 'true');

        modal.setAttribute('aria-hidden', 'false');
        document.addEventListener('focus', enforceFocus, true);
        document.addEventListener('keydown', onKeyDown);
        // Move focus into the modal: prefer first focusable or the panel itself
        const focusables = getFocusable(modal);
        if (focusables.length) {
          focusables[0].focus();
        } else {
          modal.focus();
        }
      }

      function closeModal() {
        modal.setAttribute('aria-hidden', 'true');
        main.removeAttribute('aria-hidden');
        document.removeEventListener('focus', enforceFocus, true);
        document.removeEventListener('keydown', onKeyDown);
        // Return focus to the originator if available
        if (lastFocused && typeof lastFocused.focus === 'function') {
          lastFocused.focus({ preventScroll: true });
        }
      }

      // Keep focus inside modal
      function enforceFocus(e) {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        if (!modal.contains(e.target)) {
          e.stopPropagation();
          const focusables = getFocusable(modal);
          if (focusables.length) {
            focusables[0].focus();
          } else {
            modal.focus();
          }
        }
      }

      function onKeyDown(e) {
        if (modal.getAttribute('aria-hidden') === 'true') return;
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
          return;
        }
        if (e.key === 'Tab') {
          // Handle tab trapping
          const focusables = getFocusable(modal);
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || modal === document.activeElement) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Attach triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev) => {
          openModal(ev.currentTarget);
        });
      });

      // Dismiss via overlay or elements with data-dismiss="close"
      modal.addEventListener('click', (ev) => {
        // Click on overlay (not the panel) closes modal
        if (ev.target === modal || ev.target.hasAttribute('data-dismiss')) {
          // If an inner element has data-dismiss, it will be handled here too
          // Ensure clicks inside the panel that shouldn't close won't bubble with that attribute
          closeModal();
        }
      });

      // Prevent clicks inside panel from triggering overlay logic unless marked
      const panel = modal.querySelector('.modal__panel');
      if (panel) {
        panel.addEventListener('click', (ev) => {
          ev.stopPropagation();
        });
      }

      // Close buttons (data-dismiss="close") already handled by modal click listener.
      // Provide safe initialization: ensure modal closed on load
      modal.setAttribute('aria-hidden', 'true');
    })();
  </script>
</body>
</html>