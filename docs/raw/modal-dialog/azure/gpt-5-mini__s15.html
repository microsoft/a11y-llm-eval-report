<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accessible Modal Example</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.6);
      --modal-bg: #fff;
      --radius: 8px;
      --max-width: 600px;
      --gap: 24px;
      --transition: 220ms cubic-bezier(.2,.9,.3,1);
    }

    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:#f3f4f6;
      color:#111827;
    }

    header{
      padding:20px;
      background:linear-gradient(90deg,#0ea5e9 0%, #7c3aed 100%);
      color:white;
    }

    main{
      padding:24px;
      max-width:900px;
      margin:24px auto;
    }

    .trigger{
      display:inline-block;
      padding:10px 16px;
      background:#0ea5e9;
      color:white;
      border:0;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(2,6,23,0.12);
    }

    /* Modal overlay */
    .modal-overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--overlay-bg);
      z-index:1000;
      opacity:0;
      pointer-events:none;
      transition:opacity var(--transition);
    }

    .modal-overlay[hidden]{
      visibility:hidden;
    }

    .modal-overlay.open{
      opacity:1;
      pointer-events:auto;
      visibility:visible;
    }

    /* Modal panel */
    .modal{
      background:var(--modal-bg);
      width:calc(100% - 48px);
      max-width:var(--max-width);
      border-radius:var(--radius);
      box-shadow:0 10px 40px rgba(2,6,23,0.3);
      transform:translateY(10px) scale(.995);
      transition:transform var(--transition), opacity var(--transition);
      opacity:0;
      max-height:85vh;
      display:flex;
      flex-direction:column;
      outline: none;
    }

    .modal-overlay.open .modal{
      transform:translateY(0) scale(1);
      opacity:1;
    }

    .modal-header{
      padding:20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid #eef2ff;
    }

    .modal-title{
      margin:0;
      font-size:18px;
      font-weight:700;
    }

    .modal-body{
      padding:16px 20px;
      overflow:auto;
    }

    .modal-actions{
      padding:12px 20px;
      display:flex;
      gap:12px;
      justify-content:flex-end;
      border-top:1px solid #eef2ff;
    }

    .btn{
      padding:8px 12px;
      border-radius:6px;
      border:0;
      cursor:pointer;
      font-weight:600;
    }

    .btn.primary{
      background:#7c3aed;
      color:white;
    }

    .btn.ghost{
      background:transparent;
      border:1px solid #e6e7ee;
    }

    .close-btn{
      background:transparent;
      border:0;
      padding:6px;
      border-radius:6px;
      cursor:pointer;
      color:#374151;
      font-size:16px;
    }

    .vis-hide{
      position:absolute !important;
      height:1px; width:1px; overflow:hidden;
      clip:rect(1px,1px,1px,1px);
      white-space:nowrap;
    }

    /* Prevent body scroll when modal open */
    body.modal-open{
      overflow:hidden;
    }

    /* small responsive tweaks */
    @media (max-width:480px){
      .modal-header, .modal-actions, .modal-body{ padding-left:12px; padding-right:12px; }
      .modal-title{ font-size:16px; }
    }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0; font-size:20px;">Demo: Accessible Modal</h1>
  </header>

  <main id="main-content">
    <p>This page demonstrates a small accessible modal dialog component. The modal is closed by default. Use the button below (it has the required class "trigger") to open it.</p>

    <button class="trigger" id="openModalBtn">Open modal</button>

    <section style="margin-top:24px;">
      <h2>Page content</h2>
      <p>More content so you can see the background being inert while the modal is open. Try tabbing around and use Escape to close the dialog.</p>
      <a href="https://example.com" target="_blank">External link</a>
    </section>
  </main>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay" role="presentation" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc" tabindex="-1">
      <div class="modal-header">
        <h2 id="modalTitle" class="modal-title">Example Modal</h2>
        <button class="close-btn" id="closeBtn" aria-label="Close dialog">&times;</button>
      </div>
      <div class="modal-body" id="modalDesc">
        <p>This is a simple modal dialog. Focus is trapped inside while open, and closing returns focus to the trigger. Click outside the dialog or press Escape to close.</p>
        <p>
          <label for="sampleInput">Sample input:</label>
          <input id="sampleInput" type="text" placeholder="Type here" style="padding:8px; border-radius:6px; border:1px solid #e6e7ee; margin-top:6px; width:100%;" />
        </p>
      </div>
      <div class="modal-actions">
        <button class="btn ghost" id="cancelBtn">Cancel</button>
        <button class="btn primary" id="confirmBtn">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const triggers = Array.from(document.querySelectorAll('.trigger'));
      const overlay = document.getElementById('modalOverlay');
      const modal = overlay.querySelector('.modal');
      const closeBtn = document.getElementById('closeBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const confirmBtn = document.getElementById('confirmBtn');
      const mainContent = document.getElementById('main-content');
      let lastFocused = null;

      // Helper: get all focusable elements inside node
      function getFocusable(node){
        const selectors = [
          'a[href]:not([tabindex^="-"])',
          'area[href]',
          'input:not([disabled]):not([type="hidden"]):not([tabindex^="-"])',
          'select:not([disabled]):not([tabindex^="-"])',
          'textarea:not([disabled]):not([tabindex^="-"])',
          'button:not([disabled]):not([tabindex^="-"])',
          'iframe',
          'object',
          'embed',
          '[contenteditable]',
          '[tabindex]:not([tabindex^="-"])'
        ];
        return Array.from(node.querySelectorAll(selectors.join(','))).filter(el => el.offsetWidth > 0 || el.offsetHeight > 0 || el === document.activeElement);
      }

      function openModal(triggerEl){
        if (!overlay.hasAttribute('hidden')) return;
        lastFocused = triggerEl || document.activeElement;
        overlay.removeAttribute('hidden');
        // small timeout to allow CSS transitions
        requestAnimationFrame(() => overlay.classList.add('open'));
        document.body.classList.add('modal-open');
        // hide background from assistive tech
        mainContent.setAttribute('aria-hidden', 'true');
        overlay.setAttribute('aria-hidden', 'false');

        // trap focus: focus the first focusable element or modal itself
        const focusable = getFocusable(modal);
        (focusable[0] || modal).focus();

        // attach keydown to trap focus and close with Escape
        document.addEventListener('keydown', onKeyDown, true);
      }

      function closeModal(){
        if (overlay.hasAttribute('hidden')) return;
        overlay.classList.remove('open');
        // wait for transition to end then hide
        const onTransitionEnd = () => {
          overlay.setAttribute('hidden', '');
          overlay.removeEventListener('transitionend', onTransitionEnd);
        };
        overlay.addEventListener('transitionend', onTransitionEnd);
        document.body.classList.remove('modal-open');
        mainContent.removeAttribute('aria-hidden');
        overlay.setAttribute('aria-hidden', 'true');

        document.removeEventListener('keydown', onKeyDown, true);

        // restore focus
        try { lastFocused && lastFocused.focus(); }
        catch(e){}
      }

      function onKeyDown(e){
        if (e.key === 'Escape' || e.key === 'Esc') {
          e.preventDefault();
          closeModal();
          return;
        }

        if (e.key === 'Tab') {
          // manage focus trap
          const focusable = getFocusable(modal);
          if (focusable.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey) {
            if (document.activeElement === first || document.activeElement === modal) {
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // open triggers
      triggers.forEach(btn => {
        btn.addEventListener('click', (ev)=>{
          ev.preventDefault();
          openModal(btn);
        });
      });

      // close handlers
      closeBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        closeModal();
      });
      cancelBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        closeModal();
      });

      // example confirm action
      confirmBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        // simulate some action...
        closeModal();
        setTimeout(()=> alert('Confirmed!'), 150);
      });

      // clicking overlay outside modal closes dialog
      overlay.addEventListener('click', (e)=>{
        if (e.target === overlay) {
          closeModal();
        }
      });

      // handle focus if user tabs into overlay (prevents focus leak)
      overlay.addEventListener('focusin', (e)=>{
        if (!modal.contains(e.target)) {
          const focusable = getFocusable(modal);
          (focusable[0] || modal).focus();
        }
      });

      // ensure modal is hidden by default for assistive tech
      overlay.setAttribute('aria-hidden', 'true');

    })();
  </script>
</body>
</html>