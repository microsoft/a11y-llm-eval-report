<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --accent:#0b79d0;
      --bg:#f8f9fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --radius:8px;
      --shadow: 0 4px 12px rgba(16,24,40,0.06);
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 32px;
      background: linear-gradient(180deg, #f7fbff 0%, #ffffff 100%);
      color:var(--text);
      line-height:1.4;
    }

    h1 {
      margin: 0 0 20px 0;
      font-size: 20px;
    }

    .grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .example {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(15,23,42,0.04);
    }

    .example h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
    }

    .controller {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    button.toggle {
      appearance: none;
      border: 1px solid rgba(15,23,42,0.06);
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset;
    }

    button.toggle:focus {
      outline: 3px solid rgba(11,121,208,0.18);
      outline-offset: 2px;
    }

    .chev {
      width: 12px;
      height: 12px;
      display:inline-block;
      transition: transform 220ms ease;
      transform-origin: 50% 50%;
      color:var(--accent);
    }

    button[aria-expanded="true"] .chev {
      transform: rotate(90deg);
    }

    /* Controlled content (must have class "details") */
    .details {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 320ms cubic-bezier(.2,.9,.2,1), opacity 240ms ease;
      margin-top: 12px;
    }

    .details.open {
      opacity: 1;
    }

    .details .content {
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px dashed rgba(15,23,42,0.04);
      color: var(--muted);
      font-size: 14px;
    }

    /* Small visual instruction text */
    .hint {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .details, .chev {
        transition: none;
      }
    }

    /* Nested example spacing */
    .nested .details .details {
      margin-top: 8px;
    }

    /* Footer note */
    footer {
      margin-top: 26px;
      font-size: 13px;
      color:var(--muted);
    }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <div class="grid">
    <!-- Example 1: Simple toggle -->
    <div class="example">
      <h2>Simple toggle</h2>
      <div>
        <div class="controller">
          <button class="toggle" id="toggle-1" aria-expanded="false" aria-controls="details-1">
            <span class="chev" aria-hidden="true">▸</span>
            More details
          </button>
        </div>

        <div id="details-1" class="details" role="region" aria-labelledby="toggle-1" aria-hidden="true">
          <div class="content">
            This is a simple expand/collapse region. It is hidden by default and revealed when the button is activated.
            Use the button again to collapse it.
          </div>
        </div>

        <div class="hint">Buttons are keyboard-accessible (Space / Enter).</div>
      </div>
    </div>

    <!-- Example 2: Animated with dynamic height -->
    <div class="example">
      <h2>Animated (dynamic height)</h2>
      <div>
        <div class="controller">
          <button class="toggle" id="toggle-2" aria-expanded="false" aria-controls="details-2">
            <span class="chev" aria-hidden="true">▸</span>
            Show summary
          </button>
        </div>

        <div id="details-2" class="details" role="region" aria-labelledby="toggle-2" aria-hidden="true">
          <div class="content">
            <p><strong>Summary:</strong> This section demonstrates a smooth height animation computed from the content's scrollHeight so the transition feels natural regardless of content length.</p>
            <ul>
              <li>Accessible: uses aria-expanded and aria-hidden.</li>
              <li>Animated: expands to fit content.</li>
              <li>Works with assistive tech because of proper attributes and roles.</li>
            </ul>
          </div>
        </div>

      </div>
    </div>

    <!-- Example 3: Nested details -->
    <div class="example nested">
      <h2>Nested sections</h2>
      <div>
        <div class="controller">
          <button class="toggle" id="toggle-3" aria-expanded="false" aria-controls="details-3">
            <span class="chev" aria-hidden="true">▸</span>
            View chapter
          </button>
        </div>

        <div id="details-3" class="details" role="region" aria-labelledby="toggle-3" aria-hidden="true">
          <div class="content">
            <p><strong>Chapter 1:</strong> This chapter contains two subsections you can open independently.</p>

            <div style="margin-top:10px;">
              <div class="controller">
                <button class="toggle" id="toggle-3a" aria-expanded="false" aria-controls="details-3a">
                  <span class="chev" aria-hidden="true">▸</span>
                  Subsection A
                </button>
              </div>

              <div id="details-3a" class="details" role="region" aria-labelledby="toggle-3a" aria-hidden="true">
                <div class="content">
                  Subsection A content — details about a specific topic. Expand or collapse without affecting the parent.
                </div>
              </div>
            </div>

            <div style="margin-top:10px;">
              <div class="controller">
                <button class="toggle" id="toggle-3b" aria-expanded="false" aria-controls="details-3b">
                  <span class="chev" aria-hidden="true">▸</span>
                  Subsection B
                </button>
              </div>

              <div id="details-3b" class="details" role="region" aria-labelledby="toggle-3b" aria-hidden="true">
                <div class="content">
                  Subsection B content — more details. Nested toggles keep their own state.
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <footer>
    Each controlled content container has the class "details". Toggle buttons update aria-expanded and the region's aria-hidden for accessibility.
  </footer>

  <script>
    (function () {
      // Find all toggle buttons that control a details region
      var toggles = Array.prototype.slice.call(document.querySelectorAll('button.toggle[aria-controls]'));

      // Utility to open a details element (with smooth height animation)
      function openDetails(detailsEl) {
        // Remove any inline maxHeight to measure natural height
        detailsEl.style.maxHeight = '0px'; // ensure starting from 0
        detailsEl.classList.add('open');
        // Force a layout so the starting maxHeight is registered
        var start = detailsEl.scrollHeight;
        // Set to scrollHeight for transition
        detailsEl.style.maxHeight = detailsEl.scrollHeight + 'px';
        detailsEl.setAttribute('aria-hidden', 'false');
      }

      function closeDetails(detailsEl) {
        // For a nice collapse we set the maxHeight to current height then to 0
        detailsEl.style.maxHeight = detailsEl.scrollHeight + 'px';
        // Force layout
        detailsEl.getBoundingClientRect();
        detailsEl.style.maxHeight = '0px';
        detailsEl.setAttribute('aria-hidden', 'true');
        // Remove open class after transition completes (to allow instantaneous CSS changes if needed)
        var onEnd = function (e) {
          if (e && e.target !== detailsEl) return;
          detailsEl.classList.remove('open');
          detailsEl.removeEventListener('transitionend', onEnd);
          // Clear inline maxHeight when closed to avoid stale values
          detailsEl.style.maxHeight = '';
        };
        detailsEl.addEventListener('transitionend', onEnd);
      }

      // Initialize from markup: ensure aria-hidden matches collapsed state
      toggles.forEach(function (btn) {
        var id = btn.getAttribute('aria-controls');
        var detailsEl = document.getElementById(id);
        if (!detailsEl) return;
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded) {
          detailsEl.classList.add('open');
          detailsEl.setAttribute('aria-hidden', 'false');
          // Set maxHeight to scrollHeight so it appears open
          detailsEl.style.maxHeight = detailsEl.scrollHeight + 'px';
        } else {
          detailsEl.classList.remove('open');
          detailsEl.setAttribute('aria-hidden', 'true');
          detailsEl.style.maxHeight = '0px';
        }
      });

      // Click handlers
      toggles.forEach(function (btn) {
        btn.addEventListener('click', function () {
          var id = btn.getAttribute('aria-controls');
          var detailsEl = document.getElementById(id);
          if (!detailsEl) return;

          var isExpanded = btn.getAttribute('aria-expanded') === 'true';
          if (isExpanded) {
            btn.setAttribute('aria-expanded', 'false');
            closeDetails(detailsEl);
          } else {
            btn.setAttribute('aria-expanded', 'true');
            openDetails(detailsEl);
          }
        });
      });

      // Optional: if content inside a details changes size (images, async content),
      // keep the open maxHeight in sync.
      var ro = new ResizeObserver(function (entries) {
        entries.forEach(function (entry) {
          var el = entry.target;
          if (el.classList.contains('open')) {
            el.style.maxHeight = el.scrollHeight + 'px';
          }
        });
      });

      // Observe all details elements
      var detailsElements = Array.prototype.slice.call(document.querySelectorAll('.details'));
      detailsElements.forEach(function (el) { ro.observe(el); });

      // Clean up maxHeight if user toggles reduced-motion via media query while open
      var mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      mq.addEventListener && mq.addEventListener('change', function () {
        detailsElements.forEach(function (el) {
          if (mq.matches) {
            el.style.transition = 'none';
            el.style.maxHeight = el.classList.contains('open') ? '' : '0px';
          } else {
            el.style.transition = '';
            if (el.classList.contains('open')) {
              el.style.maxHeight = el.scrollHeight + 'px';
            }
          }
        });
      });

    })();
  </script>
</body>
</html>