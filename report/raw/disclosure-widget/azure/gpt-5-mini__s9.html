<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Expand / Collapse Widget Examples</title>
  <style>
    :root{
      --surface:#fff;
      --muted:#6b7280;
      --accent:#111827;
      --accent-2:#2563eb;
      --radius:8px;
      --gap:12px;
    }

    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.4;
      background:linear-gradient(180deg,#f8fafc,#eef2ff);
      color:var(--accent);
      padding:32px;
    }

    h1{
      margin:0 0 18px 0;
      font-size:20px;
    }

    .example{
      background:var(--surface);
      border-radius:var(--radius);
      box-shadow: 0 1px 2px rgba(16,24,40,0.04), 0 4px 14px rgba(16,24,40,0.06);
      padding:14px;
      margin:0 0 18px 0;
      max-width:760px;
    }

    .expander{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:var(--gap);
      background:transparent;
      border:1px solid transparent;
      padding:10px 12px;
      border-radius:8px;
      cursor:pointer;
      text-align:left;
      font-weight:600;
      color:var(--accent);
      font-size:15px;
    }

    .expander:focus{
      outline:3px solid rgba(37,99,235,0.15);
      box-shadow:0 0 0 3px rgba(37,99,235,0.08);
    }

    .expander .label{
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:flex-start;
      flex:1;
    }

    .expander .title{
      font-weight:700;
      letter-spacing:0.01em;
    }

    .expander .subtitle{
      font-size:13px;
      color:var(--muted);
      font-weight:500;
    }

    .icon{
      width:20px;
      height:20px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition:transform 220ms ease;
      color:var(--accent-2);
      flex:0 0 20px;
      margin-left:8px;
    }

    /* rotate when expanded */
    .expander[aria-expanded="true"] .icon{
      transform:rotate(180deg);
    }

    /* container for controlled content - requirement: class "details" */
    .details{
      overflow:hidden;
      max-height:0;
      transition:max-height 260ms ease;
      margin-top:10px;
      padding:0 2px;
      will-change:max-height;
    }

    .details .panel{
      background:linear-gradient(180deg,rgba(15,23,42,0.02),transparent);
      border-radius:6px;
      padding:12px;
      color:#0f172a;
      border:1px solid rgba(15,23,42,0.04);
      font-size:14px;
    }

    /* reduce motion respect */
    @media (prefers-reduced-motion: reduce){
      .details { transition:none; }
      .icon { transition:none; }
    }

    /* tiny utility */
    p{ margin:0 0 8px 0; }
    code{ background:#f3f4f6; padding:2px 6px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; }
  </style>
</head>
<body>
  <h1>Expand / Collapse Widget Examples</h1>

  <!-- Example 1: simple collapsed by default -->
  <div class="example">
    <button class="expander" id="button-1" aria-expanded="false" aria-controls="details-1">
      <span class="label">
        <span class="title">Simple details (collapsed)</span>
        <span class="subtitle">Click to reveal additional information</span>
      </span>
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div id="details-1" class="details" role="region" aria-labelledby="button-1" hidden>
      <div class="panel">
        <p>This is the hidden content for the first example. It starts collapsed and becomes visible when you click the button above. Use the <code>aria-expanded</code> attribute on the button and the <code>aria-controls</code> attribute to associate the controls with the content.</p>
      </div>
    </div>
  </div>

  <!-- Example 2: expanded by default -->
  <div class="example">
    <button class="expander" id="button-2" aria-expanded="true" aria-controls="details-2">
      <span class="label">
        <span class="title">Details (expanded)</span>
        <span class="subtitle">This example shows an initially expanded panel</span>
      </span>
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div id="details-2" class="details" role="region" aria-labelledby="button-2">
      <div class="panel">
        <p>This panel is open on load. It demonstrates how the widget can start expanded. The scripting initializes the visible state based on the presence or absence of the <code>hidden</code> attribute and the button's <code>aria-expanded</code> value.</p>
        <p>Try collapsing and expanding this section â€” the chevron rotates and the content animates smoothly.</p>
      </div>
    </div>
  </div>

  <!-- Example 3: multiple widgets, keyboard-friendly -->
  <div class="example">
    <button class="expander" id="button-3a" aria-expanded="false" aria-controls="details-3a">
      <span class="label">
        <span class="title">First item</span>
        <span class="subtitle">Part of a group of expanders</span>
      </span>
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div id="details-3a" class="details" role="region" aria-labelledby="button-3a" hidden>
      <div class="panel">
        <p>Content of the first item. Buttons are native button elements so they respond to Enter and Space by default.</p>
      </div>
    </div>

    <button class="expander" id="button-3b" aria-expanded="false" aria-controls="details-3b" style="margin-top:10px;">
      <span class="label">
        <span class="title">Second item</span>
        <span class="subtitle">Independent panel</span>
      </span>
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div id="details-3b" class="details" role="region" aria-labelledby="button-3b" hidden>
      <div class="panel">
        <p>Each widget is self-contained. Focus the button and press Space or Enter to toggle.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const buttons = Array.from(document.querySelectorAll('.expander'));

      // Utility to check prefers-reduced-motion
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function openPanel(button, panel){
        if (!panel) return;
        button.setAttribute('aria-expanded', 'true');
        panel.removeAttribute('hidden');
        panel.setAttribute('aria-hidden','false');

        if (reduceMotion){
          panel.style.maxHeight = null;
          return;
        }

        // Start with current height (may be 0), then expand to full scrollHeight.
        const full = panel.scrollHeight;
        panel.style.maxHeight = full + 'px';

        // When transition ends, clear max-height so content can grow naturally.
        const onEnd = function(e){
          if (e && e.target !== panel) return;
          panel.style.maxHeight = null;
          panel.removeEventListener('transitionend', onEnd);
        };
        panel.addEventListener('transitionend', onEnd);
      }

      function closePanel(button, panel){
        if (!panel) return;
        button.setAttribute('aria-expanded', 'false');
        panel.setAttribute('aria-hidden','true');

        if (reduceMotion){
          panel.setAttribute('hidden','');
          panel.style.maxHeight = null;
          return;
        }

        // For animation: set maxHeight to current height then to 0
        const startHeight = panel.scrollHeight;
        panel.style.maxHeight = startHeight + 'px';

        // Force a reflow so the starting height is taken, then set to 0
        requestAnimationFrame(() => {
          panel.style.maxHeight = '0px';
        });

        const onEnd = function(e){
          if (e && e.target !== panel) return;
          panel.setAttribute('hidden','');
          panel.style.maxHeight = null;
          panel.removeEventListener('transitionend', onEnd);
        };
        panel.addEventListener('transitionend', onEnd);
      }

      function toggle(event){
        const btn = event.currentTarget;
        const id = btn.getAttribute('aria-controls');
        const panel = document.getElementById(id);
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        if (expanded){
          closePanel(btn, panel);
        } else {
          openPanel(btn, panel);
        }
      }

      // Initialize each widget based on aria-expanded / hidden state
      buttons.forEach(btn => {
        const id = btn.getAttribute('aria-controls');
        const panel = document.getElementById(id);
        // ensure role/aria-hidden are set appropriately
        if (!panel) return;
        if (panel.hasAttribute('hidden') || btn.getAttribute('aria-expanded') === 'false'){
          // collapsed
          panel.setAttribute('aria-hidden','true');
          panel.style.maxHeight = '0px';
          btn.setAttribute('aria-expanded','false');
        } else {
          // expanded on load
          panel.removeAttribute('hidden');
          panel.setAttribute('aria-hidden','false');
          btn.setAttribute('aria-expanded','true');
          // set max-height temporarily so transition won't jump if needed
          if (!reduceMotion){
            panel.style.maxHeight = panel.scrollHeight + 'px';
            // clear after a tick so layout is natural
            requestAnimationFrame(()=> panel.style.maxHeight = null);
          } else {
            panel.style.maxHeight = null;
          }
        }

        btn.addEventListener('click', toggle);
        // Buttons already handle Enter/Space natively. No extra key handlers required.
      });

      // Keep any open panels sized correctly on window resize (if currently animating/open)
      window.addEventListener('resize', () => {
        buttons.forEach(btn => {
          const id = btn.getAttribute('aria-controls');
          const panel = document.getElementById(id);
          if (!panel) return;
          if (btn.getAttribute('aria-expanded') === 'true' && !reduceMotion){
            // temporarily set max-height to current intrinsic height to avoid clipping
            panel.style.maxHeight = panel.scrollHeight + 'px';
            // clear after a short delay so the layout settles
            clearTimeout(panel._resizeTimer);
            panel._resizeTimer = setTimeout(()=> { panel.style.maxHeight = null; }, 250);
          }
        });
      });
    })();
  </script>
</body>
</html>