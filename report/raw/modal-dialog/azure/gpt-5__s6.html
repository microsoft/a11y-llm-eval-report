<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Modal Dialog Example</title>
<style>
  * { box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 2rem; }
  button { font: inherit; }
  .trigger { display: inline-block; padding: 0.6rem 1rem; background: #2563eb; color: #fff; border: none; border-radius: 0.375rem; cursor: pointer; }
  .trigger:hover { background: #1e40af; }

  #modal-backdrop[hidden] { display: none; }
  #modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
  .modal { background: #fff; width: min(600px, 90vw); max-height: 80vh; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); overflow: hidden; }
  .modal header { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid #eee; }
  .modal header h2 { font-size: 1.125rem; margin: 0; }
  .modal .content { padding: 1rem; overflow: auto; }
  .modal footer { padding: 0.75rem 1rem; border-top: 1px solid #eee; display: flex; gap: 0.5rem; justify-content: flex-end; }
  .modal .close-btn { border: none; background: transparent; color: #374151; cursor: pointer; font-size: 1rem; padding: 0.25rem; border-radius: 0.375rem; }
  .modal .close-btn:hover { background: #f3f4f6; }
  .primary { padding: 0.5rem 0.9rem; background: #10b981; color: #fff; border: none; border-radius: 0.375rem; cursor: pointer; }
  .primary:hover { background: #0ea5e9; }
  label { font-weight: 600; }
  input { border: 1px solid #d1d5db; border-radius: 0.375rem; }
</style>
</head>
<body>
  <h1>Modal Dialog Component</h1>
  <p>This example demonstrates a modal dialog that is closed by default. Use the button below to open it.</p>
  <button class="trigger" aria-haspopup="dialog" aria-controls="modal" type="button">Open Modal</button>

  <div id="modal-backdrop" hidden>
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" aria-hidden="true" tabindex="-1">
      <header>
        <h2 id="modal-title">Modal Title</h2>
        <button id="modal-close" class="close-btn" type="button" aria-label="Close dialog">âœ•</button>
      </header>
      <div class="content">
        <p id="modal-desc">This is a simple modal dialog with focus trapping and ESC-to-close. Click outside the dialog or press the close button to dismiss.</p>
        <form>
          <label for="name">Name</label><br>
          <input id="name" name="name" type="text" placeholder="Your name" style="width:100%; padding:0.5rem; margin:0.25rem 0 0.75rem;"><br>
          <label for="email">Email</label><br>
          <input id="email" name="email" type="email" placeholder="you@example.com" style="width:100%; padding:0.5rem; margin:0.25rem 0 0.75rem;"><br>
          <a href="#" style="color:#2563eb">Learn more</a>
        </form>
      </div>
      <footer>
        <button class="primary" type="button">Confirm</button>
        <button id="modal-cancel" type="button">Cancel</button>
      </footer>
    </div>
  </div>

<script>
(function(){
  const triggers = Array.from(document.querySelectorAll('.trigger'));
  const backdrop = document.getElementById('modal-backdrop');
  const dialog = document.getElementById('modal');
  const btnClose = document.getElementById('modal-close');
  const btnCancel = document.getElementById('modal-cancel');

  let previousActive = null;
  let boundKeydown = null;

  const focusableSelector = 'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"]), [contenteditable="true"]';

  function getFocusableElements() {
    return Array.from(dialog.querySelectorAll(focusableSelector))
      .filter(el => el.offsetParent !== null || dialog === el);
  }

  function trapFocus(e) {
    if (e.key === 'Tab') {
      const focusable = getFocusableElements();
      if (focusable.length === 0) {
        e.preventDefault();
        dialog.focus();
        return;
      }
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      const isShift = e.shiftKey;

      if (!isShift && document.activeElement === last) {
        e.preventDefault();
        first.focus();
      } else if (isShift && document.activeElement === first) {
        e.preventDefault();
        last.focus();
      }
    } else if (e.key === 'Escape') {
      closeModal();
    }
  }

  function openModal(fromTrigger) {
    if (!backdrop.hidden) return;
    previousActive = fromTrigger || document.activeElement;
    backdrop.hidden = false;
    dialog.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';

    const focusable = getFocusableElements();
    const target = focusable.find(el => el.tagName === 'INPUT' || el.tagName === 'BUTTON') || focusable[0] || dialog;
    target.focus();

    boundKeydown = trapFocus;
    document.addEventListener('keydown', boundKeydown);
  }

  function closeModal() {
    if (backdrop.hidden) return;
    backdrop.hidden = true;
    dialog.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    document.removeEventListener('keydown', boundKeydown);
    boundKeydown = null;

    if (previousActive && typeof previousActive.focus === 'function') {
      previousActive.focus();
    }
  }

  triggers.forEach(trigger => {
    trigger.addEventListener('click', () => openModal(trigger));
  });

  btnClose.addEventListener('click', closeModal);
  btnCancel.addEventListener('click', closeModal);

  backdrop.addEventListener('mousedown', (e) => {
    if (e.target === backdrop) {
      closeModal();
    }
  });

  dialog.addEventListener('mousedown', (e) => {
    e.stopPropagation();
  });

  dialog.addEventListener('focusin', (e) => {
    if (backdrop.hidden) return;
    if (!dialog.contains(e.target)) {
      const focusable = getFocusableElements();
      (focusable[0] || dialog).focus();
    }
  });
})();
</script>
</body>
</html>